---
title: WRF模擬結果的轉接
tags: CAMx WRF wrfcamx
layout: article
aside:
  toc: true
sidebar:
  nav: layouts
---

## 背景
- CAMx可以使用wrf、mm5、rams等多種氣象動力模式的結果。此處介紹WRF結果檔案的轉接(後2者皆已自官網下架，mm5camx在backup目錄下還有[一個v5.1的備份][mm5camx_v5.1]，官網目前只有wrfcamx版本)。
- wrfcamx程式與mm5camx有很高的相似性，差異最大的部分就是wrf_out是nc檔，需要連結netCDF程式庫，和其他CAMx前處理程式的執行方式也很相似，是以一個C shell腳本控制輸入內容，將wrf_out留在腳本的最後段。
- wrfcamx和CMAQ系統的mcip異同條列如下

### 比較CAMx和CMAQ系統的氣象前處理程式

項目|CAMx|CMAQ|說明
-|-|-|-
主程式版本|6+|5+|
前處理程式|wrfcamx|mcip|
版本|5+|5|
垂直層合併|可|不可|CMAQ垂直網格設定需與WRF完全相同
降雨量|不累積|累積|批次時間如不相符，需重新計算累積雨量
水平邊界內縮|>1層|>1層|


## 程式下載編譯
- 因應CAMx輸入檔格式的進版，wrfcamx版本也有所對應，如下表所示：

###  wrfcamx版本與下載點

CAMx版本|重要改變|tuv版本及下載點
-|-|-
v6.3-v7+|改成統一的uamiv格式|[wrfcamx_v4.8.1.14Dec20.tgz](https://camx-wp.azurewebsites.net/getmedia/wrfcamx_v4.8.1.14Dec20.tgz)
v7+|nc格式|[wrfcamx_v5.2.10Jan22.tgz](https://camx-wp.azurewebsites.net/getmedia/wrfcamx_v5.2.10Jan22.tgz)

### 編譯
- 使用Makefile
  - 3種編譯器可供選擇

```bash
FC = pgf90
FLGS = -O2 -Mnoframe -Mextend -Bstatic_pgi

###FC = ifort
###FLGS = -O2 -align dcommons -extend_source -ipo -static_intel

###FC = gfortran
###FLGS = -O2 -fno-align-commons -frecord-marker=4 -ffixed-line-length-0

.SUFFIXES: .o .f90 .F90 .f
```
- 連結netCDF程式庫與內含文件

```bash
LIBS  = -L/usr/local/netcdf/lib
INC   = -I/usr/local/netcdf/include
```

- 如需執行tuvcompr，需另外分別編譯(也有Makefile)

## 執行腳本
- 由於使用C shell環境變數腳本，並沒有設定平行化或多工處理的方式。需循序一一執行。

### 執行選項

環境變數|內容|選項
-|-|-
MECH|化學機制|CB05, CB6, SAPRC07
SCHEME|計算方法|1 = pseudo spherical 2-stream/2 = discrete ordinates(recommended)
RUN_TUVCOMPR|是否執行比較|'YES', 'NO'
number of vert levels|垂直層數|11層或[15層][15]

### tuv.inp 輸入變數內容

變數|內容|範例
-|-|-
program version|程式版本|TUV4.8CAMx7.00
output file name|輸出檔名稱|./$OUTFILE
o3map file name|o3map檔名|../../toms/o3map.20$1.d$DOM
number of vert levels|垂直層數   | 11
levels, km agl|各層離地高Km| 0. 0.15 0.35 0.60 1.00 2.00 3.00 4.00 6.00 8.00 10.0
date (YYMMDD)|日期| $yymmdd
rad transfer scheme|自由基傳輸方式|$SCHEME
num of phot reactions|光化反應數| $RXNUM
TUV reaction #s|光解反應式| $RXLST



### 腳本內容

```bash

```
[mm5camx_v5.1]: <master:/home/backup/users/4139/CAMx/CAMx5.30/mm5camx_v5.1> "master:/home/backup/users/4139/CAMx/CAMx5.30/mm5camx_v5.1"
[15]: <https://www.camx.com/download/support-software/> "num levels, km agl     | .0, .083, .168, .345,.610,.790,.972,1.346,1.676,2.339,3.619,5.525,7.444,12.583,20"
---
title: ncdump應用範例
tags: netCDF
layout: article
aside:
  toc: true
sidebar:
  nav: layouts
date:  2022-07-15 
modify_date: 2022-07-15 13:27:31
---
# 背景
- netCDF是地球科學領域重要的檔案格式。然而因其二進位檔案格式的限制，不方便以文字檔案方式檢閱，[官網](https://www.unidata.ucar.edu/software/netcdf/workshops/2011/utilities/Ncdump.html)提供了ncdump讓使用者可以輕鬆讀取其內容。
- 以下以ioapi協定之內容說明CDF(common data format)的內容順序如表所示，

## CDF的內容順序
項次|名稱|內容|說明
-|-|-|-
1|dimensions|所有變數應用到的維度名稱、長度、是否受限|與檔案結構有關，為表頭的第一組內容
2|variables|按照英文字母的順序將所有變數名稱列表，包括其維度、數據類別(整數、實數、字串、邏輯布林等)、個別屬性如長名稱、內容敘述、單位等等，使用者可以自由增加變數的屬性|表頭的第二組內容，如檔案含有眾多變數(VAR維度的長度很長)，ncdump結果會很長
3|global attributes|全域屬性|有關整體檔案的性質。使用者也可以ncatted來增減修改其內容。其中history的內容是nco程式庫自動產生的，可以從中找到檔案處理的過程，如果是fortran或是python所產生的新檔，不會記錄在其history。
4|data|數據內容，會按前述排序依次印出變數的內容，顯示的維度順序如未指定，為C語言協定方式|內容會非常長，如未妥善引導將會佔據顯示器記憶體。一般會以ncdump -h選項只列出表頭(--head)，以避免出現data部分節省顯示器記憶內容。

## ncdump的應用
### 原則
- 將表頭顯示於螢幕或檔案進行確認
  - 使用`ncdump -h $nc`指令
- 將整個檔案連data數據內容輸出成CDF文字檔案進行後續處理，再以[ncgen](https://sinotec2.github.io/Focus-on-Air-Quality/utilities/netCDF/pncgen/#ncgen)轉成nc檔案。
  - 範例可以詳見鳥哥為公版模式所寫的[run.ocean.sh](https://github.com/sinotec2/Focus-on-Air-Quality/blob/main/GridModels/TWNEPA_RecommCMAQ/run.ocean.sh.TXT)

### 應用範例
- nc檔案的維度：`ncdump -h $nc|head`
- ioapi檔案的起始日期時間：`ncdump -h $nc|grep SDATE;ncdump -h $nc|grep STIME;`
- 特定條件之實數變數名稱：`ncdump -h $nc|grep float|grep DUST`
- 尋找特定全域變數的內容：`ncdump -h $nc|grep NAME_CAMx`
- 列印表頭及特定變數的內容：`ncdump -v CP_NO $nc|M`
- 從nc檔案的歷史紀錄中找到含有ncks的特定文字：`ncdump -h $nc|grep ncks|cut -d/ -f10|cut -d . -f11|cut -c -10`


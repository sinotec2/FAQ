# Thursday, February 9, 2023


## MDN Web Docs

[MDN Web Docs](https://developer.mozilla.org/en-US/about) since 2005, is an open-source, collaborative project documenting Web platform technologies, including CSS, HTML, JavaScript, and Web APIs. We also provide an extensive set of learning resources for beginning developers and students.

## node.js tips

### how to make a server listen to a path in nodejs

- [stackoverflow](https://stackoverflow.com/questions/44939908/how-to-make-a-server-listen-to-a-path-in-nodejs)

```js
    var express = require('express');
    var app = express();
    app.listen('/tmp/sock');
```

```js
var express = require("express"),
    app = express();
 var fs = require('fs');
var port = process.env.PORT || 8000;

app.use(express.static(__dirname + '/public'));
app.get("/login", function (request, response) {
  var request= request.query.body;
    });
app.listen(port);
```

- [official listen](http://expressjs.com/en/api.html#app.listen)

### view layouts

- header, body in ./views/layout.pug
- / in html means: $root_of_node/public
- body block content in ./views/index.pug

###  body-parser

[ Express 與 body-parser](https://ithelp.ithome.com.tw/articles/10241083)

- 包裹法(in app.js)

```js
import express from 'express';
const app =express();
app.use(express.json());
app.listen(3000, () => console.log('http server is running at port 3000.'));
```

- 個別使用法(eg. test.js)

```js
import express from 'express';
const router = express.Router();
router.post('/test', express.json(), (req, res, next) => {
  res.send(JSON.stringify(req.body));
});
export default router;
```

### postman

[curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh](https://www.postman.com/downloads/)
(no use)

### Express: pass variable to main layout

- [stackoverflow](https://stackoverflow.com/questions/34300890/express-pass-variable-to-main-layout)
- [Express Handlebars](https://www.npmjs.com/package/express-handlebars)

### NodeJs Express EJS Layouts and Partials

In general, our websites have more than one layout and often the only area of the website that needs to change drastically is the body. This is where [EJS](https://raddy.dev/blog/nodejs-express-layouts-and-partials/) Layouts come in and help us create projects that are easier to maintain.
- [soarez/express-ejs-layouts](https://github.com/soarez/express-ejs-layouts)

### pug Template Inheritance

[pugjs.org](https://pugjs.org/language/inheritance.html)

### Whats the best view engine for node.js (ejs , jade or handlebars)?

### string concatinate in pug

[stackoverflow](https://stackoverflow.com/questions/56355319/concatenate-a-variable-with-an-id-tag-in-pug)

```js
        - urlH = `${root}?`
        //- urlH = `$#{root} + "?" + #{tauH} + "&" + #{regR} + "&" + #{fcsD} + "&field=";
        div(class="category-wrapper")
          p() FIELDS
        div(class="category-wrapper")
          p() Surface
          ul
            each spName in specs
              - url = `${urlH}${spName}`
              li
                a(href=url) #{spName}
```

### fetch query string parameters and display on pug generated page after form submission

- [stackoverflow](https://stackoverflow.com/questions/49018853/fetch-query-string-parameters-and-display-on-pug-generated-page-after-form-submi)
- pug and html to index.js (title string)
- pug file

```js
 form.create-list(action='/test', method='get')
  fieldset
    legend Add your item
    label(for='item-name') Item: 
    input#name(type='text', name='name', required='')
    br
    label(for='item-name') Quantity: 
    input#quantity(type='text', name='quantity', required='')
    br
    br
    input(type='submit')
```

index.js

```js
router.get('/test/:name', function(req, res, next) {
res.render('layout', {'title': { name : req.query.name }});
});
```

### Dynamic locals unavailable with Pug and Parcel

https://fluid.nccs.nasa.gov/cf/classic_geos_cf/?one_click=1&tau=000&stream=GEOSCFFC&level=0&region=nam&fcst=20230208T120000&field=no2sfc&animate=1

https://www.sinotech-eng.com/tw/
<link rel="shortcut icon" type="image/svg" href="https://www.sinotech-eng.com/assets/front/images/favicon/favicon.svg">
<meta property="og:image" content="http://earth.nullschool.net/preview.jpg">

## pug模板語法

> 如果妳在尋找更靈活的網頁寫法，例如將網頁看成是個樣板，以使用者行為產生的變數，來置換樣板的內容，那這個簡單的pug顯然會對妳有所幫助。

### 背景

- pug是express套件常用的顯示引擎之一。所謂的引擎事實上就是個編譯器，將樣板內容、套用當時前後端整體的變數環境，編譯成最後使用者看到的html檔案(如[wiki: Web_template_system][2]圖示)。

![](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/TempEngWeb016.svg/1200px-TempEngWeb016.svg.png)
- 其他選項還包括了EJS、 handlebar、nunjucks等等引擎，因pug有自己的語法因此被認為是比較困難一點，也因此有較簡潔、直覺的強項、符合高階工程師的期待。
- 目前pug更新到3.0.2版(2021/03)。
- pug應用狀況
  1. 遠端運轉著大量資訊的伺服器，其複雜度不是一般網頁可以消化，需要切換數個(>10[^1])版本的網頁，才能有正確的呈現。
  2. 網頁常常需要維護、更新
  3. 前端使用者的行為不會太複雜
  4. 工程師可以接受以固定空格(tab)來定義從屬關係，即python縮排語法
- pug的中文簡要說明可以參考[前端筆記](https://orandigo.github.io/blog/2020/12/27/20201227-pug-note/)，完整的說明可以詳見官網[pug.org](https://pugjs.org/api/getting-started.html)。英文的互動說明可以參考[LHViet88@2018 Bibooki](https://pughtml.com/what-is-pug-html)
- 典型的index.pug檔案

```python
- var user = {description: 'foo bar baz'}
- var authorised = false
#user
  if user.description
    h2.green Description
    p.description= user.description
  else if authorised
    h2.blue Description
    p.description.
      User has no description,
      why not add one...
  else
    h2.red Description
    p.description User has no description
```

其效果為

```html
<div id="user">
  <h2 class="green">Description</h2>
  <p class="description">foo bar baz</p>
</div>
```

### pug中的變數

- 因為pug是在整體js環境中，除了自己本身宣告的變數之外，也可以取用或改變公用的變數(不必另外宣告)，如以下views/index.pug的片段。
1. 在pug語法中，縮排是有意義的，相同縮排的物件彼此是平形的，差2格縮排表示有上下從屬關係。
2. 在pug中可以接受**部分**js指令，以減號當成前綴。如下列範例宣告了字串(注意合併的方式)、序列等
3. 減號前綴後如果要引用變數(包括pug內臨時宣告、或是經locals公開到程式間可以使用的公用變數)，需加上`${...}`意即環境變數。
4. 在pug語法括號`(...)`內要引用變數，直接寫變數名稱即可，而在括號外部，則需要加上`#{...}`，如`li: a(href=url) #{spName}`

```python
    div(id="menu-container" class="fluid hide_mobile")
      ul(id="menu")
        li: form(action="/" method="POST")
          - var root = "/";
          - var tauH = `tau=${reqT}`;
          - var fcsD = `fcst=${reqF}`;
          - var regR = `region=${reqR}`;
          - var fieD = `field=${reqD}`;
          - var specs = ["O3", "NO2", "CO", "SO2", "PM2.5"];
          - urlH = `${root}?${tauH}&${regR}&${fcsD}&field=`;
          div(class="category-wrapper")
            p() FIELDS
          div(class="category-wrapper")
            p() Surface
            ul
              each spName in specs
                - url = `${urlH}${spName}`
                li: a(href=url) #{spName}
```

- pug變數如何傳回變數?
  - 基本上是透過html上使用者的行為。當使用者點選物件、觸發了post方法，其標籤(action)讓伺服器可以解讀，即傳回了變數的內容。具體而言即為express.Router().get傳回的reqire.query內容。
  - 如html內容：

```html
<form action="/" method="POST">
<form action="/" method="POST" name="control_form" class="animate">
```
- 使用者觸發事件將會回傳一個網址，如layout.pug指定之`url=http://125.229.149.182:3000/?tau=undefined&fcst=undefined&field=O3&region=se_china`，routers/index.js就會將其中的內容記錄成為變數的值，在利用res.render()將其宣告成公用變數，如下：
  - routes/index.js

```js
var express = require('express');
var router = express.Router();

/* GET home page. */
router.get('/', function(req, res, next) {
  res.render('index', { title: 'Composition Forecast Maps ' + req.query.region + req.query.field,
    reqD: req.query.field,
    reqR: req.query.region,
    reqF: req.query.fcst,
    reqT: req.query.tou,
    reqC: req.query.control_form}
  );
});
module.exports = router;
```



[^1]: 林罡北(2018)如果你是常切版的前端工程師-你一定要知道pug, [Medium][1]

[1]: https://northbei.medium.com/如果你是常切版的前端工程師-你一定要知道pug-8b2cbc0a784c "如果你是常切版的前端工程師-你一定要知道pug-8b2cbc0a784c"
[2]: https://en.wikipedia.org/wiki/Web_template_system "Web_template_system"
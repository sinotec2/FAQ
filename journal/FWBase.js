window._RootPath = 'https://1968gis.freeway.gov.tw/';
window._APIPath = 'https://1968gis.freeway.gov.tw/FW_API/'
/*!  cache 23/06/06 12:05:57.990*/
/*! D:\FW_API\scripts\FWBase.js*/
function DeviceTest() {
    var n = navigator.userAgent.toLowerCase();
    return n.indexOf("msie") > 0 && document.all ? "MSIE" : n.indexOf("edge") > 0 ? "Edge" : n.indexOf("firefox") > 0 ? "Firefox" : n.indexOf("chrome") > 0 ? "Chrome" : n.indexOf("safari") > 0 ? "Safari" : n.indexOf("opera") > 0 ? "Opera" : n.indexOf("camino") > 0 ? "Camino" : n.indexOf("gecko") > 0 ? "Gecko" : n.indexOf("trident") > 0 ? "Trident" : n.indexOf("mozilla") > 0 ? "Mozilla" : null
}
function FuncAdapter(n, t) {
    return function(i) {
        return t.call(n, i)
    }
}
function Inherit(n, t) {
    for (var i in t)
        n[i] = t[i]
}
function AttachEvent(n, t, i, r) {
    n.addEventListener ? (t == "mousewheel" && DeviceTest() == "Firefox" && (t = "DOMMouseScroll"),
    t == "keydown" && (r = !0),
    t == "keyup" && (r = !0),
    r ? n.ownerDocument.addEventListener(t, i, r) : n.addEventListener(t, i, r)) : (n.attachEvent("on" + t, i),
    r && n.setCapture())
}
function DetachEvent(n, t, i, r) {
    n.removeEventListener ? (t == "mousewheel" && DeviceTest() == "Firefox" && (t = "DOMMouseScroll"),
    r ? n.ownerDocument.removeEventListener(t, i, r) : n.removeEventListener(t, i, r)) : (n.detachEvent("on" + t, i),
    r && n.releaseCapture())
}
function FireEvent(n, t, i) {
    var u = n.ownerDocument || n.document || null, r;
    u != null && (n.dispatchEvent ? (t == "mousewheel" && DeviceTest() == "Firefox" && (t = "DOMMouseScroll"),
    r = null,
    i != null ? (r = document.createEvent("CustomEvent"),
    r && r.initCustomEvent(t, !1, !1, i)) : (r = u.createEvent("UIEvents"),
    r && r.initEvent(t, !1, !1)),
    r && n.dispatchEvent(r)) : n.fireEvent && (n[t]++,
    r = u.createEventObject(),
    n.fireEvent("on" + t, r)))
}
function createNode(n) {
    var t, i;
    if (n.constructor === String)
        return document.createTextNode(n);
    if (n instanceof Element)
        return n;
    if (t = null,
    t = n.ns ? document.createElementNS(n.ns, n.tag) : document.createElement(n.tag),
    n.attr)
        for (i in n.attr)
            t.setAttribute(i, n.attr[i]);
    if (n.style)
        for (i in n.style)
            t.style[i] = n.style[i];
    if (n.event)
        for (i in n.event)
            t.addEventListener(i, n.event[i]);
    return n.child && (n.child.constructor === Array ? n.child.forEach(function(n) {
        t.appendChild(createNode(n))
    }) : t.appendChild(createNode(n.child))),
    n.parent && createNode(n.parent).appendChild(t),
    n.init && n.init.call(t),
    t
}
function phi4z(n, t, i, r, u, f, e, o, s) {
    for (var c, l, a, h, v, s = f, y = 1; 15 >= y; y++)
        if (c = Math.sin(s),
        a = Math.tan(s),
        o = a * Math.sqrt(1 - n * c * c),
        l = Math.sin(2 * s),
        h = t * s - i * l + r * Math.sin(4 * s) - u * Math.sin(6 * s),
        v = t - 2 * i * Math.cos(2 * s) + 4 * r * Math.cos(4 * s) - 6 * u * Math.cos(6 * s),
        c = 2 * h + o * (h * h + e) - 2 * f * (o * h + 1),
        a = n * l * (h * h + e - 2 * f * h) / (2 * o),
        o = 2 * (f - h) * (o * v - 2 / l) - 2 * v,
        c /= a + o,
        s += c,
        1e-10 >= Math.abs(c))
            return s;
    return Proj4js.reportError("phi4z: No convergence"),
    null
}
function e4fn(n) {
    var t;
    return t = 1 + n,
    n = 1 - n,
    Math.sqrt(Math.pow(t, t) * Math.pow(n, n))
}
function AjaxAgent(n, t, i) {
    var u = this
      , r = null;
    if (window.XMLHttpRequest)
        r = new XMLHttpRequest,
        r.overrideMimeType && r.overrideMimeType("text/xml");
    else if (window.ActiveXObject)
        try {
            r = new ActiveXObject("Msxml2.XMLHTTP")
        } catch (f) {
            try {
                r = new ActiveXObject("Microsoft.XMLHTTP")
            } catch (f) {}
        }
    this.Open = function(n, u) {
        r != null && (r.open(n, u, t),
        i && r.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"))
    }
    ;
    this.SendRequest = function(n, i, f, e, o) {
        function s() {
            f && f.call(u, r, r.status);
            r.status != 200 ? (e && e.call(u, r, r.status),
            bDebug && window.open("").document.write(r.responseText)) : i && i.call(u, r)
        }
        if (r != null) {
            t && (r.onreadystatechange = function() {
                o && o.call(u, r, r.readyState);
                r.readyState == 4 && s()
            }
            );
            try {
                r.send(n)
            } catch (h) {
                return alert(h)
            }
            return t ? null : (t || s(),
            r)
        }
    }
    ;
    n && this.Open("POST", n)
}
function GetXMLChildNode(n, t) {
    var i = FindXMLNodes(n, t);
    return i != null && i.length > 0 ? i.item(0) : null
}
function FindXMLNodes(n, t) {
    return n == null ? null : n.getElementsByTagName(t)
}
function GetXMLNodeText(n) {
    return n == null ? null : n.firstChild ? n.firstChild.nodeValue : ""
}
function GetXMLNodeAttribute(n, t) {
    return n ? n.getAttribute(t) : ""
}
function LoadScript(n, t, i) {
    function o() {
        r.readyState == "loaded" && u()
    }
    function u() {
        e = !0;
        var n = eval(f);
        result = n;
        t.call(null, r, n);
        DetachEvent(r, "readystatechange", o, !1);
        DetachEvent(r, "load", u, !1);
        document.body.removeChild(r)
    }
    var f = "_result_" + i + "_" + nResult, e, r;
    nResult++;
    e = !1;
    r = document.createElement("script");
    AttachEvent(r, "readystatechange", o, !1);
    AttachEvent(r, "load", u, !1);
    document.body.appendChild(r);
    r.type = "text/javascript";
    r.src = n + "&Result=" + f
}
function MapLayer(n, t) {
    function ft(n) {
        var f = null, i = "", c = "", l = 0, h, r, u;
        if (n && (i = GetXMLNodeAttribute(n, "Name"),
        l = parseInt(GetXMLNodeAttribute(n, "FeatureType")),
        c = GetXMLNodeAttribute(n, "SRName")),
        h = i,
        r = FindXMLNodes(GetXMLChildNode(n, "Fields"), "Field"),
        r)
            for (f = [],
            u = 0; u < r.length; u++)
                f.push(GetXMLNodeAttribute(r.item(u), "Name"));
        this.getName = function() {
            return i
        }
        ;
        this.putName = function(n) {
            i = n
        }
        ;
        this.getTitle = function() {
            return h
        }
        ;
        this.putTitle = function(n) {
            h = n
        }
        ;
        this.getFields = function() {
            return f
        }
        ;
        this.getFeatureType = function() {
            return l
        }
        ;
        this.getSRName = function() {
            return c
        }
        ;
        this.ExecuteQuery = function(n, i, r, u) {
            e = new AjaxAgent(t + "/Query",!0,!0);
            e.SendRequest("V=" + o + "&S=" + s.valueOf() + "&Layer=" + escape(this.getName()) + (i ? "&GEOM=" : "&EXPR=") + escape(n), r, null, u)
        }
        ;
        this.ExecuteUpdate = function(n, i, r, u, f) {
            e = new AjaxAgent(t + "/Update",!1,!0);
            e.SendRequest("V=" + o + "&S=" + s.valueOf() + "&Layer=" + escape(this.getName()) + "&ID=" + n + "&GEOM=" + i + "&Values=" + r, u, null, f);
            ot()
        }
        ;
        this.ExecuteDelete = function(n, i, r) {
            e = new AjaxAgent(t + "/Delete",!1,!0);
            e.SendRequest("V=" + o + "&S=" + s.valueOf() + "&Layer=" + escape(this.getName()) + "&ID=" + n, i, null, r);
            ot()
        }
    }
    function ot() {
        o++;
        var n = new AjaxAgent(t,!1,!0);
        n.SendRequest("V=" + o + "&S=" + s.valueOf(), function(n) {
            var i = n.responseXML
              , r = GetXMLChildNode(i.documentElement, "Infomation")
              , t = GetXMLChildNode(r, "Envelope");
            c = parseFloat(GetXMLNodeAttribute(t, "Left"));
            l = parseFloat(GetXMLNodeAttribute(t, "Top"));
            a = parseFloat(GetXMLNodeAttribute(t, "Right"));
            v = parseFloat(GetXMLNodeAttribute(t, "Bottom"));
            y.RebuildElement()
        })
    }
    var y = this, r = null, nt = n, p = n, c = 0, l = 0, a = 1, v = 1, w = !0, tt = 0, it = 0, rt = 0, ut = 0, b = 0, k = 0, d = 0, g = 0, o = 0, s = new Date, i = null, u = [], f = null, h, st, et, e;
    this.getName = function() {
        return nt
    }
    ;
    this.putName = function(n) {
        nt = n
    }
    ;
    this.getTitle = function() {
        return p
    }
    ;
    this.putTitle = function(n) {
        p = n
    }
    ;
    this.getVisible = function() {
        return w
    }
    ;
    this.putVisible = function(n) {
        w = n;
        i && (i.style.visibility = n ? "" : "hidden")
    }
    ;
    this.getResourcePath = function() {
        return t
    }
    ;
    this.getNode = function() {
        return i
    }
    ;
    this.getLeft = function() {
        return c
    }
    ;
    this.getTop = function() {
        return l
    }
    ;
    this.getRight = function() {
        return a
    }
    ;
    this.getBottom = function() {
        return v
    }
    ;
    this.getLayers = function() {
        return u
    }
    ;
    this.getThematicLayer = function() {
        return f
    }
    ;
    this.Initialize = function(n) {
        r = n;
        var t = r.getHObject();
        i = t.ownerDocument.createElement("img");
        t.appendChild(i);
        i.galleryImg = !1;
        i.hideFocus = !0;
        i.style.MozUserSelect = "none";
        i.border = "0px";
        i.style.position = "absolute";
        i.style.width = "100%";
        i.style.height = "100%";
        i.style.visibility = w ? "" : "hidden";
        i.onmousedown = function() {
            return !1
        }
        ;
        i.galleryImg = !1
    }
    ;
    this.RemoveSelf = function() {
        if (i != null) {
            if (r != null) {
                var n = r.getHObject();
                n.removeChild(i)
            }
            i = null
        }
    }
    ;
    this.UpdateElement = function() {
        var n = r.FromMapPoint(tt, it)
          , t = r.FromMapPoint(rt, ut);
        i.style.width = parseInt(Math.abs(t.x - n.x)) + "px";
        i.style.height = parseInt(Math.abs(t.y - n.y)) + "px";
        i.style.left = Math.round(Math.min(n.x, t.x)) + "px";
        i.style.top = Math.round(Math.min(n.y, t.y)) + "px"
    }
    ;
    h = function() {
        (i.readyState == "complete" || i.complete && i.readyState == null) && (DeviceTest() == "MSIE" ? DetachEvent(i, "readystatechange", h, !1) : DetachEvent(i, "load", h, !1),
        tt = b,
        it = k,
        rt = d,
        ut = g,
        y.UpdateElement && y.UpdateElement())
    }
    ;
    this.RebuildElement = function() {
        var n, u, f, e, y;
        this.getVisible() != !1 && ((n = r.FromMapPoint(c, l),
        u = r.FromMapPoint(a, v),
        n.x < 0 ? n.x = 0 : n.x > r.getClientWidth() && (n.x = r.getClientWidth()),
        n.y < 0 ? n.y = 0 : n.y > r.getClientHeight() && (n.y = r.getClientHeight()),
        u.x < 0 ? u.x = 0 : u.x > r.getClientWidth() && (u.x = r.getClientWidth()),
        u.y < 0 ? u.y = 0 : u.y > r.getClientHeight() && (u.y = r.getClientHeight()),
        n.x > u.x || n.y > u.y) || (f = r.ToMapPoint(n.x, n.y),
        e = r.ToMapPoint(u.x, u.y),
        b = f.x,
        k = f.y,
        d = e.x,
        g = e.y,
        nWidth = parseInt(u.x - n.x),
        nHeight = parseInt(u.y - n.y),
        y = "/GetImage?V=" + o + "&S=" + s.valueOf() + "&Width=" + nWidth + "&Height=" + nHeight + "&Left=" + b + "&Top=" + k + "&Right=" + d + "&Bottom=" + g,
        DeviceTest() == "MSIE" ? AttachEvent(i, "readystatechange", h, !1) : AttachEvent(i, "load", h, !1),
        i.src = t + y))
    }
    ;
    st = function(n) {
        var t = n.srcElement ? n.srcElement : n.target;
        t.tagName == "INPUT" && (this.putVisible(t.checked),
        this.RebuildElement())
    }
    ;
    et = function(n, t) {
        f = t
    }
    ;
    this.CreateLegend = function(n) {
        if (u.length > 1)
            for (var t = 0; t < u.length; t++)
                n.CreateSubLegend(u[t], et)
    }
    ;
    this.ExecuteQuery = function(n, t, i, r) {
        if (f != null)
            return f.ExecuteQuery(n, t, i, r)
    }
    ;
    this.ExecuteUpdate = function(n, t, i, r, u) {
        if (f != null)
            return f.ExecuteUpdate(n, t, i, r, u)
    }
    ;
    this.ExecuteDelete = function(n, t, i) {
        if (f != null)
            return f.ExecuteDelete(n, t, i)
    }
    ;
    this.getFeatureType = function() {
        if (f != null)
            return f.getFeatureType()
    }
    ;
    this.getFields = function() {
        if (f != null)
            return f.getFields()
    }
    ;
    u = [];
    e = new AjaxAgent(t,!1,!0);
    e.SendRequest("V=" + o + "&S=" + s.valueOf(), function(n) {
        var e = n.responseXML, f = GetXMLChildNode(e.documentElement, "Infomation"), t = GetXMLChildNode(f, "Envelope"), i, r;
        if (c = parseFloat(GetXMLNodeAttribute(t, "Left")),
        l = parseFloat(GetXMLNodeAttribute(t, "Top")),
        a = parseFloat(GetXMLNodeAttribute(t, "Right")),
        v = parseFloat(GetXMLNodeAttribute(t, "Bottom")),
        i = FindXMLNodes(GetXMLChildNode(f, "Layers"), "Layer"),
        i)
            for (r = 0; r < i.length; r++)
                u.push(new ft(i.item(r)))
    });
    u.length == 0 ? u.push(new ft(null)) : u.length == 1 && (u[0].putName(""),
    u[0].putTitle(p));
    f = u[u.length - 1]
}
function CachedLevelTransformation(n) {
    function h(n) {
        for (var i = 0, r, u, i = 0; i < t.length - 1; i++)
            if (n < t[i + 1])
                break;
        return i < t.length - 1 && (r = t[i],
        u = t[i + 1],
        i += Math.log(n / r) / Math.log(u / r)),
        i
    }
    function s(n) {
        var i = Math.floor(Math.max(0, Math.min(n, t.length - 2)))
          , u = n - i
          , r = t[i]
          , f = t[i + 1];
        return r * Math.pow(f / r, u)
    }
    for (var i, u, r = n.getBaseScaleX(), f = n.getBaseScaleY(), t = [], o = n.getScales(), e = 0; e < o.length; e++)
        t.push(1 / o[e].factor);
    t.reverse();
    i = 0;
    u = 1;
    this.FitLevel = function() {
        this.putMapLevel(Math.round(i))
    }
    ;
    this.getBaseScaleX = function() {
        return r
    }
    ;
    this.putBaseScaleX = function(n) {
        r = n
    }
    ;
    this.getBaseScaleY = function() {
        return f
    }
    ;
    this.putBaseScaleY = function(n) {
        f = n
    }
    ;
    this.getMapMaxLevel = function() {
        return t.length
    }
    ;
    this.getMapLevel = function() {
        return i
    }
    ;
    this.putMapLevel = function(n) {
        if (i == n)
            return !0;
        var r = n > t.length - 1 ? t.length - 1 : n < 0 ? 0 : n;
        return (n >= t.length || n < 0) && i == r ? !1 : (i = r,
        u = s(i),
        !0)
    }
    ;
    this.getScale = function() {
        return r * u
    }
    ;
    this.putScale = function(n) {
        this.putMapLevel(h(n / r))
    }
    ;
    this.getScaleX = function() {
        return r * u
    }
    ;
    this.getScaleY = function() {
        return f * u
    }
    ;
    this.getLevelScale = function(n) {
        return r * s(n)
    }
}
function MapCachedLayer(n, t, r, u, f, e, o) {
    function at() {
        return typeof t == "string" ? t + "/GetCacheConfig?Format=JSON" : "url"in t ? t.url + "/GetResource?ResourceName=" + encodeURIComponent(t.resName) + "&Format=JSON&UserPass=" + encodeURIComponent(t.uPass) : null
    }
    function v(n, t, i) {
        var r = i(n);
        return isNaN(r) ? t : r
    }
    function it(n, r) {
        function k(n, i, u) {
            return typeof t == "string" ? t + "/GetCacheImage?S=" + n + "&X=" + i + "&Y=" + u + "&L=" + r : "url"in t ? t.url + "/GetCacheImage?ResourceName=" + encodeURIComponent(t.resName) + "&ScaleIndex=" + n + "&XIndex=" + i + "&YIndex=" + u + "&LayerIndex=" + r + "&UserPass=" + encodeURIComponent(t.uPass) : null
        }
        function rt(n, t, i, r) {
            for (var s, o = 0; o < e.length; o++)
                if (e[o].isEqual(n.scale, t, i))
                    return;
            if (s = k(r, t, i),
            s) {
                var h = n.ox + t * n.factor * y
                  , c = n.ox + (t + 1) * n.factor * y
                  , l = n.oy + i * n.factor * p
                  , a = n.oy + (i + 1) * n.factor * p;
                e.push(new MapCachedImage(s,f,n.scale,t,i,h,a,c,l,u))
            }
        }
        function ut(n, t, i, r, u) {
            for (var s, f = l[u], e = f.factor * y, o = f.factor * p, a = Math.floor((Math.max(n, d) - f.ox) / e), v = Math.floor((Math.max(r, tt) - f.oy) / o), w = Math.ceil((Math.min(i, nt) - f.ox) / e), b = Math.ceil((Math.min(t, g) - f.oy) / o), k = ((n + i) / 2 - f.ox) / e, it = ((t + r) / 2 - f.oy) / o, c = [], h = v; h < b; h++)
                for (s = a; s < w; s++)
                    c.push({
                        x: s,
                        y: h,
                        left: f.ox + s * e,
                        top: f.oy + (h + 1) * o,
                        d2: Math.pow(s - k, 2) + Math.pow(h - it, 2)
                    });
            return c = c.sort(function(n, t) {
                return n.d2 - t.d2
            }),
            {
                left: a * e + f.ox,
                bottom: v * o + f.oy,
                right: w * e + f.ox,
                top: b * o + f.oy,
                xy: c
            }
        }
        var e = [], o = [], f = null, s = !0, it = null, a = "", w = 0, b = "", v;
        n && (a = n.Name,
        w = parseInt(n.FeatureType),
        b = n.SRName);
        v = a;
        this.getName = function() {
            return a
        }
        ;
        this.putName = function(n) {
            a = n
        }
        ;
        this.getTitle = function() {
            return v
        }
        ;
        this.putTitle = function(n) {
            v = n
        }
        ;
        this.getVisible = function() {
            return s
        }
        ;
        this.putVisible = function(n) {
            s = n;
            f && (f.style.visibility = s ? "" : "hidden")
        }
        ;
        this.getFields = function() {
            return it
        }
        ;
        this.getFeatureType = function() {
            return w
        }
        ;
        this.getSRName = function() {
            return b
        }
        ;
        this.Initialize = function() {
            this.RemoveSelf();
            f = h.ownerDocument.createElement("div");
            h.appendChild(f);
            f.style.position = "absolute";
            f.style.overflow = "hidden";
            f.style.left = "0px";
            f.style.top = "0px";
            f.style.width = "100%";
            f.style.height = "100%";
            f.style.visibility = s ? "" : "hidden"
        }
        ;
        this.RemoveSelf = function() {
            if (e)
                while (e.length > 0)
                    e.pop().RemoveSelf();
            if (o)
                while (o.length > 0)
                    o.pop().RemoveSelf();
            f != null && f.parentNode && (c != null && f.parentNode.removeChild(f),
            f = null)
        }
        ;
        this.MoveTiles = function() {
            var s, r, t, n;
            if (c != null && this.getVisible())
                for (s = [e, o],
                r = 0; r < s.length; r++)
                    for (t = s[r],
                    n = 0; n < t.length; n++) {
                        var i = c.FromMapPoint(t[n].getLeft(), t[n].getTop())
                          , h = c.FromMapPoint(t[n].getRight(), t[n].getBottom())
                          , u = h.x - i.x
                          , f = h.y - i.y;
                        u < 0 && (i.x -= u = -u);
                        f < 0 && (i.y -= f = -f);
                        t[n].ReloadStatus(i.x, i.y, u, f)
                    }
        }
        ;
        this.getTiles = function(n, t, i, r, u) {
            for (var f = o(n, t, i, r, u), s = f.xy, o = [], e = 0; e < f.xy.length; e++)
                o.push({
                    url: k(u, f.xy[e].x, f.xy[e].y),
                    leftTop: [f.xy[e].left, f.xy[e].top]
                });
            return o
        }
        ;
        this.UpdateElement = function() {
            this.RebuildElement()
        }
        ;
        this.RebuildElement = function() {
            var s, r, u, h, p, f, a;
            if (c != null && this.getVisible()) {
                var v = c.ToMapPoint(0, 0)
                  , y = c.ToMapPoint(c.getClientWidth(), c.getClientHeight())
                  , k = c.ToMapDistX(1)
                  , g = c.ToMapDistY(1)
                  , t = 0;
                if (l.length > 0)
                    for (t = 0; t < l.length - 1; t++)
                        if (k < (l[t + 1].factor + l[t].factor) / 2)
                            break;
                for (s = l[t],
                r = ut(v.x, v.y, y.x, y.y, t),
                u = 0; u < r.xy.length; u++)
                    rt(s, r.xy[u].x, r.xy[u].y, t);
                for (h = [],
                p = e.length,
                i = 0; i < p; i++) {
                    var n = e[i]
                      , d = n.getScale()
                      , w = (n.getLeft() + n.getRight()) / 2
                      , b = (n.getTop() + n.getBottom()) / 2;
                    d == s.scale && w < r.left != w < r.right && b < r.top != b < r.bottom ? h.push(n) : n.IsComplete() && n.getStatus() ? o.push(n) : n.RemoveSelf()
                }
                e = h;
                f = this;
                this.MoveTiles();
                a = function() {
                    for (var t = !0, n = 0; n < e.length; n++)
                        if (e[n].IsComplete())
                            t &= e[n].getStatus();
                        else
                            return setTimeout(a, 100);
                    if (t) {
                        while (o.length > 0)
                            o.pop().RemoveSelf();
                        f.loading = !1;
                        FBM.FWEvent.trigger_(f, "loaded")
                    }
                }
                ;
                f.loading = !0;
                setTimeout(a, 100)
            }
        }
    }
    var c = null, rt = n, b = n, k = !0, d = 0, g = 0, nt = 1, tt = 1, y = 256, p = 256, ut = 0, ft = 0, et = 1, ot = 1, l = [], h = null, s = [], a = null, ct = !1, lt = this, st, w, ht;
    LoadScript(at(), function(n, t) {
        var r = t.Infomation || t.Resource && t.Resource.CacheSetting, u, f, h, w, k, rt, st, ht, at, i;
        if (r) {
            if (u = (r.Layers || t.Resource.LayerContent).Layer,
            y = v(r.TileWidth, 256, parseInt),
            p = v(r.TileHeight, 256, parseInt),
            ut = v(r.CornerLeft, 0, parseFloat),
            ft = v(r.CornerLower, 0, parseFloat),
            f = r.Envelope,
            d = v(f.Left, 0, parseFloat),
            g = v(f.Top, 1, parseFloat),
            nt = v(f.Right, 1, parseFloat),
            tt = v(f.Bottom, 0, parseFloat),
            l = [],
            h = r.Scales.Scale,
            h && h.length > 0)
                for (i = 0; i < h.length; i++)
                    w = h[i],
                    k = parseFloat(w),
                    isNaN(k) && (k = parseFloat(w._text || w.Denominator)),
                    rt = parseFloat(w.Factor),
                    isNaN(rt) && (rt = k * .0254 / 96),
                    st = {
                        scale: k,
                        factor: rt,
                        ox: ut,
                        oy: ft
                    },
                    o && (ht = o[i],
                    st.ox = ht.left,
                    st.oy = ht.top),
                    l.push(st);
            if (l.length > 0 && (at = l[l.length - 1],
            et = at.factor * y,
            ot = -at.factor * p),
            u) {
                for (u.length || (u = [u]),
                i = 0; i < u.length; i++)
                    s.push(new it(u[i],i));
                if (s.reverse(),
                c != null)
                    for (i = s.length - 1; i >= 0; i--)
                        s[i].Initialize(c)
            }
            s.length == 0 ? s.push(new it(null)) : s.length == 1 && (s[0].putName(""),
            s[0].putTitle(b));
            a = s[s.length - 1];
            ct = !0;
            lt.RebuildElement();
            e && e.call(this, !0)
        }
    }, f);
    this.getName = function() {
        return rt
    }
    ;
    this.putName = function(n) {
        rt = n
    }
    ;
    this.getTitle = function() {
        return b
    }
    ;
    this.putTitle = function(n) {
        b = n
    }
    ;
    this.getVisible = function() {
        return k
    }
    ;
    this.putVisible = function(n) {
        k = n;
        h && (h.style.visibility = n ? "" : "hidden")
    }
    ;
    this.getResourcePath = function() {
        return typeof t == "string" ? t : t.url
    }
    ;
    this.getLeft = function() {
        return d
    }
    ;
    this.getTop = function() {
        return g
    }
    ;
    this.getRight = function() {
        return nt
    }
    ;
    this.getBottom = function() {
        return tt
    }
    ;
    this.getImageWidth = function() {
        return y
    }
    ;
    this.getImageHeight = function() {
        return p
    }
    ;
    this.getLayers = function() {
        return s
    }
    ;
    this.getThematicLayer = function() {
        return a
    }
    ;
    this.getScales = function() {
        return l
    }
    ;
    this.getBaseScaleX = function() {
        return y / et
    }
    ;
    this.getBaseScaleY = function() {
        return p / ot
    }
    ;
    this.Initialize = function(n) {
        var i, t;
        for (c = n,
        i = c.getHObject(),
        h = i.ownerDocument.createElement("div"),
        i.appendChild(h),
        h.style.position = "absolute",
        h.style.overflow = "hidden",
        h.style.left = "0px",
        h.style.top = "0px",
        h.style.width = "100%",
        h.style.height = "100%",
        h.style.visibility = k ? "" : "hidden",
        this.loading = !1,
        t = s.length - 1; t >= 0; t--)
            s[t].Initialize(n)
    }
    ;
    this.RemoveSelf = function() {
        for (var n = 0; n < s.length; n++)
            s[n].RemoveSelf();
        c = null
    }
    ;
    this.UpdateElement = function() {
        if (this.getVisible())
            for (var n = 0; n < s.length; n++)
                s[n].UpdateElement()
    }
    ;
    this.getTiles = function(n, t, i, r, u, f) {
        if (s[f])
            return s[f].getTiles(n, t, i, r, u)
    }
    ;
    this.RebuildElement = function() {
        var n, t;
        this.getVisible() && (this.loading || (n = s.length,
        n > 0 && (this.loading = !0,
        t = this,
        s.forEach(function(i) {
            FBM.FWEvent.addListenerOnce(i, "loaded", function() {
                n--;
                n == 0 && (t.loading = !1,
                FBM.FWEvent.trigger_(t, "loaded"))
            })
        }))),
        s.forEach(function(n) {
            n.RebuildElement()
        }))
    }
    ;
    st = 0;
    w = 1;
    this.setZIndex = function(n) {
        h && (st = n,
        h.style.zIndex = n)
    }
    ;
    this.setOpacity = function(n) {
        h && (w = n,
        h.style.opacity = w,
        h.style.filter = "alpha(opacity=" + w * 100 + ")")
    }
    ;
    ht = function(n, t) {
        a = t
    }
    ;
    this.CreateLegend = function(n) {
        if (s.length > 1)
            for (var t = 0; t < s.length; t++)
                n.CreateSubLegend(s[t], ht)
    }
    ;
    this.ExecuteQuery = function(n, t, i, r) {
        a != null && a.ExecuteQuery(n, t, i, r)
    }
    ;
    this.getFeatureType = function() {
        if (a != null)
            return a.getFeatureType()
    }
    ;
    this.getFields = function() {
        if (a != null)
            return a.getFields()
    }
    ;
    this.gethLayers = function() {
        return h
    }
    ;
    FBM.RegisterEvent(it, ["loaded", ])
}
function MapCachedImage(n, t, i, r, u, f, e, o, s, h) {
    var c, l, a, v, y, p, w, b, k = !1, d;
    l = i;
    a = r;
    v = u;
    y = f;
    p = e;
    w = o;
    b = s;
    d = n;
    c = t.ownerDocument.createElement("img");
    c.onerror = function() {
        c && (c.alt = "不提供圖磚服務",
        c.onload = null,
        c.onerror = null);
        k = !0
    }
    ;
    c.onmousedown = function() {
        return !1
    }
    ;
    c.onload = function() {
        c && (c.alt = "");
        this.loaded = !0;
        FBM.FWEvent.trigger(h, "tilesloaded")
    }
    ;
    c.galleryImg = !1;
    c.hideFocus = !0;
    c.style.MozUserSelect = "none";
    c.style.border = "0 none";
    c.style.position = "absolute";
    c.src = d;
    t.appendChild(c);
    this.IsComplete = function() {
        return c.loaded || c.readyState == "complete"
    }
    ;
    this.getStatus = function() {
        return !k
    }
    ;
    this.getHObject = function() {
        return c
    }
    ;
    this.getScale = function() {
        return l
    }
    ;
    this.getLeft = function() {
        return y
    }
    ;
    this.getTop = function() {
        return p
    }
    ;
    this.getRight = function() {
        return w
    }
    ;
    this.getBottom = function() {
        return b
    }
    ;
    this.RemoveSelf = function() {
        c && (c.onmousedown = null,
        t.removeChild(c));
        c = null
    }
    ;
    this.ReloadStatus = function(n, t, i, r) {
        var f = n + i, u;
        n = Math.round(n);
        u = t + r;
        t = Math.round(t);
        c.style.left = n + "px";
        c.style.top = t + "px";
        c.style.width = Math.round(f - n) + "px";
        c.style.height = Math.round(u - t) + "px"
    }
    ;
    this.isEqual = function(n, t, i) {
        return l == n && a == t && v == i
    }
}
function CPoint3(n, t, i) {
    return this.X = n,
    this.Y = t,
    this.Z = i,
    this
}
function GeographicTransform(n, t, i, r, u, f, e) {
    function o(n, t) {
        var i = Math.sin(t)
          , r = Math.cos(t);
        return new CPoint3(n.X,r * n.Y + i * n.Z,-i * n.Y + r * n.Z)
    }
    function s(n, t) {
        var i = Math.sin(t)
          , r = Math.cos(t);
        return new CPoint3(r * n.X - i * n.Z,n.Y,i * n.X + r * n.Z)
    }
    function h(n, t) {
        var i = Math.sin(t)
          , r = Math.cos(t);
        return new CPoint3(r * n.X + i * n.Y,-i * n.X + r * n.Y,n.Z)
    }
    return this.BursaWolfTransform = function(c) {
        return c = h(s(o(c, r), u), f),
        new CPoint3(n + (1 + e) * c.X,t + (1 + e) * c.Y,i + (1 + e) * c.Z)
    }
    ,
    this.MolodenskyBadekasTransform = function(o) {
        return new CPoint3(n + e * o.X + (o.X + f * o.Y - u * o.Z),t + e * o.Y + (-f * o.X + o.Y + r * o.Z),i + e * o.Z + (u * o.X - r * o.Y + o.Z))
    }
    ,
    this
}
function HorizontalDatum(n, t) {
    return this.SemiMajorAxis = n,
    this.Flattening = t,
    this.SemiMinorAxis = this.SemiMajorAxis * (1 - this.Flattening),
    this.es = 1 - (1 - this.Flattening) * (1 - this.Flattening),
    this.et2 = this.es / (1 - this.es),
    this
}
function TransverseMercatorProjection(n, t, i, r, u) {
    function f(n, t, i, r) {
        var u, f = 1 - r * (.25 + r * (.046875 + r * (.01953125 + r * .01068115234375))), e = r * (.75 - r * (.046875 + r * (.01953125 + r * .01068115234375))), o = (u = r * r) * (.46875 - r * (.013020833333333334 + r * .007120768229166667)), s = (u *= r) * (.36458333333333331 - r * .005696614583333333), h = u * r * .3076171875;
        return i *= t,
        t *= t,
        f * n - i * (e + t * (o + t * (s + t * h)))
    }
    function e(n, t) {
        for (var o = 1 / (1 - t), i = n, u, r, e = 10; e; --e)
            if (u = Math.sin(i),
            r = 1 - t * u * u,
            i -= r = (f(i, u, Math.cos(i), t) - n) * r * Math.sqrt(r) * o,
            Math.abs(r) < 1e-11)
                return i;
        return i
    }
    function o(n, t) {
        var s = Math.sin(t.Y), e = Math.cos(t.Y), i = Math.abs(e) > 1e-10 ? s / e : 0, o, u;
        i *= i;
        o = e * t.X;
        u = o * o;
        o /= Math.sqrt(1 - n.es * s * s);
        var h = n.et2 * e * e
          , l = o * (1 + u / 6 * (1 - i + h + u / 20 * (5 + i * (i - 18) + h * (14 - 58 * i) + u / 42 * (61 + i * (i * (179 - i) - 479)))))
          , c = r * Math.PI / 180
          , a = f(c, Math.sin(c), Math.cos(c), n.es)
          , v = f(t.Y, s, e, n.es) - a + s * o * t.X / 2 * (1 + u / 12 * (5 - i + h * (9 + 4 * h) + u / 30 * (61 + i * (i - 58) + h * (270 - 330 * i) + u / 56 * (1385 + i * (i * (543 - i) - 3111)))));
        return new CPoint3(l,v,t.Z)
    }
    function s(n, t) {
        var c = r * Math.PI / 180, w = f(c, Math.sin(c), Math.cos(c), n.es), s = e(w + t.Y, n.es), l = Math.PI / 2, o, p;
        if (Math.abs(s) >= l)
            return new CPoint3(0,t.Y < 0 ? -l : l,t.Z);
        var a = Math.sin(s)
          , h = Math.cos(s)
          , i = Math.abs(h) > 1e-10 ? a / h : 0
          , u = n.et2 * h * h
          , v = 1 - n.es * a * a
          , y = t.X * Math.sqrt(v);
        return v *= i,
        i *= i,
        o = y * y,
        s -= v * o / (1 - n.es) / 2 * (1 - o / 12 * (5 + i * (3 - 9 * u) + u * (1 - 4 * u) - o / 30 * (61 + i * (90 - 252 * u + 45 * i) + 46 * u - o / 56 * (1385 + i * (3633 + i * (4095 + 1574 * i)))))),
        p = y * (1 - o / 6 * (1 + 2 * i + u - o / 20 * (5 + i * (28 + 24 * i + 8 * u) + 6 * u - o / 42 * (61 + i * (662 + i * (1320 + 720 * i)))))) / h,
        new CPoint3(p,s,t.Z)
    }
    return this.centralMeridian = n,
    this.falseEasting = t,
    this.falseNorthing = i,
    this.latitudeOfOrigin = r,
    this.scaleFactor = u,
    this.Forward = function(r, f) {
        return f = o(r, CPoint3((f.X - n) * Math.PI / 180, f.Y * Math.PI / 180, f.Z)),
        f.X = f.X * u * r.SemiMajorAxis + t,
        f.Y = f.Y * u * r.SemiMajorAxis + i,
        f
    }
    ,
    this.Inverse = function(r, f) {
        return f = s(r, CPoint3((f.X - t) / r.SemiMajorAxis / u, (f.Y - i) / r.SemiMajorAxis / u, f.Z)),
        f.X = f.X * 180 / Math.PI + n,
        f.Y = f.Y * 180 / Math.PI,
        f
    }
    ,
    this
}
function CoordinateTransform(n, t, i, r, u, f) {
    var e = f;
    return t && (e = t.Inverse(n, e)),
    n && i && n != i && (e = n.CartesianFromGeodetic(e),
    u && (e = u.BursaWolfTransform(e)),
    e = i.GeodeticFromCartesian(e)),
    r && (e = r.Forward(i, e)),
    e
}
function MercatorProjection(n, t, r, u) {
    function o(n, t, i) {
        return t *= i,
        Math.tan(.5 * (f - n)) / Math.pow((1 - t) / (1 + t), .5 * i)
    }
    function s(n, t) {
        var o = .5 * t, r = f - 2 * Math.atan(n), u, e;
        i = 15;
        do
            u = t * Math.sin(r),
            e = f - 2 * Math.atan(n * Math.pow((1 - u) / (1 + u), o)) - r,
            r += e;
        while (Math.abs(e) > 1e-10 && --i);
        return r
    }
    function h(n, t) {
        if (Math.abs(Math.abs(t.Y) - f) <= 1e-10)
            return null;
        var i = t.X
          , r = -Math.log(o(t.Y, Math.sin(t.Y), Math.sqrt(n.es)));
        return new CPoint3(i,r,t.Z)
    }
    function c(n, t) {
        if (Math.abs(Math.abs(t.Y) - f) <= 1e-10)
            return null;
        var i = t.X
          , r = Math.log(Math.tan(e + .5 * t.Y));
        return new CPoint3(i,r,t.Z)
    }
    function l(n, t) {
        var i = s(Math.exp(-t.Y), Math.sqrt(n.es))
          , r = t.X;
        return new CPoint3(r,i,t.Z)
    }
    function a(n, t) {
        var i = f - 2 * Math.atan(Math.exp(-t.Y))
          , r = t.X;
        return new CPoint3(r,i,t.Z)
    }
    this.centralMeridian = n;
    this.falseEasting = t;
    this.falseNorthing = r;
    this.scaleFactor = u;
    this.Forward = function(i, f) {
        var e = CPoint3((f.X - n) * Math.PI / 180, f.Y * Math.PI / 180, f.Z);
        return f = i.es == 0 ? c(i, e) : h(i, e),
        f.X = f.X * u * i.SemiMajorAxis + t,
        f.Y = f.Y * u * i.SemiMajorAxis + r,
        f
    }
    ;
    this.Inverse = function(i, f) {
        var e = CPoint3((f.X - t) / i.SemiMajorAxis / u, (f.Y - r) / i.SemiMajorAxis / u, f.Z);
        return f = i.es == 0 ? a(i, e) : l(i, e),
        f.X = f.X * 180 / Math.PI + n,
        f.Y = f.Y * 180 / Math.PI,
        f
    }
    ;
    var f = Math.PI / 2
      , e = Math.PI / 4;
    return this
}
function ScaleTransformation(n) {
    var t = n
      , i = -n
      , r = 1
      , u = 1;
    this.getBaseScaleX = function() {
        return t
    }
    ;
    this.putBaseScaleX = function(n) {
        t = n
    }
    ;
    this.getBaseScaleY = function() {
        return i
    }
    ;
    this.putBaseScaleY = function(n) {
        i = n
    }
    ;
    this.getScale = function() {
        return t * r
    }
    ;
    this.putScale = function(n) {
        r = n / t;
        u = n / Math.abs(i)
    }
    ;
    this.getScaleX = function() {
        return t * r
    }
    ;
    this.getScaleY = function() {
        return i * u
    }
}
function LevelTransformation(n, t, i) {
    function s(n) {
        return Math.log(n) / Math.LN2
    }
    var u = n
      , o = -n
      , r = t
      , e = Math.pow(2, r)
      , f = i;
    this.FitLevel = function() {
        this.putMapLevel(Math.round(r))
    }
    ;
    this.getBaseScaleX = function() {
        return u
    }
    ;
    this.putBaseScaleX = function(n) {
        u = n
    }
    ;
    this.getBaseScaleY = function() {
        return o
    }
    ;
    this.putBaseScaleY = function(n) {
        o = n
    }
    ;
    this.getMapMaxLevel = function() {
        return f
    }
    ;
    this.putMapMaxLevel = function(n) {
        f = n
    }
    ;
    this.getMapLevel = function() {
        return r
    }
    ;
    this.putMapLevel = function(n) {
        if (r == n)
            return !0;
        var t = n > f - 1 ? f - 1 : n < 0 ? 0 : n;
        return (n >= f || n < 0) && r == t ? !1 : (r = t,
        e = Math.pow(2, r),
        !0)
    }
    ;
    this.getScale = function() {
        return u * e
    }
    ;
    this.putScale = function(n) {
        this.putMapLevel(s(n / u))
    }
    ;
    this.getScaleX = function() {
        return u * e
    }
    ;
    this.getScaleY = function() {
        return o * e
    }
}
function MapBase(n, t) {
    var f, r, i, u, e, s = 0, h = 0, a = 0, v = 0, c = null, o = null, nt, k, d, g;
    i = [];
    nt = 0;
    u = [];
    e = null;
    o = t;
    f = n.ownerDocument.createElement("div");
    n.appendChild(f);
    f.style.position = "absolute";
    f.style.overflow = "hidden";
    f.style.left = "0px";
    f.style.top = "0px";
    f.style.width = "100%";
    f.style.height = "100%";
    f.style.zIndex = 0;
    r = f.ownerDocument.createElement("div");
    f.appendChild(r);
    r.style.position = "absolute";
    r.style.left = "0px";
    r.style.top = "0px";
    r.style.width = "100%";
    r.style.height = "100%";
    r.style.zIndex = 0;
    s = Number(r.clientWidth);
    h = Number(r.clientHeight);
    d = FuncAdapter(this, function() {
        (s != Number(r.clientWidth) || h != Number(r.clientHeight)) && (s = Number(r.clientWidth),
        h = Number(r.clientHeight),
        k && clearTimeout(k),
        k = setTimeout(FuncAdapter(this, function() {
            this.RefreshMap(!0, !0)
        }), 1e3),
        c = null,
        this.RefreshMap(!1, !1))
    });
    AttachEvent(r, "resize", d, !1);
    this.setColor = function(n) {
        r.style.background = n
    }
    ;
    this.FinalRelease = function() {
        this.SelectMapTool(null);
        this.RemoveAllElements();
        DetachEvent(r, "resize", d, !1);
        f.parentNode.removeChild(f)
    }
    ;
    this.getHObject = function() {
        return r
    }
    ;
    this.getHPackage = function() {
        return f
    }
    ;
    this.getClientWidth = function() {
        return s
    }
    ;
    this.getClientHeight = function() {
        return h
    }
    ;
    this.getCenterX = function() {
        return a
    }
    ;
    this.putCenterX = function(n) {
        a = n
    }
    ;
    this.getCenterY = function() {
        return v
    }
    ;
    this.putCenterY = function(n) {
        v = n
    }
    ;
    this.getTransformation = function() {
        return o
    }
    ;
    this.putScale = function(n) {
        o = n
    }
    ;
    this.getScale = function() {
        return o.getScale()
    }
    ;
    this.putScale = function(n) {
        o.putScale(n)
    }
    ;
    this.getCellSizeX = function() {
        return this.ToMapDistX(1)
    }
    ;
    this.getCellSizeY = function() {
        return this.ToMapDistY(1)
    }
    ;
    this.MoveMapTo = function(n, t) {
        this.putCenterX(n);
        this.putCenterY(t)
    }
    ;
    this.ZoomMapTo = function(n) {
        if (n.left != null && n.top != null && n.right != null && n.bottom != null) {
            this.MoveMapTo((n.right + n.left) / 2, (n.bottom + n.top) / 2);
            var t = s / (n.right - n.left)
              , i = h / (n.bottom - n.top);
            this.putScale(Math.min(Math.abs(t), Math.abs(i)))
        }
    }
    ;
    this.getPackageOffset = function() {
        var i = f, n, t;
        return c || (c = i.getBoundingClientRect()),
        n = c.left,
        t = c.top,
        new FBM.FWPoint(n,t)
    }
    ;
    this.getCursorPosition = function(n) {
        if (n == null)
            return null;
        var t = this.getPackageOffset();
        return new FBM.FWPoint(n.clientX - t.x,n.clientY - t.y)
    }
    ;
    this.ToMapPoint = function(n, t) {
        return new FBM.FWPoint(this.ToMapDistX(n - s / 2) + a,this.ToMapDistY(t - h / 2) + v)
    }
    ;
    this.FromMapPoint = function(n, t) {
        return new FBM.FWPoint(this.FromMapDistX(n - a) + s / 2,this.FromMapDistY(t - v) + h / 2)
    }
    ;
    this.ToMapDistX = function(n) {
        return n / o.getScaleX()
    }
    ;
    this.ToMapDistY = function(n) {
        return n / o.getScaleY()
    }
    ;
    this.FromMapDistX = function(n) {
        return n * o.getScaleX()
    }
    ;
    this.FromMapDistY = function(n) {
        return n * o.getScaleY()
    }
    ;
    this.SelectMapTool = function(n) {
        if (n) {
            if (n.InitMapEvent)
                return e && e.ExitMapEvent && e.ExitMapEvent(),
                n.InitMapEvent(this),
                e = n,
                !0
        } else
            e && e.ExitMapEvent && (e.ExitMapEvent(),
            e = null);
        return !1
    }
    ;
    this.getLayers = function() {
        return i
    }
    ;
    this.AddLayer = function(n) {
        n != null && (n.Initialize && n.Initialize(this),
        i.push(n))
    }
    ;
    this.RemoveLayer = function(n) {
        for (var r = i.length, t = 0; t < r; t++)
            if (i[t] == n) {
                i.splice(t, 1);
                break
            }
        n.RemoveSelf && n.RemoveSelf()
    }
    ;
    this.RemoveAllLayers = function() {
        for (var t = i.length, n = 0; n < t; n++)
            i[n].RemoveSelf && i[n].RemoveSelf();
        i = []
    }
    ;
    this.getElements = function() {
        return u
    }
    ;
    this.AddElement = function(n) {
        n.Initialize && n.Initialize(this);
        u.push(n)
    }
    ;
    this.RemoveElement = function(n) {
        for (var i = u.length, t = 0; t < i; t++)
            if (u[t] == n) {
                u.splice(t, 1);
                break
            }
        n.RemoveSelf && n.RemoveSelf()
    }
    ;
    this.RemoveAllElements = function() {
        for (var t = u.length, n = 0; n < t; n++)
            u[n].RemoveSelf && u[n].RemoveSelf();
        u = []
    }
    ;
    this.getExtent = function() {
        for (var n, t = null, r = null, u = null, f = null, e = 0; e < i.length; e++)
            n = i[e],
            n.getLeft && (t == null || this.FromMapDistX(t) > this.FromMapDistX(n.getLeft())) && (t = n.getLeft()),
            n.getTop && (r == null || this.FromMapDistY(r) > this.FromMapDistY(n.getTop())) && (r = n.getTop()),
            n.getRight && (u == null || this.FromMapDistX(u) < this.FromMapDistX(n.getRight())) && (u = n.getRight()),
            n.getBottom && (f == null || this.FromMapDistY(f) < this.FromMapDistY(n.getBottom())) && (f = n.getBottom());
        return new FBM.FWEnvelope(t,r,u,f)
    }
    ;
    this.RefreshMap = function(n) {
        var r, t;
        if (l = !0,
        i && i.length > 0) {
            if (r = i.length,
            n)
                for (t = 0; t < r; t++)
                    i[t].RebuildElement && i[t].RebuildElement();
            for (t = 0; t < r; t++)
                i[t].UpdateElement && i[t].UpdateElement(1)
        }
        if (u && u.length > 0) {
            if (r = u.length,
            n)
                for (t = 0; t < r; t++)
                    u[t].RebuildElement && u[t].RebuildElement();
            for (t = 0; t < r; t++)
                u[t].UpdateElement && u[t].UpdateElement(1)
        }
    }
    ;
    var y = null
      , l = !1
      , p = null
      , w = null
      , b = null;
    this.MoveToAnimation = function(n, t, i) {
        if (l = !1,
        p = n.x,
        w = n.y,
        b = t,
        y == null) {
            var r = function() {
                if (l) {
                    y = null;
                    i && i();
                    return
                }
                var t = this.getCenterX()
                  , u = this.getCenterY()
                  , n = this.getScale();
                if ((this.FromMapDistX(Math.abs(t - p)) >= 5 || this.FromMapDistY(Math.abs(u - w)) >= 5 || Math.abs(Math.log(n / b)) >= .03125) && (this.putScale(2 / (1 / n + 1 / b)),
                n != this.getScale())) {
                    this.MoveMapTo((t + p) / 2, (u + w) / 2);
                    this.RefreshMap(!1, !0);
                    l = !1;
                    y = setTimeout(FuncAdapter(this, r), 100);
                    return
                }
                this.putScale(b);
                this.MoveMapTo(p, w);
                this.RefreshMap(!0, !0);
                l = !1;
                y = null;
                i && i()
            };
            r.call(this)
        }
    }
    ;
    this.getExtendedClientRect = function() {
        var r = FBM.math.length(this.getClientWidth(), this.getClientHeight())
          , n = r / 2
          , t = this.getClientWidth() / 2
          , i = this.getClientHeight() / 2;
        return {
            xmin: t - n,
            ymin: i - n,
            xmax: t + n,
            ymax: i + n
        }
    }
    ;
    this.getExtendedViewport = function() {
        var n = this.getExtendedClientRect()
          , t = this.ToMapPoint(n.xmin, n.ymin)
          , i = this.ToMapPoint(n.xmax, n.ymax);
        return {
            xmin: t.x,
            ymin: i.y,
            xmax: i.x,
            ymax: t.y
        }
    }
    ;
    this.getTileViewport = function() {
        var n = Math.floor(Math.abs(this.getAngle()) % 90)
          , e = FBM.math.length(this.getClientWidth(), this.getClientHeight()) / 2
          , t = e
          , i = (t - this.getClientWidth() / 2) * (n / 90)
          , r = (t - this.getClientHeight() / 2) * (n / 90)
          , u = this.ToMapPoint(0 - i, 0 - r)
          , f = this.ToMapPoint(this.getClientWidth() + i, this.getClientHeight() + r);
        return {
            xmin: u.x,
            ymin: f.y,
            xmax: f.x,
            ymax: u.y
        }
    }
    ;
    g = 0;
    this.getAngle = function() {
        return g
    }
}
function MapPoint(n, t) {
    this.x = n;
    this.y = t;
    this.Diff = function(n) {
        return n.constructor != FBM.FWPoint ? this : new FBM.FWPoint(this.x - n.x,this.y - n.y)
    }
    ;
    this.Plus = function(n) {
        return n.constructor != FBM.FWPoint ? this : new FBM.FWPoint(this.x + n.x,this.y + n.y)
    }
    ;
    this.toString = function() {
        return this.x + " " + this.y
    }
}
function MapEnvelope(n, t, i, r) {
    this.Left = n;
    this.Top = t;
    this.Right = i;
    this.Bottom = r;
    this.Extend = function(n) {
        n.constructor == FBM.FWEnvelope && (n.Left && (this.Left == null || this.Left > n.Left == this.Right > this.Left) && (this.Left = n.Left),
        n.Top && (this.Top == null || this.Top < n.Top == this.Bottom < this.Top) && (this.Top = n.Top),
        n.Right && (this.Right == null || this.Right < n.Right == this.Left < this.Right) && (this.Right = n.Right),
        n.Bottom && (this.Bottom == null || this.Bottom > n.Bottom == this.Top > this.Bottom) && (this.Bottom = n.Bottom))
    }
    ;
    this.Shrink = function(n) {
        n.constructor == FBM.FWEnvelope && (n.Left && (this.Left == null || this.Left < n.Left == this.Right > this.Left) && (this.Left = n.Left),
        n.Top && (this.Top == null || this.Top > n.Top == this.Bottom < this.Top) && (this.Top = n.Top),
        n.Right && (this.Right == null || this.Right > n.Right == this.Left < this.Right) && (this.Right = n.Right),
        n.Bottom && (this.Bottom == null || this.Bottom < n.Bottom == this.Top > this.Bottom) && (this.Bottom = n.Bottom))
    }
    ;
    this.toString = function() {
        return Math.min(this.Left, this.Right) + " " + Math.min(this.Top, this.Bottom) + "," + Math.max(this.Left, this.Right) + " " + Math.max(this.Top, this.Bottom)
    }
}
function Overview(n, t, i, r, u, f) {
    function w(n, t) {
        var r, u, i = !1;
        this.ExitMapEvent = null;
        this.IsMapAction = function() {
            return i
        }
        ;
        this.InitMapEvent = function(f) {
            var e = f.getHObject()
              , o = function(n) {
                var t = n.screenX - r
                  , i = n.screenY - u;
                r = n.screenX;
                u = n.screenY;
                f.MoveMapTo(f.getCenterX() - f.ToMapDistX(t), f.getCenterY() - f.ToMapDistY(i));
                f.RefreshMap(!1)
            }
              , s = function() {
                DetachEvent(e, "mousemove", o, !0);
                DetachEvent(e, "mouseup", s, !1);
                f.RefreshMap(!0);
                i = !1
            }
              , h = function(n) {
                util.disableDefault(n);
                i = !0;
                r = n.screenX;
                u = n.screenY;
                AttachEvent(e, "mouseup", s, !1);
                AttachEvent(e, "mousemove", o, !0)
            }
              , c = function(t) {
                if (n) {
                    i = !0;
                    var r = f.getCursorPosition(t)
                      , u = f.ToMapPoint(r.X, r.Y);
                    f.MoveToAnimation(u, f.getScale(), function() {
                        i = !1
                    })
                }
            }
              , l = function(n) {
                var e, u;
                if (t) {
                    i = !0;
                    var h = f.getCursorPosition(n)
                      , r = f.ToMapPoint(h.X, h.Y)
                      , s = f.getScale()
                      , c = n.wheelDelta ? n.wheelDelta : -n.detail
                      , o = 0;
                    c > 0 ? o = 1 : c < 0 && (o = -1);
                    e = 1;
                    u = f.getTransformation();
                    e = u != null && u.getLevelScale != null && u.getMapLevel != null ? u.getLevelScale(u.getMapLevel() + o) / s : Math.pow(2, o);
                    s *= e;
                    r = new MapPoint((f.getCenterX() - r.X) / e + r.X,(f.getCenterY() - r.Y) / e + r.Y);
                    f.MoveToAnimation(r, s, function() {
                        i = !1
                    })
                }
            };
            this.ExitMapEvent = function() {
                t && DetachEvent(e.ownerDocument, "mousewheel", l, !1);
                DetachEvent(e, "mousedown", h, !1);
                n && DetachEvent(e, "dblclick", c, !1)
            }
            ;
            AttachEvent(e, "mousedown", h, !1);
            n && AttachEvent(e, "dblclick", c, !1);
            t && AttachEvent(e.ownerDocument, "mousewheel", l, !1)
        }
    }
    function p(t) {
        switch (t) {
        case "Open":
            n.style.width = r + "px";
            n.style.height = u + "px";
            n.style.border = "2px solid";
            e.style.width = r + "px";
            e.style.height = u + "px";
            o.alt = "Open";
            o.src = FBM.RES_PATH + "ShowClose.gif";
            o.status = !0;
            break;
        case "Close":
            n.style.width = "11px";
            n.style.height = "11px";
            n.style.border = "0px";
            e.style.width = "11px";
            e.style.height = "11px";
            o.alt = "Open";
            o.src = FBM.RES_PATH + "ShowOpen.gif";
            o.status = !1
        }
    }
    function b(n) {
        var i = n.getTarget(), r = n.getMapBase(), e = !1, f = new w(!1,!1), h = r.getHPackage(), t = document.createElement("div"), u;
        h.appendChild(t);
        t.style.position = "absolute";
        t.style.overflow = "hidden";
        t.style.width = "40px";
        t.style.height = "40px";
        t.style.left = "15px";
        t.style.top = "15px";
        t.style.border = "inset 1px #0300FA";
        u = t.ownerDocument.createElement("div");
        t.appendChild(u);
        u.style.filter = "Alpha(Opacity=35)";
        u.style.opacity = .35;
        u.style.MozOpacity = .35;
        u.style.MozUserSelect = "none";
        u.style.backgroundColor = "#5e38ff";
        u.style.width = "100%";
        u.style.height = "100%";
        var o, s, l = function(n) {
            var t = n.screenX - o
              , u = n.screenY - s;
            o = n.screenX;
            s = n.screenY;
            i.MoveMapTo(i.getCenterX() + r.ToMapDistX(t), i.getCenterY() + r.ToMapDistY(u));
            i.RefreshMap(!1)
        }, a = function() {
            t.style.cursor = "default";
            DetachEvent(t, "mousemove", l, !0);
            DetachEvent(t, "mouseup", a, !1);
            i.RefreshMap(!0)
        }, y = function(n) {
            util.disableDefault(n);
            o = n.screenX;
            s = n.screenY;
            t.style.cursor = "move";
            AttachEvent(t, "mousemove", l, !0);
            AttachEvent(t, "mouseup", a, !1)
        };
        AttachEvent(t, "mousedown", y, !1);
        r.SelectMapTool(f);
        r.AddElement(this);
        this.FinalRelease = function() {
            r.RemoveElement(this);
            DetachEvent(t, "mousedown", y, !1);
            f && f.FinalRelease && f.FinalRelease();
            f = null;
            t && h.removeChild(t);
            t = null
        }
        ;
        this.UpdateElement = function() {
            if (f.IsMapAction()) {
                if (e)
                    return;
                e = !0;
                c.x = parseInt(t.style.left) + parseInt(t.style.width) / 2;
                c.y = parseInt(t.style.top) + parseInt(t.style.height) / 2;
                n = r.ToMapPoint(c.x, c.y);
                i.MoveMapTo(n.x, n.y);
                i.RefreshMap(!1);
                e = !1
            } else {
                var n = i.ToMapPoint(0, 0)
                  , u = i.ToMapPoint(i.getClientWidth(), i.getClientHeight());
                c = r.FromMapPoint(n.x, n.y);
                v = r.FromMapPoint(u.x, u.y);
                c.x && c.y && v.x && v.y && (t.style.left = c.x + "px",
                t.style.top = c.y + "px",
                t.style.width = v.x - c.x + "px",
                t.style.height = v.y - c.y + "px")
            }
        }
        ;
        this.RebuildElement = function() {
            if (f.IsMapAction()) {
                if (e)
                    return;
                e = !0;
                i.RefreshMap(!0);
                e = !1
            }
        }
    }
    var e = null, s = null, h = null, l = null, o, c = null, v = null, y, a;
    this.Show = function(t) {
        t ? (n.style.display = "inline",
        p("Open")) : n.style.display = "none"
    }
    ;
    this.Minimize = function() {
        p("Close")
    }
    ;
    this.FinalRelease = function() {
        t.RemoveElement(this);
        l && l.FinalRelease && l.FinalRelease();
        l = null;
        h && h.FinalRelease && h && h.FinalRelease && h.FinalRelease();
        h = null;
        s && n.removeChild(s);
        s = null
    }
    ;
    this.CenterXY = function() {
        return new MapPoint(h.getCenterX(),h.getCenterY())
    }
    ;
    this.SelectAreaHide = function() {
        m_IndexObj.style.visibility = "hidden"
    }
    ;
    this.SelectAreaShow = function() {
        m_IndexObj.style.visibility = "visible"
    }
    ;
    this.getTarget = function() {
        return t
    }
    ;
    this.getMapBase = function() {
        return h
    }
    ;
    this.UpdateElement = function() {
        l.UpdateElement()
    }
    ;
    this.RebuildElement = function() {
        if (l != null && l.RebuildElement(),
        h != null) {
            var n = t.getScale() / Math.pow(2, f);
            h.MoveToAnimation(new MapPoint(t.getCenterX(),t.getCenterY()), n)
        }
    }
    ;
    y = new ScaleTransformation(1);
    y.putBaseScaleX(i.getBaseScaleX());
    y.putBaseScaleY(i.getBaseScaleY());
    e = document.createElement("div");
    n.appendChild(e);
    e.style.position = "absolute";
    e.style.right = "0px";
    e.style.bottom = "0px";
    this.setColor = function(n) {
        e.style.backgroundColor = n
    }
    ;
    e.style.width = r - 10 + "px";
    e.style.height = u - 10 + "px";
    e.style.overflow = "hidden";
    s = document.createElement("div");
    e.appendChild(s);
    s.style.position = "absolute";
    s.style.overflow = "hidden";
    s.style.right = "0px";
    s.style.bottom = "0px";
    s.style.width = r + "px";
    s.style.height = u + "px";
    o = e.ownerDocument.createElement("img");
    o.onreadystatechange = function() {
        s.style.right = o.offsetWidth - 10 + "px";
        s.style.width = r + "px";
        s.style.height = u + "px";
        o.onstatechange = null
    }
    ;
    e.appendChild(o);
    o.style.position = "absolute";
    o.style.right = "0px";
    o.style.bottom = "0px";
    o.status = !0;
    o.alt = "Close";
    o.style.cursor = "pointer";
    a = null;
    this.setStyle = function() {
        var t = function(i, r) {
            divright = parseInt(e.style.width);
            divbottom = parseInt(e.style.height);
            divXOffset = i - divright;
            divYOffset = r - divbottom;
            Math.abs(divXOffset) < 10 || Math.abs(divYOffset) < 10 ? (n.style.width = i + 10 + "px",
            n.style.height = r + 10 + "px",
            e.style.width = i + "px",
            e.style.height = r + "px",
            a = null,
            o.status && (n.style.width = i + "px",
            n.style.height = r + "px",
            e.style.width = i - 10 + "px",
            e.style.height = r - 10 + "px")) : (n.style.width = divright + divXOffset / 2 + 10 + "px",
            n.style.height = divbottom + divYOffset / 2 + 10 + "px",
            e.style.width = divright + divXOffset / 2 + "px",
            e.style.height = divbottom + divYOffset / 2 + "px",
            a = setTimeout(function() {
                t(i, r)
            }, 50))
        }
    }
    ;
    o.onclick = function() {
        var t = function(i, r) {
            var u = parseInt(e.style.width)
              , f = parseInt(e.style.height)
              , s = i - u
              , h = r - f;
            Math.abs(s) < 10 || Math.abs(h) < 10 ? (n.style.width = i + "px",
            n.style.height = r + "px",
            e.style.width = i + "px",
            e.style.height = r + "px",
            n.style.border = "0px",
            a = null,
            o.status && (n.style.border = "2px solid",
            n.style.width = i + "px",
            n.style.height = r + "px",
            e.style.width = i + "px",
            e.style.height = r + "px")) : (n.style.width = u + s / 2 + "px",
            n.style.height = f + h / 2 + "px",
            e.style.width = u + s / 2 + "px",
            e.style.height = f + h / 2 + "px",
            a = setTimeout(function() {
                t(i, r)
            }, 50))
        };
        a != null && clearTimeout(a);
        a = null;
        (o.status = !o.status) ? (o.alt = "Close",
        o.src = FBM.RES_PATH + "ShowClose.gif",
        t(r, u)) : (o.alt = "Open",
        o.src = FBM.RES_PATH + "ShowOpen.gif",
        n.style.border = "2px solid",
        t(parseInt(o.offsetWidth), parseInt(o.offsetHeight)))
    }
    ;
    h = new MapBase(s,y,"0px","0px","100%","100%");
    h.MoveMapTo(t.getCenterX(), t.getCenterY());
    h.RefreshMap(!0);
    l = new b(this);
    t.AddElement(this);
    this.RebuildElement()
}
function initControlArray(n) {
    var t = n.controls
      , u = function() {
        i.BOTTOM_CENTER_update.call(t.BOTTOM_CENTER);
        i.BOTTOM_LEFT_update.call(t.BOTTOM_LEFT);
        i.BOTTOM_RIGHT_update.call(t.BOTTOM_RIGHT);
        i.LEFT_BOTTOM_update.call(t.LEFT_BOTTOM);
        i.LEFT_CENTER_update.call(t.LEFT_CENTER);
        i.LEFT_TOP_update.call(t.LEFT_TOP);
        i.RIGHT_BOTTOM_update.call(t.RIGHT_BOTTOM);
        i.RIGHT_CENTER_update.call(t.RIGHT_CENTER);
        i.RIGHT_TOP_update.call(t.RIGHT_TOP);
        i.TOP_CENTER_update.call(t.TOP_CENTER);
        i.TOP_LEFT_update.call(t.TOP_LEFT);
        i.TOP_RIGHT_update.call(t.TOP_RIGHT)
    }
      , i = {
        BOTTOM_CENTER_update: function() {
            var r = 0
              , i = 0;
            t.BOTTOM_CENTER.forEach(function(t) {
                var u = parseInt(t.clientWidth, 10)
                  , f = parseInt(t.clientHeight, 10)
                  , e = n.getMapSize().width / 2 - u / 2 >= 0 ? n.getMapSize().width / 2 - u / 2 : 0;
                r += u;
                i = Math.max(i, f);
                t.style.right = "auto";
                t.style.left = e + "px";
                t.style.top = "auto";
                t.style.bottom = "0px"
            });
            t.BOTTOM_CENTER.totalWidth = r;
            t.BOTTOM_CENTER.totalHeight = i
        },
        BOTTOM_LEFT_update: function() {
            var n = 0
              , i = 0;
            t.BOTTOM_LEFT.forEach(function(t) {
                var r = parseInt(t.scrollWidth, 10)
                  , u = parseInt(t.scrollHeight, 10);
                n += r;
                i = Math.max(i, u);
                t.style.right = "auto";
                t.style.left = n - r + "px";
                t.style.top = "auto";
                t.style.bottom = "0px"
            });
            t.BOTTOM_LEFT.totalWidth = n;
            t.BOTTOM_LEFT.totalHeight = i
        },
        BOTTOM_RIGHT_update: function() {
            var n = 0
              , i = 0;
            t.BOTTOM_RIGHT.forEach(function(t) {
                var r = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                n += r;
                i = Math.max(i, u);
                t.style.left = "auto";
                t.style.right = n - r + "px";
                t.style.top = "auto";
                t.style.bottom = "0px"
            });
            t.BOTTOM_RIGHT.totalWidth = n;
            t.BOTTOM_RIGHT.totalHeight = i
        },
        TOP_LEFT_update: function() {
            var n = 0
              , i = 0;
            t.TOP_LEFT.forEach(function(t) {
                var r = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                n += r;
                i = Math.max(i, u);
                t.style.right = "auto";
                t.style.left = n - r + "px";
                t.style.bottom = "auto";
                t.style.top = "0px"
            });
            t.TOP_LEFT.totalWidth = n;
            t.TOP_LEFT.totalHeight = i
        },
        TOP_CENTER_update: function() {
            var r = 0
              , i = 0;
            t.TOP_CENTER.forEach(function(t) {
                var u = parseInt(t.clientWidth, 10)
                  , f = parseInt(t.clientHeight, 10)
                  , e = n.getMapSize().width / 2 - u / 2 >= 0 ? n.getMapSize().width / 2 - u / 2 : 0;
                r += u;
                i = Math.max(i, f);
                t.style.right = "auto";
                t.style.left = e + "px";
                t.style.bottom = "auto";
                t.style.top = "0px"
            });
            t.TOP_CENTER.totalWidth = r;
            t.TOP_CENTER.totalHeight = i
        },
        TOP_RIGHT_update: function() {
            var n = 0
              , i = 0;
            t.TOP_RIGHT.forEach(function(t) {
                var r = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                n += r;
                i = Math.max(i, u);
                t.style.left = "auto";
                t.style.right = n - r + "px";
                t.style.bottom = "auto";
                t.style.top = "0px"
            });
            t.TOP_RIGHT.totalWidth = n;
            t.TOP_RIGHT.totalHeight = i
        },
        LEFT_TOP_update: function() {
            var i = 0
              , n = 0
              , r = 0;
            t.TOP_LEFT.getLength() > 0 && (r = parseInt(t.TOP_LEFT.totalHeight));
            t.LEFT_TOP.forEach(function(t) {
                var f = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                i += f;
                n += u;
                t.style.bottom = "auto";
                t.style.right = "auto";
                t.style.left = "0px";
                t.style.top = n - u + r + "px"
            });
            t.LEFT_TOP.totalWidth = i;
            t.LEFT_TOP.totalHeight = n
        },
        LEFT_CENTER_update: function() {
            var i = 0
              , r = 0;
            t.LEFT_CENTER.forEach(function(t) {
                var e = parseInt(t.clientWidth, 10), u = parseInt(t.clientHeight, 10), f;
                i += e;
                r += u;
                f = n.getMapSize().height / 2 - u / 2 >= 0 ? n.getMapSize().height / 2 - u / 2 : 0;
                t.style.bottom = "auto";
                t.style.right = "auto";
                t.style.left = "0px";
                t.style.top = f + "px"
            });
            t.LEFT_CENTER.totalWidth = i;
            t.LEFT_CENTER.totalHeight = r
        },
        LEFT_BOTTOM_update: function() {
            var i = 0
              , n = 0
              , r = 0;
            t.BOTTOM_LEFT.getLength() > 0 && (r = parseInt(t.BOTTOM_LEFT.totalHeight));
            t.LEFT_BOTTOM.forEach(function(t) {
                var f = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                i += f;
                n += u;
                t.style.top = "auto";
                t.style.right = "auto";
                t.style.left = "0px";
                t.style.bottom = r + n - u + "px"
            });
            t.LEFT_BOTTOM.totalWidth = i;
            t.LEFT_BOTTOM.totalHeight = n
        },
        RIGHT_TOP_update: function() {
            var i = 0
              , n = 0
              , r = 0;
            t.TOP_RIGHT.getLength() > 0 && (r = parseInt(t.TOP_RIGHT.totalHeight));
            t.RIGHT_TOP.forEach(function(t) {
                var f = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                i += f;
                n += u;
                t.style.bottom = "auto";
                t.style.left = "auto";
                t.style.right = "0px";
                t.style.top = r + n - u + "px"
            });
            t.RIGHT_TOP.totalWidth = i;
            t.RIGHT_TOP.totalHeight = n
        },
        RIGHT_CENTER_update: function() {
            var i = 0
              , r = 0;
            t.RIGHT_CENTER.forEach(function(t) {
                var f = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10)
                  , e = n.getMapSize().height / 2 - u / 2 >= 0 ? n.getMapSize().height / 2 - u / 2 : 0;
                i += f;
                r += u;
                t.style.bottom = "auto";
                t.style.left = "auto";
                t.style.right = "0px";
                t.style.top = e + "px"
            });
            t.RIGHT_CENTER.totalWidth = i;
            t.RIGHT_CENTER.totalHeight = r
        },
        RIGHT_BOTTOM_update: function() {
            var i = 0
              , n = 0
              , r = 0;
            t.BOTTOM_RIGHT.getLength() > 0 && (r = parseInt(t.BOTTOM_RIGHT.totalHeight));
            t.RIGHT_BOTTOM.forEach(function(t) {
                var f = parseInt(t.clientWidth, 10)
                  , u = parseInt(t.clientHeight, 10);
                i += f;
                n += u;
                t.style.top = "auto";
                t.style.left = "auto";
                t.style.right = "0px";
                t.style.bottom = n - u + r + "px"
            });
            t.RIGHT_BOTTOM.totalWidth = i;
            t.RIGHT_BOTTOM.totalHeight = n
        }
    }
      , f = function(t, i) {
        var r = this.getAt(i), f;
        r.style.position = "absolute";
        f = n.getHPackage();
        f.appendChild(r);
        u()
    }
      , e = function(t, i, r) {
        var f = n.getHPackage();
        f.removeChild(r);
        u()
    };
    for (var r in t)
        FBM.FWEvent.addListener(t[r], "insert_at", function() {
            var n = r;
            return function(t) {
                f.call(this, n, t)
            }
        }()),
        FBM.FWEvent.addListener(t[r], "remove_at", function() {
            var n = r;
            return function(t, i) {
                e.call(this, n, t, i)
            }
        }()),
        FBM.FWEvent.addListener(n, "resize", function() {
            u()
        })
}
var DEBUG_MODE = !1, util = util || {}, Proj4js, bDebug, nResult, result, FBM;
(function() {
    Array.prototype.indexOf || (Array.prototype.indexOf = function(n) {
        var i = this.length >>> 0
          , t = Number(arguments[1]) || 0;
        for (t = t < 0 ? Math.ceil(t) : Math.floor(t),
        t < 0 && (t += i); t < i; t++)
            if (t in this && this[t] === n)
                return t;
        return -1
    }
    );
    window.console || (window.console = {},
    window.console.log = function() {}
    ,
    window.console.debug = function() {}
    ,
    window.console.warning = function() {}
    );
    window._RootPath = window._RootPath || document.location.protocol + "//demo.supergeotek.com/";
    window._APIPath = window._APIPath || window._RootPath + "FW_API/";
    window.FBM = {};
    Object.defineProperty(window.FBM, "RES_PATH", {
        get: function() {
            return window._APIPath + "images/"
        },
        enumerable: !0
    });
    Object.defineProperty(window.FBM, "TRAFICDATA_PATH", {
        get: function() {
            return window._RootPath + "FW_DATA/"
        },
        enumerable: !0
    });
    FBM.math = FBM.math || {};
    FBM.math.toRadian = function(n) {
        return n / 180 * Math.PI
    }
    ;
    FBM.math.toDegree = function(n) {
        return n / Math.PI * 180
    }
    ;
    FBM.RegisterEvent = function(n, t) {
        var i = 0;
        for (n.prototype.events || (n.prototype.events = []),
        i = 0; i < t.length; i++)
            n.prototype.events.push(t[i])
    }
    ;
    FBM.extend = function(n, t) {
        t.prototype = new n;
        t.prototype.constructor = n;
        t.prototype._super_ = n
    }
    ;
    FBM.math.degreeToRadian = function(n) {
        return n / 180 * Math.PI
    }
    ;
    FBM.math.degreeToRadian = function(n) {
        return n / 180 * Math.PI
    }
    ;
    FBM.math.radianToDegree = function(n) {
        return n / Math.PI * 180
    }
    ;
    FBM.math.length = function(n, t) {
        return Math.sqrt(n * n + t * t)
    }
    ;
    FBM.math.rotate = function(n, t, i) {
        var r = sg.math.degreeToRadian(i);
        return n = n * Math.cos(r) - t * Math.sin(r),
        t = n * Math.sin(r) + t * Math.cos(r),
        {
            x: n,
            y: t
        }
    }
    ;
    FBM.math.Matrix = function() {
        var n = function(n) {
            this.arr_ = n
        }, t;
        return n.square = function(t, i) {
            return n.create(t, t, i)
        }
        ,
        n.rotate = function(t) {
            var i = sg.math.degreeToRadian(t)
              , r = [[Math.cos(i), -Math.sin(i), 0], [Math.sin(i), Math.cos(i), 0], [0, 0, 1]];
            return new n(r)
        }
        ,
        n.scale = function(t, i) {
            var r = [[t, 0, 0], [0, i, 0], [0, 0, 1]];
            return new n(r)
        }
        ,
        n.translate = function(t, i) {
            var r = [[1, 0, t], [0, 1, i], [0, 0, 1]];
            return new n(r)
        }
        ,
        n.identity = function(t) {
            for (var r = n.zero(t, t), u = r.arr_, i = 0; i < t; i++)
                u[i][i] = 1;
            return r
        }
        ,
        n.create = function(t, i, r) {
            for (var e, u, r = r ? r : 0, o = [], f = 0; f < t; f++)
                for (e = new Array(i),
                o.push(e),
                u = 0; u < i; u++)
                    e[u] = typeof r == "function" ? r(f, u) : r;
            return new n(o)
        }
        ,
        n.zero = function(t, i) {
            return n.create(t, i, 0)
        }
        ,
        t = n.prototype,
        t.toString = function() {
            for (var t = "\n" + this.getRows() + " x " + this.getCols(), n = 0; n < this.getRows(); n++)
                t += "\n" + this.arr_[n].join();
            return t
        }
        ,
        t.array = function() {
            return arr_
        }
        ,
        t.getRows = function() {
            return this.arr_.length
        }
        ,
        t.getCols = function() {
            return this.arr_[0].length
        }
        ,
        t.get = function(n, t) {
            return this.arr_[n][t]
        }
        ,
        t.set = function(n, t, i) {
            this.arr_[n][t] = i
        }
        ,
        t.add = function(n) {
            return this.elementOperate(n, function(t, i) {
                return this.get(t, i) + n.get(t, i)
            })
        }
        ,
        t.productOperate = function(n, t) {
            var i, u, e, f;
            if (!this.isAligned(n))
                return null;
            for (i = 0; i < r_this; i++)
                for (u = 0; u < c_target; u++) {
                    for (e = 0,
                    f = 0; f < c_this; f++)
                        e += this.arr_[i][f] * n.arr_[f][u];
                    t(i, u, e)
                }
            return r
        }
        ,
        t.elementOperate = function(t, i) {
            if (!this.isEqualSize(t))
                return null;
            var r = n.zero(r1, c1);
            return this.forEach(function(n, t) {
                r.set(n, t, i(n, t))
            }),
            r
        }
        ,
        t.multiply = function(n) {
            return this.elementOperate(n, function(t, i) {
                return this.get(t, i) * n.get(t, i)
            })
        }
        ,
        t.substract = function(n) {
            return this.elementOperate(n, function(t, i) {
                return this.get(t, i) - n.get(t, i)
            })
        }
        ,
        t.forEach = function(n) {
            var r, u, t, i;
            if (n)
                for (r = this.getCols(),
                u = this.getRows(),
                t = 0; t < u; t++)
                    for (i = 0; i < r; i++)
                        n(t, i)
        }
        ,
        t.inverse = function() {
            var t = this.determinant();
            if (t == 0)
                throw "This matrix have zero determinant";
            var i = this.arr_
              , u = i[0][0]
              , f = i[0][1]
              , r = i[0][2]
              , e = i[1][0]
              , o = i[1][1]
              , s = i[1][2]
              , h = i[2][0]
              , c = i[2][1]
              , l = i[2][2]
              , a = o * l - s * c
              , v = -(e * l - s * h)
              , g = e * c - o * h
              , y = -(f * l - r * c)
              , p = u * l - r * h
              , w = -(u * c - f * h)
              , b = f * s - r * o
              , k = -(u * s - r * e)
              , d = u * o - f * e;
            return new n([[a / t, y / t, b / t], [v / t, p / t, k / t], [r / t, w / t, d / t]])
        }
        ,
        t.determinant = function() {
            var n = this.arr_
              , o = n[0][0]
              , s = n[0][1]
              , h = n[0][2]
              , t = n[1][0]
              , i = n[1][1]
              , r = n[1][2]
              , u = n[2][0]
              , f = n[2][1]
              , e = n[2][2]
              , c = i * e - r * f
              , l = -(t * e - r * u)
              , a = t * f - i * u;
            return o * c + s * l + h * a
        }
        ,
        t.transform = function(t, i) {
            var u = new n([[t], [i], [1]])
              , r = this.product(u);
            return {
                x: r.get(0, 0),
                y: r.get(1, 0)
            }
        }
        ,
        t.isEqualSize = function(n) {
            var t = this.getRows()
              , i = this.getCols()
              , r = n.getRows()
              , u = n.getCols();
            return i === u && t === r
        }
        ,
        t.isAligned = function(n) {
            var r = this.getRows()
              , t = this.getCols()
              , i = n.getRows()
              , u = n.getCols();
            return t === i
        }
        ,
        t.product = function(t) {
            var i, r, f, u;
            if (!this.isAligned(t))
                throw "Matrix not aligned";
            var e = this.getRows()
              , h = this.getCols()
              , c = t.getRows()
              , o = t.getCols()
              , s = n.zero(e, o);
            for (i = 0; i < e; i++)
                for (r = 0; r < o; r++) {
                    for (f = 0,
                    u = 0; u < h; u++)
                        f += this.arr_[i][u] * t.arr_[u][r];
                    s.set(i, r, f)
                }
            return s
        }
        ,
        n
    }();
    window.util = util || {};
    util.removeEventHandler = function(n, t, i) {
        n.removeEventListener && n.removeEventListener(t, i, !1);
        n.detachEvent && n.detachEvent("on" + t, i)
    }
    ;
    util.createUUID = function(n, t) {
        return function() {
            return "xxxxFWxxxxxxxxxxxxxxxxxxxxxxxx".replace(n, t).toUpperCase()
        }
    }(/[xy]/g, function(n) {
        var t = Math.random() * 16 | 0
          , i = n == "x" ? t : t & 3 | 8;
        return i.toString(16)
    });
    util.getInternetExplorerVersion = function() {
        var n = -1, t, i;
        return navigator.appName == "Microsoft Internet Explorer" && (t = navigator.userAgent,
        i = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),
        i.exec(t) != null && (n = parseFloat(RegExp.$1))),
        n
    }
    ;
    util.eventTarget = function(n) {
        return n.target ? n.target : n.srcElement
    }
    ;
    util.disableDefault = function(n) {
        n.preventDefault ? n.preventDefault() : n.returnValue = !1
    }
    ;
    util.disableSelect = function(n) {
        n.addEventListener ? n.addEventListener("mousedown", util.disabler, "false") : n.attachEvent("onselectstart", util.disabler)
    }
    ;
    util.enableSelect = function(n) {
        n.addEventListener ? n.removeEventListener("mousedown", util.disabler, "false") : n.detachEvent("onselectstart", util.disabler)
    }
    ;
    util.disabler = function(n) {
        return util.disableDefault(n),
        !1
    }
    ;
    util.intersectRect = function(n, t) {
        return !(t.left > n.right || t.right < n.left || t.top > n.bottom || t.bottom < n.top)
    }
    ;
    util.loadScript = function(n) {
        var t = document.createElement("script");
        t.src = n;
        document.getElementsByTagName("head")[0].appendChild(t)
    }
    ;
    var n = function(n) {
        var t = n.toString(16);
        return t.length == 1 ? "0" + t : t
    };
    FBM.Color = function(n, t, i, r) {
        this.r = n ? parseInt(n) : this.r;
        this.g = t ? parseInt(t) : this.g;
        this.b = i ? parseInt(i) : this.b;
        this.a = r == undefined ? this.a : r
    }
    ;
    this.toHex = function() {
        return "#" + n(this.r) + n(this.g) + n(this.b)
    }
    ;
    this.toRgb = function() {
        return [this.r, this.g, this.b]
    }
    ;
    this.toRgba = function() {
        return [this.r, this.g, this.b, this.a]
    }
    ;
    this.toCss = function(n) {
        return n ? "rgb(" + this.r + "," + this.g + "," + this.b + "," + this.a + ")" : "rgb(" + this.r + "," + this.g + "," + this.b + ")"
    }
    ;
    this.toString = function() {
        return this.toCss(!0)
    }
}
)();
/*! D:\FW_API\scripts\Framework.js*/
window.performance = window.performance || {};
performance.now = function() {
    return performance.now || performance.mozNow || performance.msNow || performance.oNow || performance.webkitNow || function() {
        return (new Date).getTime()
    }
}();
FBM.isString = function(n) {
    return typeof n == "string"
}
;
FBM.isArray = function(n) {
    return Array.isArray ? Array.isArray(n) : n.constructor === Array
}
;
FBM.isNumber = function(n) {
    return !isNaN(n)
}
;
FBM.isFunction = function(n) {
    return typeof n == "function"
}
;
FBM.isBoolean = function(n) {
    return typeof n == "boolean"
}
;
FBM.forEach = function(n, t) {
    if (n && t)
        for (var i = 0; i < n.length; i++)
            t.call(n, n[i], i, n)
}
;
FBM.parseXML = function(n) {
    var t = null, i;
    if (window.DOMParser)
        i = new DOMParser,
        t = i.parseFromString(n, "application/xml");
    else if (window.ActiveXObject)
        t = new ActiveXObject("Microsoft.XMLDOM"),
        t.async = !1,
        t.loadXML(n);
    else
        return null;
    return t
}
;
FBM.simplifyLineString = function(n, t) {
    function r(n, t) {
        var i = n.x - t.x
          , r = n.y - t.y;
        return i * i + r * r
    }
    function u(n, t, i) {
        var f = t.x, e = t.y, r = i.x - f, u = i.y - e, o;
        return (r !== 0 || u !== 0) && (o = ((n.x - f) * r + (n.y - e) * u) / (r * r + u * u),
        o > 1 ? (f = i.x,
        e = i.y) : o > 0 && (f += r * o,
        e += u * o)),
        r = n.x - f,
        u = n.y - e,
        r * r + u * u
    }
    function f(n, t) {
        for (var u = n[0], f = [u], i, e = 1, o = n.length; e < o; e++)
            i = n[e],
            r(i, u) > t && (f.push(i),
            u = i);
        return u !== i && f.push(i),
        f
    }
    function e(n, t) {
        var h = n.length, v = typeof Uint8Array != "undefined" ? Uint8Array : Array, e = new v(h), f = 0, r = h - 1, c = [], a = [], i, o, l, s;
        for (e[f] = e[r] = 1; r; ) {
            for (o = 0,
            i = f + 1; i < r; i++)
                l = u(n[i], n[f], n[r]),
                l > o && (s = i,
                o = l);
            o > t && (e[s] = 1,
            c.push(f, s, s, r));
            r = c.pop();
            f = c.pop()
        }
        for (i = 0; i < h; i++)
            e[i] && a.push(n[i]);
        return a
    }
    function o(n, t, i) {
        if (n.length <= 1)
            return n;
        var r = t !== undefined ? t * t : 1;
        return n = i ? n : f(n, r),
        e(n, r / 10)
    }
    var i = n;
    return n !== undefined && (i = o(n, t, !1)),
    i
}
,
function() {
    var t, n, f, e, i, r, u;
    FBM.features = {};
    t = navigator.userAgent.toLowerCase();
    n = -1;
    navigator.appName == "Microsoft Internet Explorer" && (f = navigator.userAgent,
    e = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),
    e.exec(f) != null && (n = parseFloat(RegExp.$1)));
    n && (FBM.features.ie = {},
    FBM.features.ie.version = n);
    t.indexOf("firefox") > 0 && (FBM.features.firefox = !0);
    t.indexOf("chrome") > 0 && (FBM.features.chrome = !0);
    i = document.createElement("canvas");
    FBM.features.canvas = !!(i.getContext && i.getContext("2d"));
    r = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = r;
    u = window.cancelAnimationFrame || window.mozCancelAnimationFrame;
    window.cancelAnimationFrame = u;
    r && u && FBM.features.animationFrame;
    FBM.features.getDPI = function() {
        if (FBM.isNumber(FBM.features.DPI))
            return FBM.features.DPI;
        if (document.readyState === "complete") {
            var n = document.createElement("div");
            return n.style.width = "1in",
            n.style.height = "1in",
            n.style.position = "absolute",
            n.style.visibility = "hidden",
            document.body.appendChild(n),
            FBM.features.DPI = n.offsetHeight,
            document.body.removeChild(n),
            FBM.features.DPI
        }
    }
    ;
    FBM.features.svg = !!("createElementNS"in document && document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect);
    FBM.features.cssTransform = "transform"in document.documentElement.style || "msTransform"in document.documentElement.style;
    FBM.wrap = function(n, t) {
        return function() {
            t.apply(n, arguments)
        }
    }
}();
FBM.JsonToGraphic = function(n, t) {
    var r = "Unable to import GeoJSON", h = ["Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon", "GeometryCollection"], y = n, c = n.getCoordSys(), l = function(n, t, i, r) {
        return i == r ? {
            x: n,
            y: t
        } : FW[i + "to" + r](n, t)
    }, i = function(n, t, i) {
        var r = l(n[0], n[1], t, i);
        return new FBM.FWPoint(r.x,r.y)
    }, u = function(n, t, f) {
        var v, w, y, l, o, s, e, c, a, b, p, h, k;
        switch (n.type) {
        case "Point":
            return i(n.coordinates, t, f);
        case "MultiPoint":
            for (s = [],
            e = 0; e < n.coordinates.length; e++)
                s.push(i(n.coordinates[e], t, f));
            return new FBM.FWMultiPoint(s);
        case "LineString":
            for (s = [],
            e = 0; e < n.coordinates.length; e++)
                s.push(i(n.coordinates[e], t, f));
            return new FBM.FWLineString(s);
        case "MultiLineString":
            for (v = [],
            o = 0; o < n.coordinates.length; o++) {
                for (s = [],
                e = 0; e < n.coordinates[o].length; e++)
                    s.push(i(n.coordinates[o][e], t, f));
                c = new FBM.FWLineString(s);
                v.push(c)
            }
            return new FBM.FWMultiLineString(v);
        case "Polygon":
            for (l = [],
            o = 0; o < n.coordinates.length; o++) {
                if (s = [],
                w = o == 0,
                w)
                    for (e = 0; e < n.coordinates[o].length; e++)
                        s.push(i(n.coordinates[o][e], t, f));
                else
                    for (e = n.coordinates[o].length - 1; e >= 0; e--)
                        s.push(i(n.coordinates[o][e], t, f));
                c = new FBM.FWLineString(s);
                a = new FBM.FWLinearRing(c);
                l.push(a)
            }
            return new FBM.FWPolygon(l);
        case "MultiPolygon":
            for (y = [],
            h = 0; h < n.coordinates.length; h++) {
                for (l = [],
                o = 0; o < n.coordinates[h].length; o++) {
                    for (s = [],
                    e = 0; e < n.coordinates[h][o].length; e++)
                        s.push(i(n.coordinates[h][o][e], t, f));
                    c = new FBM.FWLineString(s);
                    a = new FBM.FWLinearRing(c);
                    l.push(a)
                }
                b = new FBM.FWPolygon(l);
                y.push(b)
            }
            return new FBM.FWMultiPolygon(y);
        case "GeometryCollection":
            for (p = [],
            h = 0; h < n.geometries.length; h++)
                k = u(n.geometries[h]),
                p.push(k);
            return new FBM.FWGeometryCollection(p);
        default:
            throw r;
        }
    }, a = function(n, t, i) {
        for (var u = [], r = 0; r < n.features.length; r++)
            u.push(e(n.features[r], t, i));
        return u
    }, e = function(n, t, i) {
        var r = u(n.geometry, t, i)
          , f = n.properties
          , e = n.id;
        return new FBM.FWGraphic({
            geometry: r,
            properties: f,
            id: e
        })
    }, v = function() {
        var n, i = this;
        n = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP");
        n.onreadystatechange = function() {
            if (n.readyState == 4 && n.status == 200) {
                var t = n.responseText
                  , i = JSON.parse(t);
                f = o(i)
            }
        }
        ;
        n.open("GET", t, !1);
        n.send()
    }, o = function(n) {
        var i, f, t, o, s, l;
        if (!n)
            throw r;
        i = "WGS84";
        n.crs && n.crs.type == "name" && n.crs.properties && (f = n.crs.properties.name,
        f == "urn:ogc:def:crs:EPSG::3826" ? i = "TWD97" : f == "urn:ogc:def:crs:EPSG::3825" && (i = "TWD67"));
        t = null;
        switch (c) {
        case FBM.FWCoordSys.EPSG3857:
            t = "WGS84";
            break;
        case FBM.FWCoordSys.EPSG3826:
            t = "TWD97";
            break;
        case FBM.FWCoordSys.EPSG3825:
            t = "TWD67";
            break;
        default:
            throw "Invalid Map CRS";
        }
        if (h.indexOf(n.type) >= 0)
            return o = u(n, i, t),
            s = new FBM.FWGraphic({
                geometry: o
            }),
            [s];
        if (n.type == "Feature")
            return l = e(n, i, t),
            [l];
        if (n.type == "FeatureCollection")
            return a(n, i, t);
        throw r;
    }, f = "", s;
    return t.indexOf("http") == 0 ? v() : (s = JSON.parse(t),
    f = o(s)),
    f
}
;
/*! D:\FW_API\scripts\MVCObject.js*/
FBM = FBM || {};
FBM.MVCObject = function() {
    this.binds_ = [];
    this.events_ = []
}
;
FBM.MVCObject.prototype.addListener = function() {}
;
FBM.MVCObject.prototype.bindTo = function(n, t, i, r) {
    var u = {
        key: n,
        target: t,
        targetKey: i ? i : n,
        noNotify: r ? !0 : !1,
        eventName: n + "_changed"
    };
    this.binds_.push(u);
    this[n] !== u.target[u.targetKey] && (u.target[u.targetKey] = this[n],
    this.notify_(t, i))
}
;
FBM.MVCObject.prototype.changed = function() {}
;
FBM.MVCObject.prototype.get = function(n) {
    return this[n]
}
;
FBM.MVCObject.prototype.notifyAll = function(n) {
    this.notify_(this, n);
    for (var t = 0; t < this.binds_.length; t++)
        this.binds_[t].key === n && this.notify_(this.binds_[t].target, this.binds_[t].targetKey)
}
;
FBM.MVCObject.prototype.notify_ = function(n, t) {
    typeof n[t + "_changed"] == "function" && n[t + "_changed"]();
    typeof n.changed == "function" && n.changed(t)
}
;
FBM.MVCObject.prototype.set = function(n, t) {
    var i;
    if (this[n] !== t) {
        for (this[n] = t,
        i = 0; i < this.binds_.length; i++) {
            var r = this.binds_[i]
              , u = r.target
              , f = r.targetKey
              , e = r.noNotify;
            f == n && (u[n] = t);
            e || this.notify_(u, f)
        }
        this.notify_(this, n)
    }
}
;
FBM.MVCObject.prototype.setValues = function(n) {
    for (var t in n)
        this.set(t, n[t])
}
;
FBM.MVCObject.prototype.unbind = function(n) {
    for (var t = this.binds_[t].length; t--; )
        this.binds_[t].key === n && this.binds_.splice(t, 1)
}
;
FBM.MVCObject.prototype.unbindAll = function() {
    this.binds_ = []
}
;
/*! D:\FW_API\scripts\FX.js*/
FBM.fx = FBM.fx || function() {
    var t = {}, n = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame, i;
    return window.requestAnimationFrame = n,
    i = window.cancelAnimationFrame || window.mozCancelAnimationFrame,
    window.cancelAnimationFrame = i,
    t.easing = {
        linear: function(n) {
            return n
        },
        quadIn: function(n) {
            return n * n
        },
        quadOut: function(n) {
            return n * (2 - n)
        },
        quadInOut: function(n) {
            return n < .5 ? 2 * n * n : -1 + (4 - 2 * n) * n
        },
        cubicIn: function(n) {
            return n * n * n
        },
        cubicOut: function(n) {
            return --n * n * n + 1
        },
        cubicInOut: function(n) {
            return n < .5 ? 4 * n * n * n : (n - 1) * (2 * n - 2) * (2 * n - 2) + 1
        },
        quartIn: function(n) {
            return n * n * n * n
        },
        quartOut: function(n) {
            return 1 - --n * n * n * n
        },
        quartInOut: function(n) {
            return n < .5 ? 8 * n * n * n * n : 1 - 8 * --n * n * n * n
        },
        quintIn: function(n) {
            return n * n * n * n * n
        },
        quintOut: function(n) {
            return 1 + --n * n * n * n * n
        },
        quintInOut: function(n) {
            return n < .5 ? 16 * n * n * n * n * n : 1 + 16 * --n * n * n * n * n
        }
    },
    t.createAnimation = function(r) {
        var w = r.easing ? r.easing : t.easing.linear, h = typeof r.duration == "number" ? r.duration : 350, c = typeof r.onAnimation == "function" ? r.onAnimation : null, l = typeof r.onEnd == "function" ? r.onEnd : null, a = typeof r.onStart == "function" ? r.onStart : null, u = r.type ? r.type : "setTimeout", b = typeof r.repeat == "boolean" ? r.repeat : !1, v = r.rate ? r.rate : 20, s = r.delay ? r.delay : 0, o, e = null, y, p = !1, f = function(t) {
            var i;
            p || (e === null && (a && a.call(this),
            e = u == "setTimeout" ? new Date : t),
            y = u == "setTimeout" ? new Date : t,
            i = u == "setTimeout" ? Math.abs(y.getTime() - e.getTime()) : Math.abs(t - e),
            percent = w(i / h),
            c && c.call(this, percent),
            percent < 1 && i < h ? o = u == "setTimeout" ? setTimeout(f, v) : n(f) : b ? (percent = percent % 1,
            e = u == "setTimeout" ? new Date : t,
            o = u == "setTimeout" ? setTimeout(f, v) : n(f)) : l && l.call(this))
        };
        return {
            play: function() {
                e = null;
                u != "setTimeout" && n ? s ? setTimeout(function() {
                    n(f)
                }, s) : n(f) : s ? setTimeout(f, s) : f()
            },
            stop: function() {
                p = !0;
                o && (u == "setTimeout" ? clearTimeout(o) : i(o))
            }
        }
    }
    ,
    t
}();
/*! D:\FW_API\scripts\Services.js*/
FBM.PROXY_LOCAL = "http://localhost:49937/fwproxy.ashx";
FBM.PROXY_SERVICE = window._RootPath + "proxy/proxy.aspx";
FBM.PROXY_SERVICE2 = window._RootPath + "proxy/FWproxy.ashx";
FBM.STATISTICS_SERVICE = window._RootPath + "FWDistrict/statistics.aspx";
FBM.STATISTICS_SERVICE2 = window._RootPath + "FWDistrict/statistics2.aspx";
FBM.FWKML_ATTR_SERVICE = window._RootPath + "SGSPWS/FWKMLService.ashx/FWQueryService";
FBM.FWKML_BUFFER_SERVICE = window._RootPath + "SGSPWS/FWKMLService.ashx/FWBufferService";
FBM.LOCATOR_SERVICE = window._RootPath + "addresslocator/locate.aspx";
FBM.ADDRESSLOCATE_SERVICE = window._RootPath + "FWAddress/FWAddress.aspx";
FBM.QUERY_SERVICE = window._RootPath + "FWQuery/FWQuery.ashx";
FBM.FWBufferStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    ZERO_RESULTS: "ZERO_RESULTS"
};
FBM.FWQueryStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    ZERO_RESULTS: "ZERO_RESULTS"
};
FBM.FWIdentifyStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    ZERO_RESULTS: "ZERO_RESULTS"
};
FBM.FWLocatorStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    ZERO_RESULTS: "ZERO_RESULTS",
    TOO_MANY_RESULTS: "TOO_MANY_RESULTS"
};
FBM.FWMeasureStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    INVALID_Coordinate: "INVALID_Coordinate"
};
FBM.FWLocatorLocation = {
    APPROXIMATE: "APPROXIMATE",
    GEOMETRIC_CENTER: "GEOMETRIC_CENTER",
    RANGE_INTERPOLATED: "GEOMETRIC_CENTER",
    ROOFTOP: "ROOFTOP"
};
FBM.FWUnitSystem = {
    IMPERIAL: "IMPERIAL",
    METRIC: "METRIC"
};
FBM.FWStatMapId = {
    COUNTYMAP: "COUNTYMAP",
    TOWNMAP: "TOWNMAP",
    VILLAGEMAP: "VILLAGEMAP"
};
FBM.FWStatServiceStatus = {
    ERROR: "ERROR",
    INVALID_REQUEST: "INVALID_REQUEST",
    OK: "OK",
    OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
    REQUEST_DENIED: "REQUEST_DENIED",
    UNKNOWN_ERROR: "UNKNOWN_ERROR",
    ZERO_RESULTS: "ZERO_RESULTS"
};
FBM.KindInfo = FBM.KindInfo || {};
FBM.KindInfo = {
    POI991: "POI991",
    POI992: "POI992",
    POI993: "POI993",
    POI994: "POI994",
    POI995: "POI995",
    POI996: "POI996",
    POI999: "POI999",
    government: "government",
    kindergarten: "kindergarten",
    culture: "culture",
    library: "library",
    museum: "museum",
    artmuseum: "artmuseum",
    funeral: "funeral",
    piration: "piration",
    hospital: "hospital",
    sanitation: "sanitation",
    preschool: "preschool",
    nursinghome: "nursinghome",
    nationalpark: "nationalpark",
    theater: "theater",
    park: "park",
    playground: "playground",
    zoo: "zoo",
    sports: "sports",
    market: "market",
    mall: "mall",
    conveniencestore: "conveniencestore",
    post: "post",
    financial: "financial",
    hotel: "hotel",
    TRA: "TRA",
    highwaybus: "highwaybus",
    MRT: "MRT",
    HSR: "HSR",
    gasstation: "gasstation",
    parking: "parking",
    restingstop: "restingstop",
    airport: "airport",
    port: "port",
    districtoffice: "districtoffice",
    household: "household",
    land: "land",
    policedepartment: "policedepartment",
    firedepartment: "firedepartment",
    elementary: "elementary",
    juniorhigh: "juniorhigh",
    seniorhigh: "seniorhigh",
    college: "college",
    school: "school",
    peasant: "peasant",
    buffer: {
        MARKNAME1: "MARKNAME1",
        ADDRESS: "ADDRESS",
        TEL: "TEL",
        COUNTYNAME: "COUNTYNAME",
        TOWNNAME: "TOWNNAME",
        FLOODING: "FLOODING",
        X_97121: "X_97121",
        Y_97121: "Y_97121",
        X_97119: "X_97119",
        Y_97119: "Y_97119",
        E: "E",
        N: "N"
    }
};
FBM.APPID = "web";
FBM.Log = function(n, t, i) {
    var u = getWebProtocal() + getAPIPath() + "rec/count.aspx?AppID=" + FBM.APPID + "&APIID=" + t + "&DataID=" + i
      , r = document.createElement("script");
    r.onload = function() {
        this.parentNode.removeChild(this)
    }
    ;
    r.onerror = function() {
        this.parentNode.removeChild(this)
    }
    ;
    r.type = "text/javascript";
    document.body.appendChild(r);
    r.src = u
}
;
FBM.ajaxCount__ = 0,
function() {
    var n = function(n, t, i) {
        return n += n.indexOf("?") >= 0 ? "&" : "?",
        n + (t + "=" + i)
    };
    FBM.getJSON = function(t, i, r, u) {
        var h = {
            src: t
        }, s = util.getInternetExplorerVersion(), e = "sn" + FBM.ajaxCount__, c = function() {
            i.apply(h, arguments);
            delete FBM.getJSON[e]
        }, o, f;
        (FBM.getJSON[e] = c,
        r && (t = n(r, "serv", encodeURIComponent(t))),
        t = n(t, "keystr", encodeURIComponent(FBM.fwHash)),
        t = n(t, "jsonp", encodeURIComponent("FBM.getJSON['" + e + "']")),
        o = document.getElementsByTagName("head"),
        o.length != 0) && (f = document.createElement("script"),
        f.type = "text/javascript",
        s >= 0 && s <= 8 ? f.onreadystatechange = function() {
            this.readyState && this.readyState !== "loaded" && this.readyState !== "complete" || (this.parentNode.removeChild(f),
            f = undefined)
        }
        : f.onload = function() {
            this.parentNode.removeChild(f);
            f = undefined
        }
        ,
        f.onerror = function() {
            u && u.call(this);
            this.parentNode.removeChild(f);
            f = undefined
        }
        ,
        FBM.ajaxCount__++,
        f.src = t,
        o[0].appendChild(f))
    }
}();
FBM.loadJsonData = function(n, t, i, r, u) {
    var f = document.createElement("script");
    f.type = "text/javascript";
    document.body.appendChild(f);
    t = t.indexOf("?") >= 0 ? t + "&keystr=" + encodeURIComponent(FBM.fwHash) : t + "?keystr=" + encodeURIComponent(FBM.fwHash);
    t += "&rn=" + Math.floor(Math.random() * 1e5 + 1);
    f.onreadystatechange = function() {
        this.readyState == "loaded" && i.call(this, dataObj)
    }
    ;
    f.onload = function() {
        i.call(this, dataObj);
        f.parentNode.removeChild(f);
        for (var n in f)
            delete f[n]
    }
    ;
    f.onerror = function() {
        r && r.call(this)
    }
    ;
    n == "" ? f.src = t : (u && (f.src = n + "?serv=" + encodeURIComponent(t) + "&skip=true&hash=" + FBM.fwHash),
    f.src = n + "?serv=" + encodeURIComponent(t))
}
;
FBM.DistrictID = {
    U01COS01_201212A: "S01",
    U01COS02_201212A: "S02",
    U01COS03_201212A: "S03",
    U01COS04_201212A: "S04",
    U01COS05_201212A: "S05",
    U01TOS01_201212A: "S06",
    U01TOS02_201212A: "S07",
    U01TOS03_201212A: "S08",
    U01TOS04_201212A: "S09",
    U01TOS05_201212A: "S10",
    U01VIS01_201212A: "S11",
    U01VIS02_201212A: "S12",
    U01VIS03_201212A: "S13",
    U01VIS04_201212A: "S14",
    U01VIS05_201212A: "S15"
};
FBM.FWDistrictStat = function() {
    this.stat = function(n, t, i, r) {
        var f = {
            getImageUrl: "",
            district: []
        }, e = "", h, c;
        switch (n) {
        case FBM.FWStatMapId.COUNTYMAP:
            e = "county";
            break;
        case FBM.FWStatMapId.TOWNMAP:
            e = "town";
            break;
        case FBM.FWStatMapId.VILLAGEMAP:
            e = "village"
        }
        var s = typeof i.layer == "string" ? i.layer : ""
          , l = typeof i.code == "string" ? i.code : ""
          , p = typeof i.statDistrictID == "number" ? i.statDistrictID : null
          , o = "ei"
          , v = typeof i.classifyMethod == "string" ? i.classifyMethod : "";
        switch (v) {
        case "EqualInterval":
            o = "ei";
            break;
        case "Quantile":
            o = "qt";
            break;
        case "StanDevi":
            o = "sd"
        }
        var a = typeof i.classes == "number" ? i.classes.toString() : ""
          , y = i.graduatedColor
          , u = "green";
        switch (y.toLowerCase()) {
        case "red":
            u = "red";
            break;
        case "yellow":
            u = "yellow";
            break;
        case "green":
            u = "green";
            break;
        case "blue":
            u = "blue"
        }
        h = typeof i.height == "number" ? i.height.toString() : "";
        c = typeof i.width == "number" ? i.width.toString() : "";
        FBM.getJSON(FBM.STATISTICS_SERVICE2 + "?width=" + c + "&height=" + h + "&district=" + e + "&color=" + u + "&layer=" + s + "&code=" + l + "&method=" + o + "&classnum=" + a, function(n) {
            var t;
            if (n && n.error) {
                r.call(this, null, "REQUEST_DENIED");
                return
            }
            f.district = n.district;
            f.legend = n.legend;
            var i = parseFloat(n.envelope.left)
              , v = parseFloat(n.envelope.top)
              , y = parseFloat(n.envelope.right)
              , p = parseFloat(n.envelope.bottom);
            f.envelope = new FBM.FWEnvelope(i,v,y,p);
            t = FBM.STATISTICS_SERVICE + "?width=" + c + "&height=" + h + "&district=" + e + "&color=" + u + "&layer=" + s + "&code=" + l + "&method=" + o + "&classnum=" + a;
            t = t.indexOf("?") >= 0 ? t + "&keystr=" + encodeURIComponent(FBM.fwHash) : t + "?keystr=" + encodeURIComponent(FBM.fwHash);
            f.imageUrl = t;
            r.call(this, f, "OK");
            s in FBM.DistrictID && FBM.Log("web", "A05", FBM.DistrictID[s])
        })
    }
}
;
FBM.FWLocateService = function() {
    function n(n, t, i) {
        var f = []
          , e = new FBM.FWTransformation
          , r = ""
          , u = "";
        switch (i) {
        case "84":
            u = "EPSG:4326";
            break;
        case "97_119":
            u = "EPSG:3825";
            break;
        default:
            u = "EPSG:3826"
        }
        FBM.getJSON(FBM.ADDRESSLOCATE_SERVICE + "?oAddress=" + n.address + "&oSRS=" + u + "&oResultDataType=jsonp&pnum=" + parseInt(n.pageNumber), function(n) {
            var u, e;
            if (n && n.Info && n.Info.length) {
                if (parseInt(n.Info[0].OutTotal) <= 0) {
                    r = FBM.FWLocatorStatus.ZERO_RESULTS;
                    t.call(this, null, r);
                    return
                }
            } else {
                r = FBM.FWLocatorStatus.ERROR;
                t.call(this, null, r);
                return
            }
            for (r = FBM.FWLocatorStatus.OK,
            parseInt(n.Info[0].OutTotal) > 30 && (r = FBM.FWLocatorStatus.TOO_MANY_RESULTS),
            u = 0; u < n.AddressList.length; u++) {
                var o = {
                    addressComponents: [],
                    formattedAddress: "",
                    geometry: {
                        bounds: "",
                        location: "",
                        locatorLocation: "",
                        geometry: ""
                    },
                    types: []
                }
                  , h = parseFloat(n.AddressList[u].X)
                  , c = parseFloat(n.AddressList[u].Y);
                if (o.addressComponents = {
                    county: n.AddressList[u].COUNTY,
                    town: n.AddressList[u].TOWN,
                    village: n.AddressList[u].VILLAGE,
                    neighborhood: n.AddressList[u].NEIGHBORHOOD,
                    road: n.AddressList[u].ROAD,
                    section: n.AddressList[u].SECTION,
                    lane: n.AddressList[u].LANE,
                    alley: n.AddressList[u].ALLEY,
                    sub_alley: n.AddressList[u].SUB_ALLEY,
                    number: n.AddressList[u].NUMBER
                },
                o.formattedAddress = n.AddressList[u].FULL_ADDR,
                o.geometry.location = new FBM.FWPoint(h,c),
                e = 500,
                i == "84") {
                    var s = FBM.WGS84ToGoo(o.geometry.location.x, o.geometry.location.y)
                      , l = FBM.GooToWGS84(s.x - e, s.y + e)
                      , a = FBM.GooToWGS84(s.x + e, s.y - e);
                    o.geometry.viewport = new FBM.FWEnvelope(l.x,l.y,a.x,a.y)
                } else
                    o.geometry.viewport = new FBM.FWEnvelope(h - e,c + e,h + e,c - e);
                f.push(o)
            }
            t.call(this, f, r);
            FBM.Log("web", "A12", "")
        })
    }
    function t(n, t, i) {
        var f = [], r = new FBM.FWTransformation, u = {
            addressComponents: [],
            formattedAddress: "",
            geometry: {
                bounds: "",
                location: "",
                locatorLocation: "",
                geometry: "",
                viewPort: ""
            },
            types: []
        }, s = n.town ? n.town : "", e = n.county ? n.county : "", o;
        e = e.replace("桃園縣", "桃園市");
        srs = i == "84" ? "EPSG4326" : i == "97_119" ? "EPSG3825" : "EPSG3826";
        o = FBM.LOCATOR_SERVICE + "?op=poi&keyword=" + n.poi + "&pnum=" + parseInt(n.pageNumber) + "&county=" + e + "&town=" + s + "&srs=" + srs;
        n.center && n.center instanceof FBM.FWPoint && (o += "&center=" + n.center.x + "," + n.center.y);
        FBM.getJSON(o, function(n) {
            var e, h, c, l, a;
            if (n && n.error) {
                t.call(this, f, "REQUEST_DENIED", 0, 0);
                return
            }
            if (!n || !n.Table || n.Table.length <= 0) {
                t.call(this, f, FBM.FWLocatorStatus.ZERO_RESULTS, 0, 0);
                return
            }
            for (e = 0; e < n.Table.length; e++) {
                u = {
                    addressComponents: [],
                    formattedAddress: "",
                    geometry: {
                        bounds: "",
                        location: "",
                        locatorLocation: "",
                        geometry: "",
                        viewPort: ""
                    },
                    types: []
                };
                var o = parseFloat(n.Table[e].X_97121)
                  , s = parseFloat(n.Table[e].Y_97121)
                  , v = n.Table[e].COUNTYNAME
                  , y = n.Table[e].TOWNNAME;
                i == "84" ? (r.twd97towgs84(o, s),
                u.geometry.location = new FBM.FWPoint(r.transResult.x,r.transResult.y),
                r.twd97towgs84(o - 1e3, s + 1e3),
                h = r.transResult.x,
                a = r.transResult.y,
                r.twd97towgs84(o + 1e3, s - 1e3),
                l = r.transResult.x,
                c = r.transResult.y,
                u.geometry.viewport = new FBM.FWEnvelope(h,a,l,c)) : i == "97_119" ? (r.twd97towgs84(o, s),
                r.wgs84totwd97_119(r.transResult.x, r.transResult.y),
                u.geometry.location = new FBM.FWPoint(r.transResult.x,r.transResult.y),
                r.twd97towgs84(o - 1e3, s + 1e3),
                r.wgs84totwd97_119(r.transResult.x, r.transResult.y),
                h = r.transResult.x,
                a = r.transResult.y,
                r.twd97towgs84(o + 1e3, s - 1e3),
                r.wgs84totwd97_119(r.transResult.x, r.transResult.y),
                l = r.transResult.x,
                c = r.transResult.y,
                u.geometry.viewport = new FBM.FWEnvelope(h,a,l,c)) : (u.geometry.viewport = new FBM.FWEnvelope(o - 1e3,s + 1e3,o + 1e3,s - 1e3),
                u.geometry.location = new FBM.FWPoint(o,s));
                u.poiName = n.Table[e].LANDMARKNA;
                u.county = n.Table[e].COUNTYNAME;
                u.town = n.Table[e].TOWNNAME;
                f.push(u)
            }
            t.call(this, f, n.pages > 1 ? FBM.FWLocatorStatus.TOO_MANY_RESULTS : FBM.FWLocatorStatus.OK, n.items, n.pages);
            FBM.Log("web", "A13", "")
        })
    }
    function i(n, t, i) {
        var f = [], u = new FBM.FWTransformation, h = n.town ? n.town : "", e = n.county ? n.county : "", s, o;
        e = e.replace("桃園縣", "桃園市");
        s = i == "84" ? "EPSG4326" : i == "97_119" ? "EPSG3825" : "EPSG3826";
        o = FBM.LOCATOR_SERVICE + "?op=rd&road=" + n.roadLocation + "&pnum=" + parseInt(n.pageNumber) + "&county=" + e + "&town=" + h + "&srs=" + s;
        n.center && n.center instanceof FBM.FWPoint && (o += "&center=" + n.center.x + "," + n.center.y);
        FBM.getJSON(o, function(n) {
            var s, h, c, l;
            if (n && n.error) {
                t.call(this, f, "REQUEST_DENIED", 0, 0);
                return
            }
            if (!n || !n.results) {
                t.call(this, f, FBM.FWLocatorStatus.ZERO_RESULTS, 0, 0);
                return
            }
            for (r = 0; r < n.results.length; r++) {
                var e = {
                    addressComponents: [],
                    formattedAddress: "",
                    geometry: {
                        bounds: "",
                        location: "",
                        locatorLocation: "",
                        geometry: "",
                        viewPort: ""
                    },
                    types: []
                }, a = parseFloat(n.results[r].min_x), v = parseFloat(n.results[r].min_y), y = parseFloat(n.results[r].max_x), p = parseFloat(n.results[r].max_y), w = parseFloat(n.results[r].point_x), b = parseFloat(n.results[r].point_y), o;
                i == "84" ? (u.twd97towgs84(w, b),
                e.geometry.location = new FBM.FWPoint(u.transResult.x,u.transResult.y),
                u.twd97towgs84(a, p),
                s = u.transResult.x,
                l = u.transResult.y,
                u.twd97towgs84(y, v),
                c = u.transResult.x,
                h = u.transResult.y,
                o = new FBM.FWEnvelope(s,l,c,h)) : i == "97_119" ? (u.twd97towgs84(w, b),
                u.wgs84totwd97_119(u.transResult.x, u.transResult.y),
                e.geometry.location = new FBM.FWPoint(u.transResult.x,u.transResult.y),
                u.twd97towgs84(a, p),
                u.wgs84totwd97_119(u.transResult.x, u.transResult.y),
                s = u.transResult.x,
                l = u.transResult.y,
                u.twd97towgs84(y, v),
                u.wgs84totwd97_119(u.transResult.x, u.transResult.y),
                c = u.transResult.x,
                h = u.transResult.y,
                o = new FBM.FWEnvelope(s,l,c,h)) : (e.geometry.location = new FBM.FWPoint(w,b),
                o = new FBM.FWEnvelope(a,p,y,v));
                e.geometry.viewport = o;
                e.county = n.results[r].countyname;
                e.town = n.results[r].townname;
                e.formattedAddress = n.results[r].roadname;
                f.push(e)
            }
            t.call(this, f, n.pages > 1 ? FBM.FWLocatorStatus.TOO_MANY_RESULTS : FBM.FWLocatorStatus.OK, n.items, n.pages);
            FBM.Log("web", "A14", "")
        })
    }
    function u(n, t, i) {
        var u = []
          , e = new FBM.FWTransformation
          , r = {
            addressComponents: [],
            formattedAddress: "",
            geometry: {
                bounds: "",
                location: "",
                locatorLocation: "",
                geometry: "",
                viewport: ""
            },
            types: []
        }
          , f = encodeURIComponent(n.district.replace("桃園縣", "桃園市"));
        FBM.getJSON(FBM.LOCATOR_SERVICE + "?op=dist&district=" + f, function(n) {
            var h;
            if (n && n.error) {
                t.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!n || n.status != "OK") {
                t.call(this, null, FBM.FWLocatorStatus.ZERO_RESULTS);
                return
            }
            var c = parseFloat(n.Information.x)
              , l = parseFloat(n.Information.y)
              , f = new FBM.FWEnvelope(n.Information.minX,n.Information.maxY,n.Information.maxX,n.Information.minY)
              , a = util.parsePolyWkt(n.Information.geometry);
            if (i == "84") {
                var e = FBM.TWD97toWGS84(f.left, f.top)
                  , o = FBM.TWD97toWGS84(f.right, f.bottom)
                  , s = FBM.TWD97toWGS84(c, l);
                r.geometry.location = new FBM.FWPoint(s.x,s.y);
                r.geometry.viewport = new FBM.FWEnvelope(e.x,e.y,o.x,o.y);
                h = FBM.Geometry.Transform(a, FBM.TWD97toWGS84);
                r.geometry.geometry = h
            } else if (i == "97_119") {
                var e = FBM.TWD97toTWD97_119(f.left, f.top)
                  , o = FBM.TWD97toTWD97_119(f.right, f.bottom)
                  , s = FBM.TWD97toTWD97_119(c, l);
                r.geometry.location = new FBM.FWPoint(s.x,s.y);
                r.geometry.viewport = new FBM.FWEnvelope(e.x,e.y,o.x,o.y);
                h = FBM.Geometry.Transform(a, FBM.TWD97toTWD97_119);
                r.geometry.geometry = h
            } else
                r.geometry.location = new FBM.FWPoint(c,l),
                r.geometry.viewport = f,
                r.geometry.geometry = a;
            r.geometry && r.geometry.geometry && r.geometry.geometry.getBounds && (r.geometry.bounds = r.geometry.geometry.getBounds());
            u.push(r);
            t.call(this, u, FBM.FWLocatorStatus.OK);
            FBM.Log("web", "A15", "")
        })
    }
    this.locateWGS84 = function(r, f) {
        typeof r.address != "undefined" ? n(r, f, "84") : typeof r.poi != "undefined" ? t(r, f, "84") : typeof r.roadLocation != "undefined" ? i(r, f, "84") : typeof r.district != "undefined" ? u(r, f, "84") : f.call(this, null, FBM.FWLocatorStatus.INVALID_REQUEST)
    }
    ;
    this.locateTWD97 = function(r, f) {
        typeof r.address != "undefined" ? n(r, f, "97") : typeof r.poi != "undefined" ? t(r, f, "97") : typeof r.roadLocation != "undefined" ? i(r, f, "97") : typeof r.district != "undefined" ? u(r, f, "97") : f.call(this, null, FBM.FWLocatorStatus.INVALID_REQUEST)
    }
    ;
    this.locateTWD97_119 = function(r, f) {
        typeof r.address != "undefined" ? n(r, f, "97_119") : typeof r.poi != "undefined" ? t(r, f, "97_119") : typeof r.roadLocation != "undefined" ? i(r, f, "97_119") : typeof r.district != "undefined" ? u(r, f, "97_119") : f.call(this, null, FBM.FWLocatorStatus.INVALID_REQUEST)
    }
    ;
    this.setCenter = function(n, t) {
        n.setCenter(t)
    }
    ;
    this.fitBounds = function(n, t) {
        n.fitBounds(t)
    }
}
;
FBM.FWMeasureService = function() {
    this.twd97LineMeasure = function(n, t) {
        var i, r;
        n instanceof FBM.FWLineString ? (i = n.getLength(),
        r = "OK") : (i = null,
        r = "INVALID_REQUEST");
        t.call(this, i, r);
        FBM.Log("web", "A07", "")
    }
    ;
    this.twd97PolygonMeasure = function(n, t) {
        var i, r;
        n instanceof FBM.FWPolygon ? (i = n.getArea(),
        r = "OK") : (i = null,
        r = "INVALID_REQUEST");
        t.call(this, i, r);
        FBM.Log("web", "A07", "")
    }
    ;
    this.twd97_119LineMeasure = function(n, t) {
        var i, r;
        n instanceof FBM.FWLineString ? (i = n.getLength(),
        r = "OK") : (i = null,
        r = "INVALID_REQUEST");
        t.call(this, i, r);
        FBM.Log("web", "A07", "")
    }
    ;
    this.twd97_119PolygonMeasure = function(n, t) {
        var i, r;
        n instanceof FBM.FWPolygon ? (i = n.getArea(),
        r = "OK") : (i = null,
        r = "INVALID_REQUEST");
        t.call(this, i, r);
        FBM.Log("web", "A07", "")
    }
    ;
    this.wgs84LineMeasure = function(n, t) {
        var u, f, o, e = new FBM.FWTransformation, r, s = [], h, c, l, i;
        if (n instanceof FBM.FWLineString) {
            for (r = n.getPath(),
            i = 0; i < r.length; i++)
                e.wgs84totwd97(r[i].x, r[i].y),
                c = e.transResult.x,
                l = e.transResult.y,
                h = new FBM.FWPoint(c,l),
                s.push(h);
            o = new FBM.FWLineString(s);
            u = o.getLength();
            f = "OK"
        } else
            u = null,
            f = "INVALID_REQUEST";
        t.call(this, u, f);
        FBM.Log("web", "A07", "")
    }
    ;
    this.wgs84PolygonMeasure = function(n, t) {
        var u, f, o, s, h, e = new FBM.FWTransformation, r, c = [], l, a, v, i;
        if (n instanceof FBM.FWPolygon) {
            for (r = n.getExteriorRing().getPath().getPath(),
            i = 0; i < r.length; i++)
                e.wgs84totwd97(r[i].x, r[i].y),
                a = e.transResult.x,
                v = e.transResult.y,
                l = new FBM.FWPoint(a,v),
                c.push(l);
            s = new FBM.FWLineString(c);
            h = new FBM.FWLinearRing(s);
            o = new FBM.FWPolygon([h]);
            u = o.getArea();
            f = "OK"
        } else
            u = null,
            f = "INVALID_REQUEST";
        t.call(this, u, f);
        FBM.Log("web", "A07", "")
    }
}
;
FBM.FWTileOverlay = function() {
    var n = [], t, i = "auto", r = null;
    this.getLayerById = function(t) {
        for (var i = 0; i < n.length; i++)
            if (n[i].id == t)
                return n[i];
        return null
    }
    ;
    this.setZIndex = function(t) {
        i = t;
        for (var r = 0; r < n.length; r++)
            n[r].setZIndex(i)
    }
    ;
    this.getZIndex = function() {
        return i
    }
    ;
    this.setTileOpacity = function(n, t) {
        if (this.getLayerById(t) != null) {
            var i = this.getLayerById(t);
            if (i == null)
                throw "Layer Not Found";
            this.getLayerById(t).setOpacity(n)
        }
    }
    ;
    this.removeTileOverlay = function(i) {
        if (this.getLayerById(i) != null) {
            t.removeLayer(this.getLayerById(i));
            for (var r = 0; r < n.length; r++)
                n[r].id == i && n.splice(r, 1)
        }
    }
    ;
    this.getThemeTile = function(i, u, f, e) {
        var y = this, c = this.getLayerById(i), o, v, s, l, a, h;
        if (c) {
            for (o = c.getTiles(u.left, u.top, u.right, u.bottom, u.scaleLevel, 0),
            l = [],
            a = [],
            h = 0; h < o.length; h++)
                l.push(new FBM.FWPoint(o[h].leftTop[0],o[h].leftTop[1])),
                a.push(o[h].url);
            e && e.call(this, {
                leftTopAnchor: l,
                imageUrl: a
            })
        } else
            t = u.map,
            u.zIndex != null && this.setZIndex(u.zIndex),
            v = getWebProtocal() + getAPIPath() + "Agent/TWD97/Agent_" + i + ".aspx",
            s = new MapCachedLayer(i,v,!1,y,"97",function() {
                var i, r, n, f;
                for (o = s.getTiles(u.left, u.top, u.right, u.bottom, u.scaleLevel, 0),
                i = [],
                r = [],
                n = 0; n < o.length; n++)
                    t.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? (f = FBM.TWD97ToWGS84(o[n].leftTop[0], o[n].leftTop[1]),
                    i.push(new FBM.FWPoint(f.x,f.y))) : i.push(new FBM.FWPoint(o[n].leftTop[0],o[n].leftTop[1])),
                    r.push(o[n].url);
                e && e.call(this, {
                    leftTopAnchor: i,
                    imageUrl: r
                })
            }
            ),
            s.id = i,
            u.map.addLayer(s, !0),
            s.setZIndex(this.getZIndex()),
            s.setOpacity(f),
            n.push(s),
            c = s,
            r = s,
            u.overlay || s.putVisible(!1);
        i in FBM.ThemeTileID && FBM.Log("web", "A03", FBM.ThemeTileID[i])
    }
    ;
    this.getNode = function() {
        return r.gethLayers()
    }
}
;
FBM.FWThemeTileRequest = function() {
    this.left = null;
    this.right = null;
    this.top = null;
    this.bottom = null;
    this.overlay = !0;
    this.map = !0;
    this.setScaleLevel = null
}
;
FBM.FWThemeTileResult = function() {
    this.ImageUrl = null;
    this.LeftTopAnchor = null
}
;
FBM.FWThemeLayer = function() {
    this.getThemePic = function(n, t, i, r) {
        var u = FBM.QUERY_SERVICE + "?op=image&res=" + FBM.MapIdInfo[n].resource + "&layer=" + FBM.MapIdInfo[n].layers[t].name + "&Left=" + i.left + "&Top=" + i.top + "&Right=" + i.right + "&Bottom=" + i.bottom + "&Width=" + parseFloat(i.width) + "&Height=" + parseFloat(i.height) + "&keystr=" + encodeURIComponent(FBM.FWHash);
        r.call(this, u, "OK", FBM.MapIdInfo[n].layers[t].legends);
        n in FBM.ThemeLayerID && FBM.Log("web", "A04", FBM.ThemeLayerID[n])
    }
}
;
FBM.FWThemePicRequest = function() {
    this.left = null;
    this.right = null;
    this.top = null;
    this.bottom = null;
    this.width = 256;
    this.height = 256;
    this.setRange = function(n, t, i, r) {
        this.left = n;
        this.right = t;
        this.top = i;
        this.bottom = r
    }
    ;
    this.setImageSize = function(n, t) {
        this.height = n;
        this.width = t
    }
}
;
FBM.FWFeatureIdentify = function() {
    function t(n) {
        return n.replace(/^[\s]*/gi, "")
    }
    function i(n) {
        return n.replace(/[\s]*$/gi, "")
    }
    function n(n) {
        return i(t(n))
    }
    this.identify = function(t, i, r, u, f) {
        function h(n, t) {
            var u = new FBM.FWTransformation, f = [], o = n.indexOf("("), s = n.indexOf(")"), e, r, i;
            for (o++,
            n = n.substring(o, s),
            e = n.split(","),
            r = 0; r < e.length; r++) {
                if (i = e[r].split(" "),
                isNaN(i[0]) || isNaN(i[1]))
                    return !1;
                t ? (u.twd97towgs84(parseFloat(i[0]), parseFloat(i[1])),
                f.push(new FBM.FWPoint(u.transResult.x,u.transResult.y))) : f.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])))
            }
            return new FBM.FWLineString(f)
        }
        function c(n, t) {
            var u = n.indexOf("("), f = n.indexOf(")"), i, r;
            return (u++,
            n = n.substring(u, f),
            i = n.split(" "),
            isNaN(i[0]) || isNaN(i[1])) ? !1 : t ? (r = new FBM.FWTransformation,
            r.twd97towgs84(parseFloat(i[0]), parseFloat(i[1])),
            new FBM.FWPoint(r.transResult.x,r.transResult.y)) : new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1]))
        }
        function l(n, t, i) {
            var r = n.indexOf("("), o, u;
            for (r++,
            o = 0,
            u = []; r != -1; ) {
                var e = n.indexOf("))", r)
                  , f = n.substring(r, e + 2);
                t == "MULTIPOINT" ? u.push(c(f, i)) : t == "MULTILINESTRING" ? u.push(h(f, i)) : t == "MULTIPOLYGON" && u.push(util.parsePolyWkt(f, i));
                r = n.indexOf("(", e - 1)
            }
            return u
        }
        function k(r) {
            var nt = "", b, w, d, g, s, v, a;
            if (!r) {
                f.call(this, null, "ZERO_RESULTS");
                return
            }
            var y = r.Feature
              , k = null
              , p = []
              , o = null;
            for (w in FBM.MapIdInfo[t].layers[i].identify)
                nt = nt + w + ",";
            if (e.fieldName = nt,
            typeof y.length == "undefined") {
                p = [];
                k = y.Values;
                for (w in FBM.MapIdInfo[t].layers[i].identify)
                    d = k[FBM.MapIdInfo[t].layers[i].identify[w]],
                    p.push(d);
                o = y.Geometry;
                g = o.indexOf("(");
                s = n(o.substr(0, g).toUpperCase());
                e.featureType = s;
                v = u == "EPSG3857";
                s == "POINT" ? a = [c(o, v)] : s == "LINESTRING" ? a = [h(o, v)] : s == "POLYGON" ? a = [util.parsePolyWkt(o)] : s.indexOf("MULTI") != -1 && (a = new l(o,s,v));
                e.fieldAttr.push(p);
                e.geometry = a;
                f.call(this, e, "OK");
                FBM.Log("web", "A08", FBM.ThemeLayerID[t])
            } else {
                for (b = 0; b < y.length; b++) {
                    p = [];
                    k = y[b].Values;
                    for (w in FBM.MapIdInfo[t].layers[i].identify)
                        d = k[FBM.MapIdInfo[t].layers[i].identify[w]],
                        p.push(d);
                    o = y[b].Geometry;
                    g = o.indexOf("(");
                    s = n(o.substr(0, g).toUpperCase());
                    e.featureType = s;
                    v = u == "EPSG3857";
                    s == "POINT" ? a = [c(o, v)] : s == "LINESTRING" ? a = [h(o, v)] : s == "POLYGON" ? a = [util.parsePolyWkt(o, v)] : s.indexOf("MULTI") != -1 && (a = new l(o,s,v));
                    e.fieldAttr.push(p);
                    e.geometry = a
                }
                f.call(this, e, "OK");
                FBM.Log("web", "A08", FBM.ThemeLayerID[t])
            }
        }
        function d() {
            var n = FBM.QUERY_SERVICE + "?op=fid_s";
            n += "&layer=dbo.LANDUSE_201207A_1";
            n += "&res=" + FBM.MapIdInfo[t].resource;
            n += "&geom=POLYGON((" + b + "))";
            FBM.getJSON(n, function(n) {
                if (n) {
                    k(n);
                    return
                }
                var i = FBM.QUERY_SERVICE + "?op=fid_s";
                i += "&layer=dbo.LANDUSE_201207A_2";
                i += "&res=" + FBM.MapIdInfo[t].resource;
                i += "&geom=POLYGON((" + b + "))";
                FBM.getJSON(i, function(n) {
                    k(n);
                    return
                })
            })
        }
        var p, w, b, s;
        if (!(r instanceof FBM.FWPoint)) {
            f.call(this, null, "INVALID_REQUEST");
            return
        }
        var nt = i
          , o = new FBM.FWPoint(0,0)
          , a = new FBM.FWPoint(0,0)
          , v = new FBM.FWPoint(0,0)
          , y = new FBM.FWPoint(0,0)
          , e = {};
        if (e.fieldAttr = [],
        e.geometry = [],
        p = 30,
        w = 30,
        o.x = r.x,
        o.y = r.y + w,
        a.x = r.x + p,
        a.y = r.y,
        v.x = r.x,
        v.y = r.y - w,
        y.x = r.x - p,
        y.y = r.y,
        b = o.x + " " + o.y + "," + a.x + " " + a.y + "," + v.x + " " + v.y + "," + y.x + " " + y.y + "," + o.x + " " + o.y,
        t == "LANDUSE") {
            d();
            return
        }
        s = FBM.QUERY_SERVICE + "?op=fid";
        s += "&layer=" + FBM.MapIdInfo[t].layers[i].name;
        s += "&res=" + FBM.MapIdInfo[t].resource;
        s += "&cx=" + r.x;
        s += "&cy=" + r.y;
        FBM.getJSON(s, function(r) {
            var nt = "", b, w, d, g, s, v, a;
            if (r && r.error) {
                f.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!r || !r.Feature) {
                f.call(this, null, "ZERO_RESULTS");
                return
            }
            var y = r.Feature
              , k = null
              , p = []
              , o = null;
            for (w in FBM.MapIdInfo[t].layers[i].identify)
                nt = nt + w + ",";
            if (e.fieldName = nt,
            typeof y.length == "undefined") {
                p = [];
                k = y.Values;
                for (w in FBM.MapIdInfo[t].layers[i].identify)
                    d = k[FBM.MapIdInfo[t].layers[i].identify[w]],
                    p.push(d);
                o = y.Geometry;
                g = o.indexOf("(");
                s = n(o.substr(0, g).toUpperCase());
                e.featureType = s;
                v = u == "EPSG3857";
                s == "POINT" ? a = [c(o, v)] : s == "LINESTRING" ? a = [h(o, v)] : s == "POLYGON" ? a = [util.parsePolyWkt(o)] : s.indexOf("MULTI") != -1 && (a = new l(o,s,v));
                e.fieldAttr.push(p);
                e.geometry = a;
                f.call(this, e, "OK");
                FBM.Log("web", "A08", FBM.ThemeLayerID[t])
            } else {
                for (b = 0; b < y.length; b++) {
                    p = [];
                    k = y[b].Values;
                    for (w in FBM.MapIdInfo[t].layers[i].identify)
                        d = k[FBM.MapIdInfo[t].layers[i].identify[w]],
                        p.push(d);
                    o = y[b].Geometry;
                    g = o.indexOf("(");
                    s = n(o.substr(0, g).toUpperCase());
                    e.featureType = s;
                    v = u == "EPSG3857";
                    s == "POINT" ? a = [c(o, v)] : s == "LINESTRING" ? a = [h(o, v)] : s == "POLYGON" ? a = [util.parsePolyWkt(o, v)] : s.indexOf("MULTI") != -1 && (a = new l(o,s,v));
                    e.fieldAttr.push(p);
                    e.geometry = a
                }
                f.call(this, e, "OK");
                FBM.Log("web", "A08", FBM.ThemeLayerID[t])
            }
        })
    }
}
;
FBM.parsePointWKT = function(n) {
    var i = n.indexOf("("), r = n.indexOf(")"), t;
    return (i++,
    n = n.substring(i, r),
    t = n.split(" "),
    isNaN(t[0]) || isNaN(t[1])) ? !1 : new FBM.FWPoint(parseFloat(t[0]),parseFloat(t[1]))
}
;
FBM.FWAttriQuery = function() {
    this.identify = function(n, t, i, r, u) {
        var a = t, f = "", o = {}, s = i.county, h = i.town, e = i.keyword, l, c;
        h != "" && s == "" ? (f = f + "[TOWN]='" + h + "'",
        e && (f = f + " AND [NAME] LIKE N'%" + e + "%'")) : h == "" && s != "" ? (f = f + "[COUNTY]='" + s.replace("台", "臺") + "'",
        e && (f = f + " AND [NAME] LIKE N'%" + e + "%'")) : h != "" && s != "" ? (s && (f = f + "[TOWN]='" + h + "' AND [COUNTY]='" + s.replace("台", "臺") + "'"),
        e && (f = f + " AND [NAME] LIKE N'%" + e + "%'")) : e && (f = f + " [NAME] LIKE N'%" + e + "%'");
        l = isNaN(i.pageNumber) || i.pageNumber < 1 ? 1 : parseInt(i.pageNumber);
        c = FBM.QUERY_SERVICE + "?op=att&res=" + FBM.MapIdInfo[n].resource;
        c += "&layer=" + FBM.MapIdInfo[n].layers[t].name;
        c += "&EXPR=" + encodeURIComponent(f);
        c += "&page=" + l;
        o.fieldAttr = [];
        o.position = [];
        FBM.getJSON(c, function(i) {
            var l = "", p, w, f, s, b, k;
            if (i && i.error) {
                u.call(this, null, "REQUEST_DENIED", 0, 0);
                return
            }
            if (!i) {
                u.call(this, null, "ZERO_RESULTS", 0, 0);
                return
            }
            var a = i.Feature
              , y = null
              , v = []
              , e = null
              , d = i.items
              , g = i.pages;
            for (s in FBM.MapIdInfo[n].layers[t].query)
                l = l + s + ",";
            for (o.fieldName = l,
            p = 0,
            w = a.length,
            f = p; f < w; f++) {
                v = [];
                y = a[f].Values;
                e = a[f].Geometry;
                for (s in FBM.MapIdInfo[n].layers[t].query)
                    b = y[FBM.MapIdInfo[n].layers[t].query[s]],
                    v.push(b);
                switch (r) {
                case "EPSG3857":
                    var h = FBM.parsePointWKT(e)
                      , c = FBM.TWD97toWGS84(h.x, h.y)
                      , k = new FBM.FWPoint(c.x,c.y);
                    break;
                case "EPSG3826":
                    k = FBM.parsePointWKT(e);
                    break;
                case "EPSG3825":
                    var h = FBM.parsePointWKT(e)
                      , c = FBM.TWD97toTWD97_119(h.x, h.y)
                      , k = new FBM.FWPoint(c.x,c.y)
                }
                o.fieldAttr.push(v);
                o.position.push(k)
            }
            u.call(this, o, "OK", d, g);
            FBM.Log("web", "A09", FBM.ThemeLayerID[n])
        })
    }
}
;
FBM.FWPointBuffer = function() {
    this.identify = function(n, t, i, r, u) {
        var o, e;
        if (!(i.position instanceof FBM.FWPoint) || typeof i.distance != "number") {
            u.call(this, null, "INVALID_REQUEST");
            return
        }
        var h = new FBM.FWPoint(0,0)
          , c = new FBM.FWPoint(0,0)
          , l = new FBM.FWPoint(0,0)
          , a = new FBM.FWPoint(0,0)
          , f = {};
        f.fieldAttr = [];
        f.position = [];
        o = "";
        e = FBM.QUERY_SERVICE + "?op=pb";
        e += "&layer=" + FBM.MapIdInfo[n].layers[t].name;
        e += "&res=" + FBM.MapIdInfo[n].resource;
        e += "&cx=" + i.position.x;
        e += "&cy=" + i.position.y;
        e += "&range=" + i.distance;
        FBM.getJSON(e, function(i) {
            var w = "", a, l, p, y;
            if (i && i.error) {
                u.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!i) {
                u.call(this, null, "ZERO_RESULTS");
                return
            }
            var h = i.Feature
              , v = null
              , e = null
              , c = [];
            for (l in FBM.MapIdInfo[n].layers[t].buffer)
                w = w + l + ",";
            if (f.fieldName = w,
            typeof h.length == "undefined") {
                c = [];
                v = h.Values;
                e = h.Geometry;
                switch (r) {
                case "EPSG3857":
                    var o = FBM.parsePointWKT(e)
                      , s = FBM.TWD97toWGS84(o.x, o.y)
                      , y = new FBM.FWPoint(s.x,s.y);
                    break;
                case "EPSG3826":
                    y = FBM.parsePointWKT(e);
                    break;
                case "EPSG3825":
                    var o = FBM.parsePointWKT(e)
                      , s = FBM.TWD97toTWD97_119(o.x, o.y)
                      , y = new FBM.FWPoint(s.x,s.y)
                }
                for (l in FBM.MapIdInfo[n].layers[t].buffer)
                    p = v[FBM.MapIdInfo[n].layers[t].buffer[l]],
                    c.push(p);
                f.position.push(y);
                f.fieldAttr.push(c);
                u.call(this, f, "OK");
                FBM.Log("web", "A10", FBM.ThemeLayerID[n])
            } else {
                for (a = 0; a < h.length; a++) {
                    c = [];
                    v = h[a].Values;
                    e = h[a].Geometry;
                    for (l in FBM.MapIdInfo[n].layers[t].buffer)
                        p = v[FBM.MapIdInfo[n].layers[t].buffer[l]],
                        c.push(p);
                    switch (r) {
                    case "EPSG3857":
                        var o = FBM.parsePointWKT(e)
                          , s = FBM.TWD97toWGS84(o.x, o.y)
                          , y = new FBM.FWPoint(s.x,s.y);
                        break;
                    case "EPSG3826":
                        y = FBM.parsePointWKT(e);
                        break;
                    case "EPSG3825":
                        var o = FBM.parsePointWKT(e)
                          , s = FBM.TWD97toTWD97_119(o.x, o.y)
                          , y = new FBM.FWPoint(s.x,s.y)
                    }
                    f.position.push(y);
                    f.fieldAttr.push(c)
                }
                u.call(this, f, "OK");
                FBM.Log("web", "A10", FBM.ThemeLayerID[n])
            }
        })
    }
}
;
FBM.FWKmlQuery = function() {
    function n(n, t, i, r) {
        return n = util.appendQStr(n, "FWMapServiceId", t),
        n = util.appendQStr(n, "FWMapId", i),
        typeof r.county == "string" && (n = util.appendQStr(n, "County", r.county)),
        typeof r.town == "string" && (n = util.appendQStr(n, "Town", r.town)),
        typeof r.keyword == "string" && (n = util.appendQStr(n, "Keyword", r.keyword)),
        n
    }
    this.identify = function(t, i, r, u) {
        if (!(t in FBM.FWMapServiceId))
            throw "Invalid FWMapServiceId";
        if (!(i in FBM.FWMapId))
            throw "Invalid mapID";
        var f = n(FBM.FWKML_ATTR_SERVICE, t, i, r);
        u && u.call(this, [{
            kmlUrl: f
        }], "OK")
    }
}
;
FBM.FWKmlBuffer = function() {
    function n(n, t, i, r) {
        n = util.appendQStr(n, "FWMapServiceId", t);
        switch (r.coordSys) {
        case "3826":
            break;
        case "4326":
            break;
        default:
            throw "Invalid CoordSys";
        }
        if (n = util.appendQStr(n, "EPSG", r.coordSys),
        n = util.appendQStr(n, "FWMapId", i),
        !util.isFloat(r.pointX))
            throw "Invalid pointX";
        if (n = util.appendQStr(n, "PointX", r.pointX),
        !util.isFloat(r.pointY))
            throw "Invalid pointY";
        if (n = util.appendQStr(n, "PointY", r.pointY),
        !util.isFloat(r.distance))
            throw "Invalid distance";
        return util.appendQStr(n, "Distance", r.distance)
    }
    this.identify = function(t, i, r, u) {
        if (!(t in FBM.FWMapServiceId))
            throw "Invalid FWMapServiceId";
        if (!(i in FBM.FWMapId))
            throw "Invalid mapID";
        var f = n(FBM.FWKML_BUFFER_SERVICE, t, i, r);
        u && u.call(this, [{
            kmlUrl: f
        }], "OK")
    }
}
;
FBM.FWPoiBuffer = function() {
    this.identify = function(n, t, i, r) {
        var e, f;
        if (!(t.position instanceof FBM.FWPoint) || typeof t.distance != "number") {
            r.call(this, null, "INVALID_REQUEST");
            return
        }
        var s = new FBM.FWPoint(0,0)
          , h = new FBM.FWPoint(0,0)
          , c = new FBM.FWPoint(0,0)
          , l = new FBM.FWPoint(0,0)
          , u = {};
        u.fieldAttr = [];
        u.position = [];
        e = "";
        f = FBM.QUERY_SERVICE + "?op=poib";
        f += "&kind=" + n;
        f += "&cx=" + t.position.x;
        f += "&cy=" + t.position.y;
        f += "&range=" + t.distance;
        FBM.getJSON(f, function(n) {
            var y = "", c, h, v, a;
            if (n && n.error) {
                r.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!n) {
                r.call(this, null, "ZERO_RESULTS");
                return
            }
            var o = n.Feature
              , l = null
              , t = null
              , s = [];
            for (h in FBM.KindInfo.buffer)
                y = y + h + ",";
            if (u.fieldName = y,
            typeof o.length == "undefined") {
                s = [];
                l = o.Values;
                t = o.Geometry;
                switch (i) {
                case "EPSG3857":
                    var f = FBM.parsePointWKT(t)
                      , e = FBM.TWD97toWGS84(f.x, f.y)
                      , a = new FBM.FWPoint(e.x,e.y);
                    break;
                case "EPSG3826":
                    a = FBM.parsePointWKT(t);
                    break;
                case "EPSG3825":
                    var f = FBM.parsePointWKT(t)
                      , e = FBM.TWD97toTWD97_119(f.x, f.y)
                      , a = new FBM.FWPoint(e.x,e.y)
                }
                for (h in FBM.KindInfo.buffer)
                    v = l[FBM.KindInfo.buffer[h]],
                    s.push(v);
                u.position.push(a);
                u.fieldAttr.push(s);
                r.call(this, u, "OK")
            } else {
                for (c = 0; c < o.length; c++) {
                    s = [];
                    l = o[c].Values;
                    t = o[c].Geometry;
                    for (h in FBM.KindInfo.buffer)
                        v = l[FBM.KindInfo.buffer[h]],
                        s.push(v);
                    switch (i) {
                    case "EPSG3857":
                        var f = FBM.parsePointWKT(t)
                          , e = FBM.TWD97toWGS84(f.x, f.y)
                          , a = new FBM.FWPoint(e.x,e.y);
                        break;
                    case "EPSG3826":
                        a = FBM.parsePointWKT(t);
                        break;
                    case "EPSG3825":
                        var f = FBM.parsePointWKT(t)
                          , e = FBM.TWD97toTWD97_119(f.x, f.y)
                          , a = new FBM.FWPoint(e.x,e.y)
                    }
                    u.position.push(a);
                    u.fieldAttr.push(s)
                }
                r.call(this, u, "OK")
            }
        })
    }
}
;
FBM.FWPoiLayer = function() {
    var t = ""
      , i = ""
      , r = ""
      , u = ""
      , n = "";
    this.getPoiLayer = function(f, e, o, s) {
        var h = {}, l, a, v, c;
        if (h.fieldAttr = [],
        h.position = [],
        n = e.map,
        l = "",
        a = !0,
        n != null && n !== undefined) {
            l = n.getLevel();
            switch (o) {
            case "EPSG3857":
                a = l >= 14 ? !0 : !1;
                break;
            case "EPSG3826":
                a = l >= 9 ? !0 : !1;
                break;
            case "EPSG3825":
                a = l >= 9 ? !0 : !1
            }
        }
        v = "";
        t = e.left;
        r = e.top;
        i = e.right;
        u = e.bottom;
        c = FBM.QUERY_SERVICE + "?op=poilayer";
        c += "&kind=" + f;
        c += "&Left=" + e.left;
        c += "&Top=" + e.top;
        c += "&Right=" + e.right;
        c += "&Bottom=" + e.bottom;
        a && FBM.getJSON(c, function(n) {
            var y = "", c, e, v, a;
            if (n && n.error) {
                s.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!n) {
                s.call(this, null, "ZERO_RESULTS");
                return
            }
            var u = n.Feature
              , l = null
              , t = null
              , f = [];
            for (e in FBM.KindInfo.buffer)
                y = y + e + ",";
            if (h.fieldName = y,
            typeof u.length == "undefined") {
                f = [];
                l = u.Values;
                t = u.Geometry;
                switch (o) {
                case "EPSG3857":
                    var i = FBM.parsePointWKT(t)
                      , r = FBM.TWD97toWGS84(i.x, i.y)
                      , a = new FBM.FWPoint(r.x,r.y);
                    break;
                case "EPSG3826":
                    a = FBM.parsePointWKT(t);
                    break;
                case "EPSG3825":
                    var i = FBM.parsePointWKT(t)
                      , r = FBM.TWD97toTWD97_119(i.x, i.y)
                      , a = new FBM.FWPoint(r.x,r.y)
                }
                for (e in FBM.KindInfo.buffer)
                    v = l[FBM.KindInfo.buffer[e]],
                    f.push(v);
                h.position.push(a);
                h.fieldAttr.push(f);
                s.call(this, h, "OK")
            } else {
                for (c = 0; c < u.length; c++) {
                    f = [];
                    l = u[c].Values;
                    t = u[c].Geometry;
                    for (e in FBM.KindInfo.buffer)
                        v = l[FBM.KindInfo.buffer[e]],
                        f.push(v);
                    switch (o) {
                    case "EPSG3857":
                        var i = FBM.parsePointWKT(t)
                          , r = FBM.TWD97toWGS84(i.x, i.y)
                          , a = new FBM.FWPoint(r.x,r.y);
                        break;
                    case "EPSG3826":
                        a = FBM.parsePointWKT(t);
                        break;
                    case "EPSG3825":
                        var i = FBM.parsePointWKT(t)
                          , r = FBM.TWD97toTWD97_119(i.x, i.y)
                          , a = new FBM.FWPoint(r.x,r.y)
                    }
                    h.position.push(a);
                    h.fieldAttr.push(f)
                }
                s.call(this, h, "OK")
            }
        })
    }
}
;
FBM.FWPoiNear = function() {
    this.identify = function(n, t, i, r) {
        var e, f;
        if (!(t.position instanceof FBM.FWPoint)) {
            r.call(this, null, "INVALID_REQUEST");
            return
        }
        var u = {};
        u.fieldAttr = [];
        u.position = [];
        e = "";
        f = FBM.QUERY_SERVICE + "?op=poinear";
        f += "&kind=" + n;
        f += "&cx=" + t.position.x;
        f += "&cy=" + t.position.y;
        FBM.getJSON(f, function(n) {
            var y = "", c, h, v, a;
            if (n && n.error) {
                r.call(this, null, "REQUEST_DENIED");
                return
            }
            if (!n) {
                r.call(this, null, "ZERO_RESULTS");
                return
            }
            var o = n.Feature
              , l = null
              , t = null
              , s = [];
            for (h in FBM.KindInfo.buffer)
                y = y + h + ",";
            if (u.fieldName = y,
            typeof o.length == "undefined") {
                s = [];
                l = o.Values;
                t = o.Geometry;
                switch (i) {
                case "EPSG3857":
                    var f = FBM.parsePointWKT(t)
                      , e = FBM.TWD97toWGS84(f.x, f.y)
                      , a = new FBM.FWPoint(e.x,e.y);
                    break;
                case "EPSG3826":
                    a = FBM.parsePointWKT(t);
                    break;
                case "EPSG3825":
                    var f = FBM.parsePointWKT(t)
                      , e = FBM.TWD97toTWD97_119(f.x, f.y)
                      , a = new FBM.FWPoint(e.x,e.y)
                }
                for (h in FBM.KindInfo.buffer)
                    v = l[FBM.KindInfo.buffer[h]],
                    s.push(v);
                u.position.push(a);
                u.fieldAttr.push(s);
                r.call(this, u, "OK")
            } else {
                for (c = 0; c < o.length; c++) {
                    s = [];
                    l = o[c].Values;
                    t = o[c].Geometry;
                    for (h in FBM.KindInfo.buffer)
                        v = l[FBM.KindInfo.buffer[h]],
                        s.push(v);
                    switch (i) {
                    case "EPSG3857":
                        var f = FBM.parsePointWKT(t)
                          , e = FBM.TWD97toWGS84(f.x, f.y)
                          , a = new FBM.FWPoint(e.x,e.y);
                        break;
                    case "EPSG3826":
                        a = FBM.parsePointWKT(t);
                        break;
                    case "EPSG3825":
                        var f = FBM.parsePointWKT(t)
                          , e = FBM.TWD97toTWD97_119(f.x, f.y)
                          , a = new FBM.FWPoint(e.x,e.y)
                    }
                    u.position.push(a);
                    u.fieldAttr.push(s)
                }
                r.call(this, u, "OK")
            }
        })
    }
}
;
util = util || {
    info: "utility class"
};
util.isInt = function(n) {
    return !isNaN(parseInt(n))
}
;
util.isUInt = function(n) {
    return !isNaN(parseInt(n)) || parseInt(n) >= 0
}
;
util.isFloat = function(n) {
    return !isNaN(parseFloat(n))
}
;
util.appendQStr = function(n, t, i) {
    return n || (n = ""),
    n.indexOf("?") > -1 ? n.concat("&" + t + "=" + i) : n.concat("?" + t + "=" + i)
}
;
util.parsePolyWkt = function(n) {
    var r = /^\s*\(?(.*?)\)?\s*$/, a = /\s+/, v = /\s*,\s*/, o = /\)\s*,\s*\(/, s = function(n) {
        for (var o, i = [], r = n.split(v), t = 0; t < r.length; t++) {
            var u = r[t].split(a)
              , f = parseFloat(u[0])
              , e = parseFloat(u[1]);
            isNaN(f) || isNaN(e) || (o = new FBM.FWPoint(f,e),
            i.push(o))
        }
        return i
    }, u = [], f, t, e, i;
    if (n.indexOf("MULTIPOLYGON") >= 0)
        for (n = n.replace("MULTIPOLYGON", "").replace(r, "$1").replace(r, "$1"),
        f = n.split(o),
        t = 0; t < f.length; t++) {
            var y = f[t].replace(r, "$1")
              , h = s(y)
              , c = new FBM.FWLineString(h)
              , l = new FBM.FWLinearRing(c);
            u.push(l)
        }
    else
        for (e = n.split(o),
        i = 0; i < e.length; i++) {
            var h = s(e[i])
              , c = new FBM.FWLineString(h)
              , l = new FBM.FWLinearRing(c);
            u.push(l)
        }
    return new FBM.FWPolygon(u)
}
;
util.decompress = function(n, t) {
    var r, u, i, h, c;
    t = Math.pow(10, -t);
    for (var l = n.length, f = 0, o = 0, s = 0, e = []; f < l; ) {
        u = 0;
        i = 0;
        do
            r = n.charCodeAt(f++) - 63,
            i |= (r & 31) << u,
            u += 5;
        while (r >= 32);
        h = i & 1 ? ~(i >> 1) : i >> 1;
        o += h;
        u = 0;
        i = 0;
        do
            r = n.charCodeAt(f++) - 63,
            i |= (r & 31) << u,
            u += 5;
        while (r >= 32);
        c = i & 1 ? ~(i >> 1) : i >> 1;
        s += c;
        e.push(o * t);
        e.push(s * t)
    }
    return e
}
;
/*! D:\FW_API\scripts\raphael.js*/
(function(n) {
    var o = "0.4.2", e = "hasOwnProperty", f = /[\.\/]/, s = "*", h = function() {}, c = function(n, t) {
        return n - t
    }, r, i, u = {
        n: {}
    }, t = function(n, f) {
        var o, p;
        n = String(n);
        var k = u, w = i, v = Array.prototype.slice.call(arguments, 2), s = t.listeners(n), a = 0, e, l = [], y = {}, h = [], b = r;
        for (r = n,
        i = 0,
        o = 0,
        p = s.length; o < p; o++)
            "zIndex"in s[o] && (l.push(s[o].zIndex),
            s[o].zIndex < 0 && (y[s[o].zIndex] = s[o]));
        for (l.sort(c); l[a] < 0; )
            if (e = y[l[a++]],
            h.push(e.apply(f, v)),
            i)
                return i = w,
                h;
        for (o = 0; o < p; o++)
            if (e = s[o],
            "zIndex"in e)
                if (e.zIndex == l[a]) {
                    if (h.push(e.apply(f, v)),
                    i)
                        break;
                    do
                        if (a++,
                        e = y[l[a]],
                        e && h.push(e.apply(f, v)),
                        i)
                            break;
                    while (e)
                } else
                    y[e.zIndex] = e;
            else if (h.push(e.apply(f, v)),
            i)
                break;
        return i = w,
        r = b,
        h.length ? h : null
    };
    t._events = u;
    t.listeners = function(n) {
        for (var a = n.split(f), t = u, i, v, o, e, p, h, c = [t], l = [], r = 0, y = a.length; r < y; r++) {
            for (h = [],
            e = 0,
            p = c.length; e < p; e++)
                for (t = c[e].n,
                v = [t[a[r]], t[s]],
                o = 2; o--; )
                    i = v[o],
                    i && (h.push(i),
                    l = l.concat(i.f || []));
            c = h
        }
        return l
    }
    ;
    t.on = function(n, t) {
        var e, i, r, o;
        if (n = String(n),
        typeof t != "function")
            return function() {}
            ;
        for (e = n.split(f),
        i = u,
        r = 0,
        o = e.length; r < o; r++)
            i = i.n,
            i = i.hasOwnProperty(e[r]) && i[e[r]] || (i[e[r]] = {
                n: {}
            });
        for (i.f = i.f || [],
        r = 0,
        o = i.f.length; r < o; r++)
            if (i.f[r] == t)
                return h;
        return i.f.push(t),
        function(n) {
            +n == +n && (t.zIndex = +n)
        }
    }
    ;
    t.f = function(n) {
        var i = [].slice.call(arguments, 1);
        return function() {
            t.apply(null, [n, null].concat(i).concat([].slice.call(arguments, 0)))
        }
    }
    ;
    t.stop = function() {
        i = 1
    }
    ;
    t.nt = function(n) {
        return n ? new RegExp("(?:\\.|\\/|^)" + n + "(?:\\.|\\/|$)").test(r) : r
    }
    ;
    t.nts = function() {
        return r.split(f)
    }
    ;
    t.off = t.unbind = function(n, i) {
        var a, r, h, v, c, p, o, w, l, y;
        if (!n) {
            t._events = u = {
                n: {}
            };
            return
        }
        for (a = n.split(f),
        l = [u],
        c = 0,
        p = a.length; c < p; c++)
            for (o = 0; o < l.length; o += v.length - 2) {
                if (v = [o, 1],
                r = l[o].n,
                a[c] != s)
                    r[a[c]] && v.push(r[a[c]]);
                else
                    for (h in r)
                        r[e](h) && v.push(r[h]);
                l.splice.apply(l, v)
            }
        for (c = 0,
        p = l.length; c < p; c++)
            for (r = l[c]; r.n; ) {
                if (i) {
                    if (r.f) {
                        for (o = 0,
                        w = r.f.length; o < w; o++)
                            if (r.f[o] == i) {
                                r.f.splice(o, 1);
                                break
                            }
                        r.f.length || delete r.f
                    }
                    for (h in r.n)
                        if (r.n[e](h) && r.n[h].f) {
                            for (y = r.n[h].f,
                            o = 0,
                            w = y.length; o < w; o++)
                                if (y[o] == i) {
                                    y.splice(o, 1);
                                    break
                                }
                            y.length || delete r.n[h].f
                        }
                } else {
                    delete r.f;
                    for (h in r.n)
                        r.n[e](h) && r.n[h].f && delete r.n[h].f
                }
                r = r.n
            }
    }
    ;
    t.once = function(n, i) {
        var r = function() {
            return t.unbind(n, r),
            i.apply(this, arguments)
        };
        return t.on(n, r)
    }
    ;
    t.version = o;
    t.toString = function() {
        return "You are running Eve " + o
    }
    ;
    typeof module != "undefined" && module.exports ? module.exports = t : typeof define != "undefined" ? define("eve", [], function() {
        return t
    }) : n.eve = t
}
)(this),
function(n, t) {
    typeof define == "function" && define.amd ? define(["eve"], function(i) {
        return t(n, i)
    }) : t(n, n.eve || typeof require == "function" && require("eve"))
}(this, function(n, t) {
    function i(n) {
        var r, u;
        return i.is(n, "function") ? li ? n() : t.on("raphael.DOMload", n) : i.is(n, tt) ? i._engine.create[v](i, n.splice(0, 3 + i.is(n[0], p))).add(n) : (r = Array.prototype.slice.call(arguments, 0),
        i.is(r[r.length - 1], "function") ? (u = r.pop(),
        li ? u.call(i._engine.create[v](i, r)) : t.on("raphael.DOMload", function() {
            u.call(i._engine.create[v](i, r))
        })) : i._engine.create[v](i, arguments))
    }
    function pt(n) {
        var i, t;
        if (typeof n == "function" || Object(n) !== n)
            return n;
        i = new n.constructor;
        for (t in n)
            n[a](t) && (i[t] = pt(n[t]));
        return i
    }
    function ef(n, t) {
        for (var i = 0, r = n.length; i < r; i++)
            if (n[i] === t)
                return n.push(n.splice(i, 1)[0])
    }
    function it(n, t, i) {
        function r() {
            var o = Array.prototype.slice.call(arguments, 0)
              , u = o.join("␀")
              , f = r.cache = r.cache || {}
              , e = r.count = r.count || [];
            return f[a](u) ? (ef(e, u),
            i ? i(f[u]) : f[u]) : (e.length >= 1e3 && delete f[e.shift()],
            e.push(u),
            f[u] = n[v](t, o),
            i ? i(f[u]) : f[u])
        }
        return r
    }
    function ei() {
        return this.hex
    }
    function wr(n, t) {
        for (var i, f = [], r = 0, u = n.length; u - 2 * !t > r; r += 2)
            i = [{
                x: +n[r - 2],
                y: +n[r - 1]
            }, {
                x: +n[r],
                y: +n[r + 1]
            }, {
                x: +n[r + 2],
                y: +n[r + 3]
            }, {
                x: +n[r + 4],
                y: +n[r + 5]
            }],
            t ? r ? u - 4 == r ? i[3] = {
                x: +n[0],
                y: +n[1]
            } : u - 2 == r && (i[2] = {
                x: +n[0],
                y: +n[1]
            },
            i[3] = {
                x: +n[2],
                y: +n[3]
            }) : i[0] = {
                x: +n[u - 2],
                y: +n[u - 1]
            } : u - 4 == r ? i[3] = i[2] : r || (i[0] = {
                x: +n[r],
                y: +n[r + 1]
            }),
            f.push(["C", (-i[0].x + 6 * i[1].x + i[2].x) / 6, (-i[0].y + 6 * i[1].y + i[2].y) / 6, (i[1].x + 6 * i[2].x - i[3].x) / 6, (i[1].y + 6 * i[2].y - i[3].y) / 6, i[2].x, i[2].y]);
        return f
    }
    function br(n, t, i, r, u) {
        var f = -3 * t + 9 * i - 9 * r + 3 * u
          , e = n * f + 6 * t - 12 * i + 6 * r;
        return n * e - 3 * t + 3 * i
    }
    function vt(n, t, i, r, f, e, o, s, h) {
        var c;
        h == null && (h = 1);
        h = h > 1 ? 1 : h < 0 ? 0 : h;
        var l = h / 2
          , w = [-.1252, .1252, -.3678, .3678, -.5873, .5873, -.7699, .7699, -.9041, .9041, -.9816, .9816]
          , b = [.2491, .2491, .2335, .2335, .2032, .2032, .1601, .1601, .1069, .1069, .0472, .0472]
          , a = 0;
        for (c = 0; c < 12; c++) {
            var v = l * w[c] + l
              , y = br(v, n, i, f, o)
              , p = br(v, t, r, e, s)
              , k = y * y + p * p;
            a += b[c] * u.sqrt(k)
        }
        return l * a
    }
    function sf(n, t, i, r, u, f, e, o, s) {
        if (!(s < 0) && !(vt(n, t, i, r, u, f, e, o) < s)) {
            for (var a = 1, l = a / 2, h = a - l, c = vt(n, t, i, r, u, f, e, o, h); y(c - s) > .01; )
                l /= 2,
                h += (c < s ? 1 : -1) * l,
                c = vt(n, t, i, r, u, f, e, o, h);
            return h
        }
    }
    function hf(n, t, i, r, u, f, e, s) {
        if (!(o(n, i) < l(u, e)) && !(l(n, i) > o(u, e)) && !(o(t, r) < l(f, s)) && !(l(t, r) > o(f, s))) {
            var p = (n * r - t * i) * (u - e) - (n - i) * (u * s - f * e)
              , w = (n * r - t * i) * (f - s) - (t - r) * (u * s - f * e)
              , a = (n - i) * (f - s) - (t - r) * (u - e);
            if (a) {
                var v = p / a
                  , y = w / a
                  , h = +v.toFixed(2)
                  , c = +y.toFixed(2);
                if (!(h < +l(n, i).toFixed(2)) && !(h > +o(n, i).toFixed(2)) && !(h < +l(u, e).toFixed(2)) && !(h > +o(u, e).toFixed(2)) && !(c < +l(t, r).toFixed(2)) && !(c > +o(t, r).toFixed(2)) && !(c < +l(f, s).toFixed(2)) && !(c > +o(f, s).toFixed(2)))
                    return {
                        x: v,
                        y: y
                    }
            }
        }
    }
    function ki(n, t, r) {
        var ut = i.bezierBBox(n), ft = i.bezierBBox(t), u, h, c, d, g;
        if (!i.isBBoxIntersect(ut, ft))
            return r ? 0 : [];
        var et = vt.apply(0, n)
          , ot = vt.apply(0, t)
          , p = o(~~(et / 5), 1)
          , w = o(~~(ot / 5), 1)
          , nt = []
          , tt = []
          , rt = {}
          , it = r ? 0 : [];
        for (u = 0; u < p + 1; u++)
            h = i.findDotsAtSegment.apply(i, n.concat(u / p)),
            nt.push({
                x: h.x,
                y: h.y,
                t: u / p
            });
        for (u = 0; u < w + 1; u++)
            h = i.findDotsAtSegment.apply(i, t.concat(u / w)),
            tt.push({
                x: h.x,
                y: h.y,
                t: u / w
            });
        for (u = 0; u < p; u++)
            for (c = 0; c < w; c++) {
                var e = nt[u]
                  , a = nt[u + 1]
                  , s = tt[c]
                  , v = tt[c + 1]
                  , b = y(a.x - e.x) < .001 ? "y" : "x"
                  , k = y(v.x - s.x) < .001 ? "y" : "x"
                  , f = hf(e.x, e.y, a.x, a.y, s.x, s.y, v.x, v.y);
                if (f) {
                    if (rt[f.x.toFixed(4)] == f.y.toFixed(4))
                        continue;
                    rt[f.x.toFixed(4)] = f.y.toFixed(4);
                    d = e.t + y((f[b] - e[b]) / (a[b] - e[b])) * (a.t - e.t);
                    g = s.t + y((f[k] - s[k]) / (v[k] - s[k])) * (v.t - s.t);
                    d >= 0 && d <= 1.001 && g >= 0 && g <= 1.001 && (r ? it++ : it.push({
                        x: f.x,
                        y: f.y,
                        t1: l(d, 1),
                        t2: l(g, 1)
                    }))
                }
            }
        return it
    }
    function di(n, t, r) {
        var e, o, s, h, b, k, d, g, c, l, y, p, nt, a, w, tt, v, u, f, it;
        for (n = i._path2curve(n),
        t = i._path2curve(t),
        y = r ? 0 : [],
        p = 0,
        nt = n.length; p < nt; p++)
            if (a = n[p],
            a[0] == "M")
                e = b = a[1],
                o = k = a[2];
            else
                for (a[0] == "C" ? (c = [e, o].concat(a.slice(1)),
                e = c[6],
                o = c[7]) : (c = [e, o, e, o, b, k, b, k],
                e = b,
                o = k),
                w = 0,
                tt = t.length; w < tt; w++)
                    if (v = t[w],
                    v[0] == "M")
                        s = d = v[1],
                        h = g = v[2];
                    else if (v[0] == "C" ? (l = [s, h].concat(v.slice(1)),
                    s = l[6],
                    h = l[7]) : (l = [s, h, s, h, d, g, d, g],
                    s = d,
                    h = g),
                    u = ki(c, l, r),
                    r)
                        y += u;
                    else {
                        for (f = 0,
                        it = u.length; f < it; f++)
                            u[f].segment1 = p,
                            u[f].segment2 = w,
                            u[f].bez1 = c,
                            u[f].bez2 = l;
                        y = y.concat(u)
                    }
        return y
    }
    function ht(n, t, i, r, u, f) {
        n != null ? (this.a = +n,
        this.b = +t,
        this.c = +i,
        this.d = +r,
        this.e = +u,
        this.f = +f) : (this.a = 1,
        this.b = 0,
        this.c = 0,
        this.d = 1,
        this.e = 0,
        this.f = 0)
    }
    function fu() {
        return this.x + lt + this.y + lt + this.width + " × " + this.height
    }
    function kf(n, t, i, r, u, f) {
        function l(n) {
            return ((h * n + o) * n + e) * n
        }
        function v(n, t) {
            var i = p(n, t);
            return ((a * i + c) * i + s) * i
        }
        function p(n, t) {
            for (var r, u, f, s, i = n, c = 0; c < 8; c++) {
                if (f = l(i) - n,
                y(f) < t)
                    return i;
                if (s = (3 * h * i + 2 * o) * i + e,
                y(s) < 1e-6)
                    break;
                i = i - f / s
            }
            if (r = 0,
            u = 1,
            i = n,
            i < r)
                return r;
            if (i > u)
                return u;
            while (r < u) {
                if (f = l(i),
                y(f - n) < t)
                    return i;
                n > f ? r = i : u = i;
                i = (u - r) / 2 + r
            }
            return i
        }
        var e = 3 * t
          , o = 3 * (r - t) - e
          , h = 1 - e - o
          , s = 3 * i
          , c = 3 * (u - i) - s
          , a = 1 - s - c;
        return v(n, 1 / (200 * f))
    }
    function ft(n, t) {
        var i = [], u = {}, r;
        if (this.ms = t,
        this.times = 1,
        n) {
            for (r in n)
                n[a](r) && (u[h(r)] = n[r],
                i.push(h(r)));
            i.sort(nf)
        }
        this.anim = u;
        this.top = i[i.length - 1];
        this.percents = i
    }
    function bt(n, r, u, e, o, c) {
        var nt, v, et, l, at, dt, ii, tt, vt, gt, yt, d, rt, st, ct, ni, ft, lt;
        u = h(u);
        var it, ot, pt, ti, bt, kt, w = n.ms, y = {}, g = {}, k = {};
        if (e) {
            for (v = 0,
            et = f.length; v < et; v++)
                if (nt = f[v],
                nt.el.id == r.id && nt.anim == n) {
                    nt.percent != u ? (f.splice(v, 1),
                    pt = 1) : ot = nt;
                    r.attr(nt.totalOrigin);
                    break
                }
        } else
            e = +g;
        for (v = 0,
        et = n.percents.length; v < et; v++)
            if (n.percents[v] == u || n.percents[v] > e * n.top) {
                u = n.percents[v];
                bt = n.percents[v - 1] || 0;
                w = w / n.top * (u - bt);
                ti = n.percents[v + 1];
                it = n.anim[u];
                break
            } else
                e && r.attr(n.anim[n.percents[v]]);
        if (it) {
            if (ot)
                ot.initstatus = e,
                ot.start = new Date - ot.ms * e;
            else {
                for (l in it)
                    if (it[a](l) && (pi[a](l) || r.paper.customAttributes[a](l))) {
                        y[l] = r.attr(l);
                        y[l] == null && (y[l] = wu[l]);
                        g[l] = it[l];
                        switch (pi[l]) {
                        case p:
                            k[l] = (g[l] - y[l]) / w;
                            break;
                        case "colour":
                            y[l] = i.getRGB(y[l]);
                            at = i.getRGB(g[l]);
                            k[l] = {
                                r: (at.r - y[l].r) / w,
                                g: (at.g - y[l].g) / w,
                                b: (at.b - y[l].b) / w
                            };
                            break;
                        case "path":
                            for (dt = wt(y[l], g[l]),
                            ii = dt[1],
                            y[l] = dt[0],
                            k[l] = [],
                            v = 0,
                            et = y[l].length; v < et; v++)
                                for (k[l][v] = [0],
                                tt = 1,
                                vt = y[l][v].length; tt < vt; tt++)
                                    k[l][v][tt] = (ii[v][tt] - y[l][v][tt]) / w;
                            break;
                        case "transform":
                            if (gt = r._,
                            yt = af(gt[l], g[l]),
                            yt)
                                for (y[l] = yt.from,
                                g[l] = yt.to,
                                k[l] = [],
                                k[l].real = !0,
                                v = 0,
                                et = y[l].length; v < et; v++)
                                    for (k[l][v] = [y[l][v][0]],
                                    tt = 1,
                                    vt = y[l][v].length; tt < vt; tt++)
                                        k[l][v][tt] = (g[l][v][tt] - y[l][v][tt]) / w;
                            else
                                d = r.matrix || new ht,
                                rt = {
                                    _: {
                                        transform: gt.transform
                                    },
                                    getBBox: function() {
                                        return r.getBBox(1)
                                    }
                                },
                                y[l] = [d.a, d.b, d.c, d.d, d.e, d.f],
                                tu(rt, g[l]),
                                g[l] = rt._.transform,
                                k[l] = [(rt.matrix.a - d.a) / w, (rt.matrix.b - d.b) / w, (rt.matrix.c - d.c) / w, (rt.matrix.d - d.d) / w, (rt.matrix.e - d.e) / w, (rt.matrix.f - d.f) / w];
                            break;
                        case "csv":
                            if (st = b(it[l])[ut](ai),
                            ct = b(y[l])[ut](ai),
                            l == "clip-rect")
                                for (y[l] = ct,
                                k[l] = [],
                                v = ct.length; v--; )
                                    k[l][v] = (st[v] - y[l][v]) / w;
                            g[l] = st;
                            break;
                        default:
                            for (st = [][s](it[l]),
                            ct = [][s](y[l]),
                            k[l] = [],
                            v = r.paper.customAttributes[l].length; v--; )
                                k[l][v] = ((st[v] || 0) - (ct[v] || 0)) / w
                        }
                    }
                if (ni = it.easing,
                ft = i.easing_formulas[ni],
                ft || (ft = b(ni).match(pu),
                ft && ft.length == 5 ? (lt = ft,
                ft = function(n) {
                    return kf(n, +lt[1], +lt[2], +lt[3], +lt[4], w)
                }
                ) : ft = tf),
                kt = it.start || n.start || +new Date,
                nt = {
                    anim: n,
                    percent: u,
                    timestamp: kt,
                    start: kt + (n.del || 0),
                    status: 0,
                    initstatus: e || 0,
                    stop: !1,
                    ms: w,
                    easing: ft,
                    from: y,
                    diff: k,
                    to: g,
                    el: r,
                    callback: it.callback,
                    prev: bt,
                    next: ti,
                    repeat: c || n.times,
                    origin: r.attr(),
                    totalOrigin: o
                },
                f.push(nt),
                e && !ot && !pt && (nt.stop = !0,
                nt.start = new Date - w * e,
                f.length == 1))
                    return er();
                pt && (nt.start = new Date - nt.ms * e);
                f.length == 1 && su(er)
            }
            t("raphael.anim.start." + r.id, r, n)
        }
    }
    function hu(n) {
        for (var t = 0; t < f.length; t++)
            f[t].el.paper == n && f.splice(t--, 1)
    }
    var ri, ui, rf, of, ot, ir, ct, uu, g, yt, w, ci;
    i.version = "2.1.2";
    i.eve = t;
    var li, ai = /[, ]+/, cu = {
        circle: 1,
        rect: 1,
        path: 1,
        ellipse: 1,
        text: 1,
        image: 1
    }, lu = /\{(\d+)\}/g, a = "hasOwnProperty", r = {
        doc: document,
        win: n
    }, vi = {
        was: Object.prototype[a].call(r.win, "Raphael"),
        is: r.win.Raphael
    }, sr = function() {
        this.ca = this.customAttributes = {}
    }, c, v = "apply", s = "concat", kt = "ontouchstart"in r.win || r.win.DocumentTouch && r.doc instanceof DocumentTouch, d = "", lt = " ", b = String, ut = "split", hr = "click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[ut](lt), dt = {
        mousedown: "touchstart",
        mousemove: "touchmove",
        mouseup: "touchend"
    }, gt = b.prototype.toLowerCase, u = Math, o = u.max, l = u.min, y = u.abs, nt = u.pow, k = u.PI, p = "number", ni = "string", tt = "array", au = Object.prototype.toString, df = i._ISURL = /^url\(['"]?(.+?)['"]?\)$/i, vu = /^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i, yu = {
        NaN: 1,
        Infinity: 1,
        "-Infinity": 1
    }, pu = /^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/, yi = u.round, h = parseFloat, et = parseInt, cr = b.prototype.toUpperCase, wu = i._availableAttrs = {
        "arrow-end": "none",
        "arrow-start": "none",
        blur: 0,
        "clip-rect": "0 0 1e9 1e9",
        cursor: "default",
        cx: 0,
        cy: 0,
        fill: "#fff",
        "fill-opacity": 1,
        font: '10px "Arial"',
        "font-family": '"Arial"',
        "font-size": "10",
        "font-style": "normal",
        "font-weight": 400,
        gradient: 0,
        height: 0,
        href: "http://raphaeljs.com/",
        "letter-spacing": 0,
        opacity: 1,
        path: "M0,0",
        r: 0,
        rx: 0,
        ry: 0,
        src: "",
        stroke: "#000",
        "stroke-dasharray": "",
        "stroke-linecap": "butt",
        "stroke-linejoin": "butt",
        "stroke-miterlimit": 0,
        "stroke-opacity": 1,
        "stroke-width": 1,
        target: "_blank",
        "text-anchor": "middle",
        title: "Raphael",
        transform: "",
        width: 0,
        x: 0,
        y: 0
    }, pi = i._availableAnimAttrs = {
        blur: p,
        "clip-rect": "csv",
        cx: p,
        cy: p,
        fill: "colour",
        "fill-opacity": p,
        "font-size": p,
        height: p,
        opacity: p,
        path: "path",
        r: p,
        rx: p,
        ry: p,
        stroke: "colour",
        "stroke-opacity": p,
        "stroke-width": p,
        transform: "transform",
        width: p,
        x: p,
        y: p
    }, wi = /[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/, bu = {
        hs: 1,
        rg: 1
    }, ku = /,?([achlmqrstvxz]),?/gi, du = /([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig, gu = /([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig, lr = /(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig, gf = i._radial_gradient = /^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/, at = {}, ne = function(n, t) {
        return n.key - t.key
    }, nf = function(n, t) {
        return h(n) - h(t)
    }, te = function() {}, tf = function(n) {
        return n
    }, ti = i._rectPath = function(n, t, i, r, u) {
        return u ? [["M", n + u, t], ["l", i - u * 2, 0], ["a", u, u, 0, 0, 1, u, u], ["l", 0, r - u * 2], ["a", u, u, 0, 0, 1, -u, u], ["l", u * 2 - i, 0], ["a", u, u, 0, 0, 1, -u, -u], ["l", 0, u * 2 - r], ["a", u, u, 0, 0, 1, u, -u], ["z"]] : [["M", n, t], ["l", i, 0], ["l", 0, r], ["l", -i, 0], ["z"]]
    }
    , ar = function(n, t, i, r) {
        return r == null && (r = i),
        [["M", n, t], ["m", 0, -r], ["a", i, r, 0, 1, 1, 0, 2 * r], ["a", i, r, 0, 1, 1, 0, -2 * r], ["z"]]
    }, ii = i._getPath = {
        path: function(n) {
            return n.attr("path")
        },
        circle: function(n) {
            var t = n.attrs;
            return ar(t.cx, t.cy, t.r)
        },
        ellipse: function(n) {
            var t = n.attrs;
            return ar(t.cx, t.cy, t.rx, t.ry)
        },
        rect: function(n) {
            var t = n.attrs;
            return ti(t.x, t.y, t.width, t.height, t.r)
        },
        image: function(n) {
            var t = n.attrs;
            return ti(t.x, t.y, t.width, t.height)
        },
        text: function(n) {
            var t = n._getBBox();
            return ti(t.x, t.y, t.width, t.height)
        },
        set: function(n) {
            var t = n._getBBox();
            return ti(t.x, t.y, t.width, t.height)
        }
    }, bi = i.mapPath = function(n, t) {
        if (!t)
            return n;
        var f, e, u, i, o, s, r;
        for (n = wt(n),
        u = 0,
        o = n.length; u < o; u++)
            for (r = n[u],
            i = 1,
            s = r.length; i < s; i += 2)
                f = t.x(r[i], r[i + 1]),
                e = t.y(r[i], r[i + 1]),
                r[i] = f,
                r[i + 1] = e;
        return n
    }
    ;
    if (i._g = r,
    i.type = r.win.SVGAngle || r.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML",
    i.type == "VML") {
        if (ri = r.doc.createElement("div"),
        ri.innerHTML = '<v:shape adj="1"/>',
        ui = ri.firstChild,
        ui.style.behavior = "url(#default#VML)",
        !(ui && typeof ui.adj == "object"))
            return i.type = d;
        ri = null
    }
    i.svg = !(i.vml = i.type == "VML");
    i._Paper = sr;
    i.fn = c = sr.prototype = i.prototype;
    i._id = 0;
    i._oid = 0;
    i.is = function(n, t) {
        return (t = gt.call(t),
        t == "finite") ? !yu[a](+n) : t == "array" ? n instanceof Array : t == "null" && n === null || t == typeof n && n !== null || t == "object" && n === Object(n) || t == "array" && Array.isArray && Array.isArray(n) || au.call(n).slice(8, -1).toLowerCase() == t
    }
    ;
    i.angle = function(n, t, r, f, e, o) {
        if (e == null) {
            var s = n - r
              , h = t - f;
            return !s && !h ? 0 : (180 + u.atan2(-h, -s) * 180 / k + 360) % 360
        }
        return i.angle(n, t, e, o) - i.angle(r, f, e, o)
    }
    ;
    i.rad = function(n) {
        return n % 360 * k / 180
    }
    ;
    i.deg = function(n) {
        return Math.round(n * 180 / k % 360 * 1e3) / 1e3
    }
    ;
    i.snapTo = function(n, t, r) {
        var f, u;
        if (r = i.is(r, "finite") ? r : 10,
        i.is(n, tt)) {
            for (f = n.length; f--; )
                if (y(n[f] - t) <= r)
                    return n[f]
        } else {
            if (n = +n,
            u = t % n,
            u < r)
                return t - u;
            if (u > n - r)
                return t - u + n
        }
        return t
    }
    ;
    rf = i.createUUID = function(n, t) {
        return function() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n, t).toUpperCase()
        }
    }(/[xy]/g, function(n) {
        var t = u.random() * 16 | 0
          , i = n == "x" ? t : t & 3 | 8;
        return i.toString(16)
    });
    i.setWindow = function(n) {
        t("raphael.setWindow", i, r.win, n);
        r.win = n;
        r.doc = r.win.document;
        i._engine.initWin && i._engine.initWin(r.win)
    }
    ;
    var fi = function(n) {
        var e, u, f, o, t;
        if (i.vml) {
            e = /^\s+|\s+$/g;
            try {
                f = new ActiveXObject("htmlfile");
                f.write("<body>");
                f.close();
                u = f.body
            } catch (s) {
                u = createPopup().document.body
            }
            o = u.createTextRange();
            fi = it(function(n) {
                try {
                    u.style.color = b(n).replace(e, d);
                    var t = o.queryCommandValue("ForeColor");
                    return t = (t & 255) << 16 | t & 65280 | (t & 16711680) >>> 16,
                    "#" + ("000000" + t.toString(16)).slice(-6)
                } catch (i) {
                    return "none"
                }
            })
        } else
            t = r.doc.createElement("i"),
            t.title = "Raphaël Colour Picker",
            t.style.display = "none",
            r.doc.body.appendChild(t),
            fi = it(function(n) {
                return t.style.color = n,
                r.doc.defaultView.getComputedStyle(t, d).getPropertyValue("color")
            });
        return fi(n)
    }
      , uf = function() {
        return "hsb(" + [this.h, this.s, this.b] + ")"
    }
      , ff = function() {
        return "hsl(" + [this.h, this.s, this.l] + ")"
    }
      , vr = function() {
        return this.hex
    }
      , yr = function(n, t, r) {
        if (t == null && i.is(n, "object") && "r"in n && "g"in n && "b"in n && (r = n.b,
        t = n.g,
        n = n.r),
        t == null && i.is(n, ni)) {
            var u = i.getRGB(n);
            n = u.r;
            t = u.g;
            r = u.b
        }
        return (n > 1 || t > 1 || r > 1) && (n /= 255,
        t /= 255,
        r /= 255),
        [n, t, r]
    }
      , pr = function(n, t, r, u) {
        n *= 255;
        t *= 255;
        r *= 255;
        var f = {
            r: n,
            g: t,
            b: r,
            hex: i.rgb(n, t, r),
            toString: vr
        };
        return i.is(u, "finite") && (f.opacity = u),
        f
    };
    i.color = function(n) {
        var t;
        return i.is(n, "object") && "h"in n && "s"in n && "b"in n ? (t = i.hsb2rgb(n),
        n.r = t.r,
        n.g = t.g,
        n.b = t.b,
        n.hex = t.hex) : i.is(n, "object") && "h"in n && "s"in n && "l"in n ? (t = i.hsl2rgb(n),
        n.r = t.r,
        n.g = t.g,
        n.b = t.b,
        n.hex = t.hex) : (i.is(n, "string") && (n = i.getRGB(n)),
        i.is(n, "object") && "r"in n && "g"in n && "b"in n ? (t = i.rgb2hsl(n),
        n.h = t.h,
        n.s = t.s,
        n.l = t.l,
        t = i.rgb2hsb(n),
        n.v = t.b) : (n = {
            hex: "none"
        },
        n.r = n.g = n.b = n.h = n.s = n.v = n.l = -1)),
        n.toString = vr,
        n
    }
    ;
    i.hsb2rgb = function(n, t, i, r) {
        this.is(n, "object") && "h"in n && "s"in n && "b"in n && (i = n.b,
        t = n.s,
        r = n.o,
        n = n.h);
        n *= 360;
        var e, o, s, f, u;
        return n = n % 360 / 60,
        u = i * t,
        f = u * (1 - y(n % 2 - 1)),
        e = o = s = i - u,
        n = ~~n,
        e += [u, f, 0, 0, f, u][n],
        o += [f, u, u, f, 0, 0][n],
        s += [0, 0, f, u, u, f][n],
        pr(e, o, s, r)
    }
    ;
    i.hsl2rgb = function(n, t, i, r) {
        this.is(n, "object") && "h"in n && "s"in n && "l"in n && (i = n.l,
        t = n.s,
        n = n.h);
        (n > 1 || t > 1 || i > 1) && (n /= 360,
        t /= 100,
        i /= 100);
        n *= 360;
        var e, o, s, f, u;
        return n = n % 360 / 60,
        u = 2 * t * (i < .5 ? i : 1 - i),
        f = u * (1 - y(n % 2 - 1)),
        e = o = s = i - u / 2,
        n = ~~n,
        e += [u, f, 0, 0, f, u][n],
        o += [f, u, u, f, 0, 0][n],
        s += [0, 0, f, u, u, f][n],
        pr(e, o, s, r)
    }
    ;
    i.rgb2hsb = function(n, t, i) {
        i = yr(n, t, i);
        n = i[0];
        t = i[1];
        i = i[2];
        var f, e, u, r;
        return u = o(n, t, i),
        r = u - l(n, t, i),
        f = r == 0 ? null : u == n ? (t - i) / r : u == t ? (i - n) / r + 2 : (n - t) / r + 4,
        f = (f + 360) % 6 / 6,
        e = r == 0 ? 0 : r / u,
        {
            h: f,
            s: e,
            b: u,
            toString: uf
        }
    }
    ;
    i.rgb2hsl = function(n, t, i) {
        i = yr(n, t, i);
        n = i[0];
        t = i[1];
        i = i[2];
        var e, h, u, f, s, r;
        return f = o(n, t, i),
        s = l(n, t, i),
        r = f - s,
        e = r == 0 ? null : f == n ? (t - i) / r : f == t ? (i - n) / r + 2 : (n - t) / r + 4,
        e = (e + 360) % 6 / 6,
        u = (f + s) / 2,
        h = r == 0 ? 0 : u < .5 ? r / (2 * u) : r / (2 - 2 * u),
        {
            h: e,
            s: h,
            l: u,
            toString: ff
        }
    }
    ;
    i._path2string = function() {
        return this.join(",").replace(ku, "$1")
    }
    ;
    of = i._preload = function(n, t) {
        var i = r.doc.createElement("img");
        i.style.cssText = "position:absolute;left:-9999em;top:-9999em";
        i.onload = function() {
            t.call(this);
            this.onload = null;
            r.doc.body.removeChild(this)
        }
        ;
        i.onerror = function() {
            r.doc.body.removeChild(this)
        }
        ;
        r.doc.body.appendChild(i);
        i.src = n
    }
    ;
    i.getRGB = it(function(n) {
        if (!n || !!((n = b(n)).indexOf("-") + 1))
            return {
                r: -1,
                g: -1,
                b: -1,
                hex: "none",
                error: 1,
                toString: ei
            };
        if (n == "none")
            return {
                r: -1,
                g: -1,
                b: -1,
                hex: "none",
                toString: ei
            };
        bu[a](n.toLowerCase().substring(0, 2)) || n.charAt() == "#" || (n = fi(n));
        var u, f, e, o, s, t, r = n.match(vu);
        return r ? (r[2] && (e = et(r[2].substring(5), 16),
        f = et(r[2].substring(3, 5), 16),
        u = et(r[2].substring(1, 3), 16)),
        r[3] && (e = et((s = r[3].charAt(3)) + s, 16),
        f = et((s = r[3].charAt(2)) + s, 16),
        u = et((s = r[3].charAt(1)) + s, 16)),
        r[4] && (t = r[4][ut](wi),
        u = h(t[0]),
        t[0].slice(-1) == "%" && (u *= 2.55),
        f = h(t[1]),
        t[1].slice(-1) == "%" && (f *= 2.55),
        e = h(t[2]),
        t[2].slice(-1) == "%" && (e *= 2.55),
        r[1].toLowerCase().slice(0, 4) == "rgba" && (o = h(t[3])),
        t[3] && t[3].slice(-1) == "%" && (o /= 100)),
        r[5]) ? (t = r[5][ut](wi),
        u = h(t[0]),
        t[0].slice(-1) == "%" && (u *= 2.55),
        f = h(t[1]),
        t[1].slice(-1) == "%" && (f *= 2.55),
        e = h(t[2]),
        t[2].slice(-1) == "%" && (e *= 2.55),
        (t[0].slice(-3) == "deg" || t[0].slice(-1) == "°") && (u /= 360),
        r[1].toLowerCase().slice(0, 4) == "hsba" && (o = h(t[3])),
        t[3] && t[3].slice(-1) == "%" && (o /= 100),
        i.hsb2rgb(u, f, e, o)) : r[6] ? (t = r[6][ut](wi),
        u = h(t[0]),
        t[0].slice(-1) == "%" && (u *= 2.55),
        f = h(t[1]),
        t[1].slice(-1) == "%" && (f *= 2.55),
        e = h(t[2]),
        t[2].slice(-1) == "%" && (e *= 2.55),
        (t[0].slice(-3) == "deg" || t[0].slice(-1) == "°") && (u /= 360),
        r[1].toLowerCase().slice(0, 4) == "hsla" && (o = h(t[3])),
        t[3] && t[3].slice(-1) == "%" && (o /= 100),
        i.hsl2rgb(u, f, e, o)) : (r = {
            r: u,
            g: f,
            b: e,
            toString: ei
        },
        r.hex = "#" + (16777216 | e | f << 8 | u << 16).toString(16).slice(1),
        i.is(o, "finite") && (r.opacity = o),
        r) : {
            r: -1,
            g: -1,
            b: -1,
            hex: "none",
            error: 1,
            toString: ei
        }
    }, i);
    i.hsb = it(function(n, t, r) {
        return i.hsb2rgb(n, t, r).hex
    });
    i.hsl = it(function(n, t, r) {
        return i.hsl2rgb(n, t, r).hex
    });
    i.rgb = it(function(n, t, i) {
        return "#" + (16777216 | i | t << 8 | n << 16).toString(16).slice(1)
    });
    i.getColor = function(n) {
        var t = this.getColor.start = this.getColor.start || {
            h: 0,
            s: 1,
            b: n || .75
        }
          , i = this.hsb2rgb(t.h, t.s, t.b);
        return t.h += .075,
        t.h > 1 && (t.h = 0,
        t.s -= .2,
        t.s <= 0 && (this.getColor.start = {
            h: 0,
            s: 1,
            b: t.b
        })),
        i.hex
    }
    ;
    i.getColor.reset = function() {
        delete this.start
    }
    ;
    i.parsePathString = function(n) {
        var r, u, t;
        return n ? (r = ot(n),
        r.arr) ? rt(r.arr) : (u = {
            a: 7,
            c: 6,
            h: 1,
            l: 2,
            m: 2,
            r: 4,
            q: 4,
            s: 4,
            t: 2,
            v: 1,
            z: 0
        },
        t = [],
        i.is(n, tt) && i.is(n[0], tt) && (t = rt(n)),
        t.length || b(n).replace(du, function(n, i, r) {
            var f = []
              , e = i.toLowerCase();
            if (r.replace(lr, function(n, t) {
                t && f.push(+t)
            }),
            e == "m" && f.length > 2 && (t.push([i][s](f.splice(0, 2))),
            e = "l",
            i = i == "m" ? "l" : "L"),
            e == "r")
                t.push([i][s](f));
            else
                while (f.length >= u[e])
                    if (t.push([i][s](f.splice(0, u[e]))),
                    !u[e])
                        break
        }),
        t.toString = i._path2string,
        r.arr = rt(t),
        t) : null
    }
    ;
    i.parseTransformString = it(function(n) {
        if (!n)
            return null;
        var t = [];
        return i.is(n, tt) && i.is(n[0], tt) && (t = rt(n)),
        t.length || b(n).replace(gu, function(n, i, r) {
            var u = []
              , f = gt.call(i);
            r.replace(lr, function(n, t) {
                t && u.push(+t)
            });
            t.push([i][s](u))
        }),
        t.toString = i._path2string,
        t
    });
    ot = function(n) {
        var t = ot.ps = ot.ps || {};
        return t[n] ? t[n].sleep = 100 : t[n] = {
            sleep: 100
        },
        setTimeout(function() {
            for (var i in t)
                t[a](i) && i != n && (t[i].sleep--,
                t[i].sleep || delete t[i])
        }),
        t[n]
    }
    ;
    i.findDotsAtSegment = function(n, t, i, r, f, e, o, s, h) {
        var c = 1 - h
          , w = nt(c, 3)
          , b = nt(c, 2)
          , l = h * h
          , d = l * h
          , tt = w * n + b * 3 * h * i + c * 3 * h * h * f + d * o
          , it = w * t + b * 3 * h * r + c * 3 * h * h * e + d * s
          , a = n + 2 * h * (i - n) + l * (f - 2 * i + n)
          , v = t + 2 * h * (r - t) + l * (e - 2 * r + t)
          , y = i + 2 * h * (f - i) + l * (o - 2 * f + i)
          , p = r + 2 * h * (e - r) + l * (s - 2 * e + r)
          , rt = c * n + h * i
          , ut = c * t + h * r
          , ft = c * f + h * o
          , et = c * e + h * s
          , g = 90 - u.atan2(a - y, v - p) * 180 / k;
        return (a > y || v < p) && (g += 180),
        {
            x: tt,
            y: it,
            m: {
                x: a,
                y: v
            },
            n: {
                x: y,
                y: p
            },
            start: {
                x: rt,
                y: ut
            },
            end: {
                x: ft,
                y: et
            },
            alpha: g
        }
    }
    ;
    i.bezierBBox = function(n, t, r, u, f, e, o, s) {
        i.is(n, "array") || (n = [n, t, r, u, f, e, o, s]);
        var h = nu.apply(null, n);
        return {
            x: h.min.x,
            y: h.min.y,
            x2: h.max.x,
            y2: h.max.y,
            width: h.max.x - h.min.x,
            height: h.max.y - h.min.y
        }
    }
    ;
    i.isPointInsideBBox = function(n, t, i) {
        return t >= n.x && t <= n.x2 && i >= n.y && i <= n.y2
    }
    ;
    i.isBBoxIntersect = function(n, t) {
        var r = i.isPointInsideBBox;
        return r(t, n.x, n.y) || r(t, n.x2, n.y) || r(t, n.x, n.y2) || r(t, n.x2, n.y2) || r(n, t.x, t.y) || r(n, t.x2, t.y) || r(n, t.x, t.y2) || r(n, t.x2, t.y2) || (n.x < t.x2 && n.x > t.x || t.x < n.x2 && t.x > n.x) && (n.y < t.y2 && n.y > t.y || t.y < n.y2 && t.y > n.y)
    }
    ;
    i.pathIntersection = function(n, t) {
        return di(n, t)
    }
    ;
    i.pathIntersectionNumber = function(n, t) {
        return di(n, t, 1)
    }
    ;
    i.isPointInsidePath = function(n, t, r) {
        var u = i.pathBBox(n);
        return i.isPointInsideBBox(u, t, r) && di(n, [["M", t, r], ["H", u.x2 + 10]], 1) % 2 == 1
    }
    ;
    i._removedFactory = function(n) {
        return function() {
            t("raphael.log", null, "Raphaël: you are calling to method “" + n + "” of removed object", n)
        }
    }
    ;
    var gi = i.pathBBox = function(n) {
        var c = ot(n), h, p, u;
        if (c.bbox)
            return pt(c.bbox);
        if (!n)
            return {
                x: 0,
                y: 0,
                width: 0,
                height: 0,
                x2: 0,
                y2: 0
            };
        n = wt(n);
        var f = 0, e = 0, i = [], r = [], t;
        for (h = 0,
        p = n.length; h < p; h++)
            t = n[h],
            t[0] == "M" ? (f = t[1],
            e = t[2],
            i.push(f),
            r.push(e)) : (u = nu(f, e, t[1], t[2], t[3], t[4], t[5], t[6]),
            i = i[s](u.min.x, u.max.x),
            r = r[s](u.min.y, u.max.y),
            f = t[5],
            e = t[6]);
        var a = l[v](0, i)
          , y = l[v](0, r)
          , w = o[v](0, i)
          , b = o[v](0, r)
          , k = w - a
          , d = b - y
          , g = {
            x: a,
            y: y,
            x2: w,
            y2: b,
            width: k,
            height: d,
            cx: a + k / 2,
            cy: y + d / 2
        };
        return c.bbox = pt(g),
        g
    }
      , rt = function(n) {
        var t = pt(n);
        return t.toString = i._path2string,
        t
    }
      , cf = i._pathToRelative = function(n) {
        var v = ot(n), u, p, f, t, s, w, h, b, c;
        if (v.rel)
            return rt(v.rel);
        i.is(n, tt) && i.is(n && n[0], tt) || (n = i.parsePathString(n));
        var r = []
          , o = 0
          , e = 0
          , l = 0
          , a = 0
          , y = 0;
        for (n[0][0] == "M" && (o = n[0][1],
        e = n[0][2],
        l = o,
        a = e,
        y++,
        r.push(["M", o, e])),
        u = y,
        p = n.length; u < p; u++) {
            if (f = r[u] = [],
            t = n[u],
            t[0] != gt.call(t[0])) {
                f[0] = gt.call(t[0]);
                switch (f[0]) {
                case "a":
                    f[1] = t[1];
                    f[2] = t[2];
                    f[3] = t[3];
                    f[4] = t[4];
                    f[5] = t[5];
                    f[6] = +(t[6] - o).toFixed(3);
                    f[7] = +(t[7] - e).toFixed(3);
                    break;
                case "v":
                    f[1] = +(t[1] - e).toFixed(3);
                    break;
                case "m":
                    l = t[1];
                    a = t[2];
                default:
                    for (s = 1,
                    w = t.length; s < w; s++)
                        f[s] = +(t[s] - (s % 2 ? o : e)).toFixed(3)
                }
            } else
                for (f = r[u] = [],
                t[0] == "m" && (l = t[1] + o,
                a = t[2] + e),
                h = 0,
                b = t.length; h < b; h++)
                    r[u][h] = t[h];
            c = r[u].length;
            switch (r[u][0]) {
            case "z":
                o = l;
                e = a;
                break;
            case "h":
                o += +r[u][c - 1];
                break;
            case "v":
                e += +r[u][c - 1];
                break;
            default:
                o += +r[u][c - 2];
                e += +r[u][c - 1]
            }
        }
        return r.toString = i._path2string,
        v.rel = rt(r),
        r
    }
      , kr = i._pathToAbsolute = function(n) {
        var p = ot(n), w, t, r, v, k, h, e, y, c, d;
        if (p.abs)
            return rt(p.abs);
        if (i.is(n, tt) && i.is(n && n[0], tt) || (n = i.parsePathString(n)),
        !n || !n.length)
            return [["M", 0, 0]];
        var o = []
          , u = 0
          , f = 0
          , l = 0
          , a = 0
          , b = 0;
        for (n[0][0] == "M" && (u = +n[0][1],
        f = +n[0][2],
        l = u,
        a = f,
        b++,
        o[0] = ["M", u, f]),
        w = n.length == 3 && n[0][0] == "M" && n[1][0].toUpperCase() == "R" && n[2][0].toUpperCase() == "Z",
        v = b,
        k = n.length; v < k; v++) {
            if (o.push(t = []),
            r = n[v],
            r[0] != cr.call(r[0])) {
                t[0] = cr.call(r[0]);
                switch (t[0]) {
                case "A":
                    t[1] = r[1];
                    t[2] = r[2];
                    t[3] = r[3];
                    t[4] = r[4];
                    t[5] = r[5];
                    t[6] = +(r[6] + u);
                    t[7] = +(r[7] + f);
                    break;
                case "V":
                    t[1] = +r[1] + f;
                    break;
                case "H":
                    t[1] = +r[1] + u;
                    break;
                case "R":
                    for (h = [u, f][s](r.slice(1)),
                    e = 2,
                    y = h.length; e < y; e++)
                        h[e] = +h[e] + u,
                        h[++e] = +h[e] + f;
                    o.pop();
                    o = o[s](wr(h, w));
                    break;
                case "M":
                    l = +r[1] + u;
                    a = +r[2] + f;
                default:
                    for (e = 1,
                    y = r.length; e < y; e++)
                        t[e] = +r[e] + (e % 2 ? u : f)
                }
            } else if (r[0] == "R")
                h = [u, f][s](r.slice(1)),
                o.pop(),
                o = o[s](wr(h, w)),
                t = ["R"][s](r.slice(-2));
            else
                for (c = 0,
                d = r.length; c < d; c++)
                    t[c] = r[c];
            switch (t[0]) {
            case "Z":
                u = l;
                f = a;
                break;
            case "H":
                u = t[1];
                break;
            case "V":
                f = t[1];
                break;
            case "M":
                l = t[t.length - 2];
                a = t[t.length - 1];
            default:
                u = t[t.length - 2];
                f = t[t.length - 1]
            }
        }
        return o.toString = i._path2string,
        p.abs = rt(o),
        o
    }
      , oi = function(n, t, i, r) {
        return [n, t, i, r, i, r]
    }
      , dr = function(n, t, i, r, u, f) {
        var e = 1 / 3
          , o = 2 / 3;
        return [e * n + o * i, e * t + o * r, e * u + o * i, e * f + o * r, u, f]
    }
      , gr = function(n, t, i, r, f, e, o, h, c, l) {
        var at = k * 120 / 180, et = k / 180 * (+f || 0), p = [], g, ot = it(function(n, t, i) {
            var r = n * u.cos(i) - t * u.sin(i)
              , f = n * u.sin(i) + t * u.cos(i);
            return {
                x: r,
                y: f
            }
        }), st, lt, w, gt;
        if (l)
            v = l[0],
            a = l[1],
            rt = l[2],
            ft = l[3];
        else {
            g = ot(n, t, -et);
            n = g.x;
            t = g.y;
            g = ot(h, c, -et);
            h = g.x;
            c = g.y;
            var oi = u.cos(k / 180 * f)
              , si = u.sin(k / 180 * f)
              , b = (n - h) / 2
              , d = (t - c) / 2
              , tt = b * b / (i * i) + d * d / (r * r);
            tt > 1 && (tt = u.sqrt(tt),
            i = tt * i,
            r = tt * r);
            var ht = i * i
              , ct = r * r
              , vt = (e == o ? -1 : 1) * u.sqrt(y((ht * ct - ht * d * d - ct * b * b) / (ht * d * d + ct * b * b)))
              , rt = vt * i * d / r + (n + h) / 2
              , ft = vt * -r * b / i + (t + c) / 2
              , v = u.asin(((t - ft) / r).toFixed(9))
              , a = u.asin(((c - ft) / r).toFixed(9));
            v = n < rt ? k - v : v;
            a = h < rt ? k - a : a;
            v < 0 && (v = k * 2 + v);
            a < 0 && (a = k * 2 + a);
            o && v > a && (v = v - k * 2);
            !o && a > v && (a = a - k * 2)
        }
        if (st = a - v,
        y(st) > at) {
            var ni = a
              , ti = h
              , ii = c;
            a = v + at * (o && a > v ? 1 : -1);
            h = rt + i * u.cos(a);
            c = ft + r * u.sin(a);
            p = gr(h, c, i, r, f, 0, o, ti, ii, [a, ni, rt, ft])
        }
        st = a - v;
        var ri = u.cos(v)
          , ui = u.sin(v)
          , fi = u.cos(a)
          , ei = u.sin(a)
          , yt = u.tan(st / 4)
          , pt = 4 / 3 * i * yt
          , wt = 4 / 3 * r * yt
          , bt = [n, t]
          , nt = [n + pt * ui, t - wt * ri]
          , kt = [h + pt * ei, c - wt * fi]
          , dt = [h, c];
        if (nt[0] = 2 * bt[0] - nt[0],
        nt[1] = 2 * bt[1] - nt[1],
        l)
            return [nt, kt, dt][s](p);
        for (p = [nt, kt, dt][s](p).join()[ut](","),
        lt = [],
        w = 0,
        gt = p.length; w < gt; w++)
            lt[w] = w % 2 ? ot(p[w - 1], p[w], et).y : ot(p[w], p[w + 1], et).x;
        return lt
    }
      , si = function(n, t, i, r, u, f, e, o, s) {
        var h = 1 - s;
        return {
            x: nt(h, 3) * n + nt(h, 2) * 3 * s * i + h * 3 * s * s * u + nt(s, 3) * e,
            y: nt(h, 3) * t + nt(h, 2) * 3 * s * r + h * 3 * s * s * f + nt(s, 3) * o
        }
    }
      , nu = it(function(n, t, i, r, f, e, s, h) {
        var b = f - 2 * i + n - (s - 2 * f + i), c = 2 * (i - n) - 2 * (f - i), g = n - i, p = (-c + u.sqrt(c * c - 4 * b * g)) / 2 / b, w = (-c - u.sqrt(c * c - 4 * b * g)) / 2 / b, k = [t, h], d = [n, s], a;
        return y(p) > "1e12" && (p = .5),
        y(w) > "1e12" && (w = .5),
        p > 0 && p < 1 && (a = si(n, t, i, r, f, e, s, h, p),
        d.push(a.x),
        k.push(a.y)),
        w > 0 && w < 1 && (a = si(n, t, i, r, f, e, s, h, w),
        d.push(a.x),
        k.push(a.y)),
        b = e - 2 * r + t - (h - 2 * e + r),
        c = 2 * (r - t) - 2 * (e - r),
        g = t - r,
        p = (-c + u.sqrt(c * c - 4 * b * g)) / 2 / b,
        w = (-c - u.sqrt(c * c - 4 * b * g)) / 2 / b,
        y(p) > "1e12" && (p = .5),
        y(w) > "1e12" && (w = .5),
        p > 0 && p < 1 && (a = si(n, t, i, r, f, e, s, h, p),
        d.push(a.x),
        k.push(a.y)),
        w > 0 && w < 1 && (a = si(n, t, i, r, f, e, s, h, w),
        d.push(a.x),
        k.push(a.y)),
        {
            min: {
                x: l[v](0, d),
                y: l[v](0, k)
            },
            max: {
                x: o[v](0, d),
                y: o[v](0, k)
            }
        }
    })
      , wt = i._path2curve = it(function(n, t) {
        var g = !t && ot(n), i, b;
        if (!t && g.curve)
            return rt(g.curve);
        var u = kr(n)
          , r = t && kr(t)
          , f = {
            x: 0,
            y: 0,
            bx: 0,
            by: 0,
            X: 0,
            Y: 0,
            qx: null,
            qy: null
        }
          , e = {
            x: 0,
            y: 0,
            bx: 0,
            by: 0,
            X: 0,
            Y: 0,
            qx: null,
            qy: null
        }
          , nt = function(n, t, i) {
            var r, u;
            if (!n)
                return ["C", t.x, t.y, t.x, t.y, t.x, t.y];
            n[0]in {
                T: 1,
                Q: 1
            } || (t.qx = t.qy = null);
            switch (n[0]) {
            case "M":
                t.X = n[1];
                t.Y = n[2];
                break;
            case "A":
                n = ["C"][s](gr[v](0, [t.x, t.y][s](n.slice(1))));
                break;
            case "S":
                i == "C" || i == "S" ? (r = t.x * 2 - t.bx,
                u = t.y * 2 - t.by) : (r = t.x,
                u = t.y);
                n = ["C", r, u][s](n.slice(1));
                break;
            case "T":
                i == "Q" || i == "T" ? (t.qx = t.x * 2 - t.qx,
                t.qy = t.y * 2 - t.qy) : (t.qx = t.x,
                t.qy = t.y);
                n = ["C"][s](dr(t.x, t.y, t.qx, t.qy, n[1], n[2]));
                break;
            case "Q":
                t.qx = n[1];
                t.qy = n[2];
                n = ["C"][s](dr(t.x, t.y, n[1], n[2], n[3], n[4]));
                break;
            case "L":
                n = ["C"][s](oi(t.x, t.y, n[1], n[2]));
                break;
            case "H":
                n = ["C"][s](oi(t.x, t.y, n[1], t.y));
                break;
            case "V":
                n = ["C"][s](oi(t.x, t.y, t.x, n[1]));
                break;
            case "Z":
                n = ["C"][s](oi(t.x, t.y, t.X, t.Y))
            }
            return n
        }
          , tt = function(n, t) {
            if (n[t].length > 7) {
                n[t].shift();
                for (var i = n[t]; i.length; )
                    l[t] = "A",
                    r && (a[t] = "A"),
                    n.splice(t++, 0, ["C"][s](i.splice(0, 6)));
                n.splice(t, 1);
                b = o(u.length, r && r.length || 0)
            }
        }
          , it = function(n, t, i, f, e) {
            n && t && n[e][0] == "M" && t[e][0] != "M" && (t.splice(e, 0, ["M", f.x, f.y]),
            i.bx = 0,
            i.by = 0,
            i.x = n[e][1],
            i.y = n[e][2],
            b = o(u.length, r && r.length || 0))
        }
          , l = []
          , a = []
          , c = ""
          , w = "";
        for (i = 0,
        b = o(u.length, r && r.length || 0); i < b; i++) {
            u[i] && (c = u[i][0]);
            c != "C" && (l[i] = c,
            i && (w = l[i - 1]));
            u[i] = nt(u[i], f, w);
            l[i] != "A" && c == "C" && (l[i] = "C");
            tt(u, i);
            r && (r[i] && (c = r[i][0]),
            c != "C" && (a[i] = c,
            i && (w = a[i - 1])),
            r[i] = nt(r[i], e, w),
            a[i] != "A" && c == "C" && (a[i] = "C"),
            tt(r, i));
            it(u, r, f, e, i);
            it(r, u, e, f, i);
            var y = u[i]
              , p = r && r[i]
              , k = y.length
              , d = r && p.length;
            f.x = y[k - 2];
            f.y = y[k - 1];
            f.bx = h(y[k - 4]) || f.x;
            f.by = h(y[k - 3]) || f.y;
            e.bx = r && (h(p[d - 4]) || e.x);
            e.by = r && (h(p[d - 3]) || e.y);
            e.x = r && p[d - 2];
            e.y = r && p[d - 1]
        }
        return r || (g.curve = rt(u)),
        r ? [u, r] : u
    }, null, rt)
      , ue = i._parseDots = it(function(n) {
        for (var f, s, c, e, u, l, r = [], t = 0, o = n.length; t < o; t++) {
            if (f = {},
            s = n[t].match(/^([^:]*):?([\d\.]*)/),
            f.color = i.getRGB(s[1]),
            f.color.error)
                return null;
            f.color = f.color.hex;
            s[2] && (f.offset = s[2] + "%");
            r.push(f)
        }
        for (t = 1,
        o = r.length - 1; t < o; t++)
            if (!r[t].offset) {
                for (c = h(r[t - 1].offset || 0),
                e = 0,
                u = t + 1; u < o; u++)
                    if (r[u].offset) {
                        e = r[u].offset;
                        break
                    }
                for (e || (e = 100,
                u = o),
                e = h(e),
                l = (e - c) / (u - t + 1); t < u; t++)
                    c += l,
                    r[t].offset = c + "%"
            }
        return r
    })
      , hi = i._tear = function(n, t) {
        n == t.top && (t.top = n.prev);
        n == t.bottom && (t.bottom = n.next);
        n.next && (n.next.prev = n.prev);
        n.prev && (n.prev.next = n.next)
    }
      , fe = i._tofront = function(n, t) {
        t.top !== n && (hi(n, t),
        n.next = null,
        n.prev = t.top,
        t.top.next = n,
        t.top = n)
    }
      , ee = i._toback = function(n, t) {
        t.bottom !== n && (hi(n, t),
        n.next = t.bottom,
        n.prev = null,
        t.bottom.prev = n,
        t.bottom = n)
    }
      , oe = i._insertafter = function(n, t, i) {
        hi(n, i);
        t == i.top && (i.top = n);
        t.next && (t.next.prev = n);
        n.next = t.next;
        n.prev = t;
        t.next = n
    }
      , se = i._insertbefore = function(n, t, i) {
        hi(n, i);
        t == i.bottom && (i.bottom = n);
        t.prev && (t.prev.next = n);
        n.prev = t.prev;
        t.prev = n;
        n.next = t
    }
      , lf = i.toMatrix = function(n, t) {
        var r = gi(n)
          , i = {
            _: {
                transform: d
            },
            getBBox: function() {
                return r
            }
        };
        return tu(i, t),
        i.matrix
    }
      , he = i.transformPath = function(n, t) {
        return bi(n, lf(n, t))
    }
      , tu = i._extractTransform = function(n, t) {
        var w, tt;
        if (t == null)
            return n._.transform;
        t = b(t).replace(/\.{3}|\u2026/g, n._.transform || d);
        var a = i.parseTransformString(t)
          , v = 0
          , g = 0
          , nt = 0
          , y = 1
          , p = 1
          , e = n._
          , u = new ht;
        if (e.transform = a || [],
        a)
            for (w = 0,
            tt = a.length; w < tt; w++) {
                var r = a[w], o = r.length, l = b(r[0]).toLowerCase(), k = r[0] != l, s = k ? u.invert() : 0, it, rt, h, c, f;
                l == "t" && o == 3 ? k ? (it = s.x(0, 0),
                rt = s.y(0, 0),
                h = s.x(r[1], r[2]),
                c = s.y(r[1], r[2]),
                u.translate(h - it, c - rt)) : u.translate(r[1], r[2]) : l == "r" ? o == 2 ? (f = f || n.getBBox(1),
                u.rotate(r[1], f.x + f.width / 2, f.y + f.height / 2),
                v += r[1]) : o == 4 && (k ? (h = s.x(r[2], r[3]),
                c = s.y(r[2], r[3]),
                u.rotate(r[1], h, c)) : u.rotate(r[1], r[2], r[3]),
                v += r[1]) : l == "s" ? o == 2 || o == 3 ? (f = f || n.getBBox(1),
                u.scale(r[1], r[o - 1], f.x + f.width / 2, f.y + f.height / 2),
                y *= r[1],
                p *= r[o - 1]) : o == 5 && (k ? (h = s.x(r[3], r[4]),
                c = s.y(r[3], r[4]),
                u.scale(r[1], r[2], h, c)) : u.scale(r[1], r[2], r[3], r[4]),
                y *= r[1],
                p *= r[2]) : l == "m" && o == 7 && u.add(r[1], r[2], r[3], r[4], r[5], r[6]);
                e.dirtyT = 1;
                n.matrix = u
            }
        n.matrix = u;
        e.sx = y;
        e.sy = p;
        e.deg = v;
        e.dx = g = u.e;
        e.dy = nt = u.f;
        y == 1 && p == 1 && !v && e.bbox ? (e.bbox.x += +g,
        e.bbox.y += +nt) : e.dirtyT = 1
    }
      , iu = function(n) {
        var t = n[0];
        switch (t.toLowerCase()) {
        case "t":
            return [t, 0, 0];
        case "m":
            return [t, 1, 0, 0, 1, 0, 0];
        case "r":
            return n.length == 4 ? [t, 0, n[2], n[3]] : [t, 0];
        case "s":
            return n.length == 5 ? [t, 1, 1, n[3], n[4]] : n.length == 3 ? [t, 1, 1] : [t, 1]
        }
    }
      , af = i._equaliseTransform = function(n, t) {
        t = b(t).replace(/\.{3}|\u2026/g, n);
        n = i.parseTransformString(n) || [];
        t = i.parseTransformString(t) || [];
        for (var l = o(n.length, t.length), s = [], h = [], u = 0, f, c, r, e; u < l; u++) {
            if (r = n[u] || iu(t[u]),
            e = t[u] || iu(r),
            r[0] != e[0] || r[0].toLowerCase() == "r" && (r[2] != e[2] || r[3] != e[3]) || r[0].toLowerCase() == "s" && (r[3] != e[3] || r[4] != e[4]))
                return;
            for (s[u] = [],
            h[u] = [],
            f = 0,
            c = o(r.length, e.length); f < c; f++)
                f in r && (s[u][f] = r[f]),
                f in e && (h[u][f] = e[f])
        }
        return {
            from: s,
            to: h
        }
    }
    ;
    i._getContainer = function(n, t, u, f) {
        var e;
        if (e = f == null && !i.is(n, "object") ? r.doc.getElementById(n) : n,
        e != null)
            return e.tagName ? t == null ? {
                container: e,
                width: e.style.pixelWidth || e.offsetWidth,
                height: e.style.pixelHeight || e.offsetHeight
            } : {
                container: e,
                width: t,
                height: u
            } : {
                container: 1,
                x: n,
                y: t,
                width: u,
                height: f
            }
    }
    ;
    i.pathToRelative = cf;
    i._engine = {};
    i.path2curve = wt;
    i.matrix = function(n, t, i, r, u, f) {
        return new ht(n,t,i,r,u,f)
    }
    ,
    function(n) {
        function t(n) {
            return n[0] * n[0] + n[1] * n[1]
        }
        function r(n) {
            var i = u.sqrt(t(n));
            n[0] && (n[0] /= i);
            n[1] && (n[1] /= i)
        }
        n.add = function(n, t, i, r, u, f) {
            var e = [[], [], []], a = [[this.a, this.c, this.e], [this.b, this.d, this.f], [0, 0, 1]], l = [[n, i, u], [t, r, f], [0, 0, 1]], o, s, h, c;
            for (n && n instanceof ht && (l = [[n.a, n.c, n.e], [n.b, n.d, n.f], [0, 0, 1]]),
            o = 0; o < 3; o++)
                for (s = 0; s < 3; s++) {
                    for (c = 0,
                    h = 0; h < 3; h++)
                        c += a[o][h] * l[h][s];
                    e[o][s] = c
                }
            this.a = e[0][0];
            this.b = e[1][0];
            this.c = e[0][1];
            this.d = e[1][1];
            this.e = e[0][2];
            this.f = e[1][2]
        }
        ;
        n.invert = function() {
            var n = this
              , t = n.a * n.d - n.b * n.c;
            return new ht(n.d / t,-n.b / t,-n.c / t,n.a / t,(n.c * n.f - n.d * n.e) / t,(n.b * n.e - n.a * n.f) / t)
        }
        ;
        n.clone = function() {
            return new ht(this.a,this.b,this.c,this.d,this.e,this.f)
        }
        ;
        n.translate = function(n, t) {
            this.add(1, 0, 0, 1, n, t)
        }
        ;
        n.scale = function(n, t, i, r) {
            t == null && (t = n);
            (i || r) && this.add(1, 0, 0, 1, i, r);
            this.add(n, 0, 0, t, 0, 0);
            (i || r) && this.add(1, 0, 0, 1, -i, -r)
        }
        ;
        n.rotate = function(n, t, r) {
            n = i.rad(n);
            t = t || 0;
            r = r || 0;
            var f = +u.cos(n).toFixed(9)
              , e = +u.sin(n).toFixed(9);
            this.add(f, e, -e, f, t, r);
            this.add(1, 0, 0, 1, -t, -r)
        }
        ;
        n.x = function(n, t) {
            return n * this.a + t * this.c + this.e
        }
        ;
        n.y = function(n, t) {
            return n * this.b + t * this.d + this.f
        }
        ;
        n.get = function(n) {
            return +this[b.fromCharCode(97 + n)].toFixed(4)
        }
        ;
        n.toString = function() {
            return i.svg ? "matrix(" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)].join() + ")" : [this.get(0), this.get(2), this.get(1), this.get(3), 0, 0].join()
        }
        ;
        n.toFilter = function() {
            return "progid:DXImageTransform.Microsoft.Matrix(M11=" + this.get(0) + ", M12=" + this.get(2) + ", M21=" + this.get(1) + ", M22=" + this.get(3) + ", Dx=" + this.get(4) + ", Dy=" + this.get(5) + ", sizingmethod='auto expand')"
        }
        ;
        n.offset = function() {
            return [this.e.toFixed(4), this.f.toFixed(4)]
        }
        ;
        n.split = function() {
            var n = {}, f, e, o;
            return n.dx = this.e,
            n.dy = this.f,
            f = [[this.a, this.c], [this.b, this.d]],
            n.scalex = u.sqrt(t(f[0])),
            r(f[0]),
            n.shear = f[0][0] * f[1][0] + f[0][1] * f[1][1],
            f[1] = [f[1][0] - f[0][0] * n.shear, f[1][1] - f[0][1] * n.shear],
            n.scaley = u.sqrt(t(f[1])),
            r(f[1]),
            n.shear /= n.scaley,
            e = -f[0][1],
            o = f[1][1],
            o < 0 ? (n.rotate = i.deg(u.acos(o)),
            e < 0 && (n.rotate = 360 - n.rotate)) : n.rotate = i.deg(u.asin(e)),
            n.isSimple = !+n.shear.toFixed(9) && (n.scalex.toFixed(9) == n.scaley.toFixed(9) || !n.rotate),
            n.isSuperSimple = !+n.shear.toFixed(9) && n.scalex.toFixed(9) == n.scaley.toFixed(9) && !n.rotate,
            n.noRotation = !+n.shear.toFixed(9) && !n.rotate,
            n
        }
        ;
        n.toTransformString = function(n) {
            var t = n || this[ut]();
            return t.isSimple ? (t.scalex = +t.scalex.toFixed(4),
            t.scaley = +t.scaley.toFixed(4),
            t.rotate = +t.rotate.toFixed(4),
            (t.dx || t.dy ? "t" + [t.dx, t.dy] : d) + (t.scalex != 1 || t.scaley != 1 ? "s" + [t.scalex, t.scaley, 0, 0] : d) + (t.rotate ? "r" + [t.rotate, 0, 0] : d)) : "m" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)]
        }
    }(ht.prototype);
    var vf = function() {
        this.returnValue = !1
    }
      , yf = function() {
        return this.originalEvent.preventDefault()
    }
      , pf = function() {
        this.cancelBubble = !0
    }
      , wf = function() {
        return this.originalEvent.stopPropagation()
    }
      , ru = function(n) {
        var t = r.doc.documentElement.scrollTop || r.doc.body.scrollTop
          , i = r.doc.documentElement.scrollLeft || r.doc.body.scrollLeft;
        return {
            x: n.clientX + i,
            y: n.clientY + t
        }
    }
      , bf = function() {
        return r.doc.addEventListener ? function(n, t, i, r) {
            var f = function(n) {
                var t = ru(n);
                return i.call(r, n, t.x, t.y)
            }, u;
            return n.addEventListener(t, f, !1),
            kt && dt[t] && (u = function(t) {
                for (var f = ru(t), e = t, u = 0, o = t.targetTouches && t.targetTouches.length; u < o; u++)
                    if (t.targetTouches[u].target == n) {
                        t = t.targetTouches[u];
                        t.originalEvent = e;
                        t.preventDefault = yf;
                        t.stopPropagation = wf;
                        break
                    }
                return i.call(r, t, f.x, f.y)
            }
            ,
            n.addEventListener(dt[t], u, !1)),
            function() {
                return n.removeEventListener(t, f, !1),
                kt && dt[t] && n.removeEventListener(dt[t], u, !1),
                !0
            }
        }
        : r.doc.attachEvent ? function(n, t, i, u) {
            var f = function(n) {
                n = n || r.win.event;
                var t = r.doc.documentElement.scrollTop || r.doc.body.scrollTop
                  , f = r.doc.documentElement.scrollLeft || r.doc.body.scrollLeft
                  , e = n.clientX + f
                  , o = n.clientY + t;
                return n.preventDefault = n.preventDefault || vf,
                n.stopPropagation = n.stopPropagation || pf,
                i.call(u, n, e, o)
            };
            return n.attachEvent("on" + t, f),
            function() {
                return n.detachEvent("on" + t, f),
                !0
            }
        }
        : void 0
    }()
      , st = []
      , nr = function(n) {
        for (var f = n.clientX, e = n.clientY, v = r.doc.documentElement.scrollTop || r.doc.body.scrollTop, y = r.doc.documentElement.scrollLeft || r.doc.body.scrollLeft, i, l = st.length, s, o; l--; ) {
            if (i = st[l],
            kt && n.touches) {
                for (s = n.touches.length; s--; )
                    if (o = n.touches[s],
                    o.identifier == i.el._drag.id) {
                        f = o.clientX;
                        e = o.clientY;
                        (n.originalEvent ? n.originalEvent : n).preventDefault();
                        break
                    }
            } else
                n.preventDefault();
            var u = i.el.node, h, a = u.nextSibling, c = u.parentNode, p = u.style.display;
            r.win.opera && c.removeChild(u);
            u.style.display = "none";
            h = i.el.paper.getElementByPoint(f, e);
            u.style.display = p;
            r.win.opera && (a ? c.insertBefore(u, a) : c.appendChild(u));
            h && t("raphael.drag.over." + i.el.id, i.el, h);
            f += y;
            e += v;
            t("raphael.drag.move." + i.el.id, i.move_scope || i.el, f - i.el._drag.x, e - i.el._drag.y, f, e, n)
        }
    }
      , tr = function(n) {
        i.unmousemove(nr).unmouseup(tr);
        for (var u = st.length, r; u--; )
            r = st[u],
            r.el._drag = {},
            t("raphael.drag.end." + r.el.id, r.end_scope || r.start_scope || r.move_scope || r.el, n);
        st = []
    }
      , e = i.el = {};
    for (ir = hr.length; ir--; )
        (function(n) {
            i[n] = e[n] = function(t, u) {
                return i.is(t, "function") && (this.events = this.events || [],
                this.events.push({
                    name: n,
                    f: t,
                    unbind: bf(this.shape || this.node || r.doc, n, t, u || this)
                })),
                this
            }
            ;
            i["un" + n] = e["un" + n] = function(t) {
                for (var r = this.events || [], u = r.length; u--; )
                    r[u].name == n && (i.is(t, "undefined") || r[u].f == t) && (r[u].unbind(),
                    r.splice(u, 1),
                    r.length || delete this.events);
                return this
            }
        }
        )(hr[ir]);
    e.data = function(n, r) {
        var u = at[this.id] = at[this.id] || {}, f;
        if (arguments.length == 0)
            return u;
        if (arguments.length == 1) {
            if (i.is(n, "object")) {
                for (f in n)
                    n[a](f) && this.data(f, n[f]);
                return this
            }
            return t("raphael.data.get." + this.id, this, u[n], n),
            u[n]
        }
        return u[n] = r,
        t("raphael.data.set." + this.id, this, r, n),
        this
    }
    ;
    e.removeData = function(n) {
        return n == null ? at[this.id] = {} : at[this.id] && delete at[this.id][n],
        this
    }
    ;
    e.getData = function() {
        return pt(at[this.id] || {})
    }
    ;
    e.hover = function(n, t, i, r) {
        return this.mouseover(n, i).mouseout(t, r || i)
    }
    ;
    e.unhover = function(n, t) {
        return this.unmouseover(n).unmouseout(t)
    }
    ;
    ct = [];
    e.drag = function(n, u, f, e, o, s) {
        function h(h) {
            var l, c;
            (h.originalEvent || h).preventDefault();
            var a = h.clientX
              , v = h.clientY
              , y = r.doc.documentElement.scrollTop || r.doc.body.scrollTop
              , p = r.doc.documentElement.scrollLeft || r.doc.body.scrollLeft;
            if (this._drag.id = h.identifier,
            kt && h.touches)
                for (l = h.touches.length; l--; )
                    if (c = h.touches[l],
                    this._drag.id = c.identifier,
                    c.identifier == this._drag.id) {
                        a = c.clientX;
                        v = c.clientY;
                        break
                    }
            this._drag.x = a + p;
            this._drag.y = v + y;
            st.length || i.mousemove(nr).mouseup(tr);
            st.push({
                el: this,
                move_scope: e,
                start_scope: o,
                end_scope: s
            });
            u && t.on("raphael.drag.start." + this.id, u);
            n && t.on("raphael.drag.move." + this.id, n);
            f && t.on("raphael.drag.end." + this.id, f);
            t("raphael.drag.start." + this.id, o || e || this, h.clientX + p, h.clientY + y, h)
        }
        return this._drag = {},
        ct.push({
            el: this,
            start: h
        }),
        this.mousedown(h),
        this
    }
    ;
    e.onDragOver = function(n) {
        n ? t.on("raphael.drag.over." + this.id, n) : t.unbind("raphael.drag.over." + this.id)
    }
    ;
    e.undrag = function() {
        for (var n = ct.length; n--; )
            ct[n].el == this && (this.unmousedown(ct[n].start),
            ct.splice(n, 1),
            t.unbind("raphael.drag.*." + this.id));
        ct.length || i.unmousemove(nr).unmouseup(tr);
        st = []
    }
    ;
    c.circle = function(n, t, r) {
        var u = i._engine.circle(this, n || 0, t || 0, r || 0);
        return this.__set__ && this.__set__.push(u),
        u
    }
    ;
    c.rect = function(n, t, r, u, f) {
        var e = i._engine.rect(this, n || 0, t || 0, r || 0, u || 0, f || 0);
        return this.__set__ && this.__set__.push(e),
        e
    }
    ;
    c.ellipse = function(n, t, r, u) {
        var f = i._engine.ellipse(this, n || 0, t || 0, r || 0, u || 0);
        return this.__set__ && this.__set__.push(f),
        f
    }
    ;
    c.path = function(n) {
        !n || i.is(n, ni) || i.is(n[0], tt) || (n += d);
        var t = i._engine.path(i.format[v](i, arguments), this);
        return this.__set__ && this.__set__.push(t),
        t
    }
    ;
    c.image = function(n, t, r, u, f) {
        var e = i._engine.image(this, n || "about:blank", t || 0, r || 0, u || 0, f || 0);
        return this.__set__ && this.__set__.push(e),
        e
    }
    ;
    c.text = function(n, t, r) {
        var u = i._engine.text(this, n || 0, t || 0, b(r));
        return this.__set__ && this.__set__.push(u),
        u
    }
    ;
    c.set = function(n) {
        i.is(n, "array") || (n = Array.prototype.splice.call(arguments, 0, arguments.length));
        var t = new yt(n);
        return this.__set__ && this.__set__.push(t),
        t.paper = this,
        t.type = "set",
        t
    }
    ;
    c.setStart = function(n) {
        this.__set__ = n || this.set()
    }
    ;
    c.setFinish = function() {
        var n = this.__set__;
        return delete this.__set__,
        n
    }
    ;
    c.getSize = function() {
        var n = this.canvas.parentNode;
        return {
            width: n.offsetWidth,
            height: n.offsetHeight
        }
    }
    ;
    c.setSize = function(n, t) {
        return i._engine.setSize.call(this, n, t)
    }
    ;
    c.setViewBox = function(n, t, r, u, f) {
        return i._engine.setViewBox.call(this, n, t, r, u, f)
    }
    ;
    c.top = c.bottom = null;
    c.raphael = i;
    uu = function(n) {
        var u = n.getBoundingClientRect()
          , f = n.ownerDocument
          , t = f.body
          , i = f.documentElement
          , e = i.clientTop || t.clientTop || 0
          , o = i.clientLeft || t.clientLeft || 0
          , s = u.top + (r.win.pageYOffset || i.scrollTop || t.scrollTop) - e
          , h = u.left + (r.win.pageXOffset || i.scrollLeft || t.scrollLeft) - o;
        return {
            y: s,
            x: h
        }
    }
    ;
    c.getElementByPoint = function(n, t) {
        var o = this, f = o.canvas, i = r.doc.elementFromPoint(n, t), s, u, e;
        if (r.win.opera && i.tagName == "svg" && (s = uu(f),
        u = f.createSVGRect(),
        u.x = n - s.x,
        u.y = t - s.y,
        u.width = u.height = 1,
        e = f.getIntersectionList(u, null),
        e.length && (i = e[e.length - 1])),
        !i)
            return null;
        while (i.parentNode && i != f.parentNode && !i.raphael)
            i = i.parentNode;
        return i == o.canvas.parentNode && (i = f),
        i && i.raphael ? o.getById(i.raphaelid) : null
    }
    ;
    c.getElementsByBBox = function(n) {
        var t = this.set();
        return this.forEach(function(r) {
            i.isBBoxIntersect(r.getBBox(), n) && t.push(r)
        }),
        t
    }
    ;
    c.getById = function(n) {
        for (var t = this.bottom; t; ) {
            if (t.id == n)
                return t;
            t = t.next
        }
        return null
    }
    ;
    c.forEach = function(n, t) {
        for (var i = this.bottom; i; ) {
            if (n.call(t, i) === !1)
                return this;
            i = i.next
        }
        return this
    }
    ;
    c.getElementsByPoint = function(n, t) {
        var i = this.set();
        return this.forEach(function(r) {
            r.isPointInside(n, t) && i.push(r)
        }),
        i
    }
    ;
    e.isPointInside = function(n, t) {
        var r = this.realPath = ii[this.type](this);
        return this.attr("transform") && this.attr("transform").length && (r = i.transformPath(r, this.attr("transform"))),
        i.isPointInsidePath(r, n, t)
    }
    ;
    e.getBBox = function(n) {
        if (this.removed)
            return {};
        var t = this._;
        return n ? ((t.dirty || !t.bboxwt) && (this.realPath = ii[this.type](this),
        t.bboxwt = gi(this.realPath),
        t.bboxwt.toString = fu,
        t.dirty = 0),
        t.bboxwt) : ((t.dirty || t.dirtyT || !t.bbox) && ((t.dirty || !this.realPath) && (t.bboxwt = 0,
        this.realPath = ii[this.type](this)),
        t.bbox = gi(bi(this.realPath, this.matrix)),
        t.bbox.toString = fu,
        t.dirty = t.dirtyT = 0),
        t.bbox)
    }
    ;
    e.clone = function() {
        if (this.removed)
            return null;
        var n = this.paper[this.type]().attr(this.attr());
        return this.__set__ && this.__set__.push(n),
        n
    }
    ;
    e.glow = function(n) {
        var r;
        if (this.type == "text")
            return null;
        n = n || {};
        var t = {
            width: (n.width || 10) + (+this.attr("stroke-width") || 1),
            fill: n.fill || !1,
            opacity: n.opacity || .5,
            offsetx: n.offsetx || 0,
            offsety: n.offsety || 0,
            color: n.color || "#000"
        }
          , u = t.width / 2
          , f = this.paper
          , e = f.set()
          , i = this.realPath || ii[this.type](this);
        for (i = this.matrix ? bi(i, this.matrix) : i,
        r = 1; r < u + 1; r++)
            e.push(f.path(i).attr({
                stroke: t.color,
                fill: t.fill ? t.color : "none",
                "stroke-linejoin": "round",
                "stroke-linecap": "round",
                "stroke-width": +(t.width / u * r).toFixed(3),
                opacity: +(t.opacity / u).toFixed(3)
            }));
        return e.insertBefore(this).translate(t.offsetx, t.offsety)
    }
    ;
    var rr = function(n, t, r, u, f, e, o, s, h) {
        return h == null ? vt(n, t, r, u, f, e, o, s) : i.findDotsAtSegment(n, t, r, u, f, e, o, s, sf(n, t, r, u, f, e, o, s, h))
    }
      , ur = function(n, t) {
        return function(r, u, f) {
            var y, p;
            r = wt(r);
            var s, h, e, a, c = "", v = {}, o, l = 0;
            for (y = 0,
            p = r.length; y < p; y++) {
                if (e = r[y],
                e[0] == "M")
                    s = +e[1],
                    h = +e[2];
                else {
                    if (a = rr(s, h, e[1], e[2], e[3], e[4], e[5], e[6]),
                    l + a > u) {
                        if (t && !v.start) {
                            if (o = rr(s, h, e[1], e[2], e[3], e[4], e[5], e[6], u - l),
                            c += ["C" + o.start.x, o.start.y, o.m.x, o.m.y, o.x, o.y],
                            f)
                                return c;
                            v.start = c;
                            c = ["M" + o.x, o.y + "C" + o.n.x, o.n.y, o.end.x, o.end.y, e[5], e[6]].join();
                            l += a;
                            s = +e[5];
                            h = +e[6];
                            continue
                        }
                        if (!n && !t)
                            return o = rr(s, h, e[1], e[2], e[3], e[4], e[5], e[6], u - l),
                            {
                                x: o.x,
                                y: o.y,
                                alpha: o.alpha
                            }
                    }
                    l += a;
                    s = +e[5];
                    h = +e[6]
                }
                c += e.shift() + e
            }
            return v.end = c,
            o = n ? l : t ? v : i.findDotsAtSegment(s, h, e[0], e[1], e[2], e[3], e[4], e[5], 1),
            o.alpha && (o = {
                x: o.x,
                y: o.y,
                alpha: o.alpha
            }),
            o
        }
    }
      , eu = ur(1)
      , ou = ur()
      , fr = ur(0, 1);
    i.getTotalLength = eu;
    i.getPointAtLength = ou;
    i.getSubpath = function(n, t, i) {
        if (this.getTotalLength(n) - i < 1e-6)
            return fr(n, t).end;
        var r = fr(n, i, 1);
        return t ? fr(r, t).end : r
    }
    ;
    e.getTotalLength = function() {
        var n = this.getPath();
        if (n)
            return this.node.getTotalLength ? this.node.getTotalLength() : eu(n)
    }
    ;
    e.getPointAtLength = function(n) {
        var t = this.getPath();
        if (t)
            return ou(t, n)
    }
    ;
    e.getPath = function() {
        var n, t = i._getPath[this.type];
        if (this.type != "text" && this.type != "set")
            return t && (n = t(this)),
            n
    }
    ;
    e.getSubpath = function(n, t) {
        var r = this.getPath();
        if (r)
            return i.getSubpath(r, n, t)
    }
    ;
    g = i.easing_formulas = {
        linear: function(n) {
            return n
        },
        "<": function(n) {
            return nt(n, 1.7)
        },
        ">": function(n) {
            return nt(n, .48)
        },
        "<>": function(n) {
            var i = .48 - n / 1.04
              , r = u.sqrt(.1734 + i * i)
              , f = r - i
              , o = nt(y(f), 1 / 3) * (f < 0 ? -1 : 1)
              , e = -r - i
              , s = nt(y(e), 1 / 3) * (e < 0 ? -1 : 1)
              , t = o + s + .5;
            return (1 - t) * 3 * t * t + t * t * t
        },
        backIn: function(n) {
            var t = 1.70158;
            return n * n * ((t + 1) * n - t)
        },
        backOut: function(n) {
            n = n - 1;
            var t = 1.70158;
            return n * n * ((t + 1) * n + t) + 1
        },
        elastic: function(n) {
            return n == !!n ? n : nt(2, -10 * n) * u.sin((n - .075) * 2 * k / .3) + 1
        },
        bounce: function(n) {
            var r = 7.5625, t = 2.75, i;
            return n < 1 / t ? i = r * n * n : n < 2 / t ? (n -= 1.5 / t,
            i = r * n * n + .75) : n < 2.5 / t ? (n -= 2.25 / t,
            i = r * n * n + .9375) : (n -= 2.625 / t,
            i = r * n * n + .984375),
            i
        }
    };
    g.easeIn = g["ease-in"] = g["<"];
    g.easeOut = g["ease-out"] = g[">"];
    g.easeInOut = g["ease-in-out"] = g["<>"];
    g["back-in"] = g.backIn;
    g["back-out"] = g.backOut;
    var f = []
      , su = n.requestAnimationFrame || n.webkitRequestAnimationFrame || n.mozRequestAnimationFrame || n.oRequestAnimationFrame || n.msRequestAnimationFrame || function(n) {
        setTimeout(n, 16)
    }
      , er = function() {
        for (var ft = +new Date, b = 0, n, v, r, u, g, c, nt, y, ut; b < f.length; b++)
            if (n = f[b],
            !n.el.removed && !n.paused) {
                var k = ft - n.start, h = n.ms, et = n.easing, o = n.from, l = n.diff, tt = n.to, ot = n.t, w = n.el, it = {}, e, rt = {}, d;
                if (n.initstatus ? (k = (n.initstatus * n.anim.top - n.prev) / (n.percent - n.prev) * h,
                n.status = n.initstatus,
                delete n.initstatus,
                n.stop && f.splice(b--, 1)) : n.status = (n.prev + (n.percent - n.prev) * (k / h)) / n.anim.top,
                !(k < 0))
                    if (k < h) {
                        v = et(k / h);
                        for (r in o)
                            if (o[a](r)) {
                                switch (pi[r]) {
                                case p:
                                    e = +o[r] + v * h * l[r];
                                    break;
                                case "colour":
                                    e = "rgb(" + [or(yi(o[r].r + v * h * l[r].r)), or(yi(o[r].g + v * h * l[r].g)), or(yi(o[r].b + v * h * l[r].b))].join(",") + ")";
                                    break;
                                case "path":
                                    for (e = [],
                                    u = 0,
                                    g = o[r].length; u < g; u++) {
                                        for (e[u] = [o[r][u][0]],
                                        c = 1,
                                        nt = o[r][u].length; c < nt; c++)
                                            e[u][c] = +o[r][u][c] + v * h * l[r][u][c];
                                        e[u] = e[u].join(lt)
                                    }
                                    e = e.join(lt);
                                    break;
                                case "transform":
                                    if (l[r].real)
                                        for (e = [],
                                        u = 0,
                                        g = o[r].length; u < g; u++)
                                            for (e[u] = [o[r][u][0]],
                                            c = 1,
                                            nt = o[r][u].length; c < nt; c++)
                                                e[u][c] = o[r][u][c] + v * h * l[r][u][c];
                                    else
                                        y = function(n) {
                                            return +o[r][n] + v * h * l[r][n]
                                        }
                                        ,
                                        e = [["m", y(0), y(1), y(2), y(3), y(4), y(5)]];
                                    break;
                                case "csv":
                                    if (r == "clip-rect")
                                        for (e = [],
                                        u = 4; u--; )
                                            e[u] = +o[r][u] + v * h * l[r][u];
                                    break;
                                default:
                                    for (ut = [][s](o[r]),
                                    e = [],
                                    u = w.paper.customAttributes[r].length; u--; )
                                        e[u] = +ut[u] + v * h * l[r][u]
                                }
                                it[r] = e
                            }
                        w.attr(it),
                        function(n, i, r) {
                            setTimeout(function() {
                                t("raphael.anim.frame." + n, i, r)
                            })
                        }(w.id, w, n.anim)
                    } else {
                        if (function(n, r, u) {
                            setTimeout(function() {
                                t("raphael.anim.frame." + r.id, r, u);
                                t("raphael.anim.finish." + r.id, r, u);
                                i.is(n, "function") && n.call(r)
                            })
                        }(n.callback, w, n.anim),
                        w.attr(tt),
                        f.splice(b--, 1),
                        n.repeat > 1 && !n.next) {
                            for (d in tt)
                                tt[a](d) && (rt[d] = n.totalOrigin[d]);
                            n.el.attr(rt);
                            bt(n.anim, n.el, n.anim.percents[0], null, n.totalOrigin, n.repeat - 1)
                        }
                        n.next && !n.stop && bt(n.anim, n.el, n.next, null, n.totalOrigin, n.repeat)
                    }
            }
        f.length && su(er)
    }
      , or = function(n) {
        return n > 255 ? 255 : n < 0 ? 0 : n
    };
    e.animateWith = function(n, t, r, u, e, o) {
        var s = this, c, h, l;
        if (s.removed)
            return o && o.call(s),
            s;
        for (c = r instanceof ft ? r : i.animation(r, u, e, o),
        bt(c, s, c.percents[0], null, s.attr()),
        h = 0,
        l = f.length; h < l; h++)
            if (f[h].anim == t && f[h].el == n) {
                f[l - 1].start = f[h].start;
                break
            }
        return s
    }
    ;
    e.onAnimation = function(n) {
        return n ? t.on("raphael.anim.frame." + this.id, n) : t.unbind("raphael.anim.frame." + this.id),
        this
    }
    ;
    ft.prototype.delay = function(n) {
        var t = new ft(this.anim,this.ms);
        return t.times = this.times,
        t.del = +n || 0,
        t
    }
    ;
    ft.prototype.repeat = function(n) {
        var t = new ft(this.anim,this.ms);
        return t.del = this.del,
        t.times = u.floor(o(n, 0)) || 1,
        t
    }
    ;
    i.animation = function(n, t, r, u) {
        var o, l, f, e, s, c;
        if (n instanceof ft)
            return n;
        (i.is(r, "function") || !r) && (u = u || r || null,
        r = null);
        n = Object(n);
        t = +t || 0;
        o = {};
        for (f in n)
            n[a](f) && h(f) != f && h(f) + "%" != f && (l = !0,
            o[f] = n[f]);
        if (l)
            return r && (o.easing = r),
            u && (o.callback = u),
            new ft({
                100: o
            },t);
        if (u) {
            e = 0;
            for (s in n)
                c = et(s),
                n[a](s) && c > e && (e = c);
            e += "%";
            n[e].callback || (n[e].callback = u)
        }
        return new ft(n,t)
    }
    ;
    e.animate = function(n, t, r, u) {
        var f = this, e;
        return f.removed ? (u && u.call(f),
        f) : (e = n instanceof ft ? n : i.animation(n, t, r, u),
        bt(e, f, e.percents[0], null, f.attr()),
        f)
    }
    ;
    e.setTime = function(n, t) {
        return n && t != null && this.status(n, l(t, n.ms) / n.ms),
        this
    }
    ;
    e.status = function(n, t) {
        var u = [], r = 0, e, i;
        if (t != null)
            return bt(n, this, -1, l(t, 1)),
            this;
        for (e = f.length; r < e; r++)
            if (i = f[r],
            i.el.id == this.id && (!n || i.anim == n)) {
                if (n)
                    return i.status;
                u.push({
                    anim: i.anim,
                    status: i.status
                })
            }
        return n ? 0 : u
    }
    ;
    e.pause = function(n) {
        for (var i = 0; i < f.length; i++)
            f[i].el.id != this.id || n && f[i].anim != n || t("raphael.anim.pause." + this.id, this, f[i].anim) !== !1 && (f[i].paused = !0);
        return this
    }
    ;
    e.resume = function(n) {
        for (var r, i = 0; i < f.length; i++)
            f[i].el.id != this.id || n && f[i].anim != n || (r = f[i],
            t("raphael.anim.resume." + this.id, this, r.anim) !== !1 && (delete r.paused,
            this.status(r.anim, r.status)));
        return this
    }
    ;
    e.stop = function(n) {
        for (var i = 0; i < f.length; i++)
            f[i].el.id != this.id || n && f[i].anim != n || t("raphael.anim.stop." + this.id, this, f[i].anim) !== !1 && f.splice(i--, 1);
        return this
    }
    ;
    t.on("raphael.remove", hu);
    t.on("raphael.clear", hu);
    e.toString = function() {
        return "Raphaël’s object"
    }
    ;
    yt = function(n) {
        if (this.items = [],
        this.length = 0,
        this.type = "set",
        n)
            for (var t = 0, i = n.length; t < i; t++)
                n[t] && (n[t].constructor == e.constructor || n[t].constructor == yt) && (this[this.items.length] = this.items[this.items.length] = n[t],
                this.length++)
    }
    ;
    w = yt.prototype;
    w.push = function() {
        for (var n, t, i = 0, r = arguments.length; i < r; i++)
            n = arguments[i],
            n && (n.constructor == e.constructor || n.constructor == yt) && (t = this.items.length,
            this[t] = this.items[t] = n,
            this.length++);
        return this
    }
    ;
    w.pop = function() {
        return this.length && delete this[this.length--],
        this.items.pop()
    }
    ;
    w.forEach = function(n, t) {
        for (var i = 0, r = this.items.length; i < r; i++)
            if (n.call(t, this.items[i], i) === !1)
                return this;
        return this
    }
    ;
    for (ci in e)
        e[a](ci) && (w[ci] = function(n) {
            return function() {
                var t = arguments;
                return this.forEach(function(i) {
                    i[n][v](i, t)
                })
            }
        }(ci));
    w.attr = function(n, t) {
        var r, f, u, e;
        if (n && i.is(n, tt) && i.is(n[0], "object"))
            for (r = 0,
            f = n.length; r < f; r++)
                this.items[r].attr(n[r]);
        else
            for (u = 0,
            e = this.items.length; u < e; u++)
                this.items[u].attr(n, t);
        return this
    }
    ;
    w.clear = function() {
        while (this.length)
            this.pop()
    }
    ;
    w.splice = function(n, t) {
        var r;
        n = n < 0 ? o(this.length + n, 0) : n;
        t = o(0, l(this.length - n, t));
        for (var u = [], e = [], f = [], i = 2; i < arguments.length; i++)
            f.push(arguments[i]);
        for (i = 0; i < t; i++)
            e.push(this[n + i]);
        for (; i < this.length - n; i++)
            u.push(this[n + i]);
        for (r = f.length,
        i = 0; i < r + u.length; i++)
            this.items[n + i] = this[n + i] = i < r ? f[i] : u[i - r];
        for (i = this.items.length = this.length -= t - r; this[i]; )
            delete this[i++];
        return new yt(e)
    }
    ;
    w.exclude = function(n) {
        for (var t = 0, i = this.length; t < i; t++)
            if (this[t] == n)
                return this.splice(t, 1),
                !0
    }
    ;
    w.animate = function(n, t, r, u) {
        var o;
        (i.is(r, "function") || !r) && (u = r || null);
        var e = this.items.length, f = e, h, c = this, s;
        if (!e)
            return this;
        for (u && (s = function() {
            --e || u.call(c)
        }
        ),
        r = i.is(r, ni) ? r : s,
        o = i.animation(n, t, r, s),
        h = this.items[--f].animate(o); f--; )
            this.items[f] && !this.items[f].removed && this.items[f].animateWith(h, o, o),
            this.items[f] && !this.items[f].removed || e--;
        return this
    }
    ;
    w.insertAfter = function(n) {
        for (var t = this.items.length; t--; )
            this.items[t].insertAfter(n);
        return this
    }
    ;
    w.getBBox = function() {
        for (var n, t = [], i = [], r = [], u = [], f = this.items.length; f--; )
            this.items[f].removed || (n = this.items[f].getBBox(),
            t.push(n.x),
            i.push(n.y),
            r.push(n.x + n.width),
            u.push(n.y + n.height));
        return t = l[v](0, t),
        i = l[v](0, i),
        r = o[v](0, r),
        u = o[v](0, u),
        {
            x: t,
            y: i,
            x2: r,
            y2: u,
            width: r - t,
            height: u - i
        }
    }
    ;
    w.clone = function(n) {
        n = this.paper.set();
        for (var t = 0, i = this.items.length; t < i; t++)
            n.push(this.items[t].clone());
        return n
    }
    ;
    w.toString = function() {
        return "Raphaël‘s set"
    }
    ;
    w.glow = function(n) {
        var t = this.paper.set();
        return this.forEach(function(i) {
            var r = i.glow(n);
            r != null && r.forEach(function(n) {
                t.push(n)
            })
        }),
        t
    }
    ;
    w.isPointInside = function(n, t) {
        var i = !1;
        return this.forEach(function(r) {
            if (r.isPointInside(n, t))
                return i = !0,
                !1
        }),
        i
    }
    ;
    i.registerFont = function(n) {
        var i, u, f, r, t, e;
        if (!n.face)
            return n;
        this.fonts = this.fonts || {};
        i = {
            w: n.w,
            face: {},
            glyphs: {}
        };
        u = n.face["font-family"];
        for (f in n.face)
            n.face[a](f) && (i.face[f] = n.face[f]);
        if (this.fonts[u] ? this.fonts[u].push(i) : this.fonts[u] = [i],
        !n.svg) {
            i.face["units-per-em"] = et(n.face["units-per-em"], 10);
            for (r in n.glyphs)
                if (n.glyphs[a](r) && (t = n.glyphs[r],
                i.glyphs[r] = {
                    w: t.w,
                    k: {},
                    d: t.d && "M" + t.d.replace(/[mlcxtrv]/g, function(n) {
                        return {
                            l: "L",
                            c: "C",
                            x: "z",
                            t: "m",
                            r: "l",
                            v: "c"
                        }[n] || "M"
                    }) + "z"
                },
                t.k))
                    for (e in t.k)
                        t[a](e) && (i.glyphs[r].k[e] = t.k[e])
        }
        return n
    }
    ;
    c.getFont = function(n, t, r, u) {
        var f, h, o, e, s, c;
        if (u = u || "normal",
        r = r || "normal",
        t = +t || {
            normal: 400,
            bold: 700,
            lighter: 300,
            bolder: 800
        }[t] || 400,
        i.fonts) {
            if (f = i.fonts[n],
            !f) {
                h = new RegExp("(^|\\s)" + n.replace(/[^\w\d\s+!~.:_-]/g, d) + "(\\s|$)","i");
                for (o in i.fonts)
                    if (i.fonts[a](o) && h.test(o)) {
                        f = i.fonts[o];
                        break
                    }
            }
            if (f)
                for (s = 0,
                c = f.length; s < c; s++)
                    if (e = f[s],
                    e.face["font-weight"] == t && (e.face["font-style"] == r || !e.face["font-style"]) && e.face["font-stretch"] == u)
                        break;
            return e
        }
    }
    ;
    c.print = function(n, t, r, u, f, e, s, h) {
        var a, et, k, y;
        e = e || "middle";
        s = o(l(s || 0, 1), -1);
        h = o(l(h || 1, 3), 1);
        var v = b(r)[ut](d), g = 0, p = 0, tt = d, c;
        if (i.is(u, "string") && (u = this.getFont(u)),
        u) {
            c = (f || 16) / u.face["units-per-em"];
            var w = u.face.bbox[ut](ai)
              , it = +w[0]
              , nt = w[3] - w[1]
              , rt = 0
              , ft = +w[1] + (e == "baseline" ? nt + +u.face.descent : nt / 2);
            for (a = 0,
            et = v.length; a < et; a++)
                v[a] == "\n" ? (g = 0,
                y = 0,
                p = 0,
                rt += nt * h) : (k = p && u.glyphs[v[a - 1]] || {},
                y = u.glyphs[v[a]],
                g += p ? (k.w || u.w) + (k.k && k.k[v[a]] || 0) + u.w * s : 0,
                p = 1),
                y && y.d && (tt += i.transformPath(y.d, ["t", g * c, rt * c, "s", c, c, it, ft, "t", (n - it) / c, (t - ft) / c]))
        }
        return this.path(tt).attr({
            fill: "#000",
            stroke: "none"
        })
    }
    ;
    c.add = function(n) {
        if (i.is(n, "array"))
            for (var u = this.set(), r = 0, f = n.length, t; r < f; r++)
                t = n[r] || {},
                cu[a](t.type) && u.push(this[t.type]().attr(t));
        return u
    }
    ;
    i.format = function(n, t) {
        var r = i.is(t, tt) ? [0][s](t) : arguments;
        return n && i.is(n, ni) && r.length - 1 && (n = n.replace(lu, function(n, t) {
            return r[++t] == null ? d : r[t]
        })),
        n || d
    }
    ;
    i.fullfill = function() {
        var n = /\{([^\}]+)\}/g
          , t = /(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g
          , i = function(n, i, r) {
            var u = r;
            return i.replace(t, function(n, t, i, r, f) {
                t = t || r;
                u && (t in u && (u = u[t]),
                typeof u == "function" && f && (u = u()))
            }),
            u = (u == null || u == r ? n : u) + ""
        };
        return function(t, r) {
            return String(t).replace(n, function(n, t) {
                return i(n, t, r)
            })
        }
    }();
    i.ninja = function() {
        return vi.was ? r.win.Raphael = vi.is : delete Raphael,
        i
    }
    ;
    i.st = w;
    t.on("raphael.DOMload", function() {
        li = !0
    });
    return function(n, t, r) {
        function u() {
            /in/.test(n.readyState) ? setTimeout(u, 9) : i.eve("raphael.DOMload")
        }
        n.readyState == null && n.addEventListener && (n.addEventListener(t, r = function() {
            n.removeEventListener(t, r, !1);
            n.readyState = "complete"
        }
        , !1),
        n.readyState = "loading");
        u()
    }(document, "DOMContentLoaded"),
    function() {
        var tt, y;
        if (i.svg) {
            var t = "hasOwnProperty"
              , u = String
              , f = parseFloat
              , it = parseInt
              , l = Math
              , d = l.max
              , p = l.abs
              , g = l.pow
              , a = /[, ]+/
              , w = i.eve
              , o = ""
              , b = " "
              , v = "http://www.w3.org/1999/xlink"
              , et = {
                block: "M5,0 0,2.5 5,5z",
                classic: "M5,0 0,2.5 5,5 3.5,3 3.5,2z",
                diamond: "M2.5,0 5,2.5 2.5,5 0,2.5z",
                open: "M6,1 1,3.5 6,6",
                oval: "M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"
            }
              , e = {};
            i.toString = function() {
                return "Your browser supports SVG.\nYou are running Raphaël " + this.version
            }
            ;
            var n = function(r, f) {
                if (f) {
                    typeof r == "string" && (r = n(r));
                    for (var e in f)
                        f[t](e) && (e.substring(0, 6) == "xlink:" ? r.setAttributeNS(v, e.substring(6), u(f[e])) : r.setAttribute(e, u(f[e])))
                } else
                    r = i._g.doc.createElementNS("http://www.w3.org/2000/svg", r),
                    r.style && (r.style.webkitTapHighlightColor = "rgba(0,0,0,0)");
                return r
            }
              , rt = function(t, r) {
                var w = "linear", c = t.id + r, b = .5, s = .5, tt = t.node, it = t.paper, k = tt.style, a = i._g.doc.getElementById(c), v, e, nt, y, h, rt;
                if (!a) {
                    if (r = u(r).replace(i._radial_gradient, function(n, t, i) {
                        if (w = "radial",
                        t && i) {
                            b = f(t);
                            s = f(i);
                            var r = (s > .5) * 2 - 1;
                            g(b - .5, 2) + g(s - .5, 2) > .25 && (s = l.sqrt(.25 - g(b - .5, 2)) * r + .5) && s != .5 && (s = s.toFixed(5) - 1e-5 * r)
                        }
                        return o
                    }),
                    r = r.split(/\s*\-\s*/),
                    w == "linear") {
                        if (v = r.shift(),
                        v = -f(v),
                        isNaN(v))
                            return null;
                        e = [0, 0, l.cos(i.rad(v)), l.sin(i.rad(v))];
                        nt = 1 / (d(p(e[2]), p(e[3])) || 1);
                        e[2] *= nt;
                        e[3] *= nt;
                        e[2] < 0 && (e[0] = -e[2],
                        e[2] = 0);
                        e[3] < 0 && (e[1] = -e[3],
                        e[3] = 0)
                    }
                    if (y = i._parseDots(r),
                    !y)
                        return null;
                    if (c = c.replace(/[\(\)\s,\xb0#]/g, "_"),
                    t.gradient && c != t.gradient.id && (it.defs.removeChild(t.gradient),
                    delete t.gradient),
                    !t.gradient)
                        for (a = n(w + "Gradient", {
                            id: c
                        }),
                        t.gradient = a,
                        n(a, w == "radial" ? {
                            fx: b,
                            fy: s
                        } : {
                            x1: e[0],
                            y1: e[1],
                            x2: e[2],
                            y2: e[3],
                            gradientTransform: t.matrix.invert()
                        }),
                        it.defs.appendChild(a),
                        h = 0,
                        rt = y.length; h < rt; h++)
                            a.appendChild(n("stop", {
                                offset: y[h].offset ? y[h].offset : h ? "100%" : "0%",
                                "stop-color": y[h].color || "#fff"
                            }))
                }
                return n(tt, {
                    fill: "url('" + document.location + "#" + c + "')",
                    opacity: 1,
                    "fill-opacity": 1
                }),
                k.fill = o,
                k.opacity = 1,
                k.fillOpacity = 1,
                1
            }
              , k = function(t) {
                var i = t.getBBox(1);
                n(t.pattern, {
                    patternTransform: t.matrix.invert() + " translate(" + i.x + "," + i.y + ")"
                })
            }
              , s = function(r, f, s) {
                var k, w, g, tt, it, rt;
                if (r.type == "path") {
                    for (var ut = u(f).toLowerCase().split("-"), ht = r.paper, h = s ? "end" : "start", ct = r.node, l = r.attrs, d = l["stroke-width"], ft = ut.length, a = "classic", p, b, ot, st, c, v = 3, y = 3, nt = 5; ft--; )
                        switch (ut[ft]) {
                        case "block":
                        case "classic":
                        case "oval":
                        case "diamond":
                        case "open":
                        case "none":
                            a = ut[ft];
                            break;
                        case "wide":
                            y = 5;
                            break;
                        case "narrow":
                            y = 2;
                            break;
                        case "long":
                            v = 5;
                            break;
                        case "short":
                            v = 2
                        }
                    a == "open" ? (v += 2,
                    y += 2,
                    nt += 2,
                    ot = 1,
                    st = s ? 4 : 1,
                    c = {
                        fill: "none",
                        stroke: l.stroke
                    }) : (st = ot = v / 2,
                    c = {
                        fill: l.stroke,
                        stroke: "none"
                    });
                    r._.arrows ? s ? (r._.arrows.endPath && e[r._.arrows.endPath]--,
                    r._.arrows.endMarker && e[r._.arrows.endMarker]--) : (r._.arrows.startPath && e[r._.arrows.startPath]--,
                    r._.arrows.startMarker && e[r._.arrows.startMarker]--) : r._.arrows = {};
                    a != "none" ? (k = "raphael-marker-" + a,
                    w = "raphael-marker-" + h + a + v + y + "-obj" + r.id,
                    i._g.doc.getElementById(k) ? e[k]++ : (ht.defs.appendChild(n(n("path"), {
                        "stroke-linecap": "round",
                        d: et[a],
                        id: k
                    })),
                    e[k] = 1),
                    g = i._g.doc.getElementById(w),
                    g ? (e[w]++,
                    tt = g.getElementsByTagName("use")[0]) : (g = n(n("marker"), {
                        id: w,
                        markerHeight: y,
                        markerWidth: v,
                        orient: "auto",
                        refX: st,
                        refY: y / 2
                    }),
                    tt = n(n("use"), {
                        "xlink:href": "#" + k,
                        transform: (s ? "rotate(180 " + v / 2 + " " + y / 2 + ") " : o) + "scale(" + v / nt + "," + y / nt + ")",
                        "stroke-width": (2 / (v / nt + y / nt)).toFixed(4)
                    }),
                    g.appendChild(tt),
                    ht.defs.appendChild(g),
                    e[w] = 1),
                    n(tt, c),
                    it = ot * (a != "diamond" && a != "oval"),
                    s ? (p = r._.arrows.startdx * d || 0,
                    b = i.getTotalLength(l.path) - it * d) : (p = it * d,
                    b = i.getTotalLength(l.path) - (r._.arrows.enddx * d || 0)),
                    c = {},
                    c["marker-" + h] = "url(#" + (w == "undefined" ? null : w) + ")",
                    (b || p) && (c.d = i.getSubpath(l.path, p, b)),
                    n(ct, c),
                    r._.arrows[h + "Path"] = k,
                    r._.arrows[h + "Marker"] = w,
                    r._.arrows[h + "dx"] = it,
                    r._.arrows[h + "Type"] = a,
                    r._.arrows[h + "String"] = f) : (s ? (p = r._.arrows.startdx * d || 0,
                    b = i.getTotalLength(l.path) - p) : (p = 0,
                    b = i.getTotalLength(l.path) - (r._.arrows.enddx * d || 0)),
                    r._.arrows[h + "Path"] && n(ct, {
                        d: i.getSubpath(l.path, p, b)
                    }),
                    delete r._.arrows[h + "Path"],
                    delete r._.arrows[h + "Marker"],
                    delete r._.arrows[h + "dx"],
                    delete r._.arrows[h + "Type"],
                    delete r._.arrows[h + "String"]);
                    for (c in e)
                        e[t](c) && !e[c] && (rt = i._g.doc.getElementById(c),
                        rt && rt.parentNode.removeChild(rt))
                }
            }
              , ot = {
                "-": [3, 1],
                ".": [1, 1],
                "-.": [3, 1, 1, 1],
                "-..": [3, 1, 1, 1, 1, 1],
                ". ": [1, 3],
                "- ": [4, 3],
                "--": [8, 3],
                "- .": [4, 3, 1, 3],
                "--.": [8, 3, 1, 3],
                "--..": [8, 3, 1, 3, 1, 3]
            }
              , ut = function(t, i, r) {
                if (i = ot[u(i).toLowerCase()],
                i) {
                    for (var e = t.attrs["stroke-width"] || "1", s = {
                        round: e,
                        square: e,
                        butt: 0
                    }[t.attrs["stroke-linecap"] || r["stroke-linecap"]] || 0, o = [], f = i.length; f--; )
                        o[f] = i[f] * e + (f % 2 ? 1 : -1) * s;
                    n(t.node, {
                        "stroke-dasharray": o.join(",")
                    })
                } else
                    n(t.node, {
                        "stroke-dasharray": "none"
                    })
            }
              , nt = function(r, f) {
                var h = r.node, c = r.attrs, pt = h.style.visibility, l, e, b, vt, g, et, nt, y, ot, at, ht, ct, lt, w, tt, ft, yt;
                h.style.visibility = "hidden";
                for (l in f)
                    if (f[t](l)) {
                        if (!i._availableAttrs[t](l))
                            continue;
                        e = f[l];
                        c[l] = e;
                        switch (l) {
                        case "blur":
                            r.blur(e);
                            break;
                        case "title":
                            b = h.getElementsByTagName("title");
                            b.length && (b = b[0]) ? b.firstChild.nodeValue = e : (b = n("title"),
                            vt = i._g.doc.createTextNode(e),
                            b.appendChild(vt),
                            h.appendChild(b));
                            break;
                        case "href":
                        case "target":
                            g = h.parentNode;
                            g.tagName.toLowerCase() != "a" && (et = n("a"),
                            g.insertBefore(et, h),
                            et.appendChild(h),
                            g = et);
                            l == "target" ? g.setAttributeNS(v, "show", e == "blank" ? "new" : e) : g.setAttributeNS(v, l, e);
                            break;
                        case "cursor":
                            h.style.cursor = e;
                            break;
                        case "transform":
                            r.transform(e);
                            break;
                        case "arrow-start":
                            s(r, e);
                            break;
                        case "arrow-end":
                            s(r, e, 1);
                            break;
                        case "clip-rect":
                            nt = u(e).split(a);
                            nt.length == 4 && (r.clip && r.clip.parentNode.parentNode.removeChild(r.clip.parentNode),
                            y = n("clipPath"),
                            ot = n("rect"),
                            y.id = i.createUUID(),
                            n(ot, {
                                x: nt[0],
                                y: nt[1],
                                width: nt[2],
                                height: nt[3]
                            }),
                            y.appendChild(ot),
                            r.paper.defs.appendChild(y),
                            n(h, {
                                "clip-path": "url(#" + y.id + ")"
                            }),
                            r.clip = ot);
                            e || (at = h.getAttribute("clip-path"),
                            at && (ht = i._g.doc.getElementById(at.replace(/(^url\(#|\)$)/g, o)),
                            ht && ht.parentNode.removeChild(ht),
                            n(h, {
                                "clip-path": o
                            }),
                            delete r.clip));
                            break;
                        case "path":
                            r.type == "path" && (n(h, {
                                d: e ? c.path = i._pathToAbsolute(e) : "M0,0"
                            }),
                            r._.dirty = 1,
                            r._.arrows && ("startString"in r._.arrows && s(r, r._.arrows.startString),
                            "endString"in r._.arrows && s(r, r._.arrows.endString, 1)));
                            break;
                        case "width":
                            if (h.setAttribute(l, e),
                            r._.dirty = 1,
                            c.fx)
                                l = "x",
                                e = c.x;
                            else
                                break;
                        case "x":
                            c.fx && (e = -c.x - (c.width || 0));
                        case "rx":
                            if (l == "rx" && r.type == "rect")
                                break;
                        case "cx":
                            h.setAttribute(l, e);
                            r.pattern && k(r);
                            r._.dirty = 1;
                            break;
                        case "height":
                            if (h.setAttribute(l, e),
                            r._.dirty = 1,
                            c.fy)
                                l = "y",
                                e = c.y;
                            else
                                break;
                        case "y":
                            c.fy && (e = -c.y - (c.height || 0));
                        case "ry":
                            if (l == "ry" && r.type == "rect")
                                break;
                        case "cy":
                            h.setAttribute(l, e);
                            r.pattern && k(r);
                            r._.dirty = 1;
                            break;
                        case "r":
                            r.type == "rect" ? n(h, {
                                rx: e,
                                ry: e
                            }) : h.setAttribute(l, e);
                            r._.dirty = 1;
                            break;
                        case "src":
                            r.type == "image" && h.setAttributeNS(v, "href", e);
                            break;
                        case "stroke-width":
                            (r._.sx != 1 || r._.sy != 1) && (e /= d(p(r._.sx), p(r._.sy)) || 1);
                            h.setAttribute(l, e);
                            c["stroke-dasharray"] && ut(r, c["stroke-dasharray"], f);
                            r._.arrows && ("startString"in r._.arrows && s(r, r._.arrows.startString),
                            "endString"in r._.arrows && s(r, r._.arrows.endString, 1));
                            break;
                        case "stroke-dasharray":
                            ut(r, e, f);
                            break;
                        case "fill":
                            if (ct = u(e).match(i._ISURL),
                            ct) {
                                y = n("pattern");
                                lt = n("image");
                                y.id = i.createUUID();
                                n(y, {
                                    x: 0,
                                    y: 0,
                                    patternUnits: "userSpaceOnUse",
                                    height: 1,
                                    width: 1
                                });
                                n(lt, {
                                    x: 0,
                                    y: 0,
                                    "xlink:href": ct[1]
                                });
                                y.appendChild(lt),
                                function(t) {
                                    i._preload(ct[1], function() {
                                        var i = this.offsetWidth
                                          , r = this.offsetHeight;
                                        n(t, {
                                            width: i,
                                            height: r
                                        });
                                        n(lt, {
                                            width: i,
                                            height: r
                                        })
                                    })
                                }(y);
                                r.paper.defs.appendChild(y);
                                n(h, {
                                    fill: "url(#" + y.id + ")"
                                });
                                r.pattern = y;
                                r.pattern && k(r);
                                break
                            }
                            if (w = i.getRGB(e),
                            w.error) {
                                if ((r.type == "circle" || r.type == "ellipse" || u(e).charAt() != "r") && rt(r, e)) {
                                    ("opacity"in c || "fill-opacity"in c) && (tt = i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g, o)),
                                    tt && (ft = tt.getElementsByTagName("stop"),
                                    n(ft[ft.length - 1], {
                                        "stop-opacity": ("opacity"in c ? c.opacity : 1) * ("fill-opacity"in c ? c["fill-opacity"] : 1)
                                    })));
                                    c.gradient = e;
                                    c.fill = "none";
                                    break
                                }
                            } else
                                delete f.gradient,
                                delete c.gradient,
                                !i.is(c.opacity, "undefined") && i.is(f.opacity, "undefined") && n(h, {
                                    opacity: c.opacity
                                }),
                                !i.is(c["fill-opacity"], "undefined") && i.is(f["fill-opacity"], "undefined") && n(h, {
                                    "fill-opacity": c["fill-opacity"]
                                });
                            w[t]("opacity") && n(h, {
                                "fill-opacity": w.opacity > 1 ? w.opacity / 100 : w.opacity
                            });
                        case "stroke":
                            w = i.getRGB(e);
                            h.setAttribute(l, w.hex);
                            l == "stroke" && w[t]("opacity") && n(h, {
                                "stroke-opacity": w.opacity > 1 ? w.opacity / 100 : w.opacity
                            });
                            l == "stroke" && r._.arrows && ("startString"in r._.arrows && s(r, r._.arrows.startString),
                            "endString"in r._.arrows && s(r, r._.arrows.endString, 1));
                            break;
                        case "gradient":
                            (r.type == "circle" || r.type == "ellipse" || u(e).charAt() != "r") && rt(r, e);
                            break;
                        case "opacity":
                            c.gradient && !c[t]("stroke-opacity") && n(h, {
                                "stroke-opacity": e > 1 ? e / 100 : e
                            });
                        case "fill-opacity":
                            if (c.gradient) {
                                tt = i._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g, o));
                                tt && (ft = tt.getElementsByTagName("stop"),
                                n(ft[ft.length - 1], {
                                    "stop-opacity": e
                                }));
                                break
                            }
                        default:
                            l == "font-size" && (e = it(e, 10) + "px");
                            yt = l.replace(/(\-.)/g, function(n) {
                                return n.substring(1).toUpperCase()
                            });
                            h.style[yt] = e;
                            r._.dirty = 1;
                            h.setAttribute(l, e)
                        }
                    }
                st(r, f);
                h.style.visibility = pt
            }
              , ft = 1.2
              , st = function(r, f) {
                var y, h, l, e, a, p, v;
                if (r.type == "text" && (f[t]("text") || f[t]("font") || f[t]("font-size") || f[t]("x") || f[t]("y"))) {
                    var c = r.attrs
                      , s = r.node
                      , w = s.firstChild ? it(i._g.doc.defaultView.getComputedStyle(s.firstChild, o).getPropertyValue("font-size"), 10) : 10;
                    if (f[t]("text")) {
                        for (c.text = f.text; s.firstChild; )
                            s.removeChild(s.firstChild);
                        for (y = u(f.text).split("\n"),
                        h = [],
                        e = 0,
                        a = y.length; e < a; e++)
                            l = n("tspan"),
                            e && n(l, {
                                dy: w * ft,
                                x: c.x
                            }),
                            l.appendChild(i._g.doc.createTextNode(y[e])),
                            s.appendChild(l),
                            h[e] = l
                    } else
                        for (h = s.getElementsByTagName("tspan"),
                        e = 0,
                        a = h.length; e < a; e++)
                            e ? n(h[e], {
                                dy: w * ft,
                                x: c.x
                            }) : n(h[0], {
                                dy: 0
                            });
                    n(s, {
                        x: c.x,
                        y: c.y
                    });
                    r._.dirty = 1;
                    p = r._getBBox();
                    v = c.y - (p.y + p.height / 2);
                    v && i.is(v, "finite") && n(h[0], {
                        dy: v
                    })
                }
            }
              , c = function(n) {
                return n.parentNode && n.parentNode.tagName.toLowerCase() === "a" ? n.parentNode : n
            }
              , h = function(n, t) {
                this[0] = this.node = n;
                n.raphael = !0;
                this.id = i._oid++;
                n.raphaelid = this.id;
                this.matrix = i.matrix();
                this.realPath = null;
                this.paper = t;
                this.attrs = this.attrs || {};
                this._ = {
                    transform: [],
                    sx: 1,
                    sy: 1,
                    deg: 0,
                    dx: 0,
                    dy: 0,
                    dirty: 1
                };
                t.bottom || (t.bottom = this);
                this.prev = t.top;
                t.top && (t.top.next = this);
                t.top = this;
                this.next = null
            }
              , r = i.el;
            h.prototype = r;
            r.constructor = h;
            i._engine.path = function(t, i) {
                var u = n("path"), r;
                return i.canvas && i.canvas.appendChild(u),
                r = new h(u,i),
                r.type = "path",
                nt(r, {
                    fill: "none",
                    stroke: "#000",
                    path: t
                }),
                r
            }
            ;
            r.rotate = function(n, t, i) {
                if (this.removed)
                    return this;
                if (n = u(n).split(a),
                n.length - 1 && (t = f(n[1]),
                i = f(n[2])),
                n = f(n[0]),
                i == null && (t = i),
                t == null || i == null) {
                    var r = this.getBBox(1);
                    t = r.x + r.width / 2;
                    i = r.y + r.height / 2
                }
                return this.transform(this._.transform.concat([["r", n, t, i]])),
                this
            }
            ;
            r.scale = function(n, t, i, r) {
                if (this.removed)
                    return this;
                if (n = u(n).split(a),
                n.length - 1 && (t = f(n[1]),
                i = f(n[2]),
                r = f(n[3])),
                n = f(n[0]),
                t == null && (t = n),
                r == null && (i = r),
                i == null || r == null)
                    var e = this.getBBox(1);
                return i = i == null ? e.x + e.width / 2 : i,
                r = r == null ? e.y + e.height / 2 : r,
                this.transform(this._.transform.concat([["s", n, t, i, r]])),
                this
            }
            ;
            r.translate = function(n, t) {
                return this.removed ? this : (n = u(n).split(a),
                n.length - 1 && (t = f(n[1])),
                n = f(n[0]) || 0,
                t = +t || 0,
                this.transform(this._.transform.concat([["t", n, t]])),
                this)
            }
            ;
            r.transform = function(r) {
                var u = this._, f;
                return r == null ? u.transform : (i._extractTransform(this, r),
                this.clip && n(this.clip, {
                    transform: this.matrix.invert()
                }),
                this.pattern && k(this),
                this.node && n(this.node, {
                    transform: this.matrix
                }),
                (u.sx != 1 || u.sy != 1) && (f = this.attrs[t]("stroke-width") ? this.attrs["stroke-width"] : 1,
                this.attr({
                    "stroke-width": f
                })),
                this)
            }
            ;
            r.hide = function() {
                return this.removed || (this.node.style.display = "none"),
                this
            }
            ;
            r.show = function() {
                return this.removed || (this.node.style.display = ""),
                this
            }
            ;
            r.remove = function() {
                var r = c(this.node), n, t;
                if (!this.removed && r.parentNode) {
                    n = this.paper;
                    n.__set__ && n.__set__.exclude(this);
                    w.unbind("raphael.*.*." + this.id);
                    this.gradient && n.defs.removeChild(this.gradient);
                    i._tear(this, n);
                    r.parentNode.removeChild(r);
                    this.removeData();
                    for (t in this)
                        this[t] = typeof this[t] == "function" ? i._removedFactory(t) : null;
                    this.removed = !0
                }
            }
            ;
            r._getBBox = function() {
                var r, i, n, t;
                this.node.style.display == "none" && (this.show(),
                r = !0);
                i = !1;
                this.paper.canvas.parentElement ? n = this.paper.canvas.parentElement.style : this.paper.canvas.parentNode && (n = this.paper.canvas.parentNode.style);
                n && n.display == "none" && (i = !0,
                n.display = "");
                t = {};
                try {
                    t = this.node.getBBox()
                } catch (u) {
                    t = {
                        x: this.node.clientLeft,
                        y: this.node.clientTop,
                        width: this.node.clientWidth,
                        height: this.node.clientHeight
                    }
                } finally {
                    t = t || {};
                    i && (n.display = "none")
                }
                return r && this.hide(),
                t
            }
            ;
            r.attr = function(n, r) {
                var e, c, l, s, o, h, f, u, v, y;
                if (this.removed)
                    return this;
                if (n == null) {
                    e = {};
                    for (c in this.attrs)
                        this.attrs[t](c) && (e[c] = this.attrs[c]);
                    return e.gradient && e.fill == "none" && (e.fill = e.gradient) && delete e.gradient,
                    e.transform = this._.transform,
                    e
                }
                if (r == null && i.is(n, "string")) {
                    if (n == "fill" && this.attrs.fill == "none" && this.attrs.gradient)
                        return this.attrs.gradient;
                    if (n == "transform")
                        return this._.transform;
                    for (l = n.split(a),
                    s = {},
                    o = 0,
                    h = l.length; o < h; o++)
                        n = l[o],
                        s[n] = n in this.attrs ? this.attrs[n] : i.is(this.paper.customAttributes[n], "function") ? this.paper.customAttributes[n].def : i._availableAttrs[n];
                    return h - 1 ? s : s[l[0]]
                }
                if (r == null && i.is(n, "array")) {
                    for (s = {},
                    o = 0,
                    h = n.length; o < h; o++)
                        s[n[o]] = this.attr(n[o]);
                    return s
                }
                r != null ? (f = {},
                f[n] = r) : n != null && i.is(n, "object") && (f = n);
                for (u in f)
                    w("raphael.attr." + u + "." + this.id, this, f[u]);
                for (u in this.paper.customAttributes)
                    if (this.paper.customAttributes[t](u) && f[t](u) && i.is(this.paper.customAttributes[u], "function")) {
                        v = this.paper.customAttributes[u].apply(this, [].concat(f[u]));
                        this.attrs[u] = f[u];
                        for (y in v)
                            v[t](y) && (f[y] = v[y])
                    }
                return nt(this, f),
                this
            }
            ;
            r.toFront = function() {
                var n, t;
                return this.removed ? this : (n = c(this.node),
                n.parentNode.appendChild(n),
                t = this.paper,
                t.top != this && i._tofront(this, t),
                this)
            }
            ;
            r.toBack = function() {
                var n, t, r;
                return this.removed ? this : (n = c(this.node),
                t = n.parentNode,
                t.insertBefore(n, t.firstChild),
                i._toback(this, this.paper),
                r = this.paper,
                this)
            }
            ;
            r.insertAfter = function(n) {
                if (this.removed || !n)
                    return this;
                var r = c(this.node)
                  , t = c(n.node || n[n.length - 1].node);
                return t.nextSibling ? t.parentNode.insertBefore(r, t.nextSibling) : t.parentNode.appendChild(r),
                i._insertafter(this, n, this.paper),
                this
            }
            ;
            r.insertBefore = function(n) {
                if (this.removed || !n)
                    return this;
                var r = c(this.node)
                  , t = c(n.node || n[0].node);
                return t.parentNode.insertBefore(r, t),
                i._insertbefore(this, n, this.paper),
                this
            }
            ;
            r.blur = function(t) {
                var r = this, u, f;
                return +t != 0 ? (u = n("filter"),
                f = n("feGaussianBlur"),
                r.attrs.blur = t,
                u.id = i.createUUID(),
                n(f, {
                    stdDeviation: +t || 1.5
                }),
                u.appendChild(f),
                r.paper.defs.appendChild(u),
                r._blur = u,
                n(r.node, {
                    filter: "url(#" + u.id + ")"
                })) : (r._blur && (r._blur.parentNode.removeChild(r._blur),
                delete r._blur,
                delete r.attrs.blur),
                r.node.removeAttribute("filter")),
                r
            }
            ;
            i._engine.circle = function(t, i, r, u) {
                var e = n("circle"), f;
                return t.canvas && t.canvas.appendChild(e),
                f = new h(e,t),
                f.attrs = {
                    cx: i,
                    cy: r,
                    r: u,
                    fill: "none",
                    stroke: "#000"
                },
                f.type = "circle",
                n(e, f.attrs),
                f
            }
            ;
            i._engine.rect = function(t, i, r, u, f, e) {
                var s = n("rect"), o;
                return t.canvas && t.canvas.appendChild(s),
                o = new h(s,t),
                o.attrs = {
                    x: i,
                    y: r,
                    width: u,
                    height: f,
                    rx: e || 0,
                    ry: e || 0,
                    fill: "none",
                    stroke: "#000"
                },
                o.type = "rect",
                n(s, o.attrs),
                o
            }
            ;
            i._engine.ellipse = function(t, i, r, u, f) {
                var o = n("ellipse"), e;
                return t.canvas && t.canvas.appendChild(o),
                e = new h(o,t),
                e.attrs = {
                    cx: i,
                    cy: r,
                    rx: u,
                    ry: f,
                    fill: "none",
                    stroke: "#000"
                },
                e.type = "ellipse",
                n(o, e.attrs),
                e
            }
            ;
            i._engine.image = function(t, i, r, u, f, e) {
                var o = n("image"), s;
                return n(o, {
                    x: r,
                    y: u,
                    width: f,
                    height: e,
                    preserveAspectRatio: "none"
                }),
                o.setAttributeNS(v, "href", i),
                t.canvas && t.canvas.appendChild(o),
                s = new h(o,t),
                s.attrs = {
                    x: r,
                    y: u,
                    width: f,
                    height: e,
                    src: i
                },
                s.type = "image",
                s
            }
            ;
            i._engine.text = function(t, r, u, f) {
                var o = n("text"), e;
                return t.canvas && t.canvas.appendChild(o),
                e = new h(o,t),
                e.attrs = {
                    x: r,
                    y: u,
                    "text-anchor": "middle",
                    text: f,
                    "font-family": i._availableAttrs["font-family"],
                    "font-size": i._availableAttrs["font-size"],
                    stroke: "none",
                    fill: "#000"
                },
                e.type = "text",
                nt(e, e.attrs),
                e
            }
            ;
            i._engine.setSize = function(n, t) {
                return this.width = n || this.width,
                this.height = t || this.height,
                this.canvas.setAttribute("width", this.width),
                this.canvas.setAttribute("height", this.height),
                this._viewBox && this.setViewBox.apply(this, this._viewBox),
                this
            }
            ;
            i._engine.create = function() {
                var u = i._getContainer.apply(0, arguments), t = u && u.container, o = u.x, s = u.y, f = u.width, e = u.height, r, h, c;
                if (!t)
                    throw new Error("SVG container not found.");
                return r = n("svg"),
                h = "overflow:hidden;",
                o = o || 0,
                s = s || 0,
                f = f || 512,
                e = e || 342,
                n(r, {
                    height: e,
                    version: 1.1,
                    width: f,
                    xmlns: "http://www.w3.org/2000/svg",
                    "xmlns:xlink": "http://www.w3.org/1999/xlink"
                }),
                t == 1 ? (r.style.cssText = h + "position:absolute;left:" + o + "px;top:" + s + "px",
                i._g.doc.body.appendChild(r),
                c = 1) : (r.style.cssText = h + "position:relative",
                t.firstChild ? t.insertBefore(r, t.firstChild) : t.appendChild(r)),
                t = new i._Paper,
                t.width = f,
                t.height = e,
                t.canvas = r,
                t.clear(),
                t._left = t._top = 0,
                c && (t.renderfix = function() {}
                ),
                t.renderfix(),
                t
            }
            ;
            i._engine.setViewBox = function(t, i, r, u, f) {
                w("raphael.setViewBox", this, this._viewBox, [t, i, r, u, f]);
                var h = this.getSize(), o = d(r / h.width, u / h.height), e = this.top, l = f ? "xMidYMid meet" : "xMinYMin", s, c;
                for (t == null ? (this._vbSize && (o = 1),
                delete this._vbSize,
                s = "0 0 " + this.width + b + this.height) : (this._vbSize = o,
                s = t + b + i + b + r + b + u),
                n(this.canvas, {
                    viewBox: s,
                    preserveAspectRatio: l
                }); o && e; )
                    c = "stroke-width"in e.attrs ? e.attrs["stroke-width"] : 1,
                    e.attr({
                        "stroke-width": c
                    }),
                    e._.dirty = 1,
                    e._.dirtyT = 1,
                    e = e.prev;
                return this._viewBox = [t, i, r, u, !!f],
                this
            }
            ;
            i.prototype.renderfix = function() {
                var n = this.canvas, u = n.style, t, i, r;
                try {
                    t = n.getScreenCTM() || n.createSVGMatrix()
                } catch (f) {
                    t = n.createSVGMatrix()
                }
                i = -t.e % 1;
                r = -t.f % 1;
                (i || r) && (i && (this._left = (this._left + i) % 1,
                u.left = this._left + "px"),
                r && (this._top = (this._top + r) % 1,
                u.top = this._top + "px"))
            }
            ;
            i.prototype.clear = function() {
                i.eve("raphael.clear", this);
                for (var t = this.canvas; t.firstChild; )
                    t.removeChild(t.firstChild);
                this.bottom = this.top = null;
                (this.desc = n("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël " + i.version));
                t.appendChild(this.desc);
                t.appendChild(this.defs = n("defs"))
            }
            ;
            i.prototype.remove = function() {
                w("raphael.remove", this);
                this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
                for (var n in this)
                    this[n] = typeof this[n] == "function" ? i._removedFactory(n) : null
            }
            ;
            tt = i.st;
            for (y in r)
                r[t](y) && !tt[t](y) && (tt[y] = function(n) {
                    return function() {
                        var t = arguments;
                        return this.forEach(function(i) {
                            i[n].apply(i, t)
                        })
                    }
                }(y))
        }
    }(),
    function() {
        var s, k, y;
        if (i.vml) {
            var h = "hasOwnProperty"
              , r = String
              , f = parseFloat
              , c = Math
              , e = c.round
              , d = c.max
              , g = c.min
              , p = c.abs
              , l = "fill"
              , a = /[, ]+/
              , ut = i.eve
              , ft = " progid:DXImageTransform.Microsoft"
              , o = " "
              , u = ""
              , nt = {
                M: "m",
                L: "l",
                C: "c",
                Z: "x",
                m: "t",
                l: "r",
                c: "v",
                z: "x"
            }
              , et = /([clmz]),?([^clmz]*)/gi
              , ot = / progid:\S+Blur\([^\)]+\)/g
              , st = /-?[^,\s-]+/g
              , tt = "position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)"
              , n = 21600
              , ht = {
                path: 1,
                rect: 1,
                image: 1
            }
              , ct = {
                circle: 1,
                ellipse: 1
            }
              , lt = function(t) {
                var l = /[ahqstv]/ig, a = i._pathToAbsolute, v, c, y, f, s, w, h, p;
                if (r(t).match(l) && (a = i._path2curve),
                l = /[clmz]/g,
                a == i._pathToAbsolute && !r(t).match(l))
                    return r(t).replace(et, function(t, i, r) {
                        var u = []
                          , o = i.toLowerCase() == "m"
                          , f = nt[i];
                        return r.replace(st, function(t) {
                            o && u.length == 2 && (f += u + nt[i == "m" ? "l" : "L"],
                            u = []);
                            u.push(e(t * n))
                        }),
                        f + u
                    });
                for (c = a(t),
                v = [],
                s = 0,
                w = c.length; s < w; s++) {
                    for (y = c[s],
                    f = c[s][0].toLowerCase(),
                    f == "z" && (f = "x"),
                    h = 1,
                    p = y.length; h < p; h++)
                        f += e(y[h] * n) + (h != p - 1 ? "," : u);
                    v.push(f)
                }
                return v.join(o)
            }
              , it = function(n, t, r) {
                var u = i.matrix();
                return u.rotate(-n, .5, .5),
                {
                    dx: u.x(t, r),
                    dy: u.y(t, r)
                }
            }
              , w = function(t, i, r, u, f, e) {
                var v = t._, k = t.matrix, h = v.fillpos, c = t.node, y = c.style, w = 1, b = "", d = n / i, g = n / r, a, s;
                (y.visibility = "hidden",
                i && r) && (c.coordsize = p(d) + o + p(g),
                y.rotation = e * (i * r < 0 ? -1 : 1),
                e && (a = it(e, u, f),
                u = a.dx,
                f = a.dy),
                i < 0 && (b += "x"),
                r < 0 && (b += " y") && (w = -1),
                y.flip = b,
                c.coordorigin = u * -d + o + f * -g,
                (h || v.fillsize) && (s = c.getElementsByTagName(l),
                s = s && s[0],
                c.removeChild(s),
                h && (a = it(e, k.x(h[0], h[1]), k.y(h[0], h[1])),
                s.position = a.dx * w + o + a.dy * w),
                v.fillsize && (s.size = v.fillsize[0] * p(i) + o + v.fillsize[1] * p(r)),
                c.appendChild(s)),
                y.visibility = "visible")
            };
            i.toString = function() {
                return "Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël " + this.version
            }
            ;
            var rt = function(n, t, i) {
                for (var u = r(t).toLowerCase().split("-"), o = i ? "end" : "start", f = u.length, s = "classic", h = "medium", c = "medium", e; f--; )
                    switch (u[f]) {
                    case "block":
                    case "classic":
                    case "oval":
                    case "diamond":
                    case "open":
                    case "none":
                        s = u[f];
                        break;
                    case "wide":
                    case "narrow":
                        c = u[f];
                        break;
                    case "long":
                    case "short":
                        h = u[f]
                    }
                e = n.node.getElementsByTagName("stroke")[0];
                e[o + "arrow"] = s;
                e[o + "arrowlength"] = h;
                e[o + "arrowwidth"] = c
            }
              , v = function(t, c) {
                var yt, nt, ot, ut, ft, y, si, pt, st, tt, k, dt, gt, et, ni, vt, ri, bt, hi;
                t.attrs = t.attrs || {};
                var b = t.node
                  , v = t.attrs
                  , it = b.style
                  , ui = ht[t.type] && (c.x != v.x || c.y != v.y || c.width != v.width || c.height != v.height || c.cx != v.cx || c.cy != v.cy || c.rx != v.rx || c.ry != v.ry || c.r != v.r)
                  , ci = ct[t.type] && (v.cx != c.cx || v.cy != c.cy || v.r != c.r || v.rx != c.rx || v.ry != c.ry)
                  , p = t;
                for (yt in c)
                    c[h](yt) && (v[yt] = c[yt]);
                if (ui && (v.path = i._getPath[t.type](t),
                t._.dirty = 1),
                c.href && (b.href = c.href),
                c.title && (b.title = c.title),
                c.target && (b.target = c.target),
                c.cursor && (it.cursor = c.cursor),
                "blur"in c && t.blur(c.blur),
                (c.path && t.type == "path" || ui) && (b.path = lt(~r(v.path).toLowerCase().indexOf("r") ? i._pathToAbsolute(v.path) : v.path),
                t._.dirty = 1,
                t.type == "image" && (t._.fillpos = [v.x, v.y],
                t._.fillsize = [v.width, v.height],
                w(t, 1, 1, 0, 0, 0))),
                "transform"in c && t.transform(c.transform),
                ci) {
                    var kt = +v.cx
                      , fi = +v.cy
                      , ei = +v.rx || +v.r || 0
                      , oi = +v.ry || +v.r || 0;
                    b.path = i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x", e((kt - ei) * n), e((fi - oi) * n), e((kt + ei) * n), e((fi + oi) * n), e(kt * n));
                    t._.dirty = 1
                }
                if ("clip-rect"in c && (nt = r(c["clip-rect"]).split(a),
                nt.length == 4 && (nt[2] = +nt[2] + +nt[0],
                nt[3] = +nt[3] + +nt[1],
                ot = b.clipRect || i._g.doc.createElement("div"),
                ut = ot.style,
                ut.clip = i.format("rect({1}px {2}px {3}px {0}px)", nt),
                b.clipRect || (ut.position = "absolute",
                ut.top = 0,
                ut.left = 0,
                ut.width = t.paper.width + "px",
                ut.height = t.paper.height + "px",
                b.parentNode.insertBefore(ot, b),
                ot.appendChild(b),
                b.clipRect = ot)),
                c["clip-rect"] || b.clipRect && (b.clipRect.style.clip = "auto")),
                t.textpath && (ft = t.textpath.style,
                c.font && (ft.font = c.font),
                c["font-family"] && (ft.fontFamily = '"' + c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g, u) + '"'),
                c["font-size"] && (ft.fontSize = c["font-size"]),
                c["font-weight"] && (ft.fontWeight = c["font-weight"]),
                c["font-style"] && (ft.fontStyle = c["font-style"])),
                "arrow-start"in c && rt(p, c["arrow-start"]),
                "arrow-end"in c && rt(p, c["arrow-end"], 1),
                (c.opacity != null || c["stroke-width"] != null || c.fill != null || c.src != null || c.stroke != null || c["stroke-width"] != null || c["stroke-opacity"] != null || c["fill-opacity"] != null || c["stroke-dasharray"] != null || c["stroke-miterlimit"] != null || c["stroke-linejoin"] != null || c["stroke-linecap"] != null) && (y = b.getElementsByTagName(l),
                si = !1,
                y = y && y[0],
                y || (si = y = s(l)),
                t.type == "image" && c.src && (y.src = c.src),
                c.fill && (y.on = !0),
                (y.on == null || c.fill == "none" || c.fill === null) && (y.on = !1),
                y.on && c.fill && (pt = r(c.fill).match(i._ISURL),
                pt ? (y.parentNode == b && b.removeChild(y),
                y.rotate = !0,
                y.src = pt[1],
                y.type = "tile",
                st = t.getBBox(1),
                y.position = st.x + o + st.y,
                t._.fillpos = [st.x, st.y],
                i._preload(pt[1], function() {
                    t._.fillsize = [this.offsetWidth, this.offsetHeight]
                })) : (y.color = i.getRGB(c.fill).hex,
                y.src = u,
                y.type = "solid",
                i.getRGB(c.fill).error && (p.type in {
                    circle: 1,
                    ellipse: 1
                } || r(c.fill).charAt() != "r") && at(p, c.fill, y) && (v.fill = "none",
                v.gradient = c.fill,
                y.rotate = !1))),
                ("fill-opacity"in c || "opacity"in c) && (tt = ((+v["fill-opacity"] + 1 || 2) - 1) * ((+v.opacity + 1 || 2) - 1) * ((+i.getRGB(c.fill).o + 1 || 2) - 1),
                tt = g(d(tt, 0), 1),
                y.opacity = tt,
                y.src && (y.color = "none")),
                b.appendChild(y),
                k = b.getElementsByTagName("stroke") && b.getElementsByTagName("stroke")[0],
                dt = !1,
                k || (dt = k = s("stroke")),
                (c.stroke && c.stroke != "none" || c["stroke-width"] || c["stroke-opacity"] != null || c["stroke-dasharray"] || c["stroke-miterlimit"] || c["stroke-linejoin"] || c["stroke-linecap"]) && (k.on = !0),
                (c.stroke == "none" || c.stroke === null || k.on == null || c.stroke == 0 || c["stroke-width"] == 0) && (k.on = !1),
                gt = i.getRGB(c.stroke),
                k.on && c.stroke && (k.color = gt.hex),
                tt = ((+v["stroke-opacity"] + 1 || 2) - 1) * ((+v.opacity + 1 || 2) - 1) * ((+gt.o + 1 || 2) - 1),
                et = (f(c["stroke-width"]) || 1) * .75,
                tt = g(d(tt, 0), 1),
                c["stroke-width"] == null && (et = v["stroke-width"]),
                c["stroke-width"] && (k.weight = et),
                et && et < 1 && (tt *= et) && (k.weight = 1),
                k.opacity = tt,
                c["stroke-linejoin"] && (k.joinstyle = c["stroke-linejoin"] || "miter"),
                k.miterlimit = c["stroke-miterlimit"] || 8,
                c["stroke-linecap"] && (k.endcap = c["stroke-linecap"] == "butt" ? "flat" : c["stroke-linecap"] == "square" ? "square" : "round"),
                "stroke-dasharray"in c && (ni = {
                    "-": "shortdash",
                    ".": "shortdot",
                    "-.": "shortdashdot",
                    "-..": "shortdashdotdot",
                    ". ": "dot",
                    "- ": "dash",
                    "--": "longdash",
                    "- .": "dashdot",
                    "--.": "longdashdot",
                    "--..": "longdashdotdot"
                },
                k.dashstyle = ni[h](c["stroke-dasharray"]) ? ni[c["stroke-dasharray"]] : u),
                dt && b.appendChild(k)),
                p.type == "text") {
                    p.paper.canvas.style.display = u;
                    var ti = p.paper.span
                      , ii = 100
                      , wt = v.font && v.font.match(/\d+(?:\.\d*)?(?=px)/);
                    for (it = ti.style,
                    v.font && (it.font = v.font),
                    v["font-family"] && (it.fontFamily = v["font-family"]),
                    v["font-weight"] && (it.fontWeight = v["font-weight"]),
                    v["font-style"] && (it.fontStyle = v["font-style"]),
                    wt = f(v["font-size"] || wt && wt[0]) || 10,
                    it.fontSize = wt * ii + "px",
                    p.textpath.string && (ti.innerHTML = r(p.textpath.string).replace(/</g, "&#60;").replace(/&/g, "&#38;").replace(/\n/g, "<br>")),
                    vt = ti.getBoundingClientRect(),
                    p.W = v.w = (vt.right - vt.left) / ii,
                    p.H = v.h = (vt.bottom - vt.top) / ii,
                    p.X = v.x,
                    p.Y = v.y + p.H / 2,
                    (("x"in c) || ("y"in c)) && (p.path.v = i.format("m{0},{1}l{2},{1}", e(v.x * n), e(v.y * n), e(v.x * n) + 1)),
                    ri = ["x", "y", "text", "font", "font-family", "font-weight", "font-style", "font-size"],
                    bt = 0,
                    hi = ri.length; bt < hi; bt++)
                        if (ri[bt]in c) {
                            p._.dirty = 1;
                            break
                        }
                    switch (v["text-anchor"]) {
                    case "start":
                        p.textpath.style["v-text-align"] = "left";
                        p.bbx = p.W / 2;
                        break;
                    case "end":
                        p.textpath.style["v-text-align"] = "right";
                        p.bbx = -p.W / 2;
                        break;
                    default:
                        p.textpath.style["v-text-align"] = "center";
                        p.bbx = 0
                    }
                    p.textpath.style["v-text-kern"] = !0
                }
            }
              , at = function(n, t, e) {
                var l, s, a, h, w;
                n.attrs = n.attrs || {};
                var b = n.attrs
                  , v = Math.pow
                  , y = "linear"
                  , p = ".5 .5";
                if ((n.attrs.gradient = t,
                t = r(t).replace(i._radial_gradient, function(n, t, i) {
                    return y = "radial",
                    t && i && (t = f(t),
                    i = f(i),
                    v(t - .5, 2) + v(i - .5, 2) > .25 && (i = c.sqrt(.25 - v(t - .5, 2)) * ((i > .5) * 2 - 1) + .5),
                    p = t + o + i),
                    u
                }),
                t = t.split(/\s*\-\s*/),
                y == "linear" && (l = t.shift(),
                l = -f(l),
                isNaN(l))) || (s = i._parseDots(t),
                !s))
                    return null;
                if (n = n.shape || n.node,
                s.length) {
                    for (n.removeChild(e),
                    e.on = !0,
                    e.method = "none",
                    e.color = s[0].color,
                    e.color2 = s[s.length - 1].color,
                    a = [],
                    h = 0,
                    w = s.length; h < w; h++)
                        s[h].offset && a.push(s[h].offset + o + s[h].color);
                    e.colors = a.length ? a.join() : "0% " + e.color;
                    y == "radial" ? (e.type = "gradientTitle",
                    e.focus = "100%",
                    e.focussize = "0 0",
                    e.focusposition = p,
                    e.angle = 0) : (e.type = "gradient",
                    e.angle = (270 - l) % 360);
                    n.appendChild(e)
                }
                return 1
            }
              , b = function(n, t) {
                this[0] = this.node = n;
                n.raphael = !0;
                this.id = i._oid++;
                n.raphaelid = this.id;
                this.X = 0;
                this.Y = 0;
                this.attrs = {};
                this.paper = t;
                this.matrix = i.matrix();
                this._ = {
                    transform: [],
                    sx: 1,
                    sy: 1,
                    dx: 0,
                    dy: 0,
                    deg: 0,
                    dirty: 1,
                    dirtyT: 1
                };
                t.bottom || (t.bottom = this);
                this.prev = t.top;
                t.top && (t.top.next = this);
                t.top = this;
                this.next = null
            }
              , t = i.el;
            b.prototype = t;
            t.constructor = b;
            t.transform = function(t) {
                var e, a, h;
                if (t == null)
                    return this._.transform;
                e = this.paper._viewBoxShift;
                a = e ? "s" + [e.scale, e.scale] + "-1-1t" + [e.dx, e.dy] : u;
                e && (h = t = r(t).replace(/\.{3}|\u2026/g, this._.transform || u));
                i._extractTransform(this, a + t);
                var s = this.matrix.clone(), c = this.skew, l = this.node, f, v = ~r(this.attrs.fill).indexOf("-"), d = !r(this.attrs.fill).indexOf("url(");
                if (s.translate(1, 1),
                d || v || this.type == "image")
                    if (c.matrix = "1 0 0 1",
                    c.offset = "0 0",
                    f = s.split(),
                    v && f.noRotation || !f.isSimple) {
                        l.style.filter = s.toFilter();
                        var y = this.getBBox()
                          , p = this.getBBox(1)
                          , b = y.x - p.x
                          , k = y.y - p.y;
                        l.coordorigin = b * -n + o + k * -n;
                        w(this, 1, 1, b, k, 0)
                    } else
                        l.style.filter = u,
                        w(this, f.scalex, f.scaley, f.dx, f.dy, f.rotate);
                else
                    l.style.filter = u,
                    c.matrix = r(s),
                    c.offset = s.offset();
                return h !== null && (this._.transform = h,
                i._extractTransform(this, h)),
                this
            }
            ;
            t.rotate = function(n, t, i) {
                if (this.removed)
                    return this;
                if (n != null) {
                    if (n = r(n).split(a),
                    n.length - 1 && (t = f(n[1]),
                    i = f(n[2])),
                    n = f(n[0]),
                    i == null && (t = i),
                    t == null || i == null) {
                        var u = this.getBBox(1);
                        t = u.x + u.width / 2;
                        i = u.y + u.height / 2
                    }
                    return this._.dirtyT = 1,
                    this.transform(this._.transform.concat([["r", n, t, i]])),
                    this
                }
            }
            ;
            t.translate = function(n, t) {
                return this.removed ? this : (n = r(n).split(a),
                n.length - 1 && (t = f(n[1])),
                n = f(n[0]) || 0,
                t = +t || 0,
                this._.bbox && (this._.bbox.x += n,
                this._.bbox.y += t),
                this.transform(this._.transform.concat([["t", n, t]])),
                this)
            }
            ;
            t.scale = function(n, t, i, u) {
                if (this.removed)
                    return this;
                if (n = r(n).split(a),
                n.length - 1 && (t = f(n[1]),
                i = f(n[2]),
                u = f(n[3]),
                isNaN(i) && (i = null),
                isNaN(u) && (u = null)),
                n = f(n[0]),
                t == null && (t = n),
                u == null && (i = u),
                i == null || u == null)
                    var e = this.getBBox(1);
                return i = i == null ? e.x + e.width / 2 : i,
                u = u == null ? e.y + e.height / 2 : u,
                this.transform(this._.transform.concat([["s", n, t, i, u]])),
                this._.dirtyT = 1,
                this
            }
            ;
            t.hide = function() {
                return this.removed || (this.node.style.display = "none"),
                this
            }
            ;
            t.show = function() {
                return this.removed || (this.node.style.display = u),
                this
            }
            ;
            t.auxGetBBox = i.el.getBBox;
            t.getBBox = function() {
                var t = this.auxGetBBox(), n, i;
                return this.paper && this.paper._viewBoxShift ? (n = {},
                i = 1 / this.paper._viewBoxShift.scale,
                n.x = t.x - this.paper._viewBoxShift.dx,
                n.x *= i,
                n.y = t.y - this.paper._viewBoxShift.dy,
                n.y *= i,
                n.width = t.width * i,
                n.height = t.height * i,
                n.x2 = n.x + n.width,
                n.y2 = n.y + n.height,
                n) : t
            }
            ;
            t._getBBox = function() {
                return this.removed ? {} : {
                    x: this.X + (this.bbx || 0) - this.W / 2,
                    y: this.Y - this.H,
                    width: this.W,
                    height: this.H
                }
            }
            ;
            t.remove = function() {
                if (!this.removed && this.node.parentNode) {
                    this.paper.__set__ && this.paper.__set__.exclude(this);
                    i.eve.unbind("raphael.*.*." + this.id);
                    i._tear(this, this.paper);
                    this.node.parentNode.removeChild(this.node);
                    this.shape && this.shape.parentNode.removeChild(this.shape);
                    for (var n in this)
                        this[n] = typeof this[n] == "function" ? i._removedFactory(n) : null;
                    this.removed = !0
                }
            }
            ;
            t.attr = function(n, t) {
                var f, c, y, o, e, s, r, u, p, w;
                if (this.removed)
                    return this;
                if (n == null) {
                    f = {};
                    for (c in this.attrs)
                        this.attrs[h](c) && (f[c] = this.attrs[c]);
                    return f.gradient && f.fill == "none" && (f.fill = f.gradient) && delete f.gradient,
                    f.transform = this._.transform,
                    f
                }
                if (t == null && i.is(n, "string")) {
                    if (n == l && this.attrs.fill == "none" && this.attrs.gradient)
                        return this.attrs.gradient;
                    for (y = n.split(a),
                    o = {},
                    e = 0,
                    s = y.length; e < s; e++)
                        n = y[e],
                        o[n] = n in this.attrs ? this.attrs[n] : i.is(this.paper.customAttributes[n], "function") ? this.paper.customAttributes[n].def : i._availableAttrs[n];
                    return s - 1 ? o : o[y[0]]
                }
                if (this.attrs && t == null && i.is(n, "array")) {
                    for (o = {},
                    e = 0,
                    s = n.length; e < s; e++)
                        o[n[e]] = this.attr(n[e]);
                    return o
                }
                t != null && (r = {},
                r[n] = t);
                t == null && i.is(n, "object") && (r = n);
                for (u in r)
                    ut("raphael.attr." + u + "." + this.id, this, r[u]);
                if (r) {
                    for (u in this.paper.customAttributes)
                        if (this.paper.customAttributes[h](u) && r[h](u) && i.is(this.paper.customAttributes[u], "function")) {
                            p = this.paper.customAttributes[u].apply(this, [].concat(r[u]));
                            this.attrs[u] = r[u];
                            for (w in p)
                                p[h](w) && (r[w] = p[w])
                        }
                    r.text && this.type == "text" && (this.textpath.string = r.text);
                    v(this, r)
                }
                return this
            }
            ;
            t.toFront = function() {
                return this.removed || this.node.parentNode.appendChild(this.node),
                this.paper && this.paper.top != this && i._tofront(this, this.paper),
                this
            }
            ;
            t.toBack = function() {
                return this.removed ? this : (this.node.parentNode.firstChild != this.node && (this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild),
                i._toback(this, this.paper)),
                this)
            }
            ;
            t.insertAfter = function(n) {
                return this.removed ? this : (n.constructor == i.st.constructor && (n = n[n.length - 1]),
                n.node.nextSibling ? n.node.parentNode.insertBefore(this.node, n.node.nextSibling) : n.node.parentNode.appendChild(this.node),
                i._insertafter(this, n, this.paper),
                this)
            }
            ;
            t.insertBefore = function(n) {
                return this.removed ? this : (n.constructor == i.st.constructor && (n = n[0]),
                n.node.parentNode.insertBefore(this.node, n.node),
                i._insertbefore(this, n, this.paper),
                this)
            }
            ;
            t.blur = function(n) {
                var t = this.node.runtimeStyle
                  , r = t.filter;
                return r = r.replace(ot, u),
                +n != 0 ? (this.attrs.blur = n,
                t.filter = r + o + ft + ".Blur(pixelradius=" + (+n || 1.5) + ")",
                t.margin = i.format("-{0}px 0 0 -{0}px", e(+n || 1.5))) : (t.filter = r,
                t.margin = 0,
                delete this.attrs.blur),
                this
            }
            ;
            i._engine.path = function(t, i) {
                var f = s("shape"), r, h, e;
                return f.style.cssText = tt,
                f.coordsize = n + o + n,
                f.coordorigin = i.coordorigin,
                r = new b(f,i),
                h = {
                    fill: "none",
                    stroke: "#000"
                },
                t && (h.path = t),
                r.type = "path",
                r.path = [],
                r.Path = u,
                v(r, h),
                i.canvas.appendChild(f),
                e = s("skew"),
                e.on = !0,
                f.appendChild(e),
                r.skew = e,
                r.transform(u),
                r
            }
            ;
            i._engine.rect = function(n, t, r, u, f, e) {
                var h = i._rectPath(t, r, u, f, e)
                  , o = n.path(h)
                  , s = o.attrs;
                return o.X = s.x = t,
                o.Y = s.y = r,
                o.W = s.width = u,
                o.H = s.height = f,
                s.r = e,
                s.path = h,
                o.type = "rect",
                o
            }
            ;
            i._engine.ellipse = function(n, t, i, r, u) {
                var f = n.path()
                  , e = f.attrs;
                return f.X = t - r,
                f.Y = i - u,
                f.W = r * 2,
                f.H = u * 2,
                f.type = "ellipse",
                v(f, {
                    cx: t,
                    cy: i,
                    rx: r,
                    ry: u
                }),
                f
            }
            ;
            i._engine.circle = function(n, t, i, r) {
                var u = n.path()
                  , f = u.attrs;
                return u.X = t - r,
                u.Y = i - r,
                u.W = u.H = r * 2,
                u.type = "circle",
                v(u, {
                    cx: t,
                    cy: i,
                    r: r
                }),
                u
            }
            ;
            i._engine.image = function(n, t, r, u, f, e) {
                var a = i._rectPath(r, u, f, e)
                  , o = n.path(a).attr({
                    stroke: "none"
                })
                  , s = o.attrs
                  , c = o.node
                  , h = c.getElementsByTagName(l)[0];
                return s.src = t,
                o.X = s.x = r,
                o.Y = s.y = u,
                o.W = s.width = f,
                o.H = s.height = e,
                s.path = a,
                o.type = "image",
                h.parentNode == c && c.removeChild(h),
                h.rotate = !0,
                h.src = t,
                h.type = "tile",
                o._.fillpos = [r, u],
                o._.fillsize = [f, e],
                c.appendChild(h),
                w(o, 1, 1, 0, 0, 0),
                o
            }
            ;
            i._engine.text = function(t, f, h, c) {
                var a = s("shape"), y = s("path"), p = s("textpath"), l, k, w;
                return f = f || 0,
                h = h || 0,
                c = c || "",
                y.v = i.format("m{0},{1}l{2},{1}", e(f * n), e(h * n), e(f * n) + 1),
                y.textpathok = !0,
                p.string = r(c),
                p.on = !0,
                a.style.cssText = tt,
                a.coordsize = n + o + n,
                a.coordorigin = "0 0",
                l = new b(a,t),
                k = {
                    fill: "#000",
                    stroke: "none",
                    font: i._availableAttrs.font,
                    text: c
                },
                l.shape = a,
                l.path = y,
                l.textpath = p,
                l.type = "text",
                l.attrs.text = r(c),
                l.attrs.x = f,
                l.attrs.y = h,
                l.attrs.w = 1,
                l.attrs.h = 1,
                v(l, k),
                a.appendChild(p),
                a.appendChild(y),
                t.canvas.appendChild(a),
                w = s("skew"),
                w.on = !0,
                a.appendChild(w),
                l.skew = w,
                l.transform(u),
                l
            }
            ;
            i._engine.setSize = function(n, t) {
                var r = this.canvas.style;
                return this.width = n,
                this.height = t,
                n == +n && (n += "px"),
                t == +t && (t += "px"),
                r.width = n,
                r.height = t,
                r.clip = "rect(0 " + n + " " + t + " 0)",
                this._viewBox && i._engine.setViewBox.apply(this, this._viewBox),
                this
            }
            ;
            i._engine.setViewBox = function(n, t, r, u, f) {
                i.eve("raphael.setViewBox", this, this._viewBox, [n, t, r, u, f]);
                var s = this.getSize(), h = s.width, c = s.height, e, o;
                return f && (e = c / u,
                o = h / r,
                r * e < h && (n -= (h - r * e) / 2 / e),
                u * o < c && (t -= (c - u * o) / 2 / o)),
                this._viewBox = [n, t, r, u, !!f],
                this._viewBoxShift = {
                    dx: -n,
                    dy: -t,
                    scale: s
                },
                this.forEach(function(n) {
                    n.transform("...")
                }),
                this
            }
            ;
            i._engine.initWin = function(n) {
                var t = n.document;
                t.styleSheets.length < 31 ? t.createStyleSheet().addRule(".rvml", "behavior:url(#default#VML)") : t.styleSheets[0].addRule(".rvml", "behavior:url(#default#VML)");
                try {
                    t.namespaces.rvml || t.namespaces.add("rvml", "urn:schemas-microsoft-com:vml");
                    s = function(n) {
                        return t.createElement("<rvml:" + n + ' class="rvml">')
                    }
                } catch (i) {
                    s = function(n) {
                        return t.createElement("<" + n + ' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')
                    }
                }
            }
            ;
            i._engine.initWin(i._g.win);
            i._engine.create = function() {
                var e = i._getContainer.apply(0, arguments)
                  , f = e.container
                  , r = e.height
                  , u = e.width
                  , c = e.x
                  , l = e.y;
                if (!f)
                    throw new Error("VML container not found.");
                var t = new i._Paper
                  , s = t.canvas = i._g.doc.createElement("div")
                  , h = s.style;
                return c = c || 0,
                l = l || 0,
                u = u || 512,
                r = r || 342,
                t.width = u,
                t.height = r,
                u == +u && (u += "px"),
                r == +r && (r += "px"),
                t.coordsize = n * 1e3 + o + n * 1e3,
                t.coordorigin = "0 0",
                t.span = i._g.doc.createElement("span"),
                t.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",
                s.appendChild(t.span),
                h.cssText = i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden", u, r),
                f == 1 ? (i._g.doc.body.appendChild(s),
                h.left = c + "px",
                h.top = l + "px",
                h.position = "absolute") : f.firstChild ? f.insertBefore(s, f.firstChild) : f.appendChild(s),
                t.renderfix = function() {}
                ,
                t
            }
            ;
            i.prototype.clear = function() {
                i.eve("raphael.clear", this);
                this.canvas.innerHTML = u;
                this.span = i._g.doc.createElement("span");
                this.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";
                this.canvas.appendChild(this.span);
                this.bottom = this.top = null
            }
            ;
            i.prototype.remove = function() {
                i.eve("raphael.remove", this);
                this.canvas.parentNode.removeChild(this.canvas);
                for (var n in this)
                    this[n] = typeof this[n] == "function" ? i._removedFactory(n) : null;
                return !0
            }
            ;
            k = i.st;
            for (y in t)
                t[h](y) && !k[h](y) && (k[y] = function(n) {
                    return function() {
                        var t = arguments;
                        return this.forEach(function(i) {
                            i[n].apply(i, t)
                        })
                    }
                }(y))
        }
    }(),
    vi.was ? r.win.Raphael = i : Raphael = i,
    typeof exports == "object" && (module.exports = i),
    i
});
/*! D:\FW_API\scripts\proj4js-compressed.js*/
/**@preserve
  proj4js.js -- Javascript reprojection library. 
  
  Authors:      Mike Adair madairATdmsolutions.ca
                Richard Greenwood richATgreenwoodmap.com
                Didier Richard didier.richardATign.fr
                Stephen Irons stephen.ironsATclear.net.nz
                Olivier Terral oterralATgmail.com
                
  License:      
 Copyright (c) 2012, Mike Adair, Richard Greenwood, Didier Richard, 
                     Stephen Irons and Olivier Terral
 Permission is hereby granted, free of charge, to any person obtaining a
 copy of this software and associated documentation files (the "Software"),
 to deal in the Software without restriction, including without limitation
 the rights to use, copy, modify, merge, publish, distribute, sublicense,
 and/or sell copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following conditions:
 The above copyright notice and this permission notice shall be included
 in all copies or substantial portions of the Software.
 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 DEALINGS IN THE SOFTWARE.
 
 Note: This program is an almost direct port of the C library PROJ.4.
*/
Proj4js = {
    defaultDatum: "WGS84",
    transform: function(n, t, i) {
        if (!n.readyToUse)
            return this.reportError("Proj4js initialization for:" + n.srsCode + " not yet complete"),
            i;
        if (!t.readyToUse)
            return this.reportError("Proj4js initialization for:" + t.srsCode + " not yet complete"),
            i;
        if (n.datum && t.datum && ((n.datum.datum_type == Proj4js.common.PJD_3PARAM || n.datum.datum_type == Proj4js.common.PJD_7PARAM) && "WGS84" != t.datumCode || (t.datum.datum_type == Proj4js.common.PJD_3PARAM || t.datum.datum_type == Proj4js.common.PJD_7PARAM) && "WGS84" != n.datumCode)) {
            var r = Proj4js.WGS84;
            this.transform(n, r, i);
            n = r
        }
        return "enu" != n.axis && this.adjust_axis(n, !1, i),
        "longlat" == n.projName ? (i.x *= Proj4js.common.D2R,
        i.y *= Proj4js.common.D2R) : (n.to_meter && (i.x *= n.to_meter,
        i.y *= n.to_meter),
        n.inverse(i)),
        n.from_greenwich && (i.x += n.from_greenwich),
        i = this.datum_transform(n.datum, t.datum, i),
        t.from_greenwich && (i.x -= t.from_greenwich),
        "longlat" == t.projName ? (i.x *= Proj4js.common.R2D,
        i.y *= Proj4js.common.R2D) : (t.forward(i),
        t.to_meter && (i.x /= t.to_meter,
        i.y /= t.to_meter)),
        "enu" != t.axis && this.adjust_axis(t, !0, i),
        i
    },
    datum_transform: function(n, t, i) {
        return n.compare_datums(t) || n.datum_type == Proj4js.common.PJD_NODATUM || t.datum_type == Proj4js.common.PJD_NODATUM ? i : ((n.es != t.es || n.a != t.a || n.datum_type == Proj4js.common.PJD_3PARAM || n.datum_type == Proj4js.common.PJD_7PARAM || t.datum_type == Proj4js.common.PJD_3PARAM || t.datum_type == Proj4js.common.PJD_7PARAM) && (n.geodetic_to_geocentric(i),
        (n.datum_type == Proj4js.common.PJD_3PARAM || n.datum_type == Proj4js.common.PJD_7PARAM) && n.geocentric_to_wgs84(i),
        (t.datum_type == Proj4js.common.PJD_3PARAM || t.datum_type == Proj4js.common.PJD_7PARAM) && t.geocentric_from_wgs84(i),
        t.geocentric_to_geodetic(i)),
        i)
    },
    adjust_axis: function(n, t, i) {
        for (var e = i.x, o = i.y, s = i.z || 0, r, u, f = 0; 3 > f; f++)
            if (!t || !(2 == f && void 0 === i.z))
                switch (0 == f ? (r = e,
                u = "x") : 1 == f ? (r = o,
                u = "y") : (r = s,
                u = "z"),
                n.axis[f]) {
                case "e":
                    i[u] = r;
                    break;
                case "w":
                    i[u] = -r;
                    break;
                case "n":
                    i[u] = r;
                    break;
                case "s":
                    i[u] = -r;
                    break;
                case "u":
                    void 0 !== i[u] && (i.z = r);
                    break;
                case "d":
                    void 0 !== i[u] && (i.z = -r);
                    break;
                default:
                    return alert("ERROR: unknow axis (" + n.axis[f] + ") - check definition of " + n.projName),
                    null
                }
        return i
    },
    reportError: function() {},
    extend: function(n, t) {
        var i, r;
        if (n = n || {},
        t)
            for (i in t)
                r = t[i],
                void 0 !== r && (n[i] = r);
        return n
    },
    Class: function() {
        for (var t = function() {
            this.initialize.apply(this, arguments)
        }, i = {}, r, n = 0; n < arguments.length; ++n)
            r = "function" == typeof arguments[n] ? arguments[n].prototype : arguments[n],
            Proj4js.extend(i, r);
        return t.prototype = i,
        t
    },
    bind: function(n, t) {
        var i = Array.prototype.slice.apply(arguments, [2]);
        return function() {
            var r = i.concat(Array.prototype.slice.apply(arguments, [0]));
            return n.apply(t, r)
        }
    },
    scriptName: "proj4js-compressed.js",
    defsLookupService: "http://spatialreference.org/ref",
    libPath: null,
    getScriptLocation: function() {
        var n, i;
        if (this.libPath)
            return this.libPath;
        for (var r = this.scriptName, u = r.length, f = document.getElementsByTagName("script"), t = 0; t < f.length; t++)
            if (n = f[t].getAttribute("src"),
            n && (i = n.lastIndexOf(r),
            -1 < i && i + u == n.length)) {
                this.libPath = n.slice(0, -u);
                break
            }
        return this.libPath || ""
    },
    loadScript: function(n, t, i, r) {
        var u = document.createElement("script");
        u.defer = !1;
        u.type = "text/javascript";
        u.id = n;
        u.src = n;
        u.onload = t;
        u.onerror = i;
        u.loadCheck = r;
        /MSIE/.test(navigator.userAgent) && (u.onreadystatechange = this.checkReadyState);
        document.getElementsByTagName("head")[0].appendChild(u)
    },
    checkReadyState: function() {
        "loaded" == this.readyState && (this.loadCheck() ? this.onload() : this.onerror())
    }
};
Proj4js.Proj = Proj4js.Class({
    readyToUse: !1,
    title: null,
    projName: null,
    units: null,
    datum: null,
    x0: 0,
    y0: 0,
    localCS: !1,
    queue: null,
    initialize: function(n, t) {
        if (this.srsCodeInput = n,
        this.queue = [],
        t && this.queue.push(t),
        0 <= n.indexOf("GEOGCS") || 0 <= n.indexOf("GEOCCS") || 0 <= n.indexOf("PROJCS") || 0 <= n.indexOf("LOCAL_CS"))
            this.parseWKT(n),
            this.deriveConstants(),
            this.loadProjCode(this.projName);
        else {
            if (0 == n.indexOf("urn:")) {
                var i = n.split(":");
                ("ogc" == i[1] || "x-ogc" == i[1]) && "def" == i[2] && "crs" == i[3] && (n = i[4] + ":" + i[i.length - 1])
            } else
                0 == n.indexOf("http://") && (i = n.split("#"),
                i[0].match(/epsg.org/) ? n = "EPSG:" + i[1] : i[0].match(/RIG.xml/) && (n = "IGNF:" + i[1]));
            this.srsCode = n.toUpperCase();
            0 == this.srsCode.indexOf("EPSG") ? (this.srsCode = this.srsCode,
            this.srsAuth = "epsg",
            this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("IGNF") ? (this.srsCode = this.srsCode,
            this.srsAuth = "IGNF",
            this.srsProjNumber = this.srsCode.substring(5)) : 0 == this.srsCode.indexOf("CRS") ? (this.srsCode = this.srsCode,
            this.srsAuth = "CRS",
            this.srsProjNumber = this.srsCode.substring(4)) : (this.srsAuth = "",
            this.srsProjNumber = this.srsCode);
            this.loadProjDefinition()
        }
    },
    loadProjDefinition: function() {
        if (Proj4js.defs[this.srsCode])
            this.defsLoaded();
        else {
            var n = Proj4js.getScriptLocation() + "defs/" + this.srsAuth.toUpperCase() + this.srsProjNumber + ".js";
            Proj4js.loadScript(n, Proj4js.bind(this.defsLoaded, this), Proj4js.bind(this.loadFromService, this), Proj4js.bind(this.checkDefsLoaded, this))
        }
    },
    loadFromService: function() {
        Proj4js.loadScript(Proj4js.defsLookupService + "/" + this.srsAuth + "/" + this.srsProjNumber + "/proj4js/", Proj4js.bind(this.defsLoaded, this), Proj4js.bind(this.defsFailed, this), Proj4js.bind(this.checkDefsLoaded, this))
    },
    defsLoaded: function() {
        this.parseDefs();
        this.loadProjCode(this.projName)
    },
    checkDefsLoaded: function() {
        return Proj4js.defs[this.srsCode] ? !0 : !1
    },
    defsFailed: function() {
        Proj4js.reportError("failed to load projection definition for: " + this.srsCode);
        Proj4js.defs[this.srsCode] = Proj4js.defs.WGS84;
        this.defsLoaded()
    },
    loadProjCode: function(n) {
        if (Proj4js.Proj[n])
            this.initTransforms();
        else {
            var t = Proj4js.getScriptLocation() + "projCode/" + n + ".js";
            Proj4js.loadScript(t, Proj4js.bind(this.loadProjCodeSuccess, this, n), Proj4js.bind(this.loadProjCodeFailure, this, n), Proj4js.bind(this.checkCodeLoaded, this, n))
        }
    },
    loadProjCodeSuccess: function(n) {
        Proj4js.Proj[n].dependsOn ? this.loadProjCode(Proj4js.Proj[n].dependsOn) : this.initTransforms()
    },
    loadProjCodeFailure: function(n) {
        Proj4js.reportError("failed to find projection file for: " + n)
    },
    checkCodeLoaded: function(n) {
        return Proj4js.Proj[n] ? !0 : !1
    },
    initTransforms: function() {
        if (Proj4js.extend(this, Proj4js.Proj[this.projName]),
        this.init(),
        this.readyToUse = !0,
        this.queue)
            for (var n; n = this.queue.shift(); )
                n.call(this, this)
    },
    wktRE: /^(\w+)\[(.*)\]$/,
    parseWKT: function(n) {
        var r, t, i, f, e;
        if (n = n.match(this.wktRE)) {
            r = n[1];
            t = n[2].split(",");
            i = "TOWGS84" == r.toUpperCase() ? r : t.shift();
            i = i.replace(/^\"/, "");
            i = i.replace(/\"$/, "");
            for (var n = [], s = 0, o = "", u = 0; u < t.length; ++u) {
                for (f = t[u],
                e = 0; e < f.length; ++e)
                    "[" == f.charAt(e) && ++s,
                    "]" == f.charAt(e) && --s;
                o += f;
                0 === s ? (n.push(o),
                o = "") : o += ","
            }
            switch (r) {
            case "LOCAL_CS":
                this.projName = "identity";
                this.localCS = !0;
                this.srsCode = i;
                break;
            case "GEOGCS":
                this.projName = "longlat";
                this.geocsCode = i;
                this.srsCode || (this.srsCode = i);
                break;
            case "PROJCS":
                this.srsCode = i;
                break;
            case "PROJECTION":
                this.projName = Proj4js.wktProjections[i];
                break;
            case "DATUM":
                this.datumName = i;
                break;
            case "LOCAL_DATUM":
                this.datumCode = "none";
                break;
            case "SPHEROID":
                this.ellps = i;
                this.a = parseFloat(n.shift());
                this.rf = parseFloat(n.shift());
                break;
            case "PRIMEM":
                this.from_greenwich = parseFloat(n.shift());
                break;
            case "UNIT":
                this.units = i;
                this.unitsPerMeter = parseFloat(n.shift());
                break;
            case "PARAMETER":
                r = i.toLowerCase();
                t = parseFloat(n.shift());
                switch (r) {
                case "false_easting":
                    this.x0 = t;
                    break;
                case "false_northing":
                    this.y0 = t;
                    break;
                case "scale_factor":
                    this.k0 = t;
                    break;
                case "central_meridian":
                    this.long0 = t * Proj4js.common.D2R;
                    break;
                case "latitude_of_origin":
                    this.lat0 = t * Proj4js.common.D2R
                }
                break;
            case "TOWGS84":
                this.datum_params = n;
                break;
            case "AXIS":
                r = i.toLowerCase();
                t = n.shift();
                switch (t) {
                case "EAST":
                    t = "e";
                    break;
                case "WEST":
                    t = "w";
                    break;
                case "NORTH":
                    t = "n";
                    break;
                case "SOUTH":
                    t = "s";
                    break;
                case "UP":
                    t = "u";
                    break;
                case "DOWN":
                    t = "d";
                    break;
                default:
                    t = " "
                }
                this.axis || (this.axis = "enu");
                switch (r) {
                case "x":
                    this.axis = t + this.axis.substr(1, 2);
                    break;
                case "y":
                    this.axis = this.axis.substr(0, 1) + t + this.axis.substr(2, 1);
                    break;
                case "z":
                    this.axis = this.axis.substr(0, 2) + t
                }
            }
            for (u = 0; u < n.length; ++u)
                this.parseWKT(n[u])
        }
    },
    parseDefs: function() {
        var r, n, i, t;
        if (this.defData = Proj4js.defs[this.srsCode],
        this.defData) {
            for (i = this.defData.split("+"),
            t = 0; t < i.length; t++)
                switch (n = i[t].split("="),
                r = n[0].toLowerCase(),
                n = n[1],
                r.replace(/\s/gi, "")) {
                case "title":
                    this.title = n;
                    break;
                case "proj":
                    this.projName = n.replace(/\s/gi, "");
                    break;
                case "units":
                    this.units = n.replace(/\s/gi, "");
                    break;
                case "datum":
                    this.datumCode = n.replace(/\s/gi, "");
                    break;
                case "nadgrids":
                    this.nagrids = n.replace(/\s/gi, "");
                    break;
                case "ellps":
                    this.ellps = n.replace(/\s/gi, "");
                    break;
                case "a":
                    this.a = parseFloat(n);
                    break;
                case "b":
                    this.b = parseFloat(n);
                    break;
                case "rf":
                    this.rf = parseFloat(n);
                    break;
                case "lat_0":
                    this.lat0 = n * Proj4js.common.D2R;
                    break;
                case "lat_1":
                    this.lat1 = n * Proj4js.common.D2R;
                    break;
                case "lat_2":
                    this.lat2 = n * Proj4js.common.D2R;
                    break;
                case "lat_ts":
                    this.lat_ts = n * Proj4js.common.D2R;
                    break;
                case "lon_0":
                    this.long0 = n * Proj4js.common.D2R;
                    break;
                case "alpha":
                    this.alpha = parseFloat(n) * Proj4js.common.D2R;
                    break;
                case "lonc":
                    this.longc = n * Proj4js.common.D2R;
                    break;
                case "x_0":
                    this.x0 = parseFloat(n);
                    break;
                case "y_0":
                    this.y0 = parseFloat(n);
                    break;
                case "k_0":
                    this.k0 = parseFloat(n);
                    break;
                case "k":
                    this.k0 = parseFloat(n);
                    break;
                case "r_a":
                    this.R_A = !0;
                    break;
                case "zone":
                    this.zone = parseInt(n, 10);
                    break;
                case "south":
                    this.utmSouth = !0;
                    break;
                case "towgs84":
                    this.datum_params = n.split(",");
                    break;
                case "to_meter":
                    this.to_meter = parseFloat(n);
                    break;
                case "from_greenwich":
                    this.from_greenwich = n * Proj4js.common.D2R;
                    break;
                case "pm":
                    n = n.replace(/\s/gi, "");
                    this.from_greenwich = Proj4js.PrimeMeridian[n] ? Proj4js.PrimeMeridian[n] : parseFloat(n);
                    this.from_greenwich *= Proj4js.common.D2R;
                    break;
                case "axis":
                    n = n.replace(/\s/gi, "");
                    3 == n.length && -1 != "ewnsud".indexOf(n.substr(0, 1)) && -1 != "ewnsud".indexOf(n.substr(1, 1)) && -1 != "ewnsud".indexOf(n.substr(2, 1)) && (this.axis = n)
                }
            this.deriveConstants()
        }
    },
    deriveConstants: function() {
        if ("@null" == this.nagrids && (this.datumCode = "none"),
        this.datumCode && "none" != this.datumCode) {
            var n = Proj4js.Datum[this.datumCode];
            n && (this.datum_params = n.towgs84 ? n.towgs84.split(",") : null,
            this.ellps = n.ellipse,
            this.datumName = n.datumName ? n.datumName : this.datumCode)
        }
        this.a || Proj4js.extend(this, Proj4js.Ellipsoid[this.ellps] ? Proj4js.Ellipsoid[this.ellps] : Proj4js.Ellipsoid.WGS84);
        this.rf && !this.b && (this.b = (1 - 1 / this.rf) * this.a);
        (0 === this.rf || Math.abs(this.a - this.b) < Proj4js.common.EPSLN) && (this.sphere = !0,
        this.b = this.a);
        this.a2 = this.a * this.a;
        this.b2 = this.b * this.b;
        this.es = (this.a2 - this.b2) / this.a2;
        this.e = Math.sqrt(this.es);
        this.R_A && (this.a *= 1 - this.es * (Proj4js.common.SIXTH + this.es * (Proj4js.common.RA4 + this.es * Proj4js.common.RA6)),
        this.a2 = this.a * this.a,
        this.b2 = this.b * this.b,
        this.es = 0);
        this.ep2 = (this.a2 - this.b2) / this.b2;
        this.k0 || (this.k0 = 1);
        this.axis || (this.axis = "enu");
        this.datum = new Proj4js.datum(this)
    }
});
Proj4js.Proj.longlat = {
    init: function() {},
    forward: function(n) {
        return n
    },
    inverse: function(n) {
        return n
    }
};
Proj4js.Proj.identity = Proj4js.Proj.longlat;
Proj4js.defs = {
    WGS84: "+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees",
    "EPSG:4326": "+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees",
    "EPSG:4269": "+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees",
    "EPSG:3875": "+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"
};
Proj4js.defs["EPSG:3785"] = Proj4js.defs["EPSG:3875"];
Proj4js.defs.GOOGLE = Proj4js.defs["EPSG:3875"];
Proj4js.defs["EPSG:900913"] = Proj4js.defs["EPSG:3875"];
Proj4js.defs["EPSG:102113"] = Proj4js.defs["EPSG:3875"];
Proj4js.common = {
    PI: 3.1415926535897931,
    HALF_PI: 1.5707963267948966,
    TWO_PI: 6.2831853071795862,
    FORTPI: .78539816339744828,
    R2D: 57.295779513082323,
    D2R: .017453292519943295,
    SEC_TO_RAD: 484813681109536e-20,
    EPSLN: 1e-10,
    MAX_ITER: 20,
    COS_67P5: .38268343236508978,
    AD_C: 1.0026,
    PJD_UNKNOWN: 0,
    PJD_3PARAM: 1,
    PJD_7PARAM: 2,
    PJD_GRIDSHIFT: 3,
    PJD_WGS84: 4,
    PJD_NODATUM: 5,
    SRS_WGS84_SEMIMAJOR: 6378137,
    SIXTH: .16666666666666666,
    RA4: .047222222222222221,
    RA6: .022156084656084655,
    RV4: .069444444444444448,
    RV6: .042438271604938273,
    msfnz: function(n, t, i) {
        return n *= t,
        i / Math.sqrt(1 - n * n)
    },
    tsfnz: function(n, t, i) {
        return i *= n,
        i = Math.pow((1 - i) / (1 + i), .5 * n),
        Math.tan(.5 * (this.HALF_PI - t)) / i
    },
    phi2z: function(n, t) {
        for (var f = .5 * n, i, r = this.HALF_PI - 2 * Math.atan(t), u = 0; 15 >= u; u++)
            if (i = n * Math.sin(r),
            i = this.HALF_PI - 2 * Math.atan(t * Math.pow((1 - i) / (1 + i), f)) - r,
            r += i,
            1e-10 >= Math.abs(i))
                return r;
        return alert("phi2z has NoConvergence"),
        -9999
    },
    qsfnz: function(n, t) {
        var i;
        return 1e-7 < n ? (i = n * t,
        (1 - n * n) * (t / (1 - i * i) - .5 / n * Math.log((1 - i) / (1 + i)))) : 2 * t
    },
    asinz: function(n) {
        return 1 < Math.abs(n) && (n = 1 < n ? 1 : -1),
        Math.asin(n)
    },
    e0fn: function(n) {
        return 1 - .25 * n * (1 + n / 16 * (3 + 1.25 * n))
    },
    e1fn: function(n) {
        return .375 * n * (1 + .25 * n * (1 + .46875 * n))
    },
    e2fn: function(n) {
        return .05859375 * n * n * (1 + .75 * n)
    },
    e3fn: function(n) {
        return n * n * n * (35 / 3072)
    },
    mlfn: function(n, t, i, r, u) {
        return n * u - t * Math.sin(2 * u) + i * Math.sin(4 * u) - r * Math.sin(6 * u)
    },
    srat: function(n, t) {
        return Math.pow((1 - n) / (1 + n), t)
    },
    sign: function(n) {
        return 0 > n ? -1 : 1
    },
    adjust_lon: function(n) {
        return Math.abs(n) < this.PI ? n : n - this.sign(n) * this.TWO_PI
    },
    adjust_lat: function(n) {
        return Math.abs(n) < this.HALF_PI ? n : n - this.sign(n) * this.PI
    },
    latiso: function(n, t, i) {
        return Math.abs(t) > this.HALF_PI ? +Number.NaN : t == this.HALF_PI ? Number.POSITIVE_INFINITY : t == -1 * this.HALF_PI ? -1 * Number.POSITIVE_INFINITY : (i *= n,
        Math.log(Math.tan((this.HALF_PI + t) / 2)) + n * Math.log((1 - i) / (1 + i)) / 2)
    },
    fL: function(n, t) {
        return 2 * Math.atan(n * Math.exp(t)) - this.HALF_PI
    },
    invlatiso: function(n, t) {
        var i = this.fL(1, t)
          , r = 0
          , u = 0;
        do
            r = i,
            u = n * Math.sin(r),
            i = this.fL(Math.exp(n * Math.log((1 + u) / (1 - u)) / 2), t);
        while (1e-12 < Math.abs(i - r));
        return i
    },
    sinh: function(n) {
        return n = Math.exp(n),
        (n - 1 / n) / 2
    },
    cosh: function(n) {
        return n = Math.exp(n),
        (n + 1 / n) / 2
    },
    tanh: function(n) {
        return n = Math.exp(n),
        (n - 1 / n) / (n + 1 / n)
    },
    asinh: function(n) {
        return (0 <= n ? 1 : -1) * Math.log(Math.abs(n) + Math.sqrt(n * n + 1))
    },
    acosh: function(n) {
        return 2 * Math.log(Math.sqrt((n + 1) / 2) + Math.sqrt((n - 1) / 2))
    },
    atanh: function(n) {
        return Math.log((n - 1) / (n + 1)) / 2
    },
    gN: function(n, t, i) {
        return t *= i,
        n / Math.sqrt(1 - t * t)
    },
    pj_enfn: function(n) {
        var t = [], i;
        return t[0] = this.C00 - n * (this.C02 + n * (this.C04 + n * (this.C06 + n * this.C08))),
        t[1] = n * (this.C22 - n * (this.C04 + n * (this.C06 + n * this.C08))),
        i = n * n,
        t[2] = i * (this.C44 - n * (this.C46 + n * this.C48)),
        i *= n,
        t[3] = i * (this.C66 - n * this.C68),
        t[4] = i * n * this.C88,
        t
    },
    pj_mlfn: function(n, t, i, r) {
        return i *= t,
        t *= t,
        r[0] * n - i * (r[1] + t * (r[2] + t * (r[3] + t * r[4])))
    },
    pj_inv_mlfn: function(n, t, i) {
        for (var o = 1 / (1 - t), r = n, e = Proj4js.common.MAX_ITER; e; --e) {
            var f = Math.sin(r)
              , u = 1 - t * f * f
              , u = (this.pj_mlfn(r, f, Math.cos(r), i) - n) * u * Math.sqrt(u) * o
              , r = r - u;
            if (Math.abs(u) < Proj4js.common.EPSLN)
                return r
        }
        return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),
        r
    },
    C00: 1,
    C02: .25,
    C04: .046875,
    C06: .01953125,
    C08: .01068115234375,
    C22: .75,
    C44: .46875,
    C46: .013020833333333334,
    C48: .007120768229166667,
    C66: .36458333333333331,
    C68: .005696614583333333,
    C88: .3076171875
};
Proj4js.datum = Proj4js.Class({
    initialize: function(n) {
        if (this.datum_type = Proj4js.common.PJD_WGS84,
        n.datumCode && "none" == n.datumCode && (this.datum_type = Proj4js.common.PJD_NODATUM),
        n && n.datum_params) {
            for (var t = 0; t < n.datum_params.length; t++)
                n.datum_params[t] = parseFloat(n.datum_params[t]);
            (0 != n.datum_params[0] || 0 != n.datum_params[1] || 0 != n.datum_params[2]) && (this.datum_type = Proj4js.common.PJD_3PARAM);
            3 < n.datum_params.length && (0 != n.datum_params[3] || 0 != n.datum_params[4] || 0 != n.datum_params[5] || 0 != n.datum_params[6]) && (this.datum_type = Proj4js.common.PJD_7PARAM,
            n.datum_params[3] *= Proj4js.common.SEC_TO_RAD,
            n.datum_params[4] *= Proj4js.common.SEC_TO_RAD,
            n.datum_params[5] *= Proj4js.common.SEC_TO_RAD,
            n.datum_params[6] = n.datum_params[6] / 1e6 + 1)
        }
        n && (this.a = n.a,
        this.b = n.b,
        this.es = n.es,
        this.ep2 = n.ep2,
        this.datum_params = n.datum_params)
    },
    compare_datums: function(n) {
        return this.datum_type != n.datum_type || this.a != n.a || 5e-11 < Math.abs(this.es - n.es) ? !1 : this.datum_type == Proj4js.common.PJD_3PARAM ? this.datum_params[0] == n.datum_params[0] && this.datum_params[1] == n.datum_params[1] && this.datum_params[2] == n.datum_params[2] : this.datum_type == Proj4js.common.PJD_7PARAM ? this.datum_params[0] == n.datum_params[0] && this.datum_params[1] == n.datum_params[1] && this.datum_params[2] == n.datum_params[2] && this.datum_params[3] == n.datum_params[3] && this.datum_params[4] == n.datum_params[4] && this.datum_params[5] == n.datum_params[5] && this.datum_params[6] == n.datum_params[6] : this.datum_type == Proj4js.common.PJD_GRIDSHIFT || n.datum_type == Proj4js.common.PJD_GRIDSHIFT ? (alert("ERROR: Grid shift transformations are not implemented."),
        !1) : !0
    },
    geodetic_to_geocentric: function(n) {
        var i = n.x, t = n.y, r = n.z ? n.z : 0, u, f, e;
        if (t < -Proj4js.common.HALF_PI && t > -1.001 * Proj4js.common.HALF_PI)
            t = -Proj4js.common.HALF_PI;
        else if (t > Proj4js.common.HALF_PI && t < 1.001 * Proj4js.common.HALF_PI)
            t = Proj4js.common.HALF_PI;
        else if (t < -Proj4js.common.HALF_PI || t > Proj4js.common.HALF_PI)
            return Proj4js.reportError("geocent:lat out of range:" + t),
            null;
        return i > Proj4js.common.PI && (i -= 2 * Proj4js.common.PI),
        f = Math.sin(t),
        e = Math.cos(t),
        u = this.a / Math.sqrt(1 - this.es * f * f),
        t = (u + r) * e * Math.cos(i),
        i = (u + r) * e * Math.sin(i),
        r = (u * (1 - this.es) + r) * f,
        n.x = t,
        n.y = i,
        n.z = r,
        0
    },
    geocentric_to_geodetic: function(n) {
        var s, e, i, o, r, t, c, u, l, a, f = n.x, h;
        if (i = n.y,
        h = n.z ? n.z : 0,
        s = Math.sqrt(f * f + i * i),
        e = Math.sqrt(f * f + i * i + h * h),
        1e-12 > s / this.a) {
            if (f = 0,
            1e-12 > e / this.a)
                return
        } else
            f = Math.atan2(i, f);
        i = h / e;
        o = s / e;
        r = 1 / Math.sqrt(1 - this.es * (2 - this.es) * o * o);
        c = o * (1 - this.es) * r;
        u = i * r;
        a = 0;
        do
            a++,
            t = this.a / Math.sqrt(1 - this.es * u * u),
            e = s * c + h * u - t * (1 - this.es * u * u),
            t = this.es * t / (t + e),
            r = 1 / Math.sqrt(1 - t * (2 - t) * o * o),
            t = o * (1 - t) * r,
            r *= i,
            l = r * c - t * u,
            c = t,
            u = r;
        while (1e-24 < l * l && 30 > a);
        return s = Math.atan(r / Math.abs(t)),
        n.x = f,
        n.y = s,
        n.z = e,
        n
    },
    geocentric_to_geodetic_noniter: function(n) {
        var r = n.x, t = n.y, u = n.z ? n.z : 0, e, o, i, f, s, r = parseFloat(r), t = parseFloat(t), u = parseFloat(u);
        if (s = !1,
        0 != r)
            e = Math.atan2(t, r);
        else if (0 < t)
            e = Proj4js.common.HALF_PI;
        else if (0 > t)
            e = -Proj4js.common.HALF_PI;
        else if (s = !0,
        e = 0,
        0 < u)
            o = Proj4js.common.HALF_PI;
        else if (0 > u)
            o = -Proj4js.common.HALF_PI;
        else
            return;
        return i = r * r + t * t,
        r = Math.sqrt(i),
        t = u * Proj4js.common.AD_C,
        i = Math.sqrt(t * t + i),
        t /= i,
        i = r / i,
        t = u + this.b * this.ep2 * t * t * t,
        f = r - this.a * this.es * i * i * i,
        i = Math.sqrt(t * t + f * f),
        t /= i,
        i = f / i,
        f = this.a / Math.sqrt(1 - this.es * t * t),
        u = i >= Proj4js.common.COS_67P5 ? r / i - f : i <= -Proj4js.common.COS_67P5 ? r / -i - f : u / t + f * (this.es - 1),
        !1 == s && (o = Math.atan(t / i)),
        n.x = e,
        n.y = o,
        n.z = u,
        n
    },
    geocentric_to_wgs84: function(n) {
        if (this.datum_type == Proj4js.common.PJD_3PARAM)
            n.x += this.datum_params[0],
            n.y += this.datum_params[1],
            n.z += this.datum_params[2];
        else if (this.datum_type == Proj4js.common.PJD_7PARAM) {
            var t = this.datum_params[3]
              , r = this.datum_params[4]
              , u = this.datum_params[5]
              , i = this.datum_params[6]
              , f = i * (u * n.x + n.y - t * n.z) + this.datum_params[1]
              , t = i * (-r * n.x + t * n.y + n.z) + this.datum_params[2];
            n.x = i * (n.x - u * n.y + r * n.z) + this.datum_params[0];
            n.y = f;
            n.z = t
        }
    },
    geocentric_from_wgs84: function(n) {
        if (this.datum_type == Proj4js.common.PJD_3PARAM)
            n.x -= this.datum_params[0],
            n.y -= this.datum_params[1],
            n.z -= this.datum_params[2];
        else if (this.datum_type == Proj4js.common.PJD_7PARAM) {
            var u = this.datum_params[3]
              , f = this.datum_params[4]
              , e = this.datum_params[5]
              , t = this.datum_params[6]
              , i = (n.x - this.datum_params[0]) / t
              , r = (n.y - this.datum_params[1]) / t
              , t = (n.z - this.datum_params[2]) / t;
            n.x = i + e * r - f * t;
            n.y = -e * i + r + u * t;
            n.z = f * i - u * r + t
        }
    }
});
Proj4js.Point = Proj4js.Class({
    initialize: function(n, t, i) {
        "object" == typeof n ? (this.x = n[0],
        this.y = n[1],
        this.z = n[2] || 0) : "string" == typeof n && "undefined" == typeof t ? (n = n.split(","),
        this.x = parseFloat(n[0]),
        this.y = parseFloat(n[1]),
        this.z = parseFloat(n[2]) || 0) : (this.x = n,
        this.y = t,
        this.z = i || 0)
    },
    clone: function() {
        return new Proj4js.Point(this.x,this.y,this.z)
    },
    toString: function() {
        return "x=" + this.x + ",y=" + this.y
    },
    toShortString: function() {
        return this.x + ", " + this.y
    }
});
Proj4js.PrimeMeridian = {
    greenwich: 0,
    lisbon: -9.131906111111,
    paris: 2.337229166667,
    bogota: -74.080916666667,
    madrid: -3.687938888889,
    rome: 12.452333333333,
    bern: 7.439583333333,
    jakarta: 106.807719444444,
    ferro: -17.666666666667,
    brussels: 4.367975,
    stockholm: 18.058277777778,
    athens: 23.7163375,
    oslo: 10.722916666667
};
Proj4js.Ellipsoid = {
    MERIT: {
        a: 6378137,
        rf: 298.257,
        ellipseName: "MERIT 1983"
    },
    SGS85: {
        a: 6378136,
        rf: 298.257,
        ellipseName: "Soviet Geodetic System 85"
    },
    GRS80: {
        a: 6378137,
        rf: 298.257222101,
        ellipseName: "GRS 1980(IUGG, 1980)"
    },
    IAU76: {
        a: 6378140,
        rf: 298.257,
        ellipseName: "IAU 1976"
    },
    airy: {
        a: 6377563.396,
        b: 6356256.91,
        ellipseName: "Airy 1830"
    },
    "APL4.": {
        a: 6378137,
        rf: 298.25,
        ellipseName: "Appl. Physics. 1965"
    },
    NWL9D: {
        a: 6378145,
        rf: 298.25,
        ellipseName: "Naval Weapons Lab., 1965"
    },
    mod_airy: {
        a: 6377340.189,
        b: 6356034.446,
        ellipseName: "Modified Airy"
    },
    andrae: {
        a: 6377104.43,
        rf: 300,
        ellipseName: "Andrae 1876 (Den., Iclnd.)"
    },
    aust_SA: {
        a: 6378160,
        rf: 298.25,
        ellipseName: "Australian Natl & S. Amer. 1969"
    },
    GRS67: {
        a: 6378160,
        rf: 298.247167427,
        ellipseName: "GRS 67(IUGG 1967)"
    },
    bessel: {
        a: 6377397.155,
        rf: 299.1528128,
        ellipseName: "Bessel 1841"
    },
    bess_nam: {
        a: 6377483.865,
        rf: 299.1528128,
        ellipseName: "Bessel 1841 (Namibia)"
    },
    clrk66: {
        a: 6378206.4,
        b: 6356583.8,
        ellipseName: "Clarke 1866"
    },
    clrk80: {
        a: 6378249.145,
        rf: 293.4663,
        ellipseName: "Clarke 1880 mod."
    },
    CPM: {
        a: 6375738.7,
        rf: 334.29,
        ellipseName: "Comm. des Poids et Mesures 1799"
    },
    delmbr: {
        a: 6376428,
        rf: 311.5,
        ellipseName: "Delambre 1810 (Belgium)"
    },
    engelis: {
        a: 6378136.05,
        rf: 298.2566,
        ellipseName: "Engelis 1985"
    },
    evrst30: {
        a: 6377276.345,
        rf: 300.8017,
        ellipseName: "Everest 1830"
    },
    evrst48: {
        a: 6377304.063,
        rf: 300.8017,
        ellipseName: "Everest 1948"
    },
    evrst56: {
        a: 6377301.243,
        rf: 300.8017,
        ellipseName: "Everest 1956"
    },
    evrst69: {
        a: 6377295.664,
        rf: 300.8017,
        ellipseName: "Everest 1969"
    },
    evrstSS: {
        a: 6377298.556,
        rf: 300.8017,
        ellipseName: "Everest (Sabah & Sarawak)"
    },
    fschr60: {
        a: 6378166,
        rf: 298.3,
        ellipseName: "Fischer (Mercury Datum) 1960"
    },
    fschr60m: {
        a: 6378155,
        rf: 298.3,
        ellipseName: "Fischer 1960"
    },
    fschr68: {
        a: 6378150,
        rf: 298.3,
        ellipseName: "Fischer 1968"
    },
    helmert: {
        a: 6378200,
        rf: 298.3,
        ellipseName: "Helmert 1906"
    },
    hough: {
        a: 6378270,
        rf: 297,
        ellipseName: "Hough"
    },
    intl: {
        a: 6378388,
        rf: 297,
        ellipseName: "International 1909 (Hayford)"
    },
    kaula: {
        a: 6378163,
        rf: 298.24,
        ellipseName: "Kaula 1961"
    },
    lerch: {
        a: 6378139,
        rf: 298.257,
        ellipseName: "Lerch 1979"
    },
    mprts: {
        a: 6397300,
        rf: 191,
        ellipseName: "Maupertius 1738"
    },
    new_intl: {
        a: 6378157.5,
        b: 6356772.2,
        ellipseName: "New International 1967"
    },
    plessis: {
        a: 6376523,
        rf: 6355863,
        ellipseName: "Plessis 1817 (France)"
    },
    krass: {
        a: 6378245,
        rf: 298.3,
        ellipseName: "Krassovsky, 1942"
    },
    SEasia: {
        a: 6378155,
        b: 6356773.3205,
        ellipseName: "Southeast Asia"
    },
    walbeck: {
        a: 6376896,
        b: 6355834.8467,
        ellipseName: "Walbeck"
    },
    WGS60: {
        a: 6378165,
        rf: 298.3,
        ellipseName: "WGS 60"
    },
    WGS66: {
        a: 6378145,
        rf: 298.25,
        ellipseName: "WGS 66"
    },
    WGS72: {
        a: 6378135,
        rf: 298.26,
        ellipseName: "WGS 72"
    },
    WGS84: {
        a: 6378137,
        rf: 298.257223563,
        ellipseName: "WGS 84"
    },
    sphere: {
        a: 6370997,
        b: 6370997,
        ellipseName: "Normal Sphere (r=6370997)"
    }
};
Proj4js.Datum = {
    WGS84: {
        towgs84: "0,0,0",
        ellipse: "WGS84",
        datumName: "WGS84"
    },
    GGRS87: {
        towgs84: "-199.87,74.79,246.62",
        ellipse: "GRS80",
        datumName: "Greek_Geodetic_Reference_System_1987"
    },
    NAD83: {
        towgs84: "0,0,0",
        ellipse: "GRS80",
        datumName: "North_American_Datum_1983"
    },
    NAD27: {
        nadgrids: "@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",
        ellipse: "clrk66",
        datumName: "North_American_Datum_1927"
    },
    potsdam: {
        towgs84: "606.0,23.0,413.0",
        ellipse: "bessel",
        datumName: "Potsdam Rauenberg 1950 DHDN"
    },
    carthage: {
        towgs84: "-263.0,6.0,431.0",
        ellipse: "clark80",
        datumName: "Carthage 1934 Tunisia"
    },
    hermannskogel: {
        towgs84: "653.0,-212.0,449.0",
        ellipse: "bessel",
        datumName: "Hermannskogel"
    },
    ire65: {
        towgs84: "482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",
        ellipse: "mod_airy",
        datumName: "Ireland 1965"
    },
    nzgd49: {
        towgs84: "59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",
        ellipse: "intl",
        datumName: "New Zealand Geodetic Datum 1949"
    },
    OSGB36: {
        towgs84: "446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",
        ellipse: "airy",
        datumName: "Airy 1830"
    }
};
Proj4js.WGS84 = new Proj4js.Proj("WGS84");
Proj4js.Datum.OSB36 = Proj4js.Datum.OSGB36;
Proj4js.wktProjections = {
    "Lambert Tangential Conformal Conic Projection": "lcc",
    Mercator: "merc",
    "Popular Visualisation Pseudo Mercator": "merc",
    Mercator_1SP: "merc",
    Transverse_Mercator: "tmerc",
    "Transverse Mercator": "tmerc",
    "Lambert Azimuthal Equal Area": "laea",
    "Universal Transverse Mercator System": "utm"
};
Proj4js.Proj.aea = {
    init: function() {
        Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN ? Proj4js.reportError("aeaInitEqualLatitudes") : (this.temp = this.b / this.a,
        this.es = 1 - Math.pow(this.temp, 2),
        this.e3 = Math.sqrt(this.es),
        this.sin_po = Math.sin(this.lat1),
        this.cos_po = Math.cos(this.lat1),
        this.con = this.t1 = this.sin_po,
        this.ms1 = Proj4js.common.msfnz(this.e3, this.sin_po, this.cos_po),
        this.qs1 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.sin_po = Math.sin(this.lat2),
        this.cos_po = Math.cos(this.lat2),
        this.t2 = this.sin_po,
        this.ms2 = Proj4js.common.msfnz(this.e3, this.sin_po, this.cos_po),
        this.qs2 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.sin_po = Math.sin(this.lat0),
        this.cos_po = Math.cos(this.lat0),
        this.t3 = this.sin_po,
        this.qs0 = Proj4js.common.qsfnz(this.e3, this.sin_po, this.cos_po),
        this.ns0 = Math.abs(this.lat1 - this.lat2) > Proj4js.common.EPSLN ? (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1) : this.con,
        this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1,
        this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0)
    },
    forward: function(n) {
        var i = n.x
          , t = n.y;
        this.sin_phi = Math.sin(t);
        this.cos_phi = Math.cos(t);
        var t = Proj4js.common.qsfnz(this.e3, this.sin_phi, this.cos_phi)
          , t = this.a * Math.sqrt(this.c - this.ns0 * t) / this.ns0
          , r = this.ns0 * Proj4js.common.adjust_lon(i - this.long0)
          , i = t * Math.sin(r) + this.x0
          , t = this.rh - t * Math.cos(r) + this.y0;
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var i, t, r;
        return n.x -= this.x0,
        n.y = this.rh - n.y + this.y0,
        0 <= this.ns0 ? (i = Math.sqrt(n.x * n.x + n.y * n.y),
        t = 1) : (i = -Math.sqrt(n.x * n.x + n.y * n.y),
        t = -1),
        r = 0,
        0 != i && (r = Math.atan2(t * n.x, t * n.y)),
        t = i * this.ns0 / this.a,
        i = (this.c - t * t) / this.ns0,
        1e-10 <= this.e3 ? (t = 1 - .5 * (1 - this.es) * Math.log((1 - this.e3) / (1 + this.e3)) / this.e3,
        t = 1e-10 < Math.abs(Math.abs(t) - Math.abs(i)) ? this.phi1z(this.e3, i) : 0 <= i ? .5 * Proj4js.common.PI : -.5 * Proj4js.common.PI) : t = this.phi1z(this.e3, i),
        r = Proj4js.common.adjust_lon(r / this.ns0 + this.long0),
        n.x = r,
        n.y = t,
        n
    },
    phi1z: function(n, t) {
        var i, o, r, f, u = Proj4js.common.asinz(.5 * t), s, e;
        if (n < Proj4js.common.EPSLN)
            return u;
        for (s = n * n,
        e = 1; 25 >= e; e++)
            if (i = Math.sin(u),
            o = Math.cos(u),
            r = n * i,
            f = 1 - r * r,
            i = .5 * f * f / o * (t / (1 - s) - i / f + .5 / n * Math.log((1 - r) / (1 + r))),
            u += i,
            1e-7 >= Math.abs(i))
                return u;
        return Proj4js.reportError("aea:phi1z:Convergence error"),
        null
    }
};
Proj4js.Proj.sterea = {
    dependsOn: "gauss",
    init: function() {
        Proj4js.Proj.gauss.init.apply(this);
        this.rc ? (this.sinc0 = Math.sin(this.phic0),
        this.cosc0 = Math.cos(this.phic0),
        this.R2 = 2 * this.rc,
        this.title || (this.title = "Oblique Stereographic Alternative")) : Proj4js.reportError("sterea:init:E_ERROR_0")
    },
    forward: function(n) {
        var i, t, r, u;
        return n.x = Proj4js.common.adjust_lon(n.x - this.long0),
        Proj4js.Proj.gauss.forward.apply(this, [n]),
        i = Math.sin(n.y),
        t = Math.cos(n.y),
        r = Math.cos(n.x),
        u = this.k0 * this.R2 / (1 + this.sinc0 * i + this.cosc0 * t * r),
        n.x = u * t * Math.sin(n.x),
        n.y = u * (this.cosc0 * i - this.sinc0 * t * r),
        n.x = this.a * n.x + this.x0,
        n.y = this.a * n.y + this.y0,
        n
    },
    inverse: function(n) {
        var t, u, i, r;
        return n.x = (n.x - this.x0) / this.a,
        n.y = (n.y - this.y0) / this.a,
        n.x /= this.k0,
        n.y /= this.k0,
        (r = Math.sqrt(n.x * n.x + n.y * n.y)) ? (i = 2 * Math.atan2(r, this.R2),
        t = Math.sin(i),
        u = Math.cos(i),
        i = Math.asin(u * this.sinc0 + n.y * t * this.cosc0 / r),
        t = Math.atan2(n.x * t, r * this.cosc0 * u - n.y * this.sinc0 * t)) : (i = this.phic0,
        t = 0),
        n.x = t,
        n.y = i,
        Proj4js.Proj.gauss.inverse.apply(this, [n]),
        n.x = Proj4js.common.adjust_lon(n.x + this.long0),
        n
    }
};
Proj4js.Proj.poly = {
    init: function() {
        0 == this.lat0 && (this.lat0 = 90);
        this.temp = this.b / this.a;
        this.es = 1 - Math.pow(this.temp, 2);
        this.e = Math.sqrt(this.es);
        this.e0 = Proj4js.common.e0fn(this.es);
        this.e1 = Proj4js.common.e1fn(this.es);
        this.e2 = Proj4js.common.e2fn(this.es);
        this.e3 = Proj4js.common.e3fn(this.es);
        this.ml0 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
    },
    forward: function(n) {
        var t, i, r, u, f;
        return r = n.y,
        i = Proj4js.common.adjust_lon(n.x - this.long0),
        1e-7 >= Math.abs(r) ? (f = this.x0 + this.a * i,
        t = this.y0 - this.a * this.ml0) : (t = Math.sin(r),
        i = Math.cos(r),
        r = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, r),
        u = Proj4js.common.msfnz(this.e, t, i),
        i = t,
        f = this.x0 + this.a * u * Math.sin(i) / t,
        t = this.y0 + this.a * (r - this.ml0 + u * (1 - Math.cos(i)) / t)),
        n.x = f,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, i;
        if (n.x -= this.x0,
        n.y -= this.y0,
        t = this.ml0 + n.y / this.a,
        1e-7 >= Math.abs(t))
            t = n.x / this.a + this.long0,
            i = 0;
        else {
            if (t = t * t + n.x / this.a * (n.x / this.a),
            t = phi4z(this.es, this.e0, this.e1, this.e2, this.e3, this.al, t, void 0, i),
            1 != t)
                return t;
            t = Proj4js.common.adjust_lon(Proj4js.common.asinz(NaN * n.x / this.a) / Math.sin(i) + this.long0)
        }
        return n.x = t,
        n.y = i,
        n
    }
};
Proj4js.Proj.equi = {
    init: function() {
        this.x0 || (this.x0 = 0);
        this.y0 || (this.y0 = 0);
        this.lat0 || (this.lat0 = 0);
        this.long0 || (this.long0 = 0)
    },
    forward: function(n) {
        var t = n.y
          , i = this.x0 + this.a * Proj4js.common.adjust_lon(n.x - this.long0) * Math.cos(this.lat0)
          , t = this.y0 + this.a * t;
        return this.t1 = i,
        this.t2 = Math.cos(this.lat0),
        n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, i;
        n.x -= this.x0;
        n.y -= this.y0;
        t = n.y / this.a;
        Math.abs(t) > Proj4js.common.HALF_PI && Proj4js.reportError("equi:Inv:DataError");
        i = Proj4js.common.adjust_lon(this.long0 + n.x / (this.a * Math.cos(this.lat0)));
        n.x = i;
        n.y = t
    }
};
Proj4js.Proj.merc = {
    init: function() {
        this.lat_ts && (this.k0 = this.sphere ? Math.cos(this.lat_ts) : Proj4js.common.msfnz(this.es, Math.sin(this.lat_ts), Math.cos(this.lat_ts)))
    },
    forward: function(n) {
        var i = n.x
          , t = n.y;
        if (90 < t * Proj4js.common.R2D && -90 > t * Proj4js.common.R2D && 180 < i * Proj4js.common.R2D && -180 > i * Proj4js.common.R2D)
            return Proj4js.reportError("merc:forward: llInputOutOfRange: " + i + " : " + t),
            null;
        if (Math.abs(Math.abs(t) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN)
            return Proj4js.reportError("merc:forward: ll2mAtPoles"),
            null;
        if (this.sphere)
            i = this.x0 + this.a * this.k0 * Proj4js.common.adjust_lon(i - this.long0),
            t = this.y0 + this.a * this.k0 * Math.log(Math.tan(Proj4js.common.FORTPI + .5 * t));
        else
            var r = Math.sin(t)
              , t = Proj4js.common.tsfnz(this.e, t, r)
              , i = this.x0 + this.a * this.k0 * Proj4js.common.adjust_lon(i - this.long0)
              , t = this.y0 - this.a * this.k0 * Math.log(t);
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var i = n.x - this.x0
          , t = n.y - this.y0;
        if (this.sphere)
            t = Proj4js.common.HALF_PI - 2 * Math.atan(Math.exp(-t / this.a * this.k0));
        else if (t = Math.exp(-t / (this.a * this.k0)),
        t = Proj4js.common.phi2z(this.e, t),
        -9999 == t)
            return Proj4js.reportError("merc:inverse: lat = -9999"),
            null;
        return i = Proj4js.common.adjust_lon(this.long0 + i / (this.a * this.k0)),
        n.x = i,
        n.y = t,
        n
    }
};
Proj4js.Proj.utm = {
    dependsOn: "tmerc",
    init: function() {
        this.zone ? (this.lat0 = 0,
        this.long0 = (6 * Math.abs(this.zone) - 183) * Proj4js.common.D2R,
        this.x0 = 5e5,
        this.y0 = this.utmSouth ? 1e7 : 0,
        this.k0 = .9996,
        Proj4js.Proj.tmerc.init.apply(this),
        this.forward = Proj4js.Proj.tmerc.forward,
        this.inverse = Proj4js.Proj.tmerc.inverse) : Proj4js.reportError("utm:init: zone must be specified for UTM")
    }
};
Proj4js.Proj.eqdc = {
    init: function() {
        this.mode || (this.mode = 0);
        this.temp = this.b / this.a;
        this.es = 1 - Math.pow(this.temp, 2);
        this.e = Math.sqrt(this.es);
        this.e0 = Proj4js.common.e0fn(this.es);
        this.e1 = Proj4js.common.e1fn(this.es);
        this.e2 = Proj4js.common.e2fn(this.es);
        this.e3 = Proj4js.common.e3fn(this.es);
        this.sinphi = Math.sin(this.lat1);
        this.cosphi = Math.cos(this.lat1);
        this.ms1 = Proj4js.common.msfnz(this.e, this.sinphi, this.cosphi);
        this.ml1 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat1);
        0 != this.mode ? (Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN && Proj4js.reportError("eqdc:Init:EqualLatitudes"),
        this.sinphi = Math.sin(this.lat2),
        this.cosphi = Math.cos(this.lat2),
        this.ms2 = Proj4js.common.msfnz(this.e, this.sinphi, this.cosphi),
        this.ml2 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat2),
        this.ns = Math.abs(this.lat1 - this.lat2) >= Proj4js.common.EPSLN ? (this.ms1 - this.ms2) / (this.ml2 - this.ml1) : this.sinphi) : this.ns = this.sinphi;
        this.g = this.ml1 + this.ms1 / this.ns;
        this.ml0 = Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);
        this.rh = this.a * (this.g - this.ml0)
    },
    forward: function(n) {
        var i = n.x
          , t = this.a * (this.g - Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, n.y))
          , r = this.ns * Proj4js.common.adjust_lon(i - this.long0)
          , i = this.x0 + t * Math.sin(r)
          , t = this.y0 + this.rh - t * Math.cos(r);
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, r, i;
        return n.x -= this.x0,
        n.y = this.rh - n.y + this.y0,
        0 <= this.ns ? (r = Math.sqrt(n.x * n.x + n.y * n.y),
        t = 1) : (r = -Math.sqrt(n.x * n.x + n.y * n.y),
        t = -1),
        i = 0,
        0 != r && (i = Math.atan2(t * n.x, t * n.y)),
        t = this.phi3z(this.g - r / this.a, this.e0, this.e1, this.e2, this.e3),
        i = Proj4js.common.adjust_lon(this.long0 + i / this.ns),
        n.x = i,
        n.y = t,
        n
    },
    phi3z: function(n, t, i, r, u) {
        for (var e, f = n, o = 0; 15 > o; o++)
            if (e = (n + i * Math.sin(2 * f) - r * Math.sin(4 * f) + u * Math.sin(6 * f)) / t - f,
            f += e,
            1e-10 >= Math.abs(e))
                return f;
        return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
        null
    }
};
Proj4js.Proj.tmerc = {
    init: function() {
        this.e0 = Proj4js.common.e0fn(this.es);
        this.e1 = Proj4js.common.e1fn(this.es);
        this.e2 = Proj4js.common.e2fn(this.es);
        this.e3 = Proj4js.common.e3fn(this.es);
        this.ml0 = this.a * Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0)
    },
    forward: function(n) {
        var i = n.y, u = Proj4js.common.adjust_lon(n.x - this.long0), t, e, r, f;
        if (t = Math.sin(i),
        r = Math.cos(i),
        this.sphere) {
            if (f = r * Math.sin(u),
            1e-10 > Math.abs(Math.abs(f) - 1))
                return Proj4js.reportError("tmerc:forward: Point projects into infinity"),
                93;
            e = .5 * this.a * this.k0 * Math.log((1 + f) / (1 - f));
            t = Math.acos(r * Math.cos(u) / Math.sqrt(1 - f * f));
            0 > i && (t = -t);
            i = this.a * this.k0 * (t - this.lat0)
        } else {
            e = r * u;
            var u = Math.pow(e, 2)
              , r = this.ep2 * Math.pow(r, 2)
              , f = Math.tan(i)
              , o = Math.pow(f, 2);
            t = 1 - this.es * Math.pow(t, 2);
            t = this.a / Math.sqrt(t);
            i = this.a * Proj4js.common.mlfn(this.e0, this.e1, this.e2, this.e3, i);
            e = this.k0 * t * e * (1 + u / 6 * (1 - o + r + u / 20 * (5 - 18 * o + Math.pow(o, 2) + 72 * r - 58 * this.ep2))) + this.x0;
            i = this.k0 * (i - this.ml0 + t * f * u * (.5 + u / 24 * (5 - o + 9 * r + 4 * Math.pow(r, 2) + u / 30 * (61 - 58 * o + Math.pow(o, 2) + 600 * r - 330 * this.ep2)))) + this.y0
        }
        return n.x = e,
        n.y = i,
        n
    },
    inverse: function(n) {
        var i, t, f, r, e, c, h, u, o;
        if (this.sphere)
            t = Math.exp(n.x / (this.a * this.k0)),
            u = .5 * (t - 1 / t),
            f = this.lat0 + n.y / (this.a * this.k0),
            r = Math.cos(f),
            i = Math.sqrt((1 - r * r) / (1 + u * u)),
            t = Proj4js.common.asinz(i),
            0 > f && (t = -t),
            i = 0 == u && 0 == r ? this.long0 : Proj4js.common.adjust_lon(Math.atan2(u, r) + this.long0);
        else {
            for (u = n.x - this.x0,
            e = n.y - this.y0,
            t = i = (this.ml0 + e / this.k0) / this.a,
            r = 0; ; r++) {
                if (f = (i + this.e1 * Math.sin(2 * t) - this.e2 * Math.sin(4 * t) + this.e3 * Math.sin(6 * t)) / this.e0 - t,
                t += f,
                Math.abs(f) <= Proj4js.common.EPSLN)
                    break;
                if (6 <= r)
                    return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),
                    95
            }
            if (Math.abs(t) < Proj4js.common.HALF_PI) {
                i = Math.sin(t);
                f = Math.cos(t);
                c = Math.tan(t);
                r = this.ep2 * Math.pow(f, 2);
                var e = Math.pow(r, 2)
                  , s = Math.pow(c, 2)
                  , l = Math.pow(s, 2);
                i = 1 - this.es * Math.pow(i, 2);
                h = this.a / Math.sqrt(i);
                i = h * (1 - this.es) / i;
                u = u / (h * this.k0);
                o = Math.pow(u, 2);
                t -= h * c * o / i * (.5 - o / 24 * (5 + 3 * s + 10 * r - 4 * e - 9 * this.ep2 - o / 30 * (61 + 90 * s + 298 * r + 45 * l - 252 * this.ep2 - 3 * e)));
                i = Proj4js.common.adjust_lon(this.long0 + u * (1 - o / 6 * (1 + 2 * s + r - o / 20 * (5 - 2 * r + 28 * s - 3 * e + 8 * this.ep2 + 24 * l))) / f)
            } else
                t = Proj4js.common.HALF_PI * Proj4js.common.sign(e),
                i = this.long0
        }
        return n.x = i,
        n.y = t,
        n
    }
};
Proj4js.defs.GOOGLE = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";
Proj4js.defs["EPSG:900913"] = Proj4js.defs.GOOGLE;
Proj4js.Proj.gstmerc = {
    init: function() {
        var n = this.b / this.a;
        this.e = Math.sqrt(1 - n * n);
        this.lc = this.long0;
        this.rs = Math.sqrt(1 + this.e * this.e * Math.pow(Math.cos(this.lat0), 4) / (1 - this.e * this.e));
        var n = Math.sin(this.lat0)
          , t = Math.asin(n / this.rs)
          , i = Math.sin(t);
        this.cp = Proj4js.common.latiso(0, t, i) - this.rs * Proj4js.common.latiso(this.e, this.lat0, n);
        this.n2 = this.k0 * this.a * Math.sqrt(1 - this.e * this.e) / (1 - this.e * this.e * n * n);
        this.xs = this.x0;
        this.ys = this.y0 - this.n2 * t;
        this.title || (this.title = "Gauss Schreiber transverse mercator")
    },
    forward: function(n) {
        var t = n.y
          , r = this.rs * (n.x - this.lc)
          , t = this.cp + this.rs * Proj4js.common.latiso(this.e, t, Math.sin(t))
          , i = Math.asin(Math.sin(r) / Proj4js.common.cosh(t))
          , i = Proj4js.common.latiso(0, i, Math.sin(i));
        return n.x = this.xs + this.n2 * i,
        n.y = this.ys + this.n2 * Math.atan(Proj4js.common.sinh(t) / Math.cos(r)),
        n
    },
    inverse: function(n) {
        var t = n.x
          , i = n.y
          , r = Math.atan(Proj4js.common.sinh((t - this.xs) / this.n2) / Math.cos((i - this.ys) / this.n2))
          , t = Math.asin(Math.sin((i - this.ys) / this.n2) / Proj4js.common.cosh((t - this.xs) / this.n2))
          , t = Proj4js.common.latiso(0, t, Math.sin(t));
        return n.x = this.lc + r / this.rs,
        n.y = Proj4js.common.invlatiso(this.e, (t - this.cp) / this.rs),
        n
    }
};
Proj4js.Proj.ortho = {
    init: function() {
        this.sin_p14 = Math.sin(this.lat0);
        this.cos_p14 = Math.cos(this.lat0)
    },
    forward: function(n) {
        var i, t, r, u, f, e, o;
        return t = n.y,
        r = Proj4js.common.adjust_lon(n.x - this.long0),
        i = Math.sin(t),
        t = Math.cos(t),
        u = Math.cos(r),
        f = this.sin_p14 * i + this.cos_p14 * t * u,
        0 < f || Math.abs(f) <= Proj4js.common.EPSLN ? (e = 1 * this.a * t * Math.sin(r),
        o = this.y0 + 1 * this.a * (this.cos_p14 * i - this.sin_p14 * t * u)) : Proj4js.reportError("orthoFwdPointError"),
        n.x = e,
        n.y = o,
        n
    },
    inverse: function(n) {
        var t, i, r, u;
        return n.x -= this.x0,
        n.y -= this.y0,
        t = Math.sqrt(n.x * n.x + n.y * n.y),
        t > this.a + 1e-7 && Proj4js.reportError("orthoInvDataError"),
        i = Proj4js.common.asinz(t / this.a),
        r = Math.sin(i),
        u = Math.cos(i),
        i = this.long0,
        Math.abs(t),
        r = Proj4js.common.asinz(u * this.sin_p14 + n.y * r * this.cos_p14 / t),
        t = Math.abs(this.lat0) - Proj4js.common.HALF_PI,
        Math.abs(t) <= Proj4js.common.EPSLN && (i = 0 <= this.lat0 ? Proj4js.common.adjust_lon(this.long0 + Math.atan2(n.x, -n.y)) : Proj4js.common.adjust_lon(this.long0 - Math.atan2(-n.x, n.y))),
        Math.sin(r),
        n.x = i,
        n.y = r,
        n
    }
};
Proj4js.Proj.krovak = {
    init: function() {
        this.a = 6377397.155;
        this.es = .006674372230614;
        this.e = Math.sqrt(this.es);
        this.lat0 || (this.lat0 = .863937979737193);
        this.long0 || (this.long0 = .43342343091192509);
        this.k0 || (this.k0 = .9999);
        this.s45 = .785398163397448;
        this.s90 = 2 * this.s45;
        this.fi0 = this.lat0;
        this.e2 = this.es;
        this.e = Math.sqrt(this.e2);
        this.alfa = Math.sqrt(1 + this.e2 * Math.pow(Math.cos(this.fi0), 4) / (1 - this.e2));
        this.uq = 1.04216856380474;
        this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa);
        this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2);
        this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g;
        this.k1 = this.k0;
        this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2));
        this.s0 = 1.37008346281555;
        this.n = Math.sin(this.s0);
        this.ro0 = this.k1 * this.n0 / Math.tan(this.s0);
        this.ad = this.s90 - this.uq
    },
    forward: function(n) {
        var t, r, i;
        return r = n.y,
        i = Proj4js.common.adjust_lon(n.x - this.long0),
        t = Math.pow((1 + this.e * Math.sin(r)) / (1 - this.e * Math.sin(r)), this.alfa * this.e / 2),
        t = 2 * (Math.atan(this.k * Math.pow(Math.tan(r / 2 + this.s45), this.alfa) / t) - this.s45),
        r = -i * this.alfa,
        i = Math.asin(Math.cos(this.ad) * Math.sin(t) + Math.sin(this.ad) * Math.cos(t) * Math.cos(r)),
        t = this.n * Math.asin(Math.cos(t) * Math.sin(r) / Math.cos(i)),
        i = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(i / 2 + this.s45), this.n),
        n.y = i * Math.cos(t) / 1,
        n.x = i * Math.sin(t) / 1,
        this.czech && (n.y *= -1,
        n.x *= -1),
        n
    },
    inverse: function(n) {
        var i, t, r, u;
        i = n.x;
        n.x = n.y;
        n.y = i;
        this.czech && (n.y *= -1,
        n.x *= -1);
        i = Math.sqrt(n.x * n.x + n.y * n.y);
        t = Math.atan2(n.y, n.x) / Math.sin(this.s0);
        r = 2 * (Math.atan(Math.pow(this.ro0 / i, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45);
        i = Math.asin(Math.cos(this.ad) * Math.sin(r) - Math.sin(this.ad) * Math.cos(r) * Math.cos(t));
        t = Math.asin(Math.cos(r) * Math.sin(t) / Math.cos(i));
        n.x = this.long0 - t / this.alfa;
        t = i;
        u = r = 0;
        do
            n.y = 2 * (Math.atan(Math.pow(this.k, -1 / this.alfa) * Math.pow(Math.tan(i / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(t)) / (1 - this.e * Math.sin(t)), this.e / 2)) - this.s45),
            1e-10 > Math.abs(t - n.y) && (r = 1),
            t = n.y,
            u += 1;
        while (0 == r && 15 > u);
        return 15 <= u ? (Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),
        null) : n
    }
};
Proj4js.Proj.somerc = {
    init: function() {
        var i = this.lat0;
        this.lambda0 = this.long0;
        var t = Math.sin(i)
          , u = this.a
          , n = 1 / this.rf
          , n = 2 * n - Math.pow(n, 2)
          , r = this.e = Math.sqrt(n);
        this.R = this.k0 * u * Math.sqrt(1 - n) / (1 - n * Math.pow(t, 2));
        this.alpha = Math.sqrt(1 + n / (1 - n) * Math.pow(Math.cos(i), 4));
        this.b0 = Math.asin(t / this.alpha);
        this.K = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2)) - this.alpha * Math.log(Math.tan(Math.PI / 4 + i / 2)) + this.alpha * r / 2 * Math.log((1 + r * t) / (1 - r * t))
    },
    forward: function(n) {
        var r = Math.log(Math.tan(Math.PI / 4 - n.y / 2))
          , t = this.e / 2 * Math.log((1 + this.e * Math.sin(n.y)) / (1 - this.e * Math.sin(n.y)))
          , t = 2 * (Math.atan(Math.exp(-this.alpha * (r + t) + this.K)) - Math.PI / 4)
          , i = this.alpha * (n.x - this.lambda0)
          , r = Math.atan(Math.sin(i) / (Math.sin(this.b0) * Math.tan(t) + Math.cos(this.b0) * Math.cos(i)))
          , t = Math.asin(Math.cos(this.b0) * Math.sin(t) - Math.sin(this.b0) * Math.cos(t) * Math.cos(i));
        return n.y = this.R / 2 * Math.log((1 + Math.sin(t)) / (1 - Math.sin(t))) + this.y0,
        n.x = this.R * r + this.x0,
        n
    },
    inverse: function(n) {
        for (var r = (n.x - this.x0) / this.R, t = 2 * (Math.atan(Math.exp((n.y - this.y0) / this.R)) - Math.PI / 4), u = Math.asin(Math.cos(this.b0) * Math.sin(t) + Math.sin(this.b0) * Math.cos(t) * Math.cos(r)), r = this.lambda0 + Math.atan(Math.sin(r) / (Math.cos(this.b0) * Math.cos(r) - Math.sin(this.b0) * Math.tan(t))) / this.alpha, t = 0, i = u, f = -1e3, e = 0; 1e-7 < Math.abs(i - f); ) {
            if (20 < ++e) {
                Proj4js.reportError("omercFwdInfinity");
                return
            }
            t = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + u / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(i)) / 2));
            f = i;
            i = 2 * Math.atan(Math.exp(t)) - Math.PI / 2
        }
        return n.x = r,
        n.y = i,
        n
    }
};
Proj4js.Proj.stere = {
    ssfn_: function(n, t, i) {
        return t *= i,
        Math.tan(.5 * (Proj4js.common.HALF_PI + n)) * Math.pow((1 - t) / (1 + t), .5 * i)
    },
    TOL: 1e-8,
    NITER: 8,
    CONV: 1e-10,
    S_POLE: 0,
    N_POLE: 1,
    OBLIQ: 2,
    EQUIT: 3,
    init: function() {
        var n, t;
        if (this.phits = this.lat_ts ? this.lat_ts : Proj4js.common.HALF_PI,
        n = Math.abs(this.lat0),
        this.mode = Math.abs(n) - Proj4js.common.HALF_PI < Proj4js.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : n > Proj4js.common.EPSLN ? this.OBLIQ : this.EQUIT,
        this.phits = Math.abs(this.phits),
        this.es)
            switch (this.mode) {
            case this.N_POLE:
            case this.S_POLE:
                Math.abs(this.phits - Proj4js.common.HALF_PI) < Proj4js.common.EPSLN ? this.akm1 = 2 * this.k0 / Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e)) : (n = Math.sin(this.phits),
                this.akm1 = Math.cos(this.phits) / Proj4js.common.tsfnz(this.e, this.phits, n),
                n *= this.e,
                this.akm1 /= Math.sqrt(1 - n * n));
                break;
            case this.EQUIT:
                this.akm1 = 2 * this.k0;
                break;
            case this.OBLIQ:
                n = Math.sin(this.lat0);
                t = 2 * Math.atan(this.ssfn_(this.lat0, n, this.e)) - Proj4js.common.HALF_PI;
                n *= this.e;
                this.akm1 = 2 * this.k0 * Math.cos(this.lat0) / Math.sqrt(1 - n * n);
                this.sinX1 = Math.sin(t);
                this.cosX1 = Math.cos(t)
            }
        else
            switch (this.mode) {
            case this.OBLIQ:
                this.sinph0 = Math.sin(this.lat0);
                this.cosph0 = Math.cos(this.lat0);
            case this.EQUIT:
                this.akm1 = 2 * this.k0;
                break;
            case this.S_POLE:
            case this.N_POLE:
                this.akm1 = Math.abs(this.phits - Proj4js.common.HALF_PI) >= Proj4js.common.EPSLN ? Math.cos(this.phits) / Math.tan(Proj4js.common.FORTPI - .5 * this.phits) : 2 * this.k0
            }
    },
    forward: function(n) {
        var u = n.x, u = Proj4js.common.adjust_lon(u - this.long0), i = n.y, e, t, o, f, r, s;
        if (this.sphere) {
            o = Math.sin(i);
            f = Math.cos(i);
            r = Math.cos(u);
            u = Math.sin(u);
            switch (this.mode) {
            case this.EQUIT:
                t = 1 + f * r;
                t <= Proj4js.common.EPSLN && Proj4js.reportError("stere:forward:Equit");
                t = this.akm1 / t;
                e = t * f * u;
                t *= o;
                break;
            case this.OBLIQ:
                t = 1 + this.sinph0 * o + this.cosph0 * f * r;
                t <= Proj4js.common.EPSLN && Proj4js.reportError("stere:forward:Obliq");
                t = this.akm1 / t;
                e = t * f * u;
                t *= this.cosph0 * o - this.sinph0 * f * r;
                break;
            case this.N_POLE:
                r = -r;
                i = -i;
            case this.S_POLE:
                Math.abs(i - Proj4js.common.HALF_PI) < this.TOL && Proj4js.reportError("stere:forward:S_POLE");
                t = this.akm1 * Math.tan(Proj4js.common.FORTPI + .5 * i);
                e = u * t;
                t *= r
            }
        } else {
            r = Math.cos(u);
            u = Math.sin(u);
            o = Math.sin(i);
            (this.mode == this.OBLIQ || this.mode == this.EQUIT) && (s = 2 * Math.atan(this.ssfn_(i, o, this.e)),
            f = Math.sin(s - Proj4js.common.HALF_PI),
            s = Math.cos(s));
            switch (this.mode) {
            case this.OBLIQ:
                i = this.akm1 / (this.cosX1 * (1 + this.sinX1 * f + this.cosX1 * s * r));
                t = i * (this.cosX1 * f - this.sinX1 * s * r);
                e = i * s;
                break;
            case this.EQUIT:
                i = 2 * this.akm1 / (1 + s * r);
                t = i * f;
                e = i * s;
                break;
            case this.S_POLE:
                i = -i;
                r = -r;
                o = -o;
            case this.N_POLE:
                e = this.akm1 * Proj4js.common.tsfnz(this.e, i, o);
                t = -e * r
            }
            e *= u
        }
        return n.x = e * this.a + this.x0,
        n.y = t * this.a + this.y0,
        n
    },
    inverse: function(n) {
        var e = (n.x - this.x0) / this.a, i = (n.y - this.y0) / this.a, r, t, o, u = r = 0, s, f = o = 0;
        if (this.sphere) {
            u = Math.sqrt(e * e + i * i);
            f = 2 * Math.atan(u / this.akm1);
            o = Math.sin(f);
            f = Math.cos(f);
            r = 0;
            switch (this.mode) {
            case this.EQUIT:
                t = Math.abs(u) <= Proj4js.common.EPSLN ? 0 : Math.asin(i * o / u);
                (0 != f || 0 != e) && (r = Math.atan2(e * o, f * u));
                break;
            case this.OBLIQ:
                t = Math.abs(u) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(f * this.sinph0 + i * o * this.cosph0 / u);
                f -= this.sinph0 * Math.sin(t);
                (0 != f || 0 != e) && (r = Math.atan2(e * o * this.cosph0, f * u));
                break;
            case this.N_POLE:
                i = -i;
            case this.S_POLE:
                t = Math.abs(u) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(this.mode == this.S_POLE ? -f : f);
                r = 0 == e && 0 == i ? 0 : Math.atan2(e, i)
            }
            n.x = Proj4js.common.adjust_lon(r + this.long0);
            n.y = t
        } else {
            s = Math.sqrt(e * e + i * i);
            switch (this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                r = 2 * Math.atan2(s * this.cosX1, this.akm1);
                o = Math.cos(r);
                t = Math.sin(r);
                u = 0 == s ? Math.asin(o * this.sinX1) : Math.asin(o * this.sinX1 + i * t * this.cosX1 / s);
                r = Math.tan(.5 * (Proj4js.common.HALF_PI + u));
                e *= t;
                i = s * this.cosX1 * o - i * this.sinX1 * t;
                f = Proj4js.common.HALF_PI;
                o = .5 * this.e;
                break;
            case this.N_POLE:
                i = -i;
            case this.S_POLE:
                r = -s / this.akm1;
                u = Proj4js.common.HALF_PI - 2 * Math.atan(r);
                f = -Proj4js.common.HALF_PI;
                o = -.5 * this.e
            }
            for (s = this.NITER; s--; u = t)
                if (t = this.e * Math.sin(u),
                t = 2 * Math.atan(r * Math.pow((1 + t) / (1 - t), o)) - f,
                Math.abs(u - t) < this.CONV)
                    return this.mode == this.S_POLE && (t = -t),
                    r = 0 == e && 0 == i ? 0 : Math.atan2(e, i),
                    n.x = Proj4js.common.adjust_lon(r + this.long0),
                    n.y = t,
                    n
        }
    }
};
Proj4js.Proj.nzmg = {
    iterations: 1,
    init: function() {
        this.A = [];
        this.A[1] = .6399175073;
        this.A[2] = -.1358797613;
        this.A[3] = .063294409;
        this.A[4] = -.02526853;
        this.A[5] = .0117879;
        this.A[6] = -.0055161;
        this.A[7] = .0026906;
        this.A[8] = -.001333;
        this.A[9] = .00067;
        this.A[10] = -.00034;
        this.B_re = [];
        this.B_im = [];
        this.B_re[1] = .7557853228;
        this.B_im[1] = 0;
        this.B_re[2] = .249204646;
        this.B_im[2] = .003371507;
        this.B_re[3] = -.001541739;
        this.B_im[3] = .04105856;
        this.B_re[4] = -.10162907;
        this.B_im[4] = .01727609;
        this.B_re[5] = -.26623489;
        this.B_im[5] = -.36249218;
        this.B_re[6] = -.6870983;
        this.B_im[6] = -1.1651967;
        this.C_re = [];
        this.C_im = [];
        this.C_re[1] = 1.3231270439;
        this.C_im[1] = 0;
        this.C_re[2] = -.577245789;
        this.C_im[2] = -.007809598;
        this.C_re[3] = .508307513;
        this.C_im[3] = -.112208952;
        this.C_re[4] = -.15094762;
        this.C_im[4] = .18200602;
        this.C_re[5] = 1.01418179;
        this.C_im[5] = 1.64497696;
        this.C_re[6] = 1.9660549;
        this.C_im[6] = 2.5127645;
        this.D = [];
        this.D[1] = 1.5627014243;
        this.D[2] = .5185406398;
        this.D[3] = -.03333098;
        this.D[4] = -.1052906;
        this.D[5] = -.0368594;
        this.D[6] = .007317;
        this.D[7] = .0122;
        this.D[8] = .00394;
        this.D[9] = -.0013
    },
    forward: function(n) {
        for (var f = 1e-5 * ((n.y - this.lat0) / Proj4js.common.SEC_TO_RAD), s = n.x - this.long0, i = 1, u = 0, t = 1; 10 >= t; t++)
            i *= f,
            u += this.A[t] * i;
        for (var f = u, i = 1, r = 0, e = 0, o = 0, t = 1; 6 >= t; t++)
            u = i * f - r * s,
            r = r * f + i * s,
            i = u,
            e = e + this.B_re[t] * i - this.B_im[t] * r,
            o = o + this.B_im[t] * i + this.B_re[t] * r;
        return n.x = o * this.a + this.x0,
        n.y = e * this.a + this.y0,
        n
    },
    inverse: function(n) {
        for (var u, f, v, c = (n.y - this.y0) / this.a, s = (n.x - this.x0) / this.a, o = 1, e = 0, h, i = 0, r = 0, t = 1; 6 >= t; t++)
            h = o * c - e * s,
            e = e * c + o * s,
            o = h,
            i = i + this.C_re[t] * o - this.C_im[t] * e,
            r = r + this.C_im[t] * o + this.C_re[t] * e;
        for (o = 0; o < this.iterations; o++) {
            for (u = i,
            f = r,
            h = c,
            e = s,
            t = 2; 6 >= t; t++)
                v = u * i - f * r,
                f = f * i + u * r,
                u = v,
                h += (t - 1) * (this.B_re[t] * u - this.B_im[t] * f),
                e += (t - 1) * (this.B_im[t] * u + this.B_re[t] * f);
            for (var u = 1, f = 0, l = this.B_re[1], a = this.B_im[1], t = 2; 6 >= t; t++)
                v = u * i - f * r,
                f = f * i + u * r,
                u = v,
                l += t * (this.B_re[t] * u - this.B_im[t] * f),
                a += t * (this.B_im[t] * u + this.B_re[t] * f);
            r = l * l + a * a;
            i = (h * l + e * a) / r;
            r = (e * l - h * a) / r
        }
        for (c = i,
        s = 1,
        i = 0,
        t = 1; 9 >= t; t++)
            s *= c,
            i += this.D[t] * s;
        return t = this.lat0 + 1e5 * i * Proj4js.common.SEC_TO_RAD,
        n.x = this.long0 + r,
        n.y = t,
        n
    }
};
Proj4js.Proj.mill = {
    init: function() {},
    forward: function(n) {
        var t = n.y
          , i = this.x0 + this.a * Proj4js.common.adjust_lon(n.x - this.long0)
          , t = this.y0 + 1.25 * this.a * Math.log(Math.tan(Proj4js.common.PI / 4 + t / 2.5));
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        n.x -= this.x0;
        n.y -= this.y0;
        var t = Proj4js.common.adjust_lon(this.long0 + n.x / this.a)
          , i = 2.5 * (Math.atan(Math.exp(.8 * n.y / this.a)) - Proj4js.common.PI / 4);
        return n.x = t,
        n.y = i,
        n
    }
};
Proj4js.Proj.gnom = {
    init: function() {
        this.sin_p14 = Math.sin(this.lat0);
        this.cos_p14 = Math.cos(this.lat0);
        this.infinity_dist = 1e3 * this.a;
        this.rc = 1
    },
    forward: function(n) {
        var i, t, r, f, u;
        return t = n.y,
        r = Proj4js.common.adjust_lon(n.x - this.long0),
        i = Math.sin(t),
        t = Math.cos(t),
        f = Math.cos(r),
        u = this.sin_p14 * i + this.cos_p14 * t * f,
        0 < u || Math.abs(u) <= Proj4js.common.EPSLN ? (r = this.x0 + 1 * this.a * t * Math.sin(r) / u,
        i = this.y0 + 1 * this.a * (this.cos_p14 * i - this.sin_p14 * t * f) / u) : (Proj4js.reportError("orthoFwdPointError"),
        r = this.x0 + this.infinity_dist * t * Math.sin(r),
        i = this.y0 + this.infinity_dist * (this.cos_p14 * i - this.sin_p14 * t * f)),
        n.x = r,
        n.y = i,
        n
    },
    inverse: function(n) {
        var t, r, u, i;
        return n.x = (n.x - this.x0) / this.a,
        n.y = (n.y - this.y0) / this.a,
        n.x /= this.k0,
        n.y /= this.k0,
        (t = Math.sqrt(n.x * n.x + n.y * n.y)) ? (i = Math.atan2(t, this.rc),
        r = Math.sin(i),
        u = Math.cos(i),
        i = Proj4js.common.asinz(u * this.sin_p14 + n.y * r * this.cos_p14 / t),
        t = Math.atan2(n.x * r, t * this.cos_p14 * u - n.y * this.sin_p14 * r),
        t = Proj4js.common.adjust_lon(this.long0 + t)) : (i = this.phic0,
        t = 0),
        n.x = t,
        n.y = i,
        n
    }
};
Proj4js.Proj.sinu = {
    init: function() {
        this.sphere ? (this.n = 1,
        this.es = this.m = 0,
        this.C_y = Math.sqrt((this.m + 1) / this.n),
        this.C_x = this.C_y / (this.m + 1)) : this.en = Proj4js.common.pj_enfn(this.es)
    },
    forward: function(n) {
        var i, t, r, u, f;
        if (i = n.x,
        t = n.y,
        i = Proj4js.common.adjust_lon(i - this.long0),
        this.sphere) {
            if (this.m) {
                for (r = this.n * Math.sin(t),
                u = Proj4js.common.MAX_ITER; u; --u)
                    if (f = (this.m * t + Math.sin(t) - r) / (this.m + Math.cos(t)),
                    t -= f,
                    Math.abs(f) < Proj4js.common.EPSLN)
                        break
            } else
                t = 1 != this.n ? Math.asin(this.n * Math.sin(t)) : t;
            i = this.a * this.C_x * i * (this.m + Math.cos(t));
            t *= this.a * this.C_y
        } else
            r = Math.sin(t),
            u = Math.cos(t),
            t = this.a * Proj4js.common.pj_mlfn(t, r, u, this.en),
            i = this.a * i * u / Math.sqrt(1 - this.es * r * r);
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, i, r;
        return n.x -= this.x0,
        n.y -= this.y0,
        this.sphere ? (n.y /= this.C_y,
        t = this.m ? Math.asin((this.m * n.y + Math.sin(n.y)) / this.n) : 1 != this.n ? Math.asin(Math.sin(n.y) / this.n) : n.y,
        i = n.x / (this.C_x * (this.m + Math.cos(n.y)))) : (t = Proj4js.common.pj_inv_mlfn(n.y / this.a, this.es, this.en),
        r = Math.abs(t),
        r < Proj4js.common.HALF_PI ? (r = Math.sin(t),
        i = this.long0 + n.x * Math.sqrt(1 - this.es * r * r) / (this.a * Math.cos(t)),
        i = Proj4js.common.adjust_lon(i)) : r - Proj4js.common.EPSLN < Proj4js.common.HALF_PI && (i = this.long0)),
        n.x = i,
        n.y = t,
        n
    }
};
Proj4js.Proj.vandg = {
    init: function() {
        this.R = 6370997
    },
    forward: function(n) {
        var u = n.y, f = Proj4js.common.adjust_lon(n.x - this.long0), i;
        Math.abs(u);
        i = Proj4js.common.asinz(2 * Math.abs(u / Proj4js.common.PI));
        (Math.abs(f) <= Proj4js.common.EPSLN || Math.abs(Math.abs(u) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN) && Math.tan(.5 * i);
        var e = .5 * Math.abs(Proj4js.common.PI / f - f / Proj4js.common.PI)
          , t = e * e
          , r = Math.sin(i)
          , i = Math.cos(i)
          , i = i / (r + i - 1)
          , r = i * (2 / r - 1)
          , r = r * r
          , t = Proj4js.common.PI * this.R * (e * (i - r) + Math.sqrt(t * (i - r) * (i - r) - (r + t) * (i * i - r))) / (r + t);
        return 0 > f && (t = -t),
        f = this.x0 + t,
        t = Math.abs(t / (Proj4js.common.PI * this.R)),
        u = 0 <= u ? this.y0 + Proj4js.common.PI * this.R * Math.sqrt(1 - t * t - 2 * e * t) : this.y0 - Proj4js.common.PI * this.R * Math.sqrt(1 - t * t - 2 * e * t),
        n.x = f,
        n.y = u,
        n
    },
    inverse: function(n) {
        var r, u, i, o, e, f, s, t;
        return n.x -= this.x0,
        n.y -= this.y0,
        t = Proj4js.common.PI * this.R,
        r = n.x / t,
        i = n.y / t,
        o = r * r + i * i,
        e = -Math.abs(i) * (1 + o),
        u = e - 2 * i * i + r * r,
        f = -2 * e + 1 + 2 * i * i + o * o,
        t = i * i / f + (2 * u * u * u / f / f / f - 9 * e * u / f / f) / 27,
        s = (e - u * u / 3 / f) / f,
        e = 2 * Math.sqrt(-s / 3),
        t = 3 * t / s / e,
        1 < Math.abs(t) && (t = 0 <= t ? 1 : -1),
        t = Math.acos(t) / 3,
        u = 0 <= n.y ? (-e * Math.cos(t + Proj4js.common.PI / 3) - u / 3 / f) * Proj4js.common.PI : -(-e * Math.cos(t + Proj4js.common.PI / 3) - u / 3 / f) * Proj4js.common.PI,
        Math.abs(r),
        r = Proj4js.common.adjust_lon(this.long0 + Proj4js.common.PI * (o - 1 + Math.sqrt(1 + 2 * (r * r - i * i) + o * o)) / 2 / r),
        n.x = r,
        n.y = u,
        n
    }
};
Proj4js.Proj.cea = {
    init: function() {},
    forward: function(n) {
        var t = n.y
          , i = this.x0 + this.a * Proj4js.common.adjust_lon(n.x - this.long0) * Math.cos(this.lat_ts)
          , t = this.y0 + this.a * Math.sin(t) / Math.cos(this.lat_ts);
        return n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        n.x -= this.x0;
        n.y -= this.y0;
        var t = Proj4js.common.adjust_lon(this.long0 + n.x / this.a / Math.cos(this.lat_ts))
          , i = Math.asin(n.y / this.a * Math.cos(this.lat_ts));
        return n.x = t,
        n.y = i,
        n
    }
};
Proj4js.Proj.eqc = {
    init: function() {
        this.x0 || (this.x0 = 0);
        this.y0 || (this.y0 = 0);
        this.lat0 || (this.lat0 = 0);
        this.long0 || (this.long0 = 0);
        this.lat_ts || (this.lat_ts = 0);
        this.title || (this.title = "Equidistant Cylindrical (Plate Carre)");
        this.rc = Math.cos(this.lat_ts)
    },
    forward: function(n) {
        var t = n.y
          , i = Proj4js.common.adjust_lon(n.x - this.long0)
          , t = Proj4js.common.adjust_lat(t - this.lat0);
        return n.x = this.x0 + this.a * i * this.rc,
        n.y = this.y0 + this.a * t,
        n
    },
    inverse: function(n) {
        var t = n.y;
        return n.x = Proj4js.common.adjust_lon(this.long0 + (n.x - this.x0) / (this.a * this.rc)),
        n.y = Proj4js.common.adjust_lat(this.lat0 + (t - this.y0) / this.a),
        n
    }
};
Proj4js.Proj.cass = {
    init: function() {
        this.sphere || (this.en = Proj4js.common.pj_enfn(this.es),
        this.m0 = Proj4js.common.pj_mlfn(this.lat0, Math.sin(this.lat0), Math.cos(this.lat0), this.en))
    },
    C1: .16666666666666666,
    C2: .0083333333333333332,
    C3: .041666666666666664,
    C4: .33333333333333331,
    C5: .066666666666666666,
    forward: function(n) {
        var u, i, r = n.x, t = n.y, r = Proj4js.common.adjust_lon(r - this.long0);
        return this.sphere ? (u = Math.asin(Math.cos(t) * Math.sin(r)),
        i = Math.atan2(Math.tan(t), Math.cos(r)) - this.phi0) : (this.n = Math.sin(t),
        this.c = Math.cos(t),
        i = Proj4js.common.pj_mlfn(t, this.n, this.c, this.en),
        this.n = 1 / Math.sqrt(1 - this.es * this.n * this.n),
        this.tn = Math.tan(t),
        this.t = this.tn * this.tn,
        this.a1 = r * this.c,
        this.c *= this.es * this.c / (1 - this.es),
        this.a2 = this.a1 * this.a1,
        u = this.n * this.a1 * (1 - this.a2 * this.t * (this.C1 - (8 - this.t + 8 * this.c) * this.a2 * this.C2)),
        i -= this.m0 - this.n * this.tn * this.a2 * (.5 + (5 - this.t + 6 * this.c) * this.a2 * this.C3)),
        n.x = this.a * u + this.x0,
        n.y = this.a * i + this.y0,
        n
    },
    inverse: function(n) {
        var t, i, r;
        return n.x -= this.x0,
        n.y -= this.y0,
        t = n.x / this.a,
        i = n.y / this.a,
        this.sphere ? (this.dd = i + this.lat0,
        i = Math.asin(Math.sin(this.dd) * Math.cos(t)),
        t = Math.atan2(Math.tan(t), Math.cos(this.dd))) : (r = Proj4js.common.pj_inv_mlfn(this.m0 + i, this.es, this.en),
        this.tn = Math.tan(r),
        this.t = this.tn * this.tn,
        this.n = Math.sin(r),
        this.r = 1 / (1 - this.es * this.n * this.n),
        this.n = Math.sqrt(this.r),
        this.r *= (1 - this.es) * this.n,
        this.dd = t / this.n,
        this.d2 = this.dd * this.dd,
        i = r - this.n * this.tn / this.r * this.d2 * (.5 - (1 + 3 * this.t) * this.d2 * this.C3),
        t = this.dd * (1 + this.t * this.d2 * (-this.C4 + (1 + 3 * this.t) * this.d2 * this.C5)) / Math.cos(r)),
        n.x = Proj4js.common.adjust_lon(this.long0 + t),
        n.y = i,
        n
    }
};
Proj4js.Proj.gauss = {
    init: function() {
        var n = Math.sin(this.lat0)
          , t = Math.cos(this.lat0)
          , t = t * t;
        this.rc = Math.sqrt(1 - this.es) / (1 - this.es * n * n);
        this.C = Math.sqrt(1 + this.es * t * t / (1 - this.es));
        this.phic0 = Math.asin(n / this.C);
        this.ratexp = .5 * this.C * this.e;
        this.K = Math.tan(.5 * this.phic0 + Proj4js.common.FORTPI) / (Math.pow(Math.tan(.5 * this.lat0 + Proj4js.common.FORTPI), this.C) * Proj4js.common.srat(this.e * n, this.ratexp))
    },
    forward: function(n) {
        var i = n.x
          , t = n.y;
        return n.y = 2 * Math.atan(this.K * Math.pow(Math.tan(.5 * t + Proj4js.common.FORTPI), this.C) * Proj4js.common.srat(this.e * Math.sin(t), this.ratexp)) - Proj4js.common.HALF_PI,
        n.x = this.C * i,
        n
    },
    inverse: function(n) {
        for (var r = n.x / this.C, t = n.y, u = Math.pow(Math.tan(.5 * t + Proj4js.common.FORTPI) / this.K, 1 / this.C), i = Proj4js.common.MAX_ITER; 0 < i; --i) {
            if (t = 2 * Math.atan(u * Proj4js.common.srat(this.e * Math.sin(n.y), -.5 * this.e)) - Proj4js.common.HALF_PI,
            1e-14 > Math.abs(t - n.y))
                break;
            n.y = t
        }
        return i ? (n.x = r,
        n.y = t,
        n) : (Proj4js.reportError("gauss:inverse:convergence failed"),
        null)
    }
};
Proj4js.Proj.omerc = {
    init: function() {
        this.mode || (this.mode = 0);
        this.lon1 || (this.lon1 = 0,
        this.mode = 1);
        this.lon2 || (this.lon2 = 0);
        this.lat2 || (this.lat2 = 0);
        var n = 1 - Math.pow(this.b / this.a, 2);
        Math.sqrt(n);
        this.sin_p20 = Math.sin(this.lat0);
        this.cos_p20 = Math.cos(this.lat0);
        this.con = 1 - this.es * this.sin_p20 * this.sin_p20;
        this.com = Math.sqrt(1 - n);
        this.bl = Math.sqrt(1 + this.es * Math.pow(this.cos_p20, 4) / (1 - n));
        this.al = this.a * this.bl * this.k0 * this.com / this.con;
        Math.abs(this.lat0) < Proj4js.common.EPSLN ? this.el = this.d = this.ts = 1 : (this.ts = Proj4js.common.tsfnz(this.e, this.lat0, this.sin_p20),
        this.con = Math.sqrt(this.con),
        this.d = this.bl * this.com / (this.cos_p20 * this.con),
        this.f = 0 < this.d * this.d - 1 ? 0 <= this.lat0 ? this.d + Math.sqrt(this.d * this.d - 1) : this.d - Math.sqrt(this.d * this.d - 1) : this.d,
        this.el = this.f * Math.pow(this.ts, this.bl));
        0 != this.mode ? (this.g = .5 * (this.f - 1 / this.f),
        this.gama = Proj4js.common.asinz(Math.sin(this.alpha) / this.d),
        this.longc -= Proj4js.common.asinz(this.g * Math.tan(this.gama)) / this.bl,
        this.con = Math.abs(this.lat0),
        this.con > Proj4js.common.EPSLN && Math.abs(this.con - Proj4js.common.HALF_PI) > Proj4js.common.EPSLN ? (this.singam = Math.sin(this.gama),
        this.cosgam = Math.cos(this.gama),
        this.sinaz = Math.sin(this.alpha),
        this.cosaz = Math.cos(this.alpha),
        this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz)) : Proj4js.reportError("omerc:Init:DataError")) : (this.sinphi = Math.sin(this.at1),
        this.ts1 = Proj4js.common.tsfnz(this.e, this.lat1, this.sinphi),
        this.sinphi = Math.sin(this.lat2),
        this.ts2 = Proj4js.common.tsfnz(this.e, this.lat2, this.sinphi),
        this.h = Math.pow(this.ts1, this.bl),
        this.l = Math.pow(this.ts2, this.bl),
        this.f = this.el / this.h,
        this.g = .5 * (this.f - 1 / this.f),
        this.j = (this.el * this.el - this.l * this.h) / (this.el * this.el + this.l * this.h),
        this.p = (this.l - this.h) / (this.l + this.h),
        this.dlon = this.lon1 - this.lon2,
        this.dlon < -Proj4js.common.PI && (this.lon2 -= 2 * Proj4js.common.PI),
        this.dlon > Proj4js.common.PI && (this.lon2 += 2 * Proj4js.common.PI),
        this.dlon = this.lon1 - this.lon2,
        this.longc = .5 * (this.lon1 + this.lon2) - Math.atan(this.j * Math.tan(.5 * this.bl * this.dlon) / this.p) / this.bl,
        this.dlon = Proj4js.common.adjust_lon(this.lon1 - this.longc),
        this.gama = Math.atan(Math.sin(this.bl * this.dlon) / this.g),
        this.alpha = Proj4js.common.asinz(this.d * Math.sin(this.gama)),
        Math.abs(this.lat1 - this.lat2) <= Proj4js.common.EPSLN ? Proj4js.reportError("omercInitDataError") : this.con = Math.abs(this.lat1),
        this.con <= Proj4js.common.EPSLN || Math.abs(this.con - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN ? Proj4js.reportError("omercInitDataError") : Math.abs(Math.abs(this.lat0) - Proj4js.common.HALF_PI) <= Proj4js.common.EPSLN && Proj4js.reportError("omercInitDataError"),
        this.singam = Math.sin(this.gam),
        this.cosgam = Math.cos(this.gam),
        this.sinaz = Math.sin(this.alpha),
        this.cosaz = Math.cos(this.alpha),
        this.u = 0 <= this.lat0 ? this.al / this.bl * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz) : -(this.al / this.bl) * Math.atan(Math.sqrt(this.d * this.d - 1) / this.cosaz))
    },
    forward: function(n) {
        var t, r, i, u, f;
        return i = n.x,
        r = n.y,
        t = Math.sin(r),
        u = Proj4js.common.adjust_lon(i - this.longc),
        i = Math.sin(this.bl * u),
        Math.abs(Math.abs(r) - Proj4js.common.HALF_PI) > Proj4js.common.EPSLN ? (t = Proj4js.common.tsfnz(this.e, r, t),
        t = this.el / Math.pow(t, this.bl),
        f = .5 * (t - 1 / t),
        t = (f * this.singam - i * this.cosgam) / (.5 * (t + 1 / t)),
        r = Math.cos(this.bl * u),
        1e-7 > Math.abs(r) ? i = this.al * this.bl * u : (i = this.al * Math.atan((f * this.cosgam + i * this.singam) / r) / this.bl,
        0 > r && (i += Proj4js.common.PI * this.al / this.bl))) : (t = 0 <= r ? this.singam : -this.singam,
        i = this.al * r / this.bl),
        Math.abs(Math.abs(t) - 1) <= Proj4js.common.EPSLN && Proj4js.reportError("omercFwdInfinity"),
        u = .5 * this.al * Math.log((1 - t) / (1 + t)) / this.bl,
        i -= this.u,
        t = this.y0 + i * this.cosaz - u * this.sinaz,
        n.x = this.x0 + u * this.cosaz + i * this.sinaz,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, i, u, r;
        return n.x -= this.x0,
        n.y -= this.y0,
        t = n.x * this.cosaz - n.y * this.sinaz,
        u = n.y * this.cosaz + n.x * this.sinaz,
        u += this.u,
        i = Math.exp(-this.bl * t / this.al),
        t = .5 * (i - 1 / i),
        i = .5 * (i + 1 / i),
        u = Math.sin(this.bl * u / this.al),
        r = (u * this.cosgam + t * this.singam) / i,
        Math.abs(Math.abs(r) - 1) <= Proj4js.common.EPSLN ? (t = this.longc,
        r = 0 <= r ? Proj4js.common.HALF_PI : -Proj4js.common.HALF_PI) : (i = 1 / this.bl,
        r = Math.pow(this.el / Math.sqrt((1 + r) / (1 - r)), i),
        r = Proj4js.common.phi2z(this.e, r),
        t = this.longc - Math.atan2(t * this.cosgam - u * this.singam, i) / this.bl,
        t = Proj4js.common.adjust_lon(t)),
        n.x = t,
        n.y = r,
        n
    }
};
Proj4js.Proj.lcc = {
    init: function() {
        var n;
        if (this.lat2 || (this.lat2 = this.lat0),
        this.k0 || (this.k0 = 1),
        Math.abs(this.lat1 + this.lat2) < Proj4js.common.EPSLN)
            Proj4js.reportError("lcc:init: Equal Latitudes");
        else {
            n = this.b / this.a;
            this.e = Math.sqrt(1 - n * n);
            var n = Math.sin(this.lat1)
              , t = Math.cos(this.lat1)
              , t = Proj4js.common.msfnz(this.e, n, t)
              , r = Proj4js.common.tsfnz(this.e, this.lat1, n)
              , i = Math.sin(this.lat2)
              , u = Math.cos(this.lat2)
              , u = Proj4js.common.msfnz(this.e, i, u)
              , i = Proj4js.common.tsfnz(this.e, this.lat2, i)
              , f = Proj4js.common.tsfnz(this.e, this.lat0, Math.sin(this.lat0));
            this.ns = Math.abs(this.lat1 - this.lat2) > Proj4js.common.EPSLN ? Math.log(t / u) / Math.log(r / i) : n;
            this.f0 = t / (this.ns * Math.pow(r, this.ns));
            this.rh = this.a * this.f0 * Math.pow(f, this.ns);
            this.title || (this.title = "Lambert Conformal Conic")
        }
    },
    forward: function(n) {
        var i = n.x, t = n.y, r;
        if (!(90 >= t && -90 <= t && 180 >= i && -180 <= i))
            return Proj4js.reportError("lcc:forward: llInputOutOfRange: " + i + " : " + t),
            null;
        if (r = Math.abs(Math.abs(t) - Proj4js.common.HALF_PI),
        r > Proj4js.common.EPSLN)
            t = Proj4js.common.tsfnz(this.e, t, Math.sin(t)),
            t = this.a * this.f0 * Math.pow(t, this.ns);
        else {
            if (r = t * this.ns,
            0 >= r)
                return Proj4js.reportError("lcc:forward: No Projection"),
                null;
            t = 0
        }
        return i = this.ns * Proj4js.common.adjust_lon(i - this.long0),
        n.x = this.k0 * t * Math.sin(i) + this.x0,
        n.y = this.k0 * (this.rh - t * Math.cos(i)) + this.y0,
        n
    },
    inverse: function(n) {
        var t, i, r, u = (n.x - this.x0) / this.k0, f = this.rh - (n.y - this.y0) / this.k0;
        if (0 < this.ns ? (t = Math.sqrt(u * u + f * f),
        i = 1) : (t = -Math.sqrt(u * u + f * f),
        i = -1),
        r = 0,
        0 != t && (r = Math.atan2(i * u, i * f)),
        0 != t || 0 < this.ns) {
            if (i = 1 / this.ns,
            t = Math.pow(t / (this.a * this.f0), i),
            t = Proj4js.common.phi2z(this.e, t),
            -9999 == t)
                return null
        } else
            t = -Proj4js.common.HALF_PI;
        return r = Proj4js.common.adjust_lon(r / this.ns + this.long0),
        n.x = r,
        n.y = t,
        n
    }
};
Proj4js.Proj.laea = {
    S_POLE: 1,
    N_POLE: 2,
    EQUIT: 3,
    OBLIQ: 4,
    init: function() {
        var n = Math.abs(this.lat0);
        if (this.mode = Math.abs(n - Proj4js.common.HALF_PI) < Proj4js.common.EPSLN ? 0 > this.lat0 ? this.S_POLE : this.N_POLE : Math.abs(n) < Proj4js.common.EPSLN ? this.EQUIT : this.OBLIQ,
        0 < this.es)
            switch (this.qp = Proj4js.common.qsfnz(this.e, 1),
            this.mmf = .5 / (1 - this.es),
            this.apa = this.authset(this.es),
            this.mode) {
            case this.N_POLE:
            case this.S_POLE:
                this.dd = 1;
                break;
            case this.EQUIT:
                this.rq = Math.sqrt(.5 * this.qp);
                this.dd = 1 / this.rq;
                this.xmf = 1;
                this.ymf = .5 * this.qp;
                break;
            case this.OBLIQ:
                this.rq = Math.sqrt(.5 * this.qp);
                n = Math.sin(this.lat0);
                this.sinb1 = Proj4js.common.qsfnz(this.e, n) / this.qp;
                this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1);
                this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * n * n) * this.rq * this.cosb1);
                this.ymf = (this.xmf = this.rq) / this.dd;
                this.xmf *= this.dd
            }
        else
            this.mode == this.OBLIQ && (this.sinph0 = Math.sin(this.lat0),
            this.cosph0 = Math.cos(this.lat0))
    },
    forward: function(n) {
        var h, t, e = n.x, o = n.y, e = Proj4js.common.adjust_lon(e - this.long0), u, f, i, s, r;
        if (this.sphere) {
            i = Math.sin(o);
            f = Math.cos(o);
            u = Math.cos(e);
            switch (this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                if (t = this.mode == this.EQUIT ? 1 + f * u : 1 + this.sinph0 * i + this.cosph0 * f * u,
                t <= Proj4js.common.EPSLN)
                    return Proj4js.reportError("laea:fwd:y less than eps"),
                    null;
                t = Math.sqrt(2 / t);
                h = t * f * Math.sin(e);
                t *= this.mode == this.EQUIT ? i : this.cosph0 * i - this.sinph0 * f * u;
                break;
            case this.N_POLE:
                u = -u;
            case this.S_POLE:
                if (Math.abs(o + this.phi0) < Proj4js.common.EPSLN)
                    return Proj4js.reportError("laea:fwd:phi < eps"),
                    null;
                t = Proj4js.common.FORTPI - .5 * o;
                t = 2 * (this.mode == this.S_POLE ? Math.cos(t) : Math.sin(t));
                h = t * Math.sin(e);
                t *= u
            }
        } else {
            s = f = 0;
            r = 0;
            u = Math.cos(e);
            e = Math.sin(e);
            i = Math.sin(o);
            i = Proj4js.common.qsfnz(this.e, i);
            (this.mode == this.OBLIQ || this.mode == this.EQUIT) && (f = i / this.qp,
            s = Math.sqrt(1 - f * f));
            switch (this.mode) {
            case this.OBLIQ:
                r = 1 + this.sinb1 * f + this.cosb1 * s * u;
                break;
            case this.EQUIT:
                r = 1 + s * u;
                break;
            case this.N_POLE:
                r = Proj4js.common.HALF_PI + o;
                i = this.qp - i;
                break;
            case this.S_POLE:
                r = o - Proj4js.common.HALF_PI;
                i = this.qp + i
            }
            if (Math.abs(r) < Proj4js.common.EPSLN)
                return Proj4js.reportError("laea:fwd:b < eps"),
                null;
            switch (this.mode) {
            case this.OBLIQ:
            case this.EQUIT:
                r = Math.sqrt(2 / r);
                t = this.mode == this.OBLIQ ? this.ymf * r * (this.cosb1 * f - this.sinb1 * s * u) : (r = Math.sqrt(2 / (1 + s * u))) * f * this.ymf;
                h = this.xmf * r * s * e;
                break;
            case this.N_POLE:
            case this.S_POLE:
                0 <= i ? (h = (r = Math.sqrt(i)) * e,
                t = u * (this.mode == this.S_POLE ? r : -r)) : h = t = 0
            }
        }
        return n.x = this.a * h + this.x0,
        n.y = this.a * t + this.y0,
        n
    },
    inverse: function(n) {
        var r, t, i, e, u, f;
        if (n.x -= this.x0,
        n.y -= this.y0,
        r = n.x / this.a,
        t = n.y / this.a,
        this.sphere) {
            if (e = 0,
            f = 0,
            u = Math.sqrt(r * r + t * t),
            i = .5 * u,
            1 < i)
                return Proj4js.reportError("laea:Inv:DataError"),
                null;
            i = 2 * Math.asin(i);
            (this.mode == this.OBLIQ || this.mode == this.EQUIT) && (f = Math.sin(i),
            e = Math.cos(i));
            switch (this.mode) {
            case this.EQUIT:
                i = Math.abs(u) <= Proj4js.common.EPSLN ? 0 : Math.asin(t * f / u);
                r *= f;
                t = e * u;
                break;
            case this.OBLIQ:
                i = Math.abs(u) <= Proj4js.common.EPSLN ? this.phi0 : Math.asin(e * this.sinph0 + t * f * this.cosph0 / u);
                r *= f * this.cosph0;
                t = (e - Math.sin(i) * this.sinph0) * u;
                break;
            case this.N_POLE:
                t = -t;
                i = Proj4js.common.HALF_PI - i;
                break;
            case this.S_POLE:
                i -= Proj4js.common.HALF_PI
            }
            r = 0 == t && (this.mode == this.EQUIT || this.mode == this.OBLIQ) ? 0 : Math.atan2(r, t)
        } else {
            i = 0;
            switch (this.mode) {
            case this.EQUIT:
            case this.OBLIQ:
                if (r /= this.dd,
                t *= this.dd,
                f = Math.sqrt(r * r + t * t),
                f < Proj4js.common.EPSLN)
                    return n.x = 0,
                    n.y = this.phi0,
                    n;
                u = 2 * Math.asin(.5 * f / this.rq);
                e = Math.cos(u);
                r *= u = Math.sin(u);
                this.mode == this.OBLIQ ? (i = e * this.sinb1 + t * u * this.cosb1 / f,
                t = f * this.cosb1 * e - t * this.sinb1 * u) : (i = t * u / f,
                t = f * e);
                break;
            case this.N_POLE:
                t = -t;
            case this.S_POLE:
                if (i = r * r + t * t,
                !i)
                    return n.x = 0,
                    n.y = this.phi0,
                    n;
                i = 1 - i / this.qp;
                this.mode == this.S_POLE && (i = -i)
            }
            r = Math.atan2(r, t);
            i = this.authlat(Math.asin(i), this.apa)
        }
        return n.x = Proj4js.common.adjust_lon(this.long0 + r),
        n.y = i,
        n
    },
    P00: .33333333333333331,
    P01: .17222222222222222,
    P02: .10257936507936508,
    P10: .063888888888888884,
    P11: .0664021164021164,
    P20: .016415012942191543,
    authset: function(n) {
        var t, i = [];
        return i[0] = n * this.P00,
        t = n * n,
        i[0] += t * this.P01,
        i[1] = t * this.P10,
        t *= n,
        i[0] += t * this.P02,
        i[1] += t * this.P11,
        i[2] = t * this.P20,
        i
    },
    authlat: function(n, t) {
        var i = n + n;
        return n + t[0] * Math.sin(i) + t[1] * Math.sin(i + i) + t[2] * Math.sin(i + i + i)
    }
};
Proj4js.Proj.aeqd = {
    init: function() {
        this.sin_p12 = Math.sin(this.lat0);
        this.cos_p12 = Math.cos(this.lat0)
    },
    forward: function(n) {
        var i = n.x, t, f = Math.sin(n.y), r = Math.cos(n.y), i = Proj4js.common.adjust_lon(i - this.long0), e = Math.cos(i), u = this.sin_p12 * f + this.cos_p12 * r * e;
        if (Math.abs(Math.abs(u) - 1) < Proj4js.common.EPSLN) {
            if (t = 1,
            0 > u) {
                Proj4js.reportError("aeqd:Fwd:PointError");
                return
            }
        } else
            t = Math.acos(u),
            t /= Math.sin(t);
        return n.x = this.x0 + this.a * t * r * Math.sin(i),
        n.y = this.y0 + this.a * t * (this.cos_p12 * f - this.sin_p12 * r * e),
        n
    },
    inverse: function(n) {
        var t, i;
        if (n.x -= this.x0,
        n.y -= this.y0,
        t = Math.sqrt(n.x * n.x + n.y * n.y),
        t > 2 * Proj4js.common.HALF_PI * this.a)
            Proj4js.reportError("aeqdInvDataError");
        else {
            var r = t / this.a, f = Math.sin(r), r = Math.cos(r), e = this.long0, u;
            return Math.abs(t) <= Proj4js.common.EPSLN ? u = this.lat0 : (u = Proj4js.common.asinz(r * this.sin_p12 + n.y * f * this.cos_p12 / t),
            i = Math.abs(this.lat0) - Proj4js.common.HALF_PI,
            Math.abs(i) <= Proj4js.common.EPSLN ? e = 0 <= this.lat0 ? Proj4js.common.adjust_lon(this.long0 + Math.atan2(n.x, -n.y)) : Proj4js.common.adjust_lon(this.long0 - Math.atan2(-n.x, n.y)) : (i = r - this.sin_p12 * Math.sin(u),
            Math.abs(i) < Proj4js.common.EPSLN && Math.abs(n.x) < Proj4js.common.EPSLN || (Math.atan2(n.x * f * this.cos_p12, i * t),
            e = Proj4js.common.adjust_lon(this.long0 + Math.atan2(n.x * f * this.cos_p12, i * t))))),
            n.x = e,
            n.y = u,
            n
        }
    }
};
Proj4js.Proj.moll = {
    init: function() {},
    forward: function(n) {
        for (var r, i = n.y, u = Proj4js.common.adjust_lon(n.x - this.long0), t = i, e = Proj4js.common.PI * Math.sin(i), f = 0; ; f++) {
            if (r = -(t + Math.sin(t) - e) / (1 + Math.cos(t)),
            t = t + r,
            Math.abs(r) < Proj4js.common.EPSLN)
                break;
            50 <= f && Proj4js.reportError("moll:Fwd:IterationError")
        }
        return t /= 2,
        Proj4js.common.PI / 2 - Math.abs(i) < Proj4js.common.EPSLN && (u = 0),
        i = .900316316158 * this.a * u * Math.cos(t) + this.x0,
        t = 1.4142135623731 * this.a * Math.sin(t) + this.y0,
        n.x = i,
        n.y = t,
        n
    },
    inverse: function(n) {
        var t, i;
        return n.x -= this.x0,
        t = n.y / (1.4142135623731 * this.a),
        .999999999999 < Math.abs(t) && (t = .999999999999),
        t = Math.asin(t),
        i = Proj4js.common.adjust_lon(this.long0 + n.x / (.900316316158 * this.a * Math.cos(t))),
        i < -Proj4js.common.PI && (i = -Proj4js.common.PI),
        i > Proj4js.common.PI && (i = Proj4js.common.PI),
        t = (2 * t + Math.sin(2 * t)) / Proj4js.common.PI,
        1 < Math.abs(t) && (t = 1),
        t = Math.asin(t),
        n.x = i,
        n.y = t,
        n
    }
};
/*! D:\FW_API\scripts\AjaxAgent.js*/
bDebug = !0;
nResult = 0;
result = null;
/*! D:\FW_API\scripts\MapLayer.js*/
MapLayer.enumFeatureType = {
    Unknown: 0,
    Point: 1,
    LineString: 2,
    Polygon: 3
};
/*! D:\FW_API\scripts\CachedLayer.js*/
FBM.FWLevelTransform = function(n, t, i, r) {
    function a(n) {
        for (var t = 0, i, r, t = 0; t < u.length - 1; t++)
            if (n < u[t + 1])
                break;
        return t < u.length - 1 && (i = u[t],
        r = u[t + 1],
        t += Math.log(n / i) / Math.log(r / i)),
        t
    }
    function l(n) {
        var t = Math.floor(Math.max(0, Math.min(n, u.length - 2)))
          , r = n - t
          , i = u[t]
          , f = u[t + 1];
        return i * Math.pow(f / i, r)
    }
    for (var f, o, e = t, s = i, u = [], c = r, h = 0; h < c.length; h++)
        u.push(1 / c[h].factor);
    u.reverse();
    f = 0;
    o = 1;
    this.FitLevel = function() {
        this.putMapLevel(Math.round(f))
    }
    ;
    this.getBaseScaleX = function() {
        return e
    }
    ;
    this.putBaseScaleX = function(n) {
        e = n
    }
    ;
    this.getBaseScaleY = function() {
        return s
    }
    ;
    this.putBaseScaleY = function(n) {
        s = n
    }
    ;
    this.getMapMaxLevel = function() {
        return u.length
    }
    ;
    this.getMapLevel = function() {
        return f
    }
    ;
    this.putMapLevel = function(n) {
        if (f == n)
            return !0;
        var t = n > u.length - 1 ? u.length - 1 : n < 0 ? 0 : n;
        return (n >= u.length || n < 0) && f == t ? !1 : (f = t,
        o = l(f),
        !0)
    }
    ;
    this.getScale = function() {
        return e * o
    }
    ;
    this.putScale = function(n) {
        this.putMapLevel(a(n / e))
    }
    ;
    this.getScaleX = function() {
        return e * o
    }
    ;
    this.getScaleY = function() {
        return s * o
    }
    ;
    this.getLevelScale = function(n) {
        return e * l(n)
    }
}
;
FBM.RegisterEvent(MapCachedLayer, ["loaded", ]);
/*! D:\FW_API\scripts\CoordSys.js*/
CPoint3.prototype.toString = function() {
    return "(" + this.X + "," + this.Y + "," + this.Z + ")"
}
;
CPoint3.prototype.Distance = function() {
    return Math.sqrt(this.X * this.X + this.Y * this.Y + this.Z * this.Z)
}
;
HorizontalDatum.prototype.CartesianFromGeodetic = function(n) {
    if (n.Y == 90 || n.Y == -90)
        return new CPoint3(0,0,(n.Y == -90 ? -1 : 1) * this.SemiMajorAxis * (1 - this.es) + n.Z);
    var r = n.Y * Math.PI / 180
      , u = n.X * Math.PI / 180
      , t = Math.sin(r)
      , f = Math.cos(r)
      , i = this.SemiMajorAxis / Math.sqrt(1 - this.es * t * t)
      , e = (i + n.Z) * f * Math.cos(u)
      , o = (i + n.Z) * f * Math.sin(u)
      , s = ((1 - this.es) * i + n.Z) * t;
    return new CPoint3(e,o,s)
}
;
HorizontalDatum.prototype.GeodeticFromCartesian = function(n) {
    var p, w;
    if (n.X == 0 && n.Y == 0)
        return new CPoint3(0,n.Z >= 0 ? 90 : -90,Math.abs(n.Z) - this.SemiMinorAxis);
    var c = .38268343236508978
      , l = n.X * n.X + n.Y * n.Y
      , i = Math.sqrt(l)
      , u = n.Z * 1.0026
      , a = Math.sqrt(u * u + l)
      , f = u / a
      , e = i / a
      , b = f * f * f
      , o = n.Z + this.SemiMinorAxis * this.et2 * b
      , s = i - this.SemiMajorAxis * this.es * e * e * e
      , v = Math.sqrt(o * o + s * s)
      , r = o / v
      , t = s / v
      , h = this.SemiMajorAxis / Math.sqrt(1 - this.es * r * r)
      , y = 0;
    return y = t >= c ? i / t - h : t <= -c ? i / -t - h : n.Z / r - h * (1 - this.es),
    p = Math.atan(r / t) * 180 / Math.PI,
    w = n.X != 0 ? Math.atan2(n.Y, n.X) * 180 / Math.PI : n.Y > 0 ? 90 : -90,
    new CPoint3(w,p,y)
}
;
/*! D:\FW_API\scripts\Mercator.js*/
/*! D:\FW_API\scripts\MapBase.js*/
/*! D:\FW_API\scripts\Overview.js*/
/*! D:\FW_API\scripts\Controls.js*/
FBM.CTRL_ZINDEX = 214748364;
FBM.HtmlControl = function(n, t, i) {
    this.getDiv = function() {
        return r
    }
    ;
    this.getPosition = function() {
        return u
    }
    ;
    this.setPosition = function(i) {
        var f = n.controls[u].indexOf(r);
        t in FBM.FWControlPosition && (f >= 0 && n.controls[u].removeAt(f),
        n.controls[i].push(r),
        u = i)
    }
    ;
    this.setContent = function(n) {
        typeof n == "string" && (f.innerHTML = n)
    }
    ;
    this.remove = function() {
        n.getMapBase().RemoveElement(this);
        var t = n.controls[u];
        t.removeAt(t.indexOf(r))
    }
    ;
    var u = null
      , f = null
      , r = null;
    u = FBM.FWControlPosition.BOTTOM_LEFT;
    t in FBM.FWControlPosition && (u = t);
    r = document.createElement("div");
    util.disableSelect(r);
    r.style.width = "250px";
    r.style.height = "50px";
    f = document.createElement("div");
    r.appendChild(f);
    f.innerHTML = i;
    f.style.position = "absolute";
    f.style.fontFamily = "calibri,微軟正黑體";
    f.style.fontWeight = "600";
    f.style.left = "5px";
    r.style.position = "absolute";
    this.setPosition(u)
}
;
FBM.CopyrightControl = function(n, t) {
    this.getDiv = function() {
        return i
    }
    ;
    this.getPosition = function() {
        return r
    }
    ;
    this.setPosition = function(u) {
        var f = n.controls[r].indexOf(i);
        t in FBM.FWControlPosition && (f >= 0 && n.controls[r].removeAt(f),
        n.controls[u].push(i),
        r = u)
    }
    ;
    var r = null
      , u = null
      , i = null
      , f = new Date
      , e = f.getFullYear();
    r = FBM.FWControlPosition.BOTTOM_LEFT;
    t in FBM.FWControlPosition && (r = t);
    i = document.createElement("div");
    util.disableSelect(i);
    i.style.width = "250px";
    i.style.height = "20px";
    u = document.createElement("div");
    i.appendChild(u);
    u.innerHTML = "FBM MAP © " + e + " ,交通部";
    u.style.position = "absolute";
    u.style.fontWeight = "900";
    u.style.left = "5px";
    u.style.bottom = "0px";
    i.style.position = "absolute";
    this.setPosition(r)
}
;
FBM.MapTypeBarControl = function(n, t) {
    function v(n, t) {
        n.src = t
    }
    function nt() {
        i = document.createElement("div");
        i.style.position = "absolute";
        i.style.padding = "5px";
        i.setAttribute("class", "FWMapTypeCtrl")
    }
    function k(t) {
        var a, y, r, s, l;
        for (f = document.createElement("div"),
        f.style.position = "absolute",
        f.style.overflow = "hidden",
        u = document.createElement("table"),
        u.style.borderSpacing = "0",
        u.border = "0",
        f.appendChild(u),
        a = u.insertRow(-1),
        y = 0,
        r = 0; r < t.length; r++)
            t[r]in n.getDocName() && (s = a.insertCell(0),
            s.width = e + "px",
            s.height = g + "px",
            s.style.padding = "0px",
            s.style.backgroundRepeat = "no-repeat",
            s.style.cursor = "pointer",
            s.mapTypeId = t[r],
            l = document.createElement("img"),
            s.appendChild(l),
            s.imgElem = l,
            l.mapTypeId = t[r],
            AttachEvent(l, "click", function(n) {
                var t = util.eventTarget(n);
                o.getMapTypeId() != t.mapTypeId && (v(t, h[t.mapTypeId + "_IMG_D"]),
                b(t.mapTypeId))
            }),
            o.getMapTypeId() == t[r] ? v(l, h[t[r] + "_IMG_D"]) : v(l, h[t[r] + "_IMG"]),
            y += e);
        AttachEvent(i, "mouseover", function() {
            c.mapTypeControlStyle != FBM.FWMapTypeControlStyle.DROPDOWN_MENU && w.expand()
        });
        AttachEvent(i, "mouseout", function() {
            c.mapTypeControlStyle != FBM.FWMapTypeControlStyle.DROPDOWN_MENU && w.minimize()
        });
        i.appendChild(f);
        util.disableSelect(f)
    }
    function d(t) {
        var u, f;
        for (r = document.createElement("div"),
        r.style.position = "absolute",
        r.style.right = "0px",
        r.style.backgroundColor = "#CCCCDD",
        r.style.borderStyle = "solid",
        r.style.borderColor = "#888888",
        r.style.fontFamily = "Times New Roman,微軟正黑體",
        l = document.createElement("div"),
        l.innerHTML = "地圖類型",
        l.style.margin = "5px",
        s = document.createElement("select"),
        s.style.margin = "5px",
        s.style.marginTop = "0px",
        r.appendChild(l),
        r.appendChild(s),
        util.disableSelect(l),
        AttachEvent(s, "change", function() {
            b(s.value)
        }),
        u = 0; u < t.length; u++)
            t[u]in n.getDocName() && (f = new Option(FBM.FWMapTypeId_zh_TW[t[u]],t[u]),
            s.add(f));
        i.appendChild(r)
    }
    function b(n) {
        w.setActiveType(n);
        o.setMapTypeId(n)
    }
    var h = {
        ROADMAP_IMG_D: FBM.RES_PATH + "ROADMAP_d.png",
        SATELLITE_IMG_D: FBM.RES_PATH + "SATELLITE_d.png",
        HYBRID_IMG_D: FBM.RES_PATH + "HYBRID_d.png",
        FWMAP_IMG_D: FBM.RES_PATH + "FWMAP_d.png",
        NLSCMAP_IMG_D: FBM.RES_PATH + "NLSCMAP_d.png",
        MOTCMAP_IMG_D: FBM.RES_PATH + "MOTCMAP_d.png",
        F2IMAGE_IMG_D: FBM.RES_PATH + "F2IMAGE_d.png",
        HILLSHADE_IMG_D: FBM.RES_PATH + "HILLSHADE_d.png",
        SEGISMAP_IMG_D: FBM.RES_PATH + "SEGISMAP_d.png",
        HILLSHADEMIX_IMG_D: FBM.RES_PATH + "HILLSHADEMIX_d.png",
        IMAGENLSC_IMG_D: FBM.RES_PATH + "IMAGENLSC_d.png",
        ROADMAP_IMG: FBM.RES_PATH + "ROADMAP_n.png",
        SATELLITE_IMG: FBM.RES_PATH + "SATELLITE_n.png",
        HYBRID_IMG: FBM.RES_PATH + "HYBRID_n.png",
        FWMAP_IMG: FBM.RES_PATH + "FWMAP_n.png",
        NLSCMAP_IMG: FBM.RES_PATH + "NLSCMAP_n.png",
        MOTCMAP_IMG: FBM.RES_PATH + "MOTCMAP_n.png",
        F2IMAGE_IMG: FBM.RES_PATH + "F2IMAGE_n.png",
        HILLSHADE_IMG: FBM.RES_PATH + "HILLSHADE_n.png",
        SEGISMAP_IMG: FBM.RES_PATH + "SEGISMAP_n.png",
        HILLSHADEMIX_IMG: FBM.RES_PATH + "HILLSHADEMIX_n.png",
        IMAGENLSC_IMG: FBM.RES_PATH + "IMAGENLSC_n.png"
    }
      , e = 70
      , g = 70
      , o = n
      , tt = o.getDiv()
      , p = o.getMapBase()
      , y = t
      , c = y
      , i = null
      , f = null
      , u = null
      , r = null
      , s = null
      , l = null
      , a = y.controlPosition
      , w = this;
    this.ani = null;
    this.expand = function() {
        for (var t = 0, n = 0, r, f, n = 0; n < u.rows[0].cells.length; n++)
            u.rows[0].cells[n].style.display = "table-cell",
            t += e;
        r = parseInt(i.style.width);
        f = t - r;
        this.ani && this.ani.stop();
        this.ani = FBM.fx.createAnimation({
            easing: FBM.fx.easing.quadOut,
            type: window.requestAnimationFrame ? "req" : "setTimeout",
            duration: 200,
            onAnimation: function(n) {
                i.style.width = r + parseInt(f * n) + "px"
            },
            onEnd: function() {
                i.style.width = t + "px"
            }
        });
        this.ani.play()
    }
    ;
    this.minimize = function() {
        for (var t, r, n = 0; n < u.rows[0].cells.length; n++)
            u.rows[0].cells[n].style.display = o.getMapTypeId() == u.rows[0].cells[n].mapTypeId ? "table-cell" : "none";
        t = parseInt(i.style.width);
        r = t - e;
        this.ani && this.ani.stop();
        this.ani = FBM.fx.createAnimation({
            easing: FBM.fx.easing.quadOut,
            type: window.requestAnimationFrame ? "req" : "setTimeout",
            duration: 200,
            onAnimation: function(n) {
                i.style.width = t - parseInt(r * n) + "px"
            },
            onEnd: function() {
                i.style.width = e + "px"
            }
        });
        this.ani.play()
    }
    ;
    this.getDiv = function() {
        return i
    }
    ;
    this.init = function() {
        nt();
        k(y.mapTypeIds);
        d(y.mapTypeIds);
        this.setStyle(FBM.FWMapTypeControlStyle.DEFAULT);
        this.setPosition(a)
    }
    ;
    this.setWms = function(n, t) {
        for (var i = defaultLayer; i < pLyr.length; i++)
            pLyr[i].getName() == n && pLyr[i].putVisible(t);
        p.RefreshMap(!0)
    }
    ;
    this.removeWms = function(n) {
        function i(n, t) {
            for (var r = new Array(n.length - 1), u = 0, i = 0; i < n.length - 1; i++)
                i != t && (r[u] = n[i],
                u++);
            return r
        }
        for (var t = defaultLayer; t < pLyr.length; t++)
            pLyr[t].getName() == n && (p.RemoveLayer(pLyr[t]),
            pLyr = i(pLyr, t)),
            p.RefreshMap(!0)
    }
    ;
    this.setPosition = function(t) {
        var r = n.controls[a].indexOf(i);
        t in FBM.FWControlPosition && (r >= 0 && n.controls[a].removeAt(r),
        n.controls[t].push(i),
        a = t)
    }
    ;
    this.setStyle = function(n) {
        if (n) {
            if (this.ani && this.ani.stop(),
            f.style.display = "inline",
            r.style.display = "none",
            n == FBM.FWMapTypeControlStyle.DEFAULT || n == FBM.FWMapTypeControlStyle.HORIZONTAL_BAR)
                f.style.display = "inline",
                r.style.display = "none",
                i.style.width = e + "px",
                i.style.height = e + "px";
            else if (n == FBM.FWMapTypeControlStyle.DROPDOWN_MENU)
                f.style.display = "none",
                r.style.display = "inline",
                i.style.height = r.scrollHeight + 10 + "px",
                i.style.width = r.scrollWidth + 10 + "px";
            else
                throw "invalide map type control style";
            c.mapTypeControlStyle = n
        }
    }
    ;
    this.setMapTypeIds = function(n) {
        i.removeChild(r);
        i.removeChild(f);
        k(n);
        d(n);
        c.mapTypeIds = n;
        var t = o.getDocName();
        if (n[0]in t) {
            b(n[0]);
            this.minimize();
            return
        }
    }
    ;
    this.setActiveType = function(n) {
        for (var t, i = 0; i < u.rows[0].cells.length; i++)
            t = u.rows[0].cells[i],
            t.mapTypeId == n ? v(t.imgElem, h[t.imgElem.mapTypeId + "_IMG_D"]) : v(t.imgElem, h[t.imgElem.mapTypeId + "_IMG"])
    }
    ;
    this.remove = function() {
        var t = n.controls[a];
        t.removeAt(t.indexOf(i))
    }
    ;
    this.display = function(n) {
        i.style.display = n ? "inline" : "none"
    }
    ;
    this.setOptions = function(n) {
        n.mapTypeIds != undefined && (this.setMapTypeIds(n.mapTypeIds),
        this.setStyle(c.mapTypeControlStyle));
        n.mapTypeControlStyle != undefined && this.setStyle(n.mapTypeControlStyle);
        n.controlPosition != undefined && this.setPosition(n.controlPosition)
    }
    ;
    this.getDiv = function() {
        return i
    }
    ;
    this.init()
}
;
FBM.LevelBarControl = function(n, t, i, r, u) {
    function nt(n) {
        t.putMapLevel(t.getMapLevel() + n);
        t.FitLevel();
        c.RefreshMap(!0)
    }
    function rt(n) {
        function i(n) {
            t.putMapLevel(Math.round(e + (u - n.clientY) / v));
            c.RefreshMap(!1)
        }
        function r() {
            DetachEvent(f, "mousemove", i, !0);
            DetachEvent(f, "mouseup", r, !0);
            t.FitLevel();
            c.RefreshMap(!0)
        }
        if (util.disableDefault(n),
        n.srcElement == f) {
            var u = n.clientY
              , e = t.getMapLevel();
            AttachEvent(f, "mousemove", i, !0);
            AttachEvent(f, "mouseup", r, !0)
        } else
            t.putMapLevel((a.clientHeight - n.offsetY) / v - .5),
            t.FitLevel(),
            c.RefreshMap(!0)
    }
    var v, c, d, o, k, y, h, f, p, w, s;
    this.getDiv = function() {
        return e
    }
    ;
    var g = u, tt = null, b = i, e = null, it;
    it = i;
    v = 16;
    c = null;
    e = document.createElement("table");
    e.style.position = "absolute";
    e.style.paddingLeft = "20px";
    e.border = "0";
    e.cellPadding = "0";
    e.cellSpacing = "0";
    e.id = "pLevelBarBar";
    e.name = "pLevelBarBar";
    util.disableSelect(e);
    k = e.insertRow(-1);
    y = k.insertCell(-1);
    y.align = "center";
    h = document.createElement("table");
    y.appendChild(h);
    h.border = "0";
    h.cellPadding = "0";
    h.cellSpacing = "0";
    h.width = "34";
    p = h.insertRow(-1);
    d = p.insertCell(-1);
    d.style.padding = "0px 4px 0px 0px";
    o = d.ownerDocument.createElement("img");
    d.appendChild(o);
    AttachEvent(o, "click", function() {
        nt(1)
    }, !1);
    o.style.cursor = "pointer";
    o.style["vertical-align"] = "top";
    k = e.insertRow(-1);
    y = k.insertCell(-1);
    y.align = "center";
    h = document.createElement("table");
    y.appendChild(h);
    h.border = "0";
    h.cellPadding = "0";
    h.cellSpacing = "0";
    h.width = "34";
    var p = h.insertRow(-1)
      , l = p.insertCell(-1)
      , a = l.ownerDocument.createElement("div");
    l.appendChild(a);
    a.style.position = "relative";
    a.style.width = "12px";
    a.style.height = "100%";
    f = document.createElement("img");
    a.appendChild(f);
    f.style.position = "absolute";
    f.src = FBM.RES_PATH + "icons/bar_06.png";
    f.style.left = "0px";
    f.style.bottom = "0px";
    f.width = "34";
    f.height = "16";
    AttachEvent(a, "mousedown", rt, !1);
    l.align = "center";
    l.style.height = "0px";
    p = h.insertRow(-1);
    w = p.insertCell(-1);
    w.align = "center";
    w.style.padding = "0px 4px 0px 0px";
    s = w.ownerDocument.createElement("img");
    w.appendChild(s);
    s.src = FBM.RES_PATH + "bar_bottom.png";
    AttachEvent(s, "click", function() {
        nt(-1)
    }, !1);
    s.style.cursor = "pointer";
    this.Initialize = function(n) {
        c = n
    }
    ;
    this.UpdateElement = function() {
        var n, r = FBM.MapTypeMaxZoomLevel[g.getCoordSys()][g.getMapTypeId()], i = Math.max(t.getMapMinLevel(), 0), u = Math.min(t.getMapMaxLevel(), r), e = u - i;
        l.style.height = (e + 1) * v + "px";
        n = (t.getMapLevel() - i) * v;
        f.style.bottom = n + "px"
    }
    ;
    this.RebuildElement = function() {}
    ;
    this.display = function(n) {
        e.style.display = n ? "" : "none"
    }
    ;
    this.setPosition = function(n) {
        var t = u.controls[b].indexOf(e);
        n in FBM.FWControlPosition && (t >= 0 && u.controls[b].removeAt(t),
        u.controls[n].push(e),
        b = n)
    }
    ;
    this.setStyle = function(n) {
        var i, r, u;
        switch (n) {
        case FBM.FWNavigationControlStyle.SMALL:
            a.style.display = "none";
            f.style.display = "none";
            l.style.display = "none";
            o.src = FBM.RES_PATH + "bar_head.png";
            o.onmousedown = null;
            o.onmouseup = null;
            s.src = FBM.RES_PATH + "bar_bottom.png";
            s.onmousedown = null;
            s.onmouseup = null;
            break;
        case FBM.FWNavigationControlStyle.MEDIUM:
            a.style.display = "none";
            f.style.display = "none";
            l.style.display = "none";
            o.src = FBM.RES_PATH + "FW01_01.png";
            o.onmousedown = function() {
                this.src = FBM.RES_PATH + "FW02_01.png"
            }
            ;
            o.onmouseup = function() {
                this.src = FBM.RES_PATH + "FW01_01.png"
            }
            ;
            s.src = FBM.RES_PATH + "FW01_02.png";
            s.onmousedown = function() {
                this.src = FBM.RES_PATH + "FW02_02.png"
            }
            ;
            s.onmouseup = function() {
                this.src = FBM.RES_PATH + "FW01_02.png"
            }
            ;
            break;
        case FBM.FWNavigationControlStyle.LARGE:
            o.src = FBM.RES_PATH + "bar_head.png";
            o.onmousedown = null;
            o.onmouseup = null;
            s.src = FBM.RES_PATH + "bar_bottom.png";
            s.onmousedown = null;
            s.onmouseup = null;
            i = Math.max(1, t.getMapMaxLevel()) * v;
            a.style.display = "";
            f.style.display = "";
            l.style.display = "";
            l.style.backgroundImage = "url(" + FBM.RES_PATH + "bar_02.png)";
            l.style.height = i + "px";
            r = t.getMapLevel();
            u = (r - .5) * v - f.clientHeight / 2;
            f.style.bottom = u + "px";
            break;
        default:
            a.style.display = "none";
            f.style.display = "none";
            l.style.display = "none";
            o.src = FBM.RES_PATH + "bar_head.png";
            o.onmousedown = null;
            o.onmouseup = null;
            s.src = FBM.RES_PATH + "bar_bottom.png";
            s.onmousedown = null;
            s.onmouseup = null
        }
        this.UpdateElement()
    }
    ;
    this.setOptions = function(n) {
        n.navigationControlStyle != undefined && this.setStyle(n.navigationControlStyle);
        n.controlPosition != undefined && this.setPosition(n.controlPosition)
    }
    ;
    tt = g.controls[b].push(e);
    this.setPosition(i);
    this.setStyle(r);
    this.UpdateElement()
}
;
FBM.ScaleBarControl = function(n, t, i, r, u) {
    function h(n, t, i, r, u, f) {
        var e = document.createElement("div"), o;
        return n.appendChild(e),
        e.style.position = "relative",
        e.style.width = u + "px",
        e.style.height = f + "px",
        e.style.overflow = "hidden",
        o = document.createElement("img"),
        e.appendChild(o),
        o.src = t,
        o.style.position = "absolute",
        o.style.left = -i + "px",
        o.style.top = -r + "px",
        e.Img = o,
        e
    }
    function et(n) {
        var t = {
            digit: n,
            base: 1,
            units: "公尺"
        };
        n > 6615 && (t.digit /= 1e3,
        t.base = 1e3,
        t.units = "公里");
        var u = Math.floor(Math.log(t.digit) / Math.LN10)
          , r = Math.pow(10, u)
          , i = Math.floor(t.digit / r);
        return i = i < 2 ? 1 : i < 5 ? 2 : 5,
        t.digit = i * r,
        t
    }
    function ot(n) {
        var t = {
            digit: n,
            base: 1,
            units: "英呎"
        };
        n > 21702 && (t.digit /= 5280,
        t.base = 5280,
        t.units = "英里");
        var u = Math.floor(Math.log(t.digit) / Math.LN10)
          , r = Math.pow(10, u)
          , i = Math.floor(t.digit / r);
        return i = i < 2 ? 1 : i < 5 ? 2 : 5,
        t.digit = i * r,
        t
    }
    var c, s, b, ft, e, nt, tt, l, a, v, y, p, w, o, k, d, g;
    this.getDiv = function() {
        return f
    }
    ;
    this.setPosition = function(n) {
        var t = u.controls[b].indexOf(s);
        n in FBM.FWControlPosition && (t >= 0 && u.controls[b].removeAt(t),
        u.controls[n].push(s),
        b = n)
    }
    ;
    this.setStyle = function(n) {
        switch (n) {
        }
    }
    ;
    this.setOptions = function(n) {
        n.scaleControlStyle != undefined && this.setStyle(n.scaleControlStyle);
        n.controlPosition != undefined && this.setPosition(n.controlPosition)
    }
    ;
    c = document.createElement("div");
    c.style.position = "relative";
    s = document.createElement("div");
    util.disableSelect(s);
    s.style.overflow = "visible";
    s.style.padding = "5px";
    var f = null, ut = 0, it = 24, rt;
    rt = i;
    b = i;
    ft = this;
    f = document.createElement("div");
    f.style.position = "relative";
    f.style.top = "2px";
    f.style.height = it + 4 + "px";
    f.style.overflow = "hidden";
    f.id = "pScaleBar";
    f.name = "pScaleBar";
    f.style.transitionDuration = "0.5s";
    e = it / 2;
    nt = h(f, FBM.RES_PATH + "scale.png", 0, 0, 4, e * .7);
    nt.style.position = "absolute";
    nt.style.left = "0px";
    nt.style.top = e - e * .7 + "px";
    tt = h(f, FBM.RES_PATH + "scale.png", 0, 32 - e * .7, 4, e * .7);
    tt.style.position = "absolute";
    tt.style.left = "0px";
    tt.style.top = e + "px";
    l = h(f, FBM.RES_PATH + "scale.png", 511, 14, 1, 4);
    l.style.position = "absolute";
    l.style.left = "3px";
    l.style.top = e - 2 + "px";
    l.style.transitionDuration = "0.5s";
    a = h(f, FBM.RES_PATH + "scale.png", 511, 14, 1, 4);
    a.style.position = "absolute";
    a.style.left = "3px";
    a.style.top = e - 2 + "px";
    a.style.transitionDuration = "0.5s";
    v = h(f, FBM.RES_PATH + "scale.png", 4, 14, 508, 4);
    v.style.position = "absolute";
    v.style.left = "3px";
    v.style.transitionDuration = "0.5s";
    v.style.top = e - 2 + "px";
    y = h(f, FBM.RES_PATH + "scale.png", 4, 14, 508, 4);
    y.style.position = "absolute";
    y.style.left = "3px";
    y.style.transitionDuration = "0.5s";
    y.style.top = e - 2 + "px";
    p = h(f, FBM.RES_PATH + "scale.png", 0, 0, 4, e - 1);
    p.style.position = "absolute";
    p.style.left = "0px";
    p.style.top = "0px";
    p.style.transitionDuration = "0.5s";
    w = h(f, FBM.RES_PATH + "scale.png", 0, 33 - e, 4, e - 1);
    w.style.position = "absolute";
    w.style.left = "0px";
    w.style.top = e + 1 + "px";
    w.style.transitionDuration = "0.5s";
    o = f.ownerDocument.createElement("div");
    o.className = "text";
    o.style.fontSize = "0.7em";
    o.style.position = "absolute";
    o.style.left = "10px";
    o.style.top = e + 5 + "px";
    o.style.width = "100%";
    o.style.height = "4px";
    o.style.textShadow = "-1px 0 white, 0 1px white, 1px 0 white, 0 -1px white";
    k = f.ownerDocument.createElement("div");
    o.appendChild(k);
    k.style.position = "absolute";
    k.style.bottom = "4px";
    d = f.ownerDocument.createElement("div");
    o.appendChild(d);
    d.style.position = "absolute";
    d.style.top = "4px";
    s.appendChild(c);
    s.appendChild(f);
    s.appendChild(o);
    g = r ? r : FBM.FWScaleControlStyle.DEFAULT;
    this.setStyle = function(n) {
        if (n) {
            g = n;
            switch (g) {
            case FBM.FWScaleControlStyle.TEXT:
                c.style.display = "block";
                f.style.display = "none";
                break;
            default:
                c.style.display = "none";
                f.style.display = "block"
            }
            this.UpdateElement()
        }
    }
    ;
    var st = new HorizontalDatum(6378137,0)
      , ht = new MercatorProjection(0,0,0,1)
      , ct = "97";
    this.UpdateElement = function() {
        var s;
        if (g == FBM.FWScaleControlStyle.TEXT)
            s = FBM.GetMapScale(u.getCoordSys(), u.getZoom()),
            c.innerHTML = " 1 : " + s;
        else {
            var h = t.ToMapDistX(it * 5)
              , e = et(h)
              , i = t.FromMapDistX(e.digit * e.base) + 2
              , b = h / .3048
              , o = ot(b)
              , r = t.FromMapDistX(o.digit * o.base * .3048) + 2
              , nt = ht.Inverse(st, new CPoint3(t.getCenterX(),t.getCenterY(),0))
              , n = 1;
            ct == "google" && (n = 1 / Math.cos(nt.Y / 180 * Math.PI));
            f.style.width = Math.round(Math.max(i, r) * n) + "px";
            p.style.left = Math.round(i * n - 4) + "px";
            w.style.left = Math.round(r * n - 4) + "px";
            v.style.width = Math.round(i * n - 4) + "px";
            y.style.width = Math.round(r * n - 4) + "px";
            l.style.left = Math.round(i * n - 1) + "px";
            a.style.left = Math.round(r * n - 1) + "px";
            k.innerHTML = e.digit + e.units;
            d.innerHTML = o.digit + o.units;
            ut = Math.round(Math.max(i, r))
        }
    }
    ;
    this.display = function(n) {
        s.style.display = n == !1 ? "none" : ""
    }
    ;
    this.ControlOptionsChang = function(n, t) {
        rt = n;
        Location(t.getClientWidth(), t.getClientHeight())
    }
    ;
    this.setPosition(b);
    this.setStyle(g);
    this.UpdateElement()
}
;
/*! D:\FW_API\scripts\ControlHandlers.js*/
/*! D:\FW_API\scripts\MVCArray.js*/
(function() {
    FBM.MVCArray = function() {
        this.arr_ = []
    }
    ;
    var n = FBM.MVCArray.prototype;
    n.getAt = function(n) {
        return this.arr_[n]
    }
    ;
    n.getLength = function() {
        return this.arr_.length
    }
    ;
    n.push = function(n) {
        var t = this.arr_.length;
        return t <= 0 && (t = 0),
        this.insertAt(t, n)
    }
    ;
    n.pop = function() {
        var n = this.arr_.length - 1;
        if (!(n < 0))
            return this.removeAt(n)
    }
    ;
    n.forEach = function(n) {
        for (var t = 0; t < this.arr_.length; t++)
            n.call(this, this.arr_[t], t)
    }
    ;
    n.getArray = function() {
        return this.arr_
    }
    ;
    n.removeAt = function(n) {
        if (!(n > this.arr_.length - 1)) {
            var t = this.arr_.splice(n, 1);
            return FBM.FWEvent.trigger_(this, "remove_at", n, t[0]),
            FBM.FWEvent.trigger_(this, "changed"),
            t
        }
    }
    ;
    n.insertAt = function(n, t) {
        if (!(n > this.arr_.length)) {
            var i = this.arr_.splice(n, 0, t);
            FBM.FWEvent.trigger_(this, "insert_at", n);
            FBM.FWEvent.trigger_(this, "changed")
        }
    }
    ;
    n.setAt = function(n, t) {
        if (!(n > this.arr_.length - 1)) {
            var i = this.arr_[n];
            this.arr_.splice(n, 1, t);
            FBM.FWEvent.trigger_(this, "set_at", n, i);
            FBM.FWEvent.trigger_(this, "changed")
        }
    }
    ;
    n.indexOf = function(n) {
        return this.arr_.indexOf(n)
    }
    ;
    FBM.RegisterEvent(FBM.MVCArray, ["insert_at", "remove_at", "set_at", "changed"])
}
)();
/*! D:\FW_API\scripts\Events.js*/
FBM.FWEvent = function() {
    var t = util.getInternetExplorerVersion()
      , i = t < 0 ? 0 : 1
      , r = function(n, t) {
        if (!n.lockEvt)
            return !1;
        for (var i = 0; i < n.lockEvt.length; i++)
            if (n.lockEvt[i] == t)
                return !0;
        return !1
    }
      , n = {
        standardDomMouseEvents: {
            click: "click",
            mousemove: "mousemove",
            mousedown: "mousedown",
            mouseover: "mouseover",
            mouseout: "mouseout",
            mouseup: "mouseup",
            dblclick: "dblclick",
            rightclick: "rightclick"
        }
    };
    return n.RIGHTBUTTON = 2,
    n.LEFTBUTTON = i,
    FBM.MapsEventListener = function() {}
    ,
    FBM.OverlayCompleteEvent = function(n, t, i) {
        this.overlay = n;
        this.type = t;
        this.action = i ? i : ""
    }
    ,
    FBM.FWMouseEvent = function(t, i) {
        Object.defineProperty(this, "type", {
            value: i || t.type
        });
        this.mapListener_ = null;
        this.stop = function() {
            n.removeListener(this.mapListener_);
            this.mapListener_ = null
        }
        ;
        this.stopPropagation = function() {
            t.stopPropagation && t.stopPropagation();
            t.cancelBubble = !0
        }
        ;
        this.point = new FBM.FWPoint
    }
    ,
    n.addListener_ = function(n, t, i, r, u) {
        if (n && t && n.events && !(n.events.indexOf(t) < 0)) {
            var f = n[t + "_"]
              , e = null;
            return f || (n[t + "_"] = [],
            f = n[t + "_"]),
            f ? (e = {
                target_: n,
                eventName_: t,
                targetQueue_: t + "_",
                handler_: i,
                executeLimit: u,
                capture: r
            },
            f.push(e),
            e) : void 0
        }
    }
    ,
    n.addDomListener = function(t, i, r, u) {
        return n.addListener_(t, i, r, u, Infinity)
    }
    ,
    n.addDomListenerOnce = function(t, i, r, u) {
        return n.addListener_(t, i, r, u, 1)
    }
    ,
    n.addListener = function(t, i, r, u) {
        return n.addListener_(t, i, r, u, Infinity)
    }
    ,
    n.addListenerOnce = function(t, i, r, u) {
        return n.addListener_(t, i, r, u, 1)
    }
    ,
    n.clearInstanceListeners = function(t) {
        if (t.events)
            for (var i = 0; i < t.events.length; i++)
                n.clearListeners(t, t.events[i])
    }
    ,
    n.copyEvent = function(t, i) {
        for (var o, f, e, r, u = 0; u < t.events.length; u++)
            if (o = t.events[u],
            f = t[o + "_"],
            f)
                for (e = 0; e < f.length; e++)
                    r = f[e],
                    n.addListener_(i, o, r.handler_, r.capture, r, r.executeLimit)
    }
    ,
    n.clearListeners = function(t, i) {
        var r = t[i + "_"], u, f;
        if (r)
            for (r = r.slice(0),
            u = r.length - 1; u >= 0; u--)
                f = r[u],
                n.removeListener(f);
        delete t[i + "_"]
    }
    ,
    n.removeListener = function(n) {
        var t = null, i;
        n && (t = n.target_[n.targetQueue_],
        t) && ((i = t.indexOf(n),
        i < 0) || (t.splice(i, 1),
        t.length <= 0 && delete n.target_[n.targetQueue_]))
    }
    ,
    n.trigger_ = function(n, t) {
        var i = n[t + "_"], u, r;
        if (!i || i.length <= 0)
            return !1;
        for (i = i.slice(0),
        u = [],
        r = 0; r < i.length; r++)
            (i[r].handler_.apply(n, Array.prototype.slice.call(arguments).slice(2)),
            i[r].executeLimit !== undefined && (i[r].executeLimit--,
            i[r].executeLimit <= 0)) || u.push(i[r]);
        n[t + "_"] = u;
        u.length <= 0 && delete n[t + "_"]
    }
    ,
    n.trigger = function(t, i) {
        n.trigger_(t, i)
    }
    ,
    n.releaseEventLock = function(n, t) {
        if (n && n.events && n.events.length && t && n.lockEvt && n.lockEvt.indexOf(t) >= 0) {
            var i = n.lockEvt.indexOf(t);
            i < 0 || n.lockEvt.splice(i, 1)
        }
    }
    ,
    n.lockEvent = function(n, t) {
        n && n.events && n.events.length && t && ((n.lockEvt || (n.lockEvt = []),
        n.lockEvt.indexOf(t) >= 0) || n.lockEvt.push(t))
    }
    ,
    n
}();
/*! D:\FW_API\scripts\FWMap.js*/
(function() {
    function h(n, t) {
        var r = n.map(function(n, i) {
            return {
                i: n,
                p: t(n),
                n: i
            }
        }), i = r.reduce(function(n, t) {
            var i = t.p;
            return n.x += i[0],
            n.y += i[1],
            n.xy += i[0] * i[1],
            n.x2 += i[0] * i[0],
            n.y2 += i[1] * i[1],
            n
        }, {
            x: 0,
            y: 0,
            xy: 0,
            x2: 0,
            y2: 0
        }), f, s;
        i.x /= r.length;
        i.y /= r.length;
        i.xy /= r.length;
        i.x2 /= r.length;
        i.y2 /= r.length;
        var e = i.xy - i.x * i.y
          , u = i.x2 - i.x * i.x
          , o = i.y2 - i.y * i.y;
        return o > u && (u = e,
        e = o),
        f = [0, 1],
        u != 0 && (f[0] = u * Math.sqrt(1 / (e * e + u * u)),
        f[1] = e / u * f[0]),
        n = r.sort(function(n, t) {
            return (n.p[0] - t.p[0]) * f[0] + (n.p[1] - t.p[1]) * f[1]
        }),
        s = n.splice(0, n.length / 2),
        [s.sort(function(n, t) {
            return n.n - t.n
        }).map(function(n) {
            return n.i
        }), n.sort(function(n, t) {
            return n.n - t.n
        }).map(function(n) {
            return n.i
        })]
    }
    var f, o, i, r, n;
    Object.defineProperty(Object.prototype, "forEachKey", {
        value: function(n) {
            for (var t in this)
                n(t, this[t])
        }
    });
    Object.mergeOptions = function() {
        var n, t, i;
        if (arguments.length <= 0)
            return null;
        for (n = arguments[0] || {},
        t = 1; t < arguments.length; t++)
            i = arguments[t],
            i && (n = Object.keys(i).reduce(function(n, t) {
                return n[t] = i[t],
                n
            }, n));
        return n
    }
    ;
    Array.prototype.find || Object.defineProperty(Array.prototype, "find", {
        value: function(n) {
            for (var t = 0; t < this.length; t++)
                if (n(this[t]))
                    return this[t];
            return null
        }
    });
    Math.hypot || (Math.hypot = function(n, t) {
        return Math.sqrt(n * n + t * t)
    }
    );
    f = document.cookie.split(/; */).filter(function(n) {
        return n.indexOf("gacid=") == 0
    }).map(function(n) {
        return n.substring(6)
    }).pop();
    f || (f = "11111111-1111-4111-8111-111111111111".replace(/[18]/g, function(n) {
        return (n ^ (Math.random() * 16 | 0) & 15 >> n / 4).toString(16)
    }));
    document.cookie = "gacid=" + f + ";expires=" + new Date((new Date).getTime() + 1296e6).toUTCString() + ";path=/";
    o = new AjaxAgent(null,!0,!1);
    o.Open("POST", "https://www.google-analytics.com/collect");
    o.SendRequest("v=1&tid=UA-131171758-1&cid=" + f + "&t=pageview&dp=%2FFW_API%2FFW.aspx");
    i = new HorizontalDatum(6378137,0);
    r = new MercatorProjection(0,0,0,1);
    var l = function(n, t) {
        this.map = t;
        this.add = function(t) {
            n.push(t)
        }
        ;
        this.remove = function(t) {
            var i = this.map.getMapBase()
              , r = n.indexOf(t);
            r != -1 && (n.splice(r, 1),
            i.getHPackage().contains(t.getElement()) && i.getHPackage().removeChild(t.getElement()))
        }
        ;
        this.UpdateElement = function() {
            for (var t = 0; t < n.length; t++)
                n[t].update()
        }
        ;
        this.containing = function(t) {
            var i = n.indexOf(t);
            return i >= 0
        }
    }
      , a = function(n) {
        function s(n, t) {
            var f = document.createElementNS("http://www.w3.org/2000/svg", "g"), r = document.createElementNS("http://www.w3.org/2000/svg", "g"), u, e, o, s;
            return n ? (n.sgroup.insertBefore(f, t ? t.sgroup : null),
            n.group.insertBefore(r, t ? t.group : null)) : (u = i.getPaper(),
            "getPaper"in r ? u = r.getPaper() : "getAdvancedLayer"in r && (e = r.getAdvancedLayer(),
            e && (u = e.paper.main)),
            o = u.canvas,
            o.insertBefore(r, t ? t.sgroup ? t.sgroup : t.group : null),
            o.insertBefore(f, r)),
            s = new FBM.FWEnvelope(0,0,0,0),
            s.setEmpty(),
            {
                group: r,
                sgroup: f,
                items: [],
                events: [],
                ext: s,
                pext: null,
                visible: !0
            }
        }
        function f(n) {
            if (n.getGraphicElement)
                return n.getGraphicElement();
            if (n.getEventElement) {
                var t = n.getEventElement();
                if (t)
                    return {
                        g: [t]
                    }
            }
            return null
        }
        function u(n, t, i) {
            var r, f, e, o;
            if (!("items"in n))
                return 1;
            for (r = n.items,
            f = 0; f < r.length; f++) {
                if ((e = u(r[f], t, i),
                e == 2) || e == 1 && t && t(n))
                    return 2;
                if (e != 0)
                    return 0
            }
            return (o = r.length == 0 ? t : i,
            o && o(n)) ? 2 : 0
        }
        function e(n) {
            var i = null;
            for (var r in t)
                if (u(t[r], function(t) {
                    var u = 0;
                    return (u = t.items.indexOf(n)) >= 0 ? (i = {
                        key: r,
                        g: t,
                        idx: u
                    },
                    !0) : !1
                }),
                i)
                    return i;
            return null
        }
        function c(n, t) {
            var i, r;
            if (n != null)
                return i = f(t),
                i != null && (n.g.group && i.g && i.g.forEach(function(t) {
                    t && t.node && n.g.group == t.node.parentElement && n.g.group.removeChild(t.node)
                }),
                n.g.sgroup && i.s && i.s.forEach(function(t) {
                    t && t.node && n.g.sgroup == t.node.parentElement && n.g.sgroup.removeChild(t.node)
                })),
                n.idx >= 0 ? (r = n.g.events[n.idx],
                FBM.FWEvent.removeListener(r.pce),
                FBM.FWEvent.removeListener(r.zce),
                n.g.events.splice(n.idx, 1),
                n.g.items.splice(n.idx, 1)) : void 0
        }
        function l(n) {
            function g(n) {
                var t = Math.hypot((n.ext.left + n.ext.right - k) / (n.ext.right - n.ext.left), (n.ext.top + n.ext.bottom - d) / (n.ext.top - n.ext.bottom));
                (e == null || y > t) && (e = n,
                y = t)
            }
            var c = "_", v = f(n), l, w, b, k, d, y, e, p;
            if (v && (c = Number(n.getZIndex())),
            l = n.getEnvelope ? n.getEnvelope() : null,
            t == null && (t = {},
            r = i.getMapBase().ToMapPoint(0, 0),
            o = i.getZoom()),
            c in t || (w = null,
            c != "_" && (b = Object.keys(t).map(function(n) {
                return n == "_" ? "_" : Number(n)
            }).sort(function(n, t) {
                return n - t
            }).find(function(n) {
                return n == "_" ? !0 : c < n
            }),
            b && (w = t[b])),
            t[c] = s(null, w),
            t[c].group.setAttribute("zIndex", c),
            t[c].sgroup.setAttribute("zIndex", c)),
            k = 0,
            d = 0,
            l != null && (k = l.left + l.right,
            d = l.top + l.bottom),
            y = null,
            e = null,
            u(t[c], g),
            e.items.length >= 300) {
                var rt = e.items.map(function(n, t) {
                    return {
                        itm: n,
                        evt: e.events[t]
                    }
                })
                  , nt = h(rt, function(n) {
                    var t = n.itm.getEnvelope();
                    return [(t.left + t.right) / 2, (t.top + t.bottom) / 2]
                })
                  , tt = s(e)
                  , ut = s(e, tt)
                  , it = [tt, ut];
                e.items = it;
                e.events = null;
                e.group.style.display = "";
                e.sgroup && (e.sgroup.style.display = "");
                y = null;
                e = null;
                it.forEach(function(n, t) {
                    n.events = nt[t].map(function(n) {
                        return n.evt
                    });
                    n.items = nt[t].map(function(n) {
                        return n.itm
                    });
                    n.items.forEach(function(t) {
                        t.getEnvelope && n.ext.Extend(t.getEnvelope());
                        var i = f(t);
                        n.group && i.g && i.g.forEach(function(t) {
                            t && t.node && n.group.appendChild(t.node)
                        });
                        n.sgroup && i.s && i.s.forEach(function(t) {
                            t && t.node && n.sgroup.appendChild(t.node)
                        })
                    });
                    n.pext = null;
                    g(n)
                })
            }
            v && (e.group && v.g && v.g.forEach(function(n) {
                n && n.node && e.group.appendChild(n.node)
            }),
            e.sgroup && v.s && v.s.forEach(function(n) {
                n && n.node && e.sgroup.appendChild(n.node)
            }));
            e.ext.Extend(l);
            e.pext = null;
            p = {};
            p.pce = FBM.FWEvent.addListener(n, "position_changed", function() {
                e.ext.setEmpty();
                e.items.forEach(function(n) {
                    var t = n.getEnvelope ? n.getEnvelope() : null;
                    t && e.ext.Extend(t)
                });
                e.pext = null
            });
            p.zce = FBM.FWEvent.addListener(n, "zindex_changed", function() {
                a(this)
            });
            e.items.push(n);
            e.events.push(p)
        }
        function a(n) {
            var i = "_", r = f(n), t;
            (r && (i = Number(n.getZIndex())),
            t = e(n),
            t.key != i) && (c(t, n),
            l(n))
        }
        var i = n
          , t = null
          , r = null
          , o = null;
        this.updateArrayOrder = function() {}
        ;
        this.updateElementOrder = function() {}
        ;
        this.add = function(n) {
            c(e(n), n);
            l(n)
        }
        ;
        this.push = function(n) {
            this.add(n)
        }
        ;
        this.containing = function(n) {
            return e(n) != null
        }
        ;
        this.remove = function(n) {
            c(e(n), n)
        }
        ;
        this.UpdateElement = function() {
            if (r != null) {
                var n = i.getMapBase().FromMapPoint(r.x, r.y)
                  , f = Math.pow(2, i.getZoom() - o);
                t && t.forEachKey(function(t, i) {
                    i.visible && (t == "_" ? u(i, function(n) {
                        return n.visible && n.items.forEach(function(n) {
                            n.update && n.update()
                        }),
                        !1
                    }) : (i.group.setAttribute("transform", "translate(" + n.x + "," + n.y + ") scale(" + f + ")"),
                    i.sgroup && i.sgroup.setAttribute("transform", "translate(" + n.x + "," + n.y + ") scale(" + f + ")")))
                })
            }
        }
        ;
        this.RebuildElement = function() {
            r = i.getMapBase().ToMapPoint(0, 0);
            o = i.getZoom();
            var n = i.getRawBound()
              , f = i.getCoordSys();
            t && t.forEachKey(function(t, i) {
                i.group.setAttribute("transform", "translate(0,0)");
                i.sgroup && i.sgroup.setAttribute("transform", "translate(0,0)");
                u(i, function(t) {
                    if (t.pext == null && f == FBM.FWCoordSys.EPSG3857) {
                        var i = FBM.WGS84ToGoo(t.ext.left, t.ext.top)
                          , r = FBM.WGS84ToGoo(t.ext.right, t.ext.bottom);
                        t.pext = new FBM.FWEnvelope(i.x,i.y,r.x,r.y)
                    }
                    return t.visible = n.Intersect(t.pext),
                    t.visible ? (t.group.style.display = "",
                    t.sgroup && (t.sgroup.style.display = ""),
                    t.items.forEach(function(n) {
                        n.redraw ? n.redraw() : n.update && n.update()
                    })) : (t.group.style.display = "none",
                    t.sgroup && (t.sgroup.style.display = "none")),
                    !1
                }, function(n) {
                    n.visible = n.items.some(function(n) {
                        return n.visible
                    })
                })
            })
        }
        ;
        this.ClickTest = function(n, i, r, u, f) {
            var v, h, o, c, y, s, e, l, a, p;
            for (v in t)
                for (h = t[v].items,
                o = 0; o < h.length; o++)
                    for (c = h[o],
                    y = c.items.length,
                    s = y - 1; s >= 0; s--)
                        if (e = c.items[s],
                        e.isPointInEnvelope) {
                            if (l = e.isPointInEnvelope(n.x, n.y, i),
                            l != null && l == !0 && (a = e.elem,
                            a !== undefined && (p = a.isPointInside(r, u),
                            p)))
                                return f(e),
                                !0
                        } else
                            f(e);
            return !1
        }
    }
      , v = function(n) {
        function u(n, t) {
            var u = document.createElementNS("http://www.w3.org/2000/svg", "g"), r = null, f, e;
            return n ? (gc = n.group,
            sgc = n.sgroup || n.group,
            r = document.createElementNS("http://www.w3.org/2000/svg", "g"),
            sgc.insertBefore(r, t ? t.sgroup : null)) : gc = document.getElementsByClassName("fwoverlay")[0].getElementsByTagName("svg")[0],
            gc.insertBefore(u, t ? t.group : null),
            f = i.getMapBase().ToMapPoint(0, 0),
            e = i.getZoom(),
            {
                group: u,
                sgroup: r,
                items: [],
                ext: null,
                ref: f,
                refZ: e,
                visible: !0
            }
        }
        function f(n) {
            var t = null;
            if (n.getGraphicElement)
                t = n.getGraphicElement();
            else if (n.getEventElement && (t = n.getEventElement(),
            t != null && !(t instanceof Array)))
                return {
                    g: [t]
                };
            return t
        }
        function r(n) {
            var r, u, i, f, e;
            for (r in t)
                for (u = t[r].items,
                i = 0; i < u.length; i++)
                    if (f = u[i],
                    e = 0,
                    (e = f.items.indexOf(n)) >= 0)
                        return {
                            key: r,
                            g: f,
                            idx: e
                        };
            return null
        }
        function e(n, t) {
            if (n != null) {
                var i = f(t);
                return i != null && (n.g.group && i.g && i.g.forEach(function(t) {
                    t && t.node && n.g.group == t.node.parentElement && n.g.group.removeChild(t.node)
                }),
                n.g.sgroup && i.s && i.s.forEach(function(t) {
                    t && t.node && n.g.sgroup == t.node.parentElement && n.g.sgroup.removeChild(t.node)
                })),
                n.idx >= 0 ? n.g.items.splice(n.idx, 1) : void 0
            }
        }
        function o(n) {
            var i = "_", e = f(n), o, h, r;
            e && (i = Number(n.getZIndex()));
            t == null && (t = {});
            i in t || (o = null,
            i != "_" && (h = Object.keys(t).map(function(n) {
                return n == "_" ? "_" : Number(n)
            }).sort(function(n, t) {
                return n - t
            }).find(function(n) {
                return n == "_" ? !0 : i < n
            }),
            h && (o = t[h])),
            t[i] = u(null, o),
            t[i].items.push(u(t[i])));
            r = t[i].items[0];
            r.items.length >= 100 && (t[i].items.unshift(u(t[i], t[i].items[0])),
            r = t[i].items[0]);
            e && (r.group && e.g && e.g.forEach(function(n) {
                n && n.node && r.group.appendChild(n.node)
            }),
            r.sgroup && e.s && e.s.forEach(function(n) {
                n && n.node && r.sgroup.appendChild(n.node)
            }));
            r.items.push(n);
            r.ext = null;
            FBM.FWEvent.addListener(n, "zindex_changed", function() {
                s(this)
            })
        }
        function s(n) {
            var i = "_", u = f(n), t;
            (u && (i = Number(n.getZIndex())),
            t = r(n),
            t.key != i) && (e(t, n),
            o(n))
        }
        var t = null
          , i = n;
        this.updateArrayOrder = function() {}
        ;
        this.updateElementOrder = function() {}
        ;
        this.add = function(n) {
            e(r(n), n);
            o(n)
        }
        ;
        this.push = function(n) {
            this.add(n)
        }
        ;
        this.containing = function(n) {
            return r(n) != null
        }
        ;
        this.remove = function(n) {
            e(r(n), n)
        }
        ;
        this.UpdateElement = function() {
            var n = i.getZoom();
            t && t.forEachKey(function(t, r) {
                if (r.visible)
                    if (t == "_")
                        r.items.forEach(function(n) {
                            return n.items.forEach(function(n) {
                                n.update && n.update()
                            })
                        });
                    else {
                        var u = i.getMapBase().FromMapPoint(r.ref.x, r.ref.y);
                        r.group.setAttribute("transform", "translate(" + u.x + "," + u.y + ") scale(" + Math.pow(2, n - r.refZ) + ")");
                        r.sgroup && r.sgroup.setAttribute("transform", "translate(" + u.x + "," + u.y + ") scale(" + Math.pow(2, n - r.refZ) + ")")
                    }
            })
        }
        ;
        this.RebuildElement = function() {
            var n = i.getMapBase().ToMapPoint(0, 0)
              , r = i.getZoom()
              , u = i.getRawBound()
              , f = i.getCoordSys();
            t && t.forEachKey(function(t, i) {
                i.group.setAttribute("transform", "translate(0,0)");
                i.sgroup && i.sgroup.setAttribute("transform", "translate(0,0)");
                i.ref = n;
                i.refZ = r;
                i.items.forEach(function(n) {
                    if (n.ext == null && (n.ext = new FBM.FWEnvelope(0,0,0,0),
                    n.ext.setEmpty(),
                    n.items.forEach(function(t) {
                        t.getEnvelope && n.ext.Extend(t.getEnvelope())
                    }),
                    f == FBM.FWCoordSys.EPSG3857)) {
                        var t = FBM.WGS84ToGoo(n.ext.left, n.ext.top)
                          , i = FBM.WGS84ToGoo(n.ext.right, n.ext.bottom);
                        n.ext = new FBM.FWEnvelope(t.x,t.y,i.x,i.y)
                    }
                    n.visible = u.Intersect(n.ext);
                    n.visible ? (n.items.forEach(function(n) {
                        n.redraw ? n.redraw() : n.update && n.update()
                    }),
                    n.group.style.display = "",
                    n.sgroup && (n.sgroup.style.display = "")) : (n.group.style.display = "none",
                    n.sgroup && (n.sgroup.style.display = "none"))
                })
            })
        }
        ;
        this.ClickTest = function(n, i, r, u, f) {
            var v, h, o, c, y, s, e, l, a, p;
            for (v in t)
                for (h = t[v].items,
                o = 0; o < h.length; o++)
                    for (c = h[o],
                    y = c.items.length,
                    s = y - 1; s >= 0; s--)
                        if (e = c.items[s],
                        e.isPointInEnvelope) {
                            if (l = e.isPointInEnvelope(n.x, n.y, i),
                            l != null && l == !0 && (a = e.elem,
                            a !== undefined && (p = a.isPointInside(r, u),
                            p)))
                                return f(e),
                                !0
                        } else
                            f(e);
            return !1
        }
    };
    FBM.FWTransStatus = {
        ERROR: "ERROR",
        INVALID_REQUEST: "INVALID_REQUEST",
        OK: "OK",
        OVER_QUERY_LIMIT: "OVER_QUERY_LIMIT",
        REQUEST_DENIED: "REQUEST_DENIED",
        UNKNOWN_ERROR: "UNKNOWN_ERROR"
    };
    FBM.FWIndexViewControlOptions = {
        NORMAL: "NORMAL",
        MINIMIZED: "MINIMIZED"
    };
    FBM.fwHash = "defaulthash";
    FBM.APPID = "web";
    FBM.APIKEY = "";
    FBM.MapTypeScales = {
        EPSG3857: {
            scales: [4514, 9028, 18056, 36112, 72224, 144448, 288896, 577792, 1155583, 2311167],
            levelX: 156543.033928041,
            levelY: -156543.033928041,
            factors: [1.19432856696208, 2.38865713392417, 4.77731426782187, 9.55462853564375, 19.1092570712875, 38.2185141426015, 76.4370282851765, 152.874056570353, 305.748113140706, 611.496226281412]
        }
    };
    FBM.FWControlPosition = {
        BOTTOM_CENTER: "BOTTOM_CENTER",
        BOTTOM_LEFT: "BOTTOM_LEFT",
        BOTTOM_RIGHT: "BOTTOM_RIGHT",
        LEFT_BOTTOM: "LEFT_BOTTOM",
        LEFT_CENTER: "LEFT_CENTER",
        LEFT_TOP: "LEFT_TOP",
        RIGHT_BOTTOM: "RIGHT_BOTTOM",
        RIGHT_CENTER: "RIGHT_CENTER",
        RIGHT_TOP: "RIGHT_TOP",
        TOP_CENTER: "TOP_CENTER",
        TOP_LEFT: "TOP_LEFT",
        TOP_RIGHT: "TOP_RIGHT"
    };
    FBM.FWMapTypeControlStyle = {
        DEFAULT: "DEFAULT",
        DROPDOWN_MENU: "DROPDOWN_MENU",
        HORIZONTAL_BAR: "HORIZONTAL_BAR"
    };
    FBM.FWNavigationControlStyle = {
        DEFAULT: "DEFAULT",
        LARGE: "LARGE",
        MEDIUM: "MEDIUM",
        SMALL: "SMALL"
    };
    FBM.FWScaleControlStyle = {
        DEFAULT: "DEFAULT",
        TEXT: "TEXT",
        BAR: "BAR",
        HD: "HD"
    };
    FBM.FWCoordSys = {
        EPSG3825: "EPSG3825",
        EPSG3826: "EPSG3826",
        EPSG3857: "EPSG3857"
    };
    FBM.KeyboardEditor = {
        NONE: "NONE",
        UP: "UP",
        DOWN: "DOWN",
        LEFT: "LEFT",
        RIGHT: "RIGHT",
        DEL: "DEL"
    };
    FBM.GetMapScale = function(n, t) {
        try {
            var i = FBM.MapTypeScales[n].scales.length - 1;
            return FBM.MapTypeScales[n].scales[i - t]
        } catch (r) {
            throw "[GetMapScale] Invalid Parameters";
        }
    }
    ;
    FBM.FWOnlineMap = function(n, t) {
        var rt, ut, yt, pt, wt;
        this.getCurrentMapType = function() {
            return currentMapType
        }
        ;
        this.getMapTypeTag = function() {
            return k
        }
        ;
        this.baseMapVisible = !0;
        this.overlayForwardEvent = !0;
        this.setOverlayForwardEvent = function(n) {
            this.overlayForwardEvent = n
        }
        ;
        this.getOverlayForwardEvent = function() {
            return this.overlayForwardEvent
        }
        ;
        this.overlayStopClick = !1;
        this.setOverlayStopClick = function() {
            this.overlayStopClick = !0
        }
        ;
        this.overlayForwardEvents = ["click"];
        this.addOverlayForwardEvent = function(n) {
            if (n instanceof Array)
                for (var t = 0; t < n.length; t++)
                    this.overlayForwardEvents.indexOf(n[t]) < 0 && this.overlayForwardEvents.push(n[t]);
            else
                n instanceof String && this.overlayForwardEvents.indexOf(n) < 0 && this.overlayForwardEvents.push(n)
        }
        ;
        this.getOverlayForwardEvents = function() {
            return this.overlayForwardEvents
        }
        ;
        this.controls = {
            BOTTOM_CENTER: new FBM.MVCArray,
            BOTTOM_LEFT: new FBM.MVCArray,
            BOTTOM_RIGHT: new FBM.MVCArray,
            LEFT_BOTTOM: new FBM.MVCArray,
            LEFT_CENTER: new FBM.MVCArray,
            LEFT_TOP: new FBM.MVCArray,
            RIGHT_BOTTOM: new FBM.MVCArray,
            RIGHT_CENTER: new FBM.MVCArray,
            RIGHT_TOP: new FBM.MVCArray,
            TOP_CENTER: new FBM.MVCArray,
            TOP_LEFT: new FBM.MVCArray,
            TOP_RIGHT: new FBM.MVCArray
        };
        this.setKeyboardEdit = function(n, t) {
            h.OpenCloseKeyboardEditor(n, t)
        }
        ;
        this.getMapSize = function() {
            return new FBM.FWSize(rt,ut)
        }
        ;
        this.IndexViewControl = {
            Show: function(n) {
                g.Show(n);
                this.changeOverviewMapType(it, n ? p : null)
            },
            Minimize: function() {
                g.Minimize();
                this.changeOverviewMapType(it)
            }
        };
        this.setCoordSys = function(n) {
            n instanceof FBM.FWCoordSys && (c = n,
            FBM.FWEvent.trigger(this, "projection_changed"))
        }
        ;
        this.getDocName = function() {
            var n;
            switch (c) {
            case FBM.FWCoordSys.EPSG3826:
                n = FBM.MapTypeDocumentName;
                k = "97";
                break;
            case FBM.FWCoordSys.EPSG3825:
                n = FBM.MapTypeDocumentNameTWD97_119;
                k = "97_119";
                break;
            case FBM.FWCoordSys.EPSG3857:
                n = FBM.MapTypeDocumentNameGoogle;
                k = "google"
            }
            return n
        }
        ;
        this.getCoordSys = function() {
            return c
        }
        ;
        this.getOPackage = function() {
            return ct
        }
        ;
        this.getMapOptions = function() {
            return e
        }
        ;
        this.getMapTypeId = function() {
            return p
        }
        ;
        this.getHPackage = function() {
            return u
        }
        ;
        this.getHPack = function() {
            return f.getHPackage()
        }
        ;
        this.getHObj = function() {
            return f.getHObject()
        }
        ;
        this.getHMap = function() {
            return f.getHObject()
        }
        ;
        this.getMapBase = function() {
            return f
        }
        ;
        this.getMap = function() {
            return this
        }
        ;
        this.ZoomTo = function(n) {
            ot || o.putMapLevel(n) && (f.putScale(o.getScale()),
            this.refreshMapWithIdle(!0))
        }
        ;
        this.ZoomIn = function() {
            this.ZoomTo(o.getMapLevel() + 1)
        }
        ;
        this.ZoomOut = function() {
            this.ZoomTo(o.getMapLevel() - 1)
        }
        ;
        this.setOptions = function(n) {
            var t, i, r;
            n != undefined && (n.backgroundColor != undefined && typeof n.backgroundColor == "string" && (f.setColor(n.backgroundColor),
            e.backgroundColor = n.backgroundColor),
            n.disableDefaultUI != undefined && typeof n.disableDefaultUI == "boolean" && (ht.display(!n.disableDefaultUI),
            et.display(!n.disableDefaultUI),
            st.display(!n.disableDefaultUI),
            e.disableDefaultUI = n.disableDefaultUI),
            n.scrollwheel != undefined && typeof n.scrollwheel == "boolean" && (kt = n.scrollwheel,
            e.scrollwheel = n.scrollwheel,
            h.OpenCloseWheel(n.scrollwheel)),
            n.mapTypeControl != undefined && typeof n.mapTypeControl == "boolean" && (et.display(n.mapTypeControl),
            e.mapTypeControl = n.mapTypeControl),
            n.mapTypeControlOptions != undefined && (et.setOptions(n.mapTypeControlOptions),
            e.mapTypeControlOptions = n.mapTypeControlOptions),
            n.navigationControl != undefined && typeof n.navigationControl == "boolean" && (st.display(n.navigationControl),
            e.navigationControl = n.navigationControl),
            n.navigationControlOptions != undefined && (st.setOptions(n.navigationControlOptions),
            e.navigationControlOptions = n.navigationControlOptions),
            n.scaleControl != undefined && typeof n.scaleControl == "boolean" && (ht.display(n.scaleControl),
            e.scaleControl = n.scaleControl),
            n.scaleControlOptions != undefined && (ht.setOptions(n.scaleControlOptions),
            e.scaleControlOptions = n.scaleControlOptions),
            n.indexViewControl != undefined && typeof n.indexViewControl == "boolean" && (g.Show(n.indexViewControl),
            e.indexViewControl = n.indexViewControl),
            n.indexViewControlOptions != undefined && n.indexViewControlOptions == FBM.FWIndexViewControlOptions.MINIMIZED && (g.Minimize(),
            e.indexViewControlOptions = n.indexViewControlOptions),
            this.changeOverviewMapType(it, e.indexViewControl && e.indexViewControlOptions != FBM.FWIndexViewControlOptions.MINIMIZED ? p : null),
            n.draggable != undefined && typeof n.draggable == "boolean" && (bt = n.draggable,
            e.draggable = n.draggable,
            h.OpenCloseMove(n.draggable)),
            n.keyboardShortcuts != undefined && typeof n.keyboardShortcuts == "boolean" && (h.allowKeyboard(n.keyboardShortcuts),
            e.keyboardShortcuts = n.keyboardShortcuts),
            n.draggableCursor != undefined && typeof n.draggableCursor == "string" && (h.changeDraggableCursor(n.draggableCursor),
            e.draggableCursor = n.draggableCursor),
            n.dragInertia != undefined && typeof n.dragInertia == "boolean" && (h.setDragInertia(n.dragInertia),
            e.dragInertia = n.dragInertia),
            n.draggingCursor != undefined && typeof n.draggingCursor == "string" && (h.changeDraggingCursor(n.draggingCursor),
            e.draggingCursor = n.draggingCursor),
            n.center != undefined && this.setCenter(n.center),
            n.dbClickZoomIn != undefined && h.OpenCloseDblClick(n.dbClickZoomIn),
            n.minZoom != undefined && n.maxZoom != undefined ? o.setMapMinMaxLevel(Math.min(n.minZoom, n.maxZoom), Math.max(n.minZoom, n.maxZoom)) : n.minZoom != undefined ? o.setMapMinLevel(n.minZoom) : n.maxZoom != undefined && o.setMapMaxLevel(n.maxZoom),
            n.mapBounds !== undefined && (t = n.mapBounds,
            c == FBM.FWCoordSys.EPSG3857 && (i = FBM.WGS84ToGoo(t.left, t.top),
            r = FBM.WGS84ToGoo(t.right, t.bottom),
            t = new FBM.FWEnvelope(i.x,i.y,r.x,r.y)),
            o.setMapBoundsLevel(t),
            h.setMapBounds(t)))
        }
        ;
        this.freezeMap = function() {
            ot || (h.ExitMapEvent(),
            ot = !0)
        }
        ;
        this.unFreezeMap = function() {
            ot && (h.InitMapEvent(this),
            ot = !1)
        }
        ;
        this.loopThroughOverlay = function() {}
        ;
        this.resize = function(n, t) {
            u.style.width = n + "px";
            u.style.height = t + "px";
            rt = u.clientWidth;
            ut = u.clientHeight
        }
        ;
        this.getBoundary = function() {
            return f.getExtent()
        }
        ;
        this.getLevel = function() {
            return o.getMapLevel()
        }
        ;
        this.getDiv = function() {
            return ii
        }
        ;
        this.getEventElement = function() {
            return this.getHObj()
        }
        ;
        this.getTransformation = function() {
            return o
        }
        ;
        this.fitBounds = function(n) {
            var t, e;
            if (n.left != null && n.top != null && n.right != null && n.bottom != null) {
                t = {
                    X: 0,
                    Y: 0
                };
                e = {
                    X: 0,
                    Y: 0
                };
                c == FBM.FWCoordSys.EPSG3857 ? (t = r.Forward(i, new CPoint3(n.left,n.top,0)),
                e = r.Forward(i, new CPoint3(n.right,n.bottom,0))) : (t.X = n.left,
                t.Y = n.top,
                e.X = n.right,
                e.Y = n.bottom);
                FBM.moveMapTo_(this, (e.X + t.X) / 2, (e.Y + t.Y) / 2);
                var s = Number(u.clientWidth)
                  , h = Number(u.clientHeight)
                  , l = s / (e.X - t.X)
                  , a = h / (e.Y - t.Y);
                f.putScale(Math.min(Math.abs(l), Math.abs(a)));
                o.FitLevel();
                this.refreshMapWithIdle(!0)
            }
        }
        ;
        this.getRawBound = function() {
            var o = rt, s = ut, n = f.ToMapPoint(0, 0), t = f.ToMapPoint(o, s), i, r, u, e;
            return i = n.x,
            r = n.y,
            u = t.x,
            e = t.y,
            new FBM.FWEnvelope(i,r,u,e)
        }
        ;
        this.getBounds = function() {
            var h = rt, l = ut, n = f.ToMapPoint(0, 0), t = f.ToMapPoint(h, l), i, r, u, e, o, s;
            switch (c) {
            case FBM.FWCoordSys.EPSG3857:
                o = FBM.GooToWGS84(n.x, n.y);
                s = FBM.GooToWGS84(t.x, t.y);
                i = o.x;
                r = o.y;
                u = s.x;
                e = s.y;
                break;
            case FBM.FWCoordSys.EPSG3826:
                i = n.x;
                r = n.y;
                u = t.x;
                e = t.y;
                break;
            case FBM.FWCoordSys.EPSG3825:
                i = n.x;
                r = n.y;
                u = t.x;
                e = t.y
            }
            return new FBM.FWEnvelope(i,r,u,e)
        }
        ;
        this.checkMapBoundsRestrict = function(n, t, i) {
            if (!n)
                return null;
            var r = this.getRawBound()
              , u = r.right - r.left
              , f = r.top - r.bottom;
            r.left = t - u / 2;
            r.right = t + u / 2;
            r.top = i + f / 2;
            r.bottom = i - f / 2;
            var s = n.right - n.left
              , h = n.top - n.bottom
              , e = 0
              , o = 0;
            return (e = u > s ? (r.left - n.left + r.right - n.right) * .5 : Math.min(0, r.left - n.left) + Math.max(0, r.right - n.right),
            o = f > h ? (r.top + r.bottom - n.top - n.bottom) * .5 : Math.max(0, r.top - n.top) + Math.min(0, r.bottom - n.bottom),
            e == 0 && o == 0) ? null : new FBM.FWPoint(t - e,i - o)
        }
        ;
        this.getCenter = function() {
            var i = f.getCenterX(), r = f.getCenterY(), n, t, u;
            switch (c) {
            case FBM.FWCoordSys.EPSG3857:
                u = FBM.GooToWGS84(i, r);
                n = u.x;
                t = u.y;
                break;
            case FBM.FWCoordSys.EPSG3826:
                n = i;
                t = r;
                break;
            case FBM.FWCoordSys.EPSG3825:
                n = i;
                t = r
            }
            return new FBM.FWPoint(n,t)
        }
        ;
        this.setCenter = function(n) {
            switch (c) {
            case FBM.FWCoordSys.EPSG3826:
                FBM.moveMapTo_(this, n.x, n.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
                FBM.moveMapTo_(this, n.x, n.y);
                break;
            case FBM.FWCoordSys.EPSG3857:
                var t = r.Forward(i, new CPoint3(n.x,n.y,0));
                FBM.moveMapTo_(this, t.X, t.Y)
            }
            this.refreshMapWithIdle(!0)
        }
        ;
        this.getZoom = function() {
            return o.getMapLevel()
        }
        ;
        this.setZoom = function(n) {
            this.ZoomTo(n)
        }
        ;
        this.setBaseMapVisible = function(n) {
            this.baseMapVisible = n;
            this.setMapTypeId()
        }
        ;
        this.setMapTypeId = function(n) {
            var r, t;
            if (!n || p !== n) {
                n !== undefined && (p = n);
                r = this;
                d.filter(function(n) {
                    return !n.skip && n.putVisible
                }).forEach(function(n) {
                    return n.putVisible(r.baseMapVisible && n.mapTypeId == p)
                });
                n !== undefined && FBM.FWEvent.trigger(this, "maptypeid_changed");
                t = wt ? e.backgroundColor : FBM.MapTypeBackgroundColor[p];
                e.backgroundColor = t;
                f.setColor(t);
                g.setColor(t);
                var i = o.getMapLevel()
                  , s = FBM.MapTypeMaxZoomLevel[this.getCoordSys()][p]
                  , h = o.getMapMinLevel()
                  , u = o.getMapMaxLevel();
                i > u && (i = u);
                o.putMapLevel(i);
                et.setActiveType(p);
                this.refreshMapWithIdle(!0);
                this.changeOverviewMapType(it, p)
            }
        }
        ;
        this.panBy = function(n, t) {
            h.panBy(n, t);
            this.refreshMapWithIdle(!0)
        }
        ;
        this.panToBounds = function(n) {
            var t, i, r;
            if (n.left != null && n.top != null && n.right != null && n.bottom != null) {
                switch (c) {
                case FBM.FWCoordSys.EPSG3857:
                    r = FBM.WGS84ToGoo(n.left, n.top);
                    t = r.x;
                    i = r.y;
                    break;
                case FBM.FWCoordSys.EPSG3826:
                    t = n.left;
                    i = n.top;
                    break;
                case FBM.FWCoordSys.EPSG3825:
                    t = n.left;
                    i = n.top
                }
                FBM.moveMapTo_(this, t, i);
                this.refreshMapWithIdle(!0)
            }
        }
        ;
        this.getLayerList = function() {
            return d
        }
        ;
        this.setMapAction = function(n, t) {
            if (n == 1) {
                var i = f.getHObject()
                  , u = function(n, u, f, e) {
                    DetachEvent(i, "mousedown", r, !1);
                    freezeMap || h.InitMapEvent(this);
                    t != null && t(n, u, f, e)
                }
                  , r = function(n) {
                    RectangleTracker(f, n, u);
                    return
                };
                h.ExitMapEvent();
                AttachEvent(i, "mousedown", r, !1);
                return
            }
            freezeMap || h.InitMapEvent(this)
        }
        ;
        this.getCoordinateString = function(n, t) {
            var i = f.ToMapPoint(n, t);
            return i.x + "," + i.y
        }
        ;
        this.changeOverviewMapType = function(n, t) {
            for (var i = 0; i < n.length; i++)
                n[i].putVisible(this.baseMapVisible && n[i].mapTypeId == t);
            g.RebuildElement()
        }
        ;
        yt = function() {
            var r, t, i, e, o;
            if (u.style.width = n.offsetWidth + "px",
            u.style.height = n.offsetHeight + "px",
            ut = u.clientHeight,
            rt = u.clientWidth,
            w.style.width = n.offsetWidth + "px",
            w.style.height = n.offsetHeight + "px",
            v.style.width = n.offsetWidth + "px",
            v.style.height = n.offsetHeight + "px",
            y.style.width = n.offsetWidth + "px",
            y.style.height = n.offsetHeight + "px",
            s)
                for (r = 0; r < s.length; r++)
                    t = s[r],
                    t && (i = t.div.main,
                    i.style.width = n.offsetWidth + "px",
                    i.style.height = n.offsetHeight + "px",
                    i = t.div.shadow,
                    i.style.width = n.offsetWidth + "px",
                    i.style.height = n.offsetHeight + "px",
                    e = t.paper.main,
                    e.setSize(u.offsetWidth, u.offsetHeight),
                    e = t.paper.shadow,
                    e.setSize(u.offsetWidth, u.offsetHeight));
            nt.setSize(u.offsetWidth, u.offsetHeight);
            ft.setSize(u.offsetWidth, u.offsetHeight);
            dt.refreshMapWithIdle(!0);
            o = window.document.createEvent("UIEvents");
            o.initUIEvent("resize", !1, !1, window, 0);
            f.getHObject().dispatchEvent(o);
            FBM.FWEvent.trigger(dt, "resize")
        }
        ;
        pt = function() {
            u = document.createElement("div");
            n.appendChild(u);
            u.style.position = "relative";
            u.style.overflow = "hidden";
            u.style.width = n.offsetWidth + "px";
            u.style.height = n.offsetHeight + "px";
            u.style.border = "0px";
            u.style.left = "0px";
            u.style.top = "0px";
            u.unselectable = "on";
            u.className = "hpack";
            rt = u.clientWidth;
            ut = u.clientHeight
        }
        ;
        this.setBackgroundColor = function(n) {
            typeof n == "string" && (wt = !0,
            f.setColor(n),
            e.backgroundColor = n)
        }
        ;
        this.getBackgroundColor = function() {
            return e.backgroundColor
        }
        ;
        this.bcTimer = null;
        this.refreshMapWithIdle = function(n) {
            if (clearTimeout(this.bcTimer),
            f.RefreshMap(!1),
            n) {
                var t = this;
                this.bcTimer = setTimeout(function() {
                    f.RefreshMap(!0);
                    FBM.FWEvent.trigger(t, "idle")
                }, 20)
            }
        }
        ;
        this.checkIdle = function(n) {
            function i(n, t, i, r) {
                r && (n && i && t ? FBM.FWEvent.addListenerOnce(n, i, r) : r())
            }
            var t = this;
            i(this, this.bcTimer, "idle", function() {
                var u = t.getMapTypeId()
                  , r = t.getLayerList().find(function(n) {
                    return n.mapTypeId == u
                });
                i(r, r && r.loading, "loaded", function() {
                    return n.apply(t)
                })
            })
        }
        ;
        this.initialize_ = function(t) {
            function oi(n, t, i) {
                var r = new MapCachedLayer(FBM.FWMapTypeId_zh_TW[n],t,!1,this,k,null,i);
                return r.mapTypeId = n,
                r.putVisible(n == p),
                r
            }
            var wt, rt, ut, ui, fi, s, ei, dt, e, ii, ri, si, tt, hi, ot;
            for (this.infoWindowLayer = new l(ti,this),
            this.overlay = new a(this),
            rt = FBM.MapTypeDocumentName,
            ut = FBM.MapTypeIndexViewDocumentName,
            c == "EPSG3857" ? (k = "google",
            ui = r.Forward(i, new CPoint3(118.9940295414,25.30028310652,0)),
            fi = r.Forward(i, new CPoint3(122.0064955717,21.896606644941,0)),
            lt = new FBM.FWEnvelope(fi.X,fi.Y,ui.X,ui.Y),
            rt = FBM.MapTypeDocumentNameGoogle,
            ut = FBM.MapTypeIndexViewDocumentNameGoogle,
            wt = FBM.CacheExtend3857) : c == "EPSG3825" ? (k = "97_119",
            lt = new FBM.FWEnvelope(339023.59349082,2425702.7292442,51368.8242689183,2799323.57990279),
            rt = FBM.MapTypeDocumentNameTWD97_119,
            ut = FBM.MapTypeIndexViewDocumentName) : (k = "97",
            lt = new FBM.FWEnvelope(339023.59349082,2425702.7292442,51368.8242689183,2799323.57990279),
            rt = FBM.MapTypeDocumentName,
            ut = FBM.MapTypeIndexViewDocumentName),
            s = [FBM.FWMapTypeId.FWMAP, FBM.FWMapTypeId.FWMAP_D],
            e = 0; e < s.length; e++)
                wt !== undefined && s[e]in wt && (ei = wt[s[e]]),
                s[e]in rt && d.push(oi.call(this, s[e], rt[s[e]], ei)),
                s[e]in ut && it.push(oi.call(this, s[e], ut[s[e]], ei)),
                s[e]in FBM.MapTypeMaxZoomLevel[c] && (at = Math.max(FBM.MapTypeMaxZoomLevel[c][s[e]], at));
            for (pt(),
            dt = FBM.MapTypeScales[c in FBM.MapTypeScales ? c : "EPSG3826"],
            o = new FBM.MapScaleLevel(this,at,dt.levelX,dt.levelY,dt.scales),
            f = new MapBase(u,o),
            this.bindEvents(this.getEventElement()),
            n.style.overflow = "hidden",
            f.AddElement(this.overlay),
            f.AddElement(this.infoWindowLayer),
            f.setColor("#a5bfdd"),
            f.ZoomMapTo(lt),
            o.FitLevel(),
            initControlArray(this),
            e = 0; e < d.length; e++)
                f.AddLayer(d[e]);
            for (ct = createNode({
                tag: "div",
                parent: u,
                style: {
                    display: "inline",
                    position: "absolute",
                    right: "0px",
                    bottom: "0px",
                    width: "145px",
                    height: "145px",
                    "background-color": "#ADD8E6",
                    margin: "5px",
                    border: "2px solid",
                    "z-index": 1e7
                }
            }),
            u.appendChild(ct),
            g = new Overview(ct,f,o,150,150,4),
            ii = 0; ii < it.length; ii++)
                g.getMapBase().AddLayer(it[ii]);
            ri = this.getMapBase().getHObject();
            si = this.getMapBase().getHPackage();
            si.oncontextmenu = function() {
                return !1
            }
            ;
            tt = "http://www.w3.org/2000/svg";
            w = document.createElement("div");
            w.style.position = "absolute";
            w.style.width = "100%";
            w.style.height = "100%";
            w.style.pointerEvents = "auto";
            w.className = "fwoverlayview";
            ri.appendChild(w);
            y = document.createElement("div");
            y.style.position = "absolute";
            y.style.width = "100%";
            y.style.height = "100%";
            y.className = "fwshadow";
            y.style.pointerEvents = "auto";
            ri.appendChild(y);
            ft = Raphael(y);
            ft.canvas.setAttribute("fill-rule", "evenodd");
            ft.canvas.setAttribute("pointer-events", "auto");
            hi = ft.rect(0, 0, 300, 300);
            hi.hide();
            v = document.createElement("div");
            v.style.position = "absolute";
            v.style.width = "100%";
            v.style.height = "100%";
            v.style.pointerEvents = "auto";
            v.className = "fwoverlay";
            ri.appendChild(v);
            Raphael.fn.createMarker = function(n, t) {
                var i = null;
                return t ? (i = this.canvas.getElementsByTagName("defs")[0].getElementById(t),
                i && i.firstChild && i.removeChild(i.firstChild)) : t = Raphael.createUUID(),
                i == null && (i = createNode({
                    tag: "marker",
                    ns: tt,
                    attr: {
                        id: t,
                        markerWidth: 22,
                        markerHeight: 22,
                        viewBox: "-11 -11 22 22",
                        orient: "auto"
                    }
                }),
                this.canvas.getElementsByTagName("defs")[0].appendChild(i)),
                i.appendChild(createNode({
                    tag: "path",
                    ns: tt,
                    attr: {
                        fill: n.fillColor,
                        "fill-opacity": n.fillOpacity,
                        stroke: n.strokeColor,
                        "stroke-width": n.strokeWeight,
                        "stroke-opacity": n.strokeOpacity,
                        d: n.symbolStyle
                    }
                })),
                t
            }
            ;
            Raphael.fn.removeMarker = function(n) {
                var t = this.canvas.getElementsByTagName("defs")[0].getElementById(n);
                t && t.parentNode.removeChild(t)
            }
            ;
            nt = Raphael(v);
            nt.canvas.getElementsByTagName("defs")[0].appendChild(createNode({
                tag: "filter",
                ns: tt,
                attr: {
                    id: "filterBorder"
                },
                child: [{
                    tag: "feMorphology",
                    ns: tt,
                    attr: {
                        result: "mor",
                        operator: "dilate",
                        radius: "1"
                    }
                }, {
                    tag: "feColorMatrix",
                    ns: tt,
                    attr: {
                        result: "cm",
                        "in": "mor",
                        type: "matrix",
                        values: "0 0 0 0 0.25 0 0 0 0 0.25 0 0 0 0 0.25 0 0 0 1 0"
                    }
                }, {
                    tag: "feBlend",
                    ns: tt,
                    attr: {
                        "in": "SourceGraphic",
                        in2: "cm",
                        mode: "normal"
                    }
                }]
            }));
            nt.canvas.getElementsByTagName("defs")[0].appendChild(createNode({
                tag: "filter",
                ns: tt,
                attr: {
                    id: "filterShadow"
                },
                child: [{
                    tag: "feDropShadow",
                    ns: tt,
                    attr: {
                        dx: "1",
                        dy: "0",
                        stdDeviation: "0",
                        "flood-color": "gray"
                    }
                }, {
                    tag: "feDropShadow",
                    ns: tt,
                    attr: {
                        dx: "-1",
                        dy: "0",
                        stdDeviation: "0",
                        "flood-color": "gray"
                    }
                }, {
                    tag: "feDropShadow",
                    ns: tt,
                    attr: {
                        dx: "0",
                        dy: "-1",
                        stdDeviation: "0",
                        "flood-color": "gray"
                    }
                }, {
                    tag: "feDropShadow",
                    ns: tt,
                    attr: {
                        dx: "0",
                        dy: "1",
                        stdDeviation: "0",
                        "flood-color": "gray"
                    }
                }, ]
            }));
            nt.canvas.setAttribute("fill-rule", "evenodd");
            nt.canvas.setAttribute("pointer-events", "auto");
            vt = new FBM.CopyrightControl(this,FBM.FWControlPosition.BOTTOM_LEFT);
            ot = vt.getDiv();
            ot.style.width = "";
            ot.style.height = "";
            ot.style.padding = "5px";
            ot.style.textShadow = "-1px 0 white, 0 1px white, 1px 0 white, 0 -1px white";
            ot.innerHTML = "<div style='font-size:0.7em;font-weight:900;margin-left:5px;'>FB-Map © " + (new Date).getFullYear() + " FB, MOTC<\/div>";
            f.AddElement(vt);
            ht = new FBM.ScaleBarControl(u,f,b.scaleControlOptions.controlPosition,b.scaleControlOptions.scaleControlStyle,this);
            f.AddElement(ht);
            et = new FBM.MapTypeBarControl(this,b.mapTypeControlOptions);
            st = new FBM.LevelBarControl(this.getHPackage(),o,b.navigationControlOptions.controlPosition,b.navigationControlOptions.style,this);
            f.AddElement(st);
            h = new FBM.FWMapMove(o,gt,bt,kt,ni,b.draggableCursor,b.draggingCursor,et,this);
            h.InitMapEvent(this);
            this.setOptions(b);
            this.setOptions(t);
            this.refreshMapWithIdle(!0);
            window.onresize = yt
        }
        ;
        this.addIndependentContainer = function(n, t) {
            var e = this.getMapBase().getHObject(), h = document.getElementsByClassName("fwoverlay")[0], v = document.getElementsByClassName("fwshadow")[0], c, i, u, l, r, f, a, o;
            return tt || (tt = []),
            t && (t.getLayerId && (c = t.getLayerId()),
            tt.push(t)),
            s || (s = []),
            i = document.createElement("div"),
            i.style.position = "absolute",
            i.style.width = "100%",
            i.style.height = "100%",
            i.style.pointerEvents = "auto",
            i.className = "IndependentContainerShadow",
            n && (i.className = i.className + "_" + n),
            s.length <= 0 ? e.insertBefore(i, h) : e.insertBefore(i, s[0].div.main),
            u = Raphael(i),
            u.canvas.setAttribute("fill-rule", "evenodd"),
            u.canvas.setAttribute("pointer-events", "auto"),
            l = u.rect(0, 0, 300, 300),
            l.hide(),
            r = document.createElement("div"),
            r.style.position = "absolute",
            r.style.width = "100%",
            r.style.height = "100%",
            r.style.pointerEvents = "auto",
            r.className = "IndependentContainer",
            n && (r.className = r.className + "_" + n),
            e.insertBefore(r, h),
            f = Raphael(r),
            f.canvas.setAttribute("fill-rule", "evenodd"),
            f.canvas.setAttribute("pointer-events", "auto"),
            a = f.rect(0, 0, 300, 300),
            a.hide(),
            o = {
                layerId: c,
                div: {
                    main: r,
                    shadow: i
                },
                paper: {
                    main: f,
                    shadow: u
                }
            },
            s.push(o),
            o
        }
        ;
        this.removeAdvancedLayer = function(n) {
            if (tt) {
                var t = tt.indexOf(n);
                t >= 0 && tt.splice(t, 1)
            }
        }
        ;
        this.removeIndependentContainer = function(n) {
            var i = this.getMapBase().getHObject(), t;
            s && (t = s.indexOf(n),
            t >= 0 && (i.removeChild(n.div.main),
            i.removeChild(n.div.shadow),
            s.splice(t, 1)))
        }
        ;
        this.getAdvancedLayers = function() {
            return tt
        }
        ;
        this.getIndependentContainers = function() {
            return s
        }
        ;
        this.moveIndependentContainerToTop = function(n) {
            var t = this.getMapBase().getHObject(), i, r;
            t != null && s && n != null && (i = s.indexOf(n),
            i >= 0 && s.length > 0 && (r = document.getElementsByClassName("fwoverlay")[0],
            t.insertBefore(n.div.shadow, s[0].div.main),
            t.removeChild(n.div.main),
            t.insertBefore(n.div.main, r),
            s.splice(i, 1, n)))
        }
        ;
        this.getPanes = function() {
            return {
                graphicLayer: v,
                mapLayer: this.getHObj(),
                shadowLayer: y,
                controlLayer: this.getHPackage(),
                overlayviewLayer: w,
                overlay: this.overlay
            }
        }
        ;
        this.addLayer = function(n, t) {
            n.skip = t;
            d.push(n);
            f.AddLayer(n);
            this.refreshMapWithIdle(!0)
        }
        ;
        this.removeLayer = function(n) {
            var t = d.indexOf(n);
            t >= 0 && (d.splice(t, 1),
            f.RemoveLayer(n));
            this.refreshMapWithIdle(!0)
        }
        ;
        this.getShadowPaper = function() {
            return ft
        }
        ;
        this.getPaper = function() {
            return nt
        }
        ;
        var c = "EPSG3857", nt, ft, v, y, w, tt, s, b = {
            backgroundColor: "#a5bfdd",
            disableDefaultUI: !1,
            draggable: !0,
            scrollwheel: !0,
            keyboardShortcuts: !0,
            draggableCursor: "",
            draggingCursor: "",
            mapTypeControl: !1,
            mapTypeControlOptions: {
                mapTypeIds: c == "EPSG3825" ? [FBM.FWMapTypeId.FWMAP, FBM.FWMapTypeId.NLSCMAP] : [FBM.FWMapTypeId.FWMAP, FBM.FWMapTypeId.NLSCMAP, FBM.FWMapTypeId.MOTCMAP, FBM.FWMapTypeId.F2IMAGE, FBM.FWMapTypeId.ROADMAP, FBM.FWMapTypeId.HILLSHADEMIX, FBM.FWMapTypeId.HILLSHADE, FBM.FWMapTypeId.IMAGENLSC],
                controlPosition: FBM.FWControlPosition.TOP_RIGHT,
                mapTypeControlStyle: FBM.FWMapTypeControlStyle.DROPDOWN_MENU
            },
            navigationControl: !0,
            navigationControlOptions: {
                controlPosition: FBM.FWControlPosition.LEFT_CENTER,
                navigationControlStyle: FBM.FWNavigationControlStyle.DEFAULT
            },
            scaleControl: !0,
            scaleControlOptions: {
                controlPosition: FBM.FWControlPosition.LEFT_BOTTOM,
                scaleControlstyle: FBM.FWScaleControlStyle.DEFAULT
            },
            indexViewControl: !1,
            indexViewControlOptions: FBM.FWIndexViewControlOptions.MINIMIZED,
            maxZoom: null,
            minZoom: null,
            dbClickZoomIn: !0
        }, e = {
            backgroundColor: "#a5bfdd",
            disableDefaultUI: !0,
            draggable: !0,
            scrollwheel: !0,
            keyboardShortcuts: !0,
            draggableCursor: "",
            dragInertia: !0,
            draggingCursor: "",
            mapTypeControl: !1,
            mapTypeControlOptions: {
                mapTypeIds: [FBM.FWMapTypeId.FWMAP, FBM.FWMapTypeId.NLSCMAP, FBM.FWMapTypeId.MOTCMAP, FBM.FWMapTypeId.F2IMAGE, FBM.FWMapTypeId.ROADMAP, FBM.FWMapTypeId.HILLSHADEMIX, FBM.FWMapTypeId.HILLSHADE, FBM.FWMapTypeId.IMAGENLSC],
                controlPosition: FBM.FWControlPosition.RIGHT_TOP,
                mapTypeControlStyle: FBM.FWMapTypeControlStyle.DEFAULT
            },
            navigationControl: !0,
            navigationControlOptions: {
                controlPosition: FBM.FWControlPosition.LEFT_TOP,
                navigationControlStyle: FBM.FWNavigationControlStyle.DEFAULT
            },
            scaleControl: !0,
            scaleControlOptions: {
                controlPosition: FBM.FWControlPosition.LEFT_BOTTOM,
                scaleControlstyle: FBM.FWScaleControlStyle.DEFAULT
            },
            indexViewControl: !1,
            indexViewControlOptions: FBM.FWIndexViewControlOptions.NORMAL,
            maxZoom: null,
            minZoom: null,
            dbClickZoomIn: !0
        }, gt = !0, bt = !0, kt = !0, ni = !1, h = null, f = null, dt = this, u = null, ct = null, ti = [], p = FBM.FWMapTypeId.FWMAP, k = "google", d = [], it = [], ii = n, lt = null, ri = FBM.FWCoordSys.EPSG3857, at = 0, o = null, ot = !1, vt = null, st = null, et = null, ht = null, g = null;
        this.initialize_(t)
    }
    ;
    FBM.FWOnlineMap.prototype = new FBM.MVCObject;
    n = FBM.FWOnlineMap.prototype;
    n.triggerEvent = function(n, t) {
        var r = this.getMapBase(), e, o, s, h, f;
        if (r) {
            e = r.getPackageOffset();
            n.changedTouches && n.changedTouches.length ? (o = n.changedTouches[0].clientX,
            s = n.changedTouches[0].clientY) : (o = n.clientX,
            s = n.clientY);
            var l = r.ToMapDistX(1), u = r.ToMapPoint(o - e.x, s - e.y), c = this.getMap().getCoordSys(), i;
            switch (c) {
            case FBM.FWCoordSys.EPSG3857:
                i = FBM.GooToWGS84(u.x, u.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                i = u;
                break;
            case FBM.FWCoordSys.EPSG3825:
                i = u
            }
            h = !1;
            h || (f = new FBM.FWMouseEvent(n,t),
            f.point = new FBM.FWPoint(i.x,i.y),
            f.target = this,
            FBM.FWEvent.trigger_(this, t, f))
        }
    }
    ;
    n.onMouseUp = function(n) {
        this.triggerEvent.call(this, n, "mouseup")
    }
    ;
    n.onMouseMove = function(n) {
        this.triggerEvent.call(this, n, "mousemove")
    }
    ;
    n.onMouseDown = function(n) {
        this.__downE = n;
        this.triggerEvent.call(this, n, "mousedown");
        var t = this
          , i = function() {
            t.onDrag.apply(t, arguments)
        }
          , r = function() {
            t.onDragEnd.apply(t, arguments);
            DetachEvent(t.elem, "mousemove", t.elem.dragWrapper);
            DetachEvent(t.elem, "mouseup", t.elem.dragEndWrapper);
            DetachEvent(t.elem, "touchmove", t.elem.dragWrapper);
            DetachEvent(t.elem, "touchend", t.elem.dragEndWrapper)
        };
        this.elem.dragWrapper = i;
        this.elem.dragEndWrapper = r;
        AttachEvent(this.elem, "mousemove", i);
        AttachEvent(this.elem, "mouseup", r);
        AttachEvent(this.elem, "touchmove", i);
        AttachEvent(this.elem, "touchend", r)
    }
    ;
    n.onMouseOver = function(n) {
        this.triggerEvent.call(this, n, "mouseover")
    }
    ;
    n.onMouseOut = function(n) {
        this.triggerEvent.call(this, n, "mouseout")
    }
    ;
    n.onDblClick = function(n) {
        this.triggerEvent.call(this, n, "dblclick")
    }
    ;
    n.isNearPosition = function(n, t) {
        var e = !1, i, r, u, f;
        return n.changedTouches && t.changedTouches && n.changedTouches.length && t.changedTouches.length ? (i = n.changedTouches[0].screenX,
        r = n.changedTouches[0].screenY,
        u = t.changedTouches[0].screenX,
        f = t.changedTouches[0].screenY) : (i = n.screenX,
        r = n.screenY,
        u = t.screenX,
        f = t.screenY),
        (i - 1 === u || i === u || i + 1 === u) && (r - 1 === f || r === f || r + 1 === f) && (e = !0),
        e
    }
    ;
    n.isSamePosition = function(n, t) {
        var i, r, u, f;
        return n.changedTouches && t.changedTouches && n.changedTouches.length && t.changedTouches.length ? (i = n.changedTouches[0].screenX,
        r = n.changedTouches[0].screenY,
        u = t.changedTouches[0].screenX,
        f = t.changedTouches[0].screenY) : (i = n.screenX,
        r = n.screenY,
        u = t.screenX,
        f = t.screenY),
        i === u && r === f
    }
    ;
    n.onDrag = function(n) {
        this.isSamePosition(this.__downE, n) || (DetachEvent(this.elem, "mousemove", this.elem.dragWrapper),
        DetachEvent(this.elem, "mouseup", this.elem.dragEndWrapper),
        DetachEvent(this.elem, "touchmove", this.elem.dragWrapper),
        DetachEvent(this.elem, "touchend", this.elem.dragEndWrapper))
    }
    ;
    n.onDragEnd = function(n) {
        DetachEvent(this.elem, "mousemove", this.elem.dragWrapper);
        DetachEvent(this.elem, "mouseup", this.elem.dragEndWrapper);
        DetachEvent(this.elem, "touchmove", this.elem.dragWrapper);
        DetachEvent(this.elem, "touchend", this.elem.dragEndWrapper);
        this.isNearPosition(this.__downE, n) && (n.button == FBM.FWEvent.RIGHTBUTTON ? this.triggerEvent.call(this, n, "rightclick") : n.button == FBM.FWEvent.LEFTBUTTON ? this.triggerEvent.call(this, n, "click") : this.triggerEvent.call(this, n, "click"))
    }
    ;
    n.bindEvents = function() {
        if (this.elem = this.getEventElement(),
        this.elem) {
            var n = this;
            AttachEvent(this.elem, "mouseup", function() {
                n.onMouseUp.apply(n, arguments)
            });
            AttachEvent(this.elem, "mousemove", function() {
                n.onMouseMove.apply(n, arguments)
            });
            AttachEvent(this.elem, "mousedown", function() {
                n.onMouseDown.apply(n, arguments)
            });
            AttachEvent(this.elem, "mouseover", function() {
                n.onMouseOver.apply(n, arguments)
            });
            AttachEvent(this.elem, "mouseout", function() {
                n.onMouseOut.apply(n, arguments)
            });
            AttachEvent(this.elem, "dblclick", function() {
                n.onDblClick.apply(n, arguments)
            });
            AttachEvent(this.elem, "touchstart", function() {
                n.onMouseDown.apply(n, arguments)
            });
            AttachEvent(this.elem, "touchend", function() {
                n.onMouseUp.apply(n, arguments)
            });
            AttachEvent(this.elem, "touchmove", function() {
                n.onMouseMove.apply(n, arguments)
            })
        }
    }
    ;
    n.layout = function(n) {
        if (n) {
            var t = this.getDiv();
            this.checkIdle(function() {
                for (var i = [], u = t.getElementsByTagName("svg"), r = 0; r < u.length; r++)
                    i.push({
                        newchild: document.createElement("canvas"),
                        oldchild: u[r]
                    });
                i.forEach(function(n) {
                    n.oldchild.parentNode.insertBefore(n.newchild, n.oldchild);
                    canvg(n.newchild, n.oldchild);
                    n.oldchild.parentNode.removeChild(n.oldchild)
                });
                html2canvas(t, {
                    background: "undefined",
                    useCORS: !0,
                    onrendered: function(t) {
                        i.forEach(function(n) {
                            n.newchild.parentNode.insertBefore(n.oldchild, n.newchild);
                            n.newchild.parentNode.removeChild(n.newchild)
                        });
                        var r = new Image;
                        r.src = t.toDataURL("image/png");
                        n(r)
                    }
                })
            })
        }
    }
    ;
    FBM.RegisterEvent(FBM.FWOnlineMap, ["bounds_changed", "center_changed", "zoom_changed", "maptypeid_changed", "tilesloaded", "click", "mousedown", "mousemove", "mouseout", "mouseover", "projection_changed", "dragstart", "drag", "dragend", "idle", "resize", "dblclick", "rightclick"]);
    FBM.moveMapTo_ = function(n, t, i) {
        var u = n.getMapBase().getCenterX(), f = n.getMapBase().getCenterY(), e = n.getBounds().toString(), r;
        n.getMapBase().MoveMapTo(t, i);
        r = n.getBounds().toString();
        (u != t || f != i) && FBM.FWEvent.trigger(n, "center_changed");
        e != r && FBM.FWEvent.trigger(n, "bounds_changed")
    }
    ;
    FBM.FWIndexViewControl = function(n) {
        this.show = function(t) {
            n.IndexViewControl && n.IndexViewControl.Show(t)
        }
        ;
        this.minimize = function() {
            n.IndexViewControl.minimize()
        }
    }
    ;
    FBM.FWMapMove = function(n, t, i, r, u, f, e, o, s, h) {
        var p, d = !1, et, a = 0, ii = null, ot, bt, kt, dt, gt, ni, it = !1, st = !1, ri = null, ht, ct, k = !1, ri = null, rt = "", lt = "", at = !0, ut = !1, vt = null, l, yt = !1, pt = 0, h, g = 50, s = s, w = 0, b = 0, nt = null, tt = null, v = null, y = null, ti = function() {
            var n = v - nt
              , t = y - tt;
            w = n / g;
            b = t / g
        }, wt, ft;
        this.ExitMapEvent = null;
        this.IsMapAction = function() {
            return k
        }
        ;
        wt = function(n, t, i) {
            function l() {
                var l = new Date, h = l.getTime(), i;
                if (h - c > t * 1e3) {
                    FBM.moveMapTo_(s, n.x, n.y);
                    s.refreshMapWithIdle(!0);
                    clearInterval(y);
                    return
                }
                i = (h - c) / (t * 1e3);
                r.putCenterX(u + i * e);
                r.putCenterY(f + i * o);
                s.refreshMapWithIdle(!1)
            }
            var r = s.getMapBase()
              , u = r.getCenterX()
              , f = r.getCenterY()
              , e = n.x - u
              , o = n.y - f
              , h = t * 1e3 / i
              , a = 1e3 / i
              , p = e / h
              , w = o / h
              , v = new Date
              , c = v.getTime()
              , y = setInterval(l, a)
        }
        ;
        this.panBy = function(n, t) {
            var i = s.getMapBase()
              , e = i.getClientWidth()
              , o = i.getClientHeight()
              , u = i.getCenterX() + n
              , f = i.getCenterY() + t
              , r = i.FromMapPoint(u, f);
            r.x >= 0 && r.x <= e && r.y >= 0 && r.y <= o ? wt({
                x: u,
                y: f
            }, .5, 30) : FBM.moveMapTo_(s, u, f)
        }
        ;
        this.panToBounds = function() {
            var n = s.getMapBase()
              , u = n.getClientWidth()
              , f = n.getClientHeight()
              , i = n.getCenterX() + offsetX
              , r = n.getCenterY() + offsetY
              , t = n.FromMapPoint(i, r);
            t.x >= 0 && t.x <= u && t.y >= 0 && t.y <= f ? wt({
                x: i,
                y: r
            }, .5, 30) : FBM.moveMapTo_(s, i, r)
        }
        ;
        this.setMapBounds = function(n) {
            h = n;
            var i = s.getMapBase()
              , r = i.getCenterX()
              , u = i.getCenterY()
              , t = s.checkMapBoundsRestrict(h, r, u);
            t != null && (FBM.moveMapTo_(s, t.x, t.y),
            s.refreshMapWithIdle(!0))
        }
        ;
        this.allowKeyboard = function(n) {
            typeof n == "boolean" && (at = n)
        }
        ;
        this.clearNum = function() {
            c = 0
        }
        ;
        ft = !0;
        this.setDragInertia = function(n) {
            typeof n == "boolean" && (ft = n)
        }
        ;
        this.changeDraggableCursor = function(n) {
            rt = n;
            l.style.cursor = rt
        }
        ;
        this.changeDraggingCursor = function(n) {
            lt = n
        }
        ;
        this.InitMapEvent = function(f) {
            var fr = !1, e = f.getMapBase(), di;
            l = e.getHObject();
            var hr = e.getHPackage(), o = [], pi = [], er = function(n) {
                ii = setTimeout(function() {
                    a = 0
                }, n)
            }, wi = function(n, t, i) {
                var r = 20;
                return (i && (r = i),
                Math.abs(n.X - t.X) <= r && Math.abs(n.Y - t.Y) <= r) ? !0 : !1
            }, gi = function(n, t) {
                var i = e.getCursorPosition(n)
                  , r = e.getCursorPosition(t)
                  , u = parseFloat((i.x + r.x) / 2)
                  , f = parseFloat((i.y + r.y) / 2)
                  , o = Math.sqrt((i.x - r.x) * (i.x - r.x) + (i.y - r.y) * (i.y - r.y));
                return {
                    scrCenter: {
                        X: u,
                        Y: f
                    },
                    length: o
                }
            }, or = function(n, t) {
                var r = gi(n, t)
                  , i = r.scrCenter
                  , u = r.length
                  , f = e.ToMapPoint(i.X, i.Y);
                return {
                    mapCenter: f,
                    scrCenter: i,
                    length: u
                }
            }, si = function(n) {
                var t, r, u, i;
                o = n.touches;
                wt && wt.stop();
                w = 0;
                b = 0;
                t = o[0];
                r = {
                    X: t.clientX,
                    Y: t.clientY,
                    MX: e.getCenterX(),
                    MY: e.getCenterY()
                };
                a == 0 ? a = 1 : a == 2 && wi(r, p) == !0 ? (a = 3,
                et = t) : a = 0;
                p = r;
                o.length > 1 ? (u = o[1],
                i = or(t, u),
                ot = i.mapCenter,
                bt = i.scrCenter,
                kt = i.length,
                dt = e.getCellSizeX(),
                gt = e.getCellSizeY(),
                ni = e.getScale(),
                it = !0) : (v = o[0].clientX,
                y = o[0].clientY,
                nt = v,
                tt = y,
                li = setInterval(ti, g),
                ri = !1,
                ei = 0);
                d = !0
            }, hi = function(n) {
                var t, f, r, i;
                if (d)
                    if (n.preventDefault(),
                    o = n.touches,
                    pi = n.changedTouches,
                    t = o[0],
                    a == 0 || wi({
                        X: t.clientX,
                        Y: t.clientY
                    }, p) || (a = 0),
                    o.length > 1) {
                        if (st)
                            return;
                        if (st = !0,
                        f = o[1],
                        it && (r = gi(t, f),
                        i = r.scrCenter,
                        !wi(i, bt, 5))) {
                            var c = r.length
                              , u = parseFloat(c / kt)
                              , l = e.getClientWidth() / 2 - i.X
                              , w = e.getClientHeight() / 2 - i.Y
                              , h = new FBM.FWPoint(ot.x + l * dt / u,ot.y + w * gt / u);
                            e.putScale(ni * u);
                            FBM.moveMapTo_(s, h.x, h.y);
                            s.refreshMapWithIdle(!1)
                        }
                        st = !1
                    } else
                        ai && (clearTimeout(ai),
                        ri = !1),
                        setTimeout(nr, 500),
                        ei++,
                        nt = v,
                        tt = y,
                        v = t.clientX,
                        y = t.clientY,
                        FBM.moveMapTo_(s, p.MX - e.ToMapDistX(t.clientX - p.X), p.MY - e.ToMapDistY(t.clientY - p.Y)),
                        s.refreshMapWithIdle(!1)
            }, c = function(t) {
                var i;
                if (d) {
                    if (d = !1,
                    it = !1,
                    t.preventDefault(),
                    o = t.touches,
                    pi = t.changedTouches,
                    a == 3) {
                        a = 0;
                        oi(et);
                        s.onDblClick(et);
                        return
                    }
                    if (ft && !it && Math.hypot(w, b) > ir && ei > 2 && !ri) {
                        var r = e.getCenterX()
                          , u = e.getCenterY()
                          , f = e.ToMapDistX(-w * fi)
                          , c = e.ToMapDistY(-b * fi)
                          , i = s.checkMapBoundsRestrict(h, r + f, u + c);
                        i != null && (f = i.x - r,
                        c = i.y - u);
                        wt = FBM.fx.createAnimation({
                            easing: FBM.fx.easing.quadOut,
                            type: window.requestAnimationFrame ? "req" : "setTimeout",
                            duration: fi,
                            repeat: !1,
                            onAnimation: function(n) {
                                FBM.moveMapTo_(s, r + f * n, u + c * n);
                                s.refreshMapWithIdle(!1)
                            },
                            onEnd: function() {
                                n.FitLevel();
                                s.refreshMapWithIdle(!0)
                            }
                        });
                        wt.play()
                    } else
                        i = s.checkMapBoundsRestrict(h, e.getCenterX(), e.getCenterY()),
                        i != null && FBM.moveMapTo_(s, i.x, i.y),
                        n.FitLevel(),
                        s.refreshMapWithIdle(!0);
                    clearInterval(li);
                    a = a == 1 ? 2 : 0;
                    er(500)
                }
            }, ci = function() {
                o = [];
                pi = [];
                s.refreshMapWithIdle(!0);
                d = !1
            }, nr = function() {
                ri = !0
            }, tr = function(n) {
                var t, r, u, f;
                (n.preventDefault(),
                util.disableDefault(n),
                i) && (t = n.screenX - ht,
                r = n.screenY - ct,
                ht = n.screenX,
                ct = n.screenY,
                ai && (clearTimeout(ai),
                ri = !1),
                setTimeout(nr, 500),
                ei++,
                nt = v,
                tt = y,
                v = n.screenX,
                y = n.screenY,
                yt = !0,
                l.style.cursor = lt ? lt : "url(" + FBM.RES_PATH + "catch.cur),default",
                u = e.getCenterX() - e.ToMapDistX(t),
                f = e.getCenterY() - e.ToMapDistY(r),
                FBM.moveMapTo_(s, u, f),
                s.refreshMapWithIdle(!1),
                pt < 1 && FBM.FWEvent.trigger(s, "dragstart"),
                FBM.FWEvent.trigger(s, "drag"),
                pt++)
            }, wt, fi = 500, ir = 4 / g, rr = function(t) {
                var r;
                if ((util.disableDefault(t),
                i) && !fr) {
                    if (DetachEvent(l, "mousemove", tr, !0),
                    DetachEvent(l, "mouseup", rr, !0),
                    l.style.cursor = rt ? rt : "default",
                    k = !1,
                    ft && Math.hypot(w, b) > ir && ei > 2 && !ri) {
                        var u = e.getCenterX()
                          , f = e.getCenterY()
                          , o = e.ToMapDistX(-w * fi)
                          , c = e.ToMapDistY(-b * fi)
                          , r = s.checkMapBoundsRestrict(h, u + o, f + c);
                        r != null && (o = r.x - u,
                        c = r.y - f);
                        wt = FBM.fx.createAnimation({
                            easing: FBM.fx.easing.quadOut,
                            type: window.requestAnimationFrame ? "req" : "setTimeout",
                            duration: fi,
                            repeat: !1,
                            onAnimation: function(n) {
                                FBM.moveMapTo_(s, u + o * n, f + c * n);
                                s.refreshMapWithIdle(!1)
                            },
                            onEnd: function() {
                                n.FitLevel();
                                s.refreshMapWithIdle(!0)
                            }
                        });
                        wt.play()
                    } else
                        r = s.checkMapBoundsRestrict(h, e.getCenterX(), e.getCenterY()),
                        r != null && FBM.moveMapTo_(s, r.x, r.y),
                        n.FitLevel(),
                        s.refreshMapWithIdle(!0);
                    clearInterval(li);
                    yt && FBM.FWEvent.trigger(s, "dragend")
                }
            }, li, ai, ei = 0, ri = !0, vi = function(n) {
                (n.preventDefault(),
                util.disableDefault(n),
                wt && wt.stop(),
                ri = !1,
                ei = 0,
                w = 0,
                b = 0,
                v = n.screenX,
                y = n.screenY,
                nt = v,
                tt = y,
                li = setInterval(ti, g),
                i) && (k = !0,
                yt = !1,
                pt = 0,
                AttachEvent(l, "mouseup", rr, !0),
                AttachEvent(l, "mousemove", tr, !0),
                l.focus())
            }, ur = function(n) {
                (n.preventDefault(),
                util.disableDefault(n),
                i) && (k = !0,
                ht = n.screenX,
                ct = n.screenY)
            }, oi = function(i) {
                if (util.disableDefault(i),
                t) {
                    k = !0;
                    var r = e.getCursorPosition(i)
                      , u = e.ToMapPoint(r.x, r.y);
                    n.putMapLevel(n.getMapLevel() + 1);
                    FBM.moveMapTo_(s, u.x, u.y);
                    s.refreshMapWithIdle(!0)
                }
            }, yi = function(t) {
                var y, c, f;
                if (util.disableDefault(t),
                r) {
                    k = !0;
                    var u = e.getCursorPosition(t)
                      , l = e.getClientWidth() / 2
                      , a = e.getClientHeight() / 2
                      , w = e.FromMapPoint(l, a)
                      , b = l - u.x
                      , d = a - u.y
                      , i = e.ToMapPoint(u.x, u.y)
                      , p = e.getScale()
                      , v = t.wheelDelta ? t.wheelDelta : -t.detail
                      , o = 0;
                    v > 0 ? o = 1 : v < 0 && (o = -1);
                    n.putMapLevel(n.getMapLevel() + o);
                    y = e.getScale();
                    c = y / p;
                    i = new FBM.FWPoint((e.getCenterX() - i.x) / c + i.x,(e.getCenterY() - i.y) / c + i.y);
                    h && (f = s.checkMapBoundsRestrict(h, i.x, i.y),
                    f != null && (i.x = f.x,
                    i.y = f.y));
                    FBM.moveMapTo_(s, i.x, i.y);
                    s.refreshMapWithIdle(!0)
                }
            }, sr = function() {}, ui = 0, bi = function() {
                at && (ui = 0)
            }, ki = function(n) {
                function f(n) {
                    t.putMapLevel(t.getMapLevel() + n);
                    s.refreshMapWithIdle(!0)
                }
                function i(n, t) {
                    FBM.moveMapTo_(s, e.getCenterX() + n, e.getCenterY() + t);
                    s.refreshMapWithIdle(!1)
                }
                var t, r, u;
                if (at && !ut) {
                    t = e.getTransformation();
                    ui = ui + 4;
                    ui > 24 && (ui = 24);
                    r = 1 / t.getScaleX() * ui;
                    u = 1 / t.getScaleY() * ui;
                    switch (n.keyCode) {
                    case 37:
                        i(-r, 0);
                        break;
                    case 38:
                        i(0, -u);
                        break;
                    case 39:
                        i(r, 0);
                        break;
                    case 40:
                        i(0, u);
                        break;
                    case 107:
                        f(1);
                        break;
                    case 109:
                        f(-1)
                    }
                }
            };
            this.isDblClickEnabled = function() {
                return t
            }
            ;
            this.OpenCloseDblClick = function(n) {
                t && n || (t = n,
                n ? AttachEvent(l, "dblclick", oi, !1) : DetachEvent(l, "dblclick", oi, !1))
            }
            ;
            di = function(n) {
                if (ut) {
                    var t = FBM.KeyboardEditor.NONE
                      , i = n.ctrlKey
                      , r = n.altKey;
                    switch (n.keyCode) {
                    case 37:
                        t = FBM.KeyboardEditor.LEFT;
                        break;
                    case 38:
                        t = FBM.KeyboardEditor.UP;
                        break;
                    case 39:
                        t = FBM.KeyboardEditor.RIGHT;
                        break;
                    case 40:
                        t = FBM.KeyboardEditor.DOWN;
                        break;
                    case 46:
                        t = FBM.KeyboardEditor.DEL
                    }
                    vt && vt.call(this, t, s)
                }
            }
            ;
            this.OpenCloseKeyboardEditor = function(n, t) {
                ut && n || (ut = n,
                vt = t,
                n ? AttachEvent(l, "keydown", di, !1) : DetachEvent(l, "keydown", di, !1))
            }
            ;
            this.OpenCloseMove = function(n) {
                i && n || (i = n,
                n ? (AttachEvent(l, "mousedown", vi, !1),
                AttachEvent(l, "touchstart", si, !1),
                AttachEvent(l, "touchend", c, !1),
                AttachEvent(l, "touchcancel", ci, !1),
                AttachEvent(l, "touchleave", c, !1),
                AttachEvent(l, "touchmove", hi, !1)) : (DetachEvent(l, "mousedown", vi, !1),
                DetachEvent(l, "touchstart", si, !1),
                DetachEvent(l, "touchend", c, !1),
                DetachEvent(l, "touchcancel", ci, !1),
                DetachEvent(l, "touchleave", c, !1),
                DetachEvent(l, "touchmove", hi, !1)))
            }
            ;
            this.OpenCloseWheel = function(n) {
                r && n || (n ? AttachEvent(l, "mousewheel", yi, !1) : DetachEvent(l, "mousewheel", yi, !1),
                r = n)
            }
            ;
            this.OpenClosekeyboard = function(n) {
                u && n || (u = n,
                n == !1 ? (DetachEvent(l, "keydown", ki, !1),
                DetachEvent(l, "keyup", bi, !1)) : (AttachEvent(l, "keydown", ki, !1),
                AttachEvent(l, "keyup", bi, !1)))
            }
            ;
            this.ExitMapEvent = function() {
                r && DetachEvent(l, "mousewheel", yi, !1);
                DetachEvent(l, "mousedown", vi, !1);
                DetachEvent(l, "mousedown", ur, !1);
                t && DetachEvent(l, "dblclick", oi, !1);
                DetachEvent(l, "touchstart", si, !1);
                DetachEvent(l, "touchend", c, !1);
                DetachEvent(l, "touchcancel", ci, !1);
                DetachEvent(l, "touchleave", c, !1);
                DetachEvent(l, "touchmove", hi, !1)
            }
            ;
            AttachEvent(l, "mousedown", vi, !1);
            AttachEvent(l, "mousedown", ur, !1);
            AttachEvent(l, "contextmenu", sr, !1);
            AttachEvent(l, "keydown", ki, !1);
            AttachEvent(l, "keyup", bi, !1);
            t && AttachEvent(l, "dblclick", oi, !1);
            r && AttachEvent(l, "mousewheel", yi, !1);
            AttachEvent(l, "touchstart", si, !1);
            AttachEvent(l, "touchend", c, !1);
            AttachEvent(l, "touchcancel", ci, !1);
            AttachEvent(l, "touchleave", c, !1);
            AttachEvent(l, "touchmove", hi, !1)
        }
    }
    ;
    FBM.MapScaleLevel = function(n, t, i, r, u) {
        function p(n) {
            for (var t = 0, i, r, t = 0; t < o.length - 1; t++)
                if (n < o[t + 1])
                    break;
            return t < o.length - 1 && (i = o[t],
            r = o[t + 1],
            t += Math.log(n / i) / Math.log(r / i)),
            t
        }
        function w(n) {
            var t = Math.floor(Math.max(0, Math.min(n, o.length - 2)))
              , r = n - t
              , i = o[t]
              , u = o[t + 1];
            return i * Math.pow(u / i, r)
        }
        for (var l, h, s = 1, f = t, e = null, c = 256 / i, v = 256 / r, o = [], a = u, y = 0; y < a.length; y++)
            o.push(a[a.length - 1] / a[y]);
        o.reverse();
        l = 1;
        this.FitLevel = function() {
            this.putMapLevel(Math.round(s))
        }
        ;
        this.setMapBoundsLevel = function(t) {
            if (h = t,
            h) {
                var r = n.getMapBase()
                  , u = r.getClientHeight()
                  , o = r.getClientWidth()
                  , s = o / (h.right - h.left)
                  , l = (h.top - h.bottom) / u
                  , i = Math.ceil(p(s / c));
                i < e && (i = e);
                i > f && (i = f);
                this.setMapMinLevel(i)
            }
        }
        ;
        this.getBaseScaleX = function() {
            return c
        }
        ;
        this.putBaseScaleX = function(n) {
            c = n
        }
        ;
        this.getBaseScaleY = function() {
            return v
        }
        ;
        this.putBaseScaleY = function(n) {
            v = n
        }
        ;
        this.getMapMinLevel = function() {
            return e
        }
        ;
        this.setMapMinMaxLevel = function(t, i) {
            f = i == null ? FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()] : Math.min(i, FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()]);
            e = t == null ? 0 : t;
            s > f ? (this.putMapLevel(f),
            n.setZoom(f)) : s < e && (this.putMapLevel(e),
            n.setZoom(e))
        }
        ;
        this.setMapMaxLevel = function(t) {
            f = t == null ? FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()] : Math.min(t, FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()]);
            s > f && (this.putMapLevel(f),
            n.setZoom(f))
        }
        ;
        this.getMapMaxLevel = function() {
            return Math.min(f, FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()]),
            f
        }
        ;
        this.setMapMinLevel = function(t) {
            e = t == null ? 0 : t;
            s < e && (this.putMapLevel(e),
            n.setZoom(e))
        }
        ;
        this.getLevelNumber = function() {
            return this.getMapMaxLevel() - this.getMapMinLevel()
        }
        ;
        this.getMapLevel = function() {
            return s
        }
        ;
        this.putMapLevel = function(t) {
            var y = n.getMapBase().getCenterX(), p = n.getMapBase().getCenterY(), b = n.getBounds().toString(), r = FBM.MapTypeMaxZoomLevel[n.getCoordSys()][n.getMapTypeId()], u = f == null ? r : r > f ? f : r, o = e == null ? 0 : e, c = t > u ? u : t < o ? o : t, k = s !== t, a, i;
            s = c;
            l = w(s);
            a = n.getMapTypeId();
            i = n.getCoordSys();
            i == "EPSG3826" || i == "EPSG3825" ? a == "FWMAP" && c == 13 : i == "EPSG3857" && a == "FWMAP" && c == 19;
            var d = n.getMapBase().getCenterX()
              , g = n.getMapBase().getCenterY()
              , nt = n.getBounds().toString();
            if ((y != d || p != g) && FBM.FWEvent.trigger(n, "center_changed"),
            b != nt && FBM.FWEvent.trigger(n, "bounds_changed"),
            k && FBM.FWEvent.trigger(n, "zoom_changed"),
            h) {
                var tt = n.getMapBase().getCenterX()
                  , it = n.getMapBase().getCenterY()
                  , v = n.checkMapBoundsRestrict(h, tt, it);
                v != null && (FBM.moveMapTo_(n, v.x, v.y),
                n.refreshMapWithIdle(!1))
            }
            return t > u || t < o ? !1 : !0
        }
        ;
        this.getScale = function() {
            return c * l
        }
        ;
        this.putScale = function(n) {
            this.putMapLevel(p(n / c))
        }
        ;
        this.getScaleX = function() {
            return c * l
        }
        ;
        this.getScaleY = function() {
            return v * l
        }
        ;
        this.getLevelScale = function(n) {
            return c * w(n)
        }
    }
    ;
    FBM.FWTransStatus = {
        OK: "OK",
        INVALID_REQUEST: "INVALID_REQUEST"
    };
    FBM.FWMaxZoomLevel = function() {
        this.getMaxZoomLevel = function(n, t, i) {
            return i.call(this, FBM.MapTypeMaxZoomLevel[t][n])
        }
    }
    ;
    Proj4js.defs["EPSG:3826"] = "+title=TWD97 TM2+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +units=公尺 +no_defs";
    Proj4js.defs["EPSG:3857"] = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";
    Proj4js.defs["EPSG:3825"] = "+title=二度分帶：TWD97 TM2 澎湖 +proj=tmerc +lat_0=0 +lon_0=119 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +units=公尺 +no_defs";
    var u = new Proj4js.Proj("EPSG:3826")
      , e = new Proj4js.Proj("EPSG:3825")
      , s = new Proj4js.Proj("EPSG:3857")
      , t = new Proj4js.Proj("EPSG:4326");
    FBM.WGS84toWGS84 = FBM.TWD97toTWD97 = FBM.TWD97_119toTWD97_119 = FBM.TWD67toTWD67 = FBM.GootoGoo = function(n, t) {
        return {
            x: n,
            y: t
        }
    }
    ;
    FBM.TWD97toWGS84 = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(u, t, r),
        r
    }
    ;
    FBM.WGS84toTWD97 = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(t, u, r),
        r
    }
    ;
    FBM.TWD97_119toWGS84 = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(e, t, r),
        r
    }
    ;
    FBM.TWD67toWGS84 = FBM.TWD97_119toWGS84;
    FBM.WGS84toTWD97_119 = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(t, e, r),
        r
    }
    ;
    FBM.WGS84toTWD67 = FBM.WGS84toTWD97_119;
    FBM.TWD97toTWD97_119 = function(n, t) {
        var i = new Proj4js.Point(parseFloat(n),parseFloat(t));
        return Proj4js.transform(u, e, i),
        i
    }
    ;
    FBM.TWD97toTWD67 = FBM.TWD97toTWD97_119;
    FBM.TWD97_119toTWD97 = function(n, t) {
        var i = new Proj4js.Point(parseFloat(n),parseFloat(t));
        return Proj4js.transform(EPSG4325, u, i),
        i
    }
    ;
    FBM.TWD67toTWD97 = FBM.TWD97_119toTWD97;
    FBM.GootoWGS84 = FBM.GooToWGS84 = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(s, t, r),
        r
    }
    ;
    FBM.WGS84toGoo = FBM.WGS84ToGoo = function(n, i) {
        var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
        return Proj4js.transform(t, s, r),
        r
    }
    ;
    FBM.FWTransformation = function() {
        this.twd97towgs84 = function(n, i) {
            var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
            Proj4js.transform(u, t, r);
            this.transResult = new FBM.FWPoint(r.x,r.y)
        }
        ;
        this.wgs84totwd97 = function(n, i) {
            var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
            Proj4js.transform(t, u, r);
            this.transResult = new FBM.FWPoint(r.x,r.y)
        }
        ;
        this.twd97_119towgs84 = function(n, i) {
            var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
            Proj4js.transform(e, t, r);
            this.transResult = new FBM.FWPoint(r.x,r.y)
        }
        ;
        this.wgs84totwd97_119 = function(n, i) {
            var r = new Proj4js.Point(parseFloat(n),parseFloat(i));
            Proj4js.transform(t, e, r);
            this.transResult = new FBM.FWPoint(r.x,r.y)
        }
        ;
        this.transResult = null
    }
}
)();
/*! D:\FW_API\scripts\Graphic.js*/
FBM.Graphic = function() {
    var t = function() {
        this.type = "FWGraphic"
    }, n;
    return FBM.extend(FBM.MVCObject, t),
    n = t.prototype,
    n.triggerEvent = function(n, t) {
        var f = this.getMapBase(), e, o, s, i, h, r, u;
        if (f) {
            e = f.getPackageOffset();
            n.changedTouches && n.changedTouches.length ? (o = n.changedTouches[0].clientX,
            s = n.changedTouches[0].clientY) : (o = n.clientX,
            s = n.clientY);
            i = f.ToMapPoint(o - e.x, s - e.y);
            h = this.getMap().getCoordSys();
            switch (h) {
            case FBM.FWCoordSys.EPSG3857:
                r = FBM.GooToWGS84(i.x, i.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                r = i;
                break;
            case FBM.FWCoordSys.EPSG3825:
                r = i
            }
            u = new FBM.FWMouseEvent(n,t);
            u.point = new FBM.FWPoint(r.x,r.y);
            u.target = this;
            FBM.FWEvent.trigger_(this, t, u)
        }
    }
    ,
    n.onMouseUp = function(n) {
        this.triggerEvent.call(this, n, "mouseup")
    }
    ,
    n.onMouseMove = function(n) {
        this.triggerEvent.call(this, n, "mousemove")
    }
    ,
    n.onMouseDown = function(n) {
        var t, i, r;
        this.__downE = n;
        t = this;
        this.elem.dragWrapper && (this.elem.untouchmove(this.elem.dragWrapper),
        this.elem.unmousemove(this.elem.dragWrapper));
        this.elem.dragEndWrapper && (this.elem.untouchend(this.elem.dragEndWrapper),
        this.elem.unmouseup(this.elem.dragEndWrapper));
        i = function() {
            t.onDrag.apply(t, arguments)
        }
        ;
        r = function() {
            t.onDragEnd.apply(t, arguments)
        }
        ;
        this.elem.dragWrapper = i;
        this.elem.dragEndWrapper = r;
        n instanceof MouseEvent ? (this.triggerEvent.call(this, n, "mousedown"),
        this.elem.mousemove(i),
        this.elem.mouseup(r)) : (this.elem.touchmove(i),
        this.elem.touchend(r))
    }
    ,
    n.onMouseOver = function(n) {
        this.triggerEvent.call(this, n, "mouseover")
    }
    ,
    n.onMouseOut = function(n) {
        this.triggerEvent.call(this, n, "mouseout")
    }
    ,
    n.onDblClick = function(n) {
        this.triggerEvent.call(this, n, "dblclick")
    }
    ,
    n.onClick = function(n) {
        this.triggerEvent.call(this, n, "click")
    }
    ,
    n.onMoved = function(n) {
        this.triggerEvent.call(this, n, "moved")
    }
    ,
    n.isSamePosition = function(n, t) {
        var i, r, u, f;
        return n.changedTouches && t.changedTouches && n.changedTouches.length && t.changedTouches.length ? (i = n.changedTouches[0].screenX,
        r = n.changedTouches[0].screenY,
        u = t.changedTouches[0].screenX,
        f = t.changedTouches[0].screenY) : (i = n.screenX,
        r = n.screenY,
        u = t.screenX,
        f = t.screenY),
        i === u && r === f
    }
    ,
    n.onDrag = function(n) {
        this.isSamePosition(this.__downE, n) || (this.elem.untouchmove(this.elem.dragWrapper),
        this.elem.untouchend(this.elem.dragEndWrapper),
        this.elem.unmousemove(this.elem.dragWrapper),
        this.elem.unmouseup(this.elem.dragEndWrapper))
    }
    ,
    n.onDragEnd = function(n) {
        this.elem.untouchmove(this.elem.dragWrapper);
        this.elem.untouchend(this.elem.dragEndWrapper);
        this.elem.unmousemove(this.elem.dragWrapper);
        this.elem.unmouseup(this.elem.dragEndWrapper);
        n instanceof MouseEvent ? n.button == FBM.FWEvent.RIGHTBUTTON ? (this.map && this.map.setOverlayStopClick(),
        this.triggerEvent.call(this, n, "rightclick")) : n.button == FBM.FWEvent.LEFTBUTTON && (this.map && this.map.setOverlayStopClick(),
        this.triggerEvent.call(this, n, "click")) : (this.map && this.map.setOverlayStopClick(),
        this.triggerEvent.call(this, n, "click"))
    }
    ,
    n.bindEvents = function() {
        if (this.elem = this.getEventElement(),
        this.elem) {
            var n = this;
            this.elem.mouseup(function() {
                n.onMouseUp && n.onMouseUp.apply(n, arguments)
            });
            this.elem.mousemove(function() {
                n.onMouseMove && n.onMouseMove.apply(n, arguments)
            });
            this.elem.mousedown(function() {
                n.onMouseDown && n.onMouseDown.apply(n, arguments)
            });
            this.elem.mouseover(function() {
                n.onMouseOver && n.onMouseOver.apply(n, arguments)
            });
            this.elem.mouseout(function() {
                n.onMouseOut && n.onMouseOut.apply(n, arguments)
            });
            this.elem.dblclick(function() {
                n.onDblClick && n.onDblClick.apply(n, arguments)
            });
            this.elem.touchstart(function() {
                n.onMouseDown && n.onMouseDown.apply(n, arguments)
            })
        }
    }
    ,
    n.annotation = null,
    t
}();
/*! D:\FW_API\scripts\FWGraphic.js*/
FBM.FWGraphic = function() {
    var t = function(n) {
        this.gs_ = [];
        n && (this.geometry = n,
        n.geometry instanceof FBM.FWGeometry && (this.geometry = n.geometry),
        n.properties && (this.properties = n.properties),
        n.id && (this.id = n.id))
    }
      , n = t.prototype;
    return n.id = null,
    n.geometry = null,
    n.originGeometry = null,
    n.properties = null,
    n.style = null,
    n.ownStyle = null,
    n.gs_ = null,
    n.getGeometry = function() {
        return this.geoemtry
    }
    ,
    n.setGeometry = function(n) {
        if (!n) {
            var t = this.geometry;
            this.geometrty = n;
            FBM.FWEvent.trigger_(this, "setgeometry", {
                graphic: this,
                oldGeometry: t,
                newGeometry: value
            })
        }
    }
    ,
    n.getProperty = function(n) {
        if (this.properties)
            return this.properties[n]
    }
    ,
    n.setProperty = function(n, t) {
        if (this.properties && n) {
            var i = this.properties[n];
            this.properties[n] = t;
            FBM.FWEvent.trigger_(this, "setproperty", {
                graphic: this,
                name: n,
                oldValue: i,
                newValue: t
            })
        }
    }
    ,
    n.removeProperty = function(n) {
        if (this.properties && n && n in this.properties) {
            var t = this.properties[n];
            this.properties[n] = undefined;
            FBM.FWEvent.trigger_(this, "removeproperty", {
                graphic: this,
                name: n,
                oldValue: t
            })
        }
    }
    ,
    n.redraw = function(n) {
        this.clear();
        this.draw(n)
    }
    ,
    n.clear = function() {
        for (var n = 0; n < this.gs_.length; n++)
            this.gs_[n].setMap(null),
            delete this.gs_[n];
        this.gs_ = []
    }
    ,
    n.bindEvents = function(n) {
        var t = this;
        FBM.FWEvent.addListener(n, "mousedown", function(n) {
            FBM.FWEvent.trigger_(t, "mousedown", n)
        });
        FBM.FWEvent.addListener(n, "mouseup", function(n) {
            FBM.FWEvent.trigger_(t, "mouseup", n)
        });
        FBM.FWEvent.addListener(n, "mousemove", function(n) {
            FBM.FWEvent.trigger_(t, "mousemove", n)
        });
        FBM.FWEvent.addListener(n, "mouseover", function(n) {
            FBM.FWEvent.trigger_(t, "mouseover", n)
        });
        FBM.FWEvent.addListener(n, "dblclick", function(n) {
            FBM.FWEvent.trigger_(t, "dblclick", n)
        });
        FBM.FWEvent.addListener(n, "click", function(n) {
            FBM.FWEvent.trigger_(t, "click", n)
        });
        FBM.FWEvent.addListener(n, "rightclick", function(n) {
            FBM.FWEvent.trigger_(t, "rightclick", n)
        });
        FBM.FWEvent.addListener(n, "mouseout", function(n) {
            FBM.FWEvent.trigger_(t, "mouseout", n)
        })
    }
    ,
    n.setStyle = function(n) {
        this.style = n;
        this.refreshStyle()
    }
    ,
    n.setOwnStyle = function(n) {
        this.ownStyle = n;
        this.refreshStyle()
    }
    ,
    n.refreshStyle = function() {
        var n = {};
        n = typeof this.style == "function" ? this.style(this) : Object.mergeOptions({}, this.style);
        n = Object.mergeOptions(n, this.ownStyle);
        this.gs_.forEach(function(t) {
            "updateOptions"in t && t.updateOptions(n)
        })
    }
    ,
    n.draw = function(n, t) {
        var t, i, r, u;
        n && (t = t ? t : this.geometry,
        t) && (i = {},
        i = typeof i == "function" ? i(this) : Object.mergeOptions({}, this.style),
        i = Object.mergeOptions(i, this.ownStyle),
        r = null,
        t instanceof FBM.FWPoint ? r = new FBM.FWMarker(n,t,null,null,i) : t instanceof FBM.FWLineString ? r = new FBM.FWLine(n,t,i) : t instanceof FBM.FWPolygon ? r = new FBM.FWFill(n,t,i) : t instanceof FBM.FWMultiGeometry && (u = this,
        t.getArray().forEach(function(t) {
            return u.draw(n, t)
        })),
        r && (this.bindEvents(r),
        this.gs_.push(r)))
    }
    ,
    FBM.RegisterEvent(t, ["setproperty", "removeproperty", "click", "dblclick", "mousedown", "mouseup", "mouseout", "mouseover", "mousemove", "rightclick"]),
    t
}();
/*! D:\FW_API\scripts\FWFill.js*/
(function() {
    function i(n) {
        n.cancelBubble = !0;
        n.stopPropagation && n.stopPropagation()
    }
    var n = function(n, t) {
        var i;
        switch (n) {
        case FBM.FWCoordSys.EPSG3857:
            i = FBM.WGS84ToGoo(t.x, t.y);
            break;
        case FBM.FWCoordSys.EPSG3826:
            i = t;
            break;
        case FBM.FWCoordSys.EPSG3825:
            i = t
        }
        return i
    }
      , t = function(t, i, r, u, f) {
        for (var e = "", l = u.getPath().getPath(), o = FBM.simplifyLineString(l, r), s = f ? n(i, o[o.length - 1]) : n(i, o[0]), h = t.FromMapPoint(s.x, s.y), e = e + "M" + h.x + " " + h.y, c = 0; c < o.length; c++)
            s = n(i, o[c]),
            h = t.FromMapPoint(s.x, s.y),
            e = e + "L" + h.x + " " + h.y;
        return e + " Z "
    };
    FBM.FWFill = function(r, u, f) {
        var d = 2, ft = 0, et = 0, h = r, c, e = u, tt = !0, l = 1, g = 1, v = "#88ff88", ot = "1", nt = "#000000", y = 1, p = "square", w = "miter", b = 1, k = "none", it = 0, rt = "", a = !0, st = null, ht = !0, s, ut, o;
        this.getEventElement = function() {
            return h == null ? null : o
        }
        ;
        s = this;
        this.endDrag = function(n) {
            (s.sclientx - n.clientX > d || s.sclienty - n.clientY > d || s.sclientx - n.clientX < -d || s.sclienty - n.clientY < -d) && (s.dragMoved = !0);
            i(n);
            DetachEvent(document.body, "mousemove", s.markMove, !0);
            DetachEvent(document.body, "mouseup", s.endDrag, !0);
            !s.dragMoved && s.editable ? s.clickCallback != null && s.clickCallback.call(this, s) : s.movedCallback != null && s.movedCallback.call(this, s)
        }
        ;
        this.markMove = function(n) {
            var r, t, u, f, o;
            i(n);
            r = h.getMapBase();
            t = r.getPackageOffset();
            switch (h.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                f = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y);
                o = FBM.GooToWGS84(f.x, f.y);
                u = new FBM.FWPoint(o.x,o.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                u = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
                u = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y)
            }
            var l = u.x - s.spos.x
              , a = u.y - s.spos.y
              , c = e.getBounds()
              , v = c.left - s.senv.left
              , y = c.top - s.senv.top;
            e.transform(1, 0, 0, 1, l - v, a - y);
            s.update();
            s.editable && s.moveCallback != null && s.moveCallback.call(this, s)
        }
        ;
        this.markDrag = function(n) {
            var r, t, f, o, c, u;
            i(n);
            s.sclientx = n.clientX;
            s.sclienty = n.clientY;
            s.dragMoved = !1;
            r = h.getMapBase();
            t = r.getPackageOffset();
            switch (h.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                o = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y);
                c = FBM.GooToWGS84(o.x, o.y);
                f = new FBM.FWPoint(c.x,c.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                f = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
                f = r.ToMapPoint(n.clientX - t.x, n.clientY - t.y)
            }
            s.spos = f;
            u = e.getBounds();
            s.senv = new FBM.FWEnvelope(u.left,u.top,u.right,u.bottom);
            AttachEvent(document.body, "mousemove", s.markMove, !0);
            AttachEvent(document.body, "mouseup", s.endDrag, !0)
        }
        ;
        this.clone = function() {
            var t = {
                opacity: this.getOpacity(),
                fillColor: this.getFillColor(),
                fillOpacity: this.getFillOpacity(),
                fillOutline: this.getFillOutline(),
                strokeColor: this.getStrokeColor(),
                strokeWeight: this.getStrokeWeight(),
                strokeOpacity: this.getStrokeOpacity(),
                strokeLinejoin: this.getStrokeLinejoin(),
                strokeLinecap: this.getStrokeLinecap(),
                strokeDasharray: this.getStrokeDasharray()
            }
              , n = new FBM.FWFill(null,this.getPath(),t);
            return n.setTitle(this.getTitle()),
            n
        }
        ;
        this.setClickCallback = function(n) {
            this.clickCallback = n
        }
        ;
        this.setMoveCallback = function(n) {
            this.moveCallback = n
        }
        ;
        this.setMovedCallback = function(n) {
            this.movedCallback = n
        }
        ;
        this.getEditable = function() {
            return this.editable
        }
        ;
        this.setEditable = function(n) {
            this.editable = n;
            this.setDraggable(n)
        }
        ;
        this.getDraggable = function() {
            return this.draggable
        }
        ;
        this.setDraggable = function(n) {
            if (n !== undefined) {
                if (this.draggable = n,
                !this.elem)
                    return;
                n == !0 && this.elem ? this.elem.mousedown(this.markDrag) : n == !1 && this.elem && this.elem.unmousedown(this.markDrag)
            }
        }
        ;
        this.getVisible = function() {
            return a
        }
        ;
        this.setVisible = function(n) {
            switch (n) {
            case !0:
                a = !0;
                o.show();
                this.redraw();
                this.update();
                break;
            case !1:
                o.hide();
                a = !1;
                this.redraw();
                this.update()
            }
        }
        ;
        this.getAdvancedLayer = function() {
            return c
        }
        ;
        this.setAdvancedLayer = function(n) {
            c = n
        }
        ;
        this.getPaper = function() {
            return c != null ? c.paper.main : h.getPaper()
        }
        ;
        this.getMap = function() {
            return h
        }
        ;
        this.setMap = function(n) {
            if (o && o.remove(),
            n == null) {
                if (!h)
                    return;
                h.overlay.containing(this) && h.overlay.remove(this);
                FBM.FWEvent.clearInstanceListeners(this);
                h = null
            }
            n instanceof FBM.FWOnlineMap && (h = n,
            this.init())
        }
        ;
        this.getPath = function() {
            return e
        }
        ;
        this.setPath = function(n) {
            e = n;
            this.redraw(!0);
            FBM.FWEvent.trigger(this, "position_changed")
        }
        ;
        this.isPointInEnvelope = function(n, t) {
            var r = null
              , i = e;
            return i !== undefined && i != null && (i.getEnvelope && (i = i.getEnvelope()),
            i.left && (r = n >= i.left && n <= i.right && t >= i.bottom && t <= i.top ? !0 : !1)),
            r
        }
        ;
        this.getEnvelope = function() {
            if (this.getPath) {
                var n = this.getPath();
                return n ? n.Envelope !== undefined ? n.Envelope : n : null
            }
            return null
        }
        ;
        this.getBounds = function() {
            if (e)
                return e.getBounds()
        }
        ;
        this.setClickable = function(n) {
            typeof n == "boolean" && (tt = n,
            n ? FBM.FWEvent.releaseEventLock(this, "click") : FBM.FWEvent.lockEvent(this, "click"),
            FBM.FWEvent.trigger(this, "clickable_changed"))
        }
        ;
        this.getOpacity = function() {
            return l
        }
        ;
        this.setOpacity = function(n) {
            l = n;
            o && o.attr({
                opacity: l
            })
        }
        ;
        this.getFillOpacity = function() {
            return g
        }
        ;
        this.setFillOpacity = function(n) {
            g = n;
            o && o.attr({
                "fill-opacity": l
            })
        }
        ;
        this.getFillOutline = function() {
            return ot
        }
        ;
        this.setFillOpacity = function(n) {
            ot = n;
            o && o.attr({
                "stroke-opacity": l
            })
        }
        ;
        this.getTitle = function() {
            return rt
        }
        ;
        this.setTitle = function(n) {
            (rt = n,
            o) && (o.attr({
                title: rt
            }),
            FBM.FWEvent.trigger(this, "title_changed"))
        }
        ;
        this.getClickable = function() {
            return tt
        }
        ;
        this.getFillColor = function() {
            return v
        }
        ;
        this.setFillColor = function(n) {
            v = n;
            o && o.attr({
                fill: v
            })
        }
        ;
        this.getStrokeColor = function() {
            return nt
        }
        ;
        this.setStrokeColor = function(n) {
            nt = n;
            o && o.attr({
                stroke: n
            })
        }
        ;
        this.getStrokeWeight = function() {
            return y
        }
        ;
        this.setStrokeWeight = function(n) {
            y = n;
            o && o.attr({
                "stroke-width": y
            })
        }
        ;
        this.getStrokeOpacity = function() {
            return b
        }
        ;
        this.setStrokeOpacity = function(n) {
            b = n;
            o && o.attr({
                "stroke-opacity": b
            })
        }
        ;
        this.getStrokeLinecap = function() {
            return p
        }
        ;
        this.setStrokeLinecap = function(n) {
            p = n;
            o && o.attr({
                "stroke-linecap": p
            })
        }
        ;
        this.getStrokeLinejoin = function() {
            return w
        }
        ;
        this.setStrokeLinejoin = function(n) {
            w = n;
            o && o.attr({
                "stroke-linejoin": w
            })
        }
        ;
        this.getStrokeDasharray = function() {
            return k
        }
        ;
        this.setStrokeDasharray = function(n) {
            k = n;
            o && o.attr({
                "stroke-dasharray": k
            })
        }
        ;
        this.getZIndex = function() {
            return it
        }
        ;
        this.setZIndex = function(n) {
            typeof n == "number" && o && (it = parseFloat(n),
            h.overlay.updateArrayOrder(this),
            h.overlay.updateElementOrder(this),
            FBM.FWEvent.trigger(this, "zindex_changed"))
        }
        ;
        this.update = function() {
            if (e && h) {
                if (!a) {
                    o.hide();
                    return
                }
                var i = h.getMapBase()
                  , n = this.getAnchorPoint()
                  , t = i.FromMapPoint(n.x, n.y)
                  , r = t.x - ft
                  , u = t.y - et;
                o.transform("t" + r + "," + u)
            }
        }
        ;
        this.createPathStr = function() {
            var i = "", u = h.getCoordSys(), r = h.getMapBase(), o = r.getCellSizeX(), c, l, y, s, f, p, w, b;
            if (u == FBM.FWCoordSys.EPSG3857 && (o = o / 1e6),
            e instanceof FBM.FWPolygon)
                for (i = i + t(r, u, o, e.getExteriorRing()),
                s = e.getInteriorRings(),
                f = 0; f < s.length; f++)
                    i = i + t(r, u, o, s[f], !0);
            else if (e instanceof FBM.FWMultiPolygon) {
                for (c = "",
                l = 0; l < e.getLength(); l++)
                    for (y = e.getArray()[l],
                    c = c + t(r, u, o, y.getExteriorRing()),
                    s = y.getInteriorRings(),
                    f = 0; f < s.length; f++)
                        c = c + t(r, u, o, s[f], !0);
                i = c
            } else if (e instanceof FBM.FWCircle) {
                var k = e.getVertexCount()
                  , d = n(u, e.getCenter())
                  , a = r.FromMapPoint(d.x, d.y)
                  , ct = e.getRadius()
                  , v = r.FromMapDistX(ct)
                  , g = 0
                  , nt = a.x + Math.cos(0) * v
                  , tt = a.y + Math.sin(0) * v;
                for (i = "M" + Math.round(nt) + " " + Math.round(tt),
                p = 360 / k,
                w = p,
                b = 0; b < k; b++) {
                    var g = w / 180 * Math.PI
                      , nt = Math.round(a.x + Math.cos(g) * v)
                      , tt = Math.round(a.y + Math.sin(g) * v);
                    i = i + "L" + nt + " " + tt;
                    w += p
                }
                i += " Z"
            } else if (e instanceof FBM.FWEnvelope) {
                var it = n(u, new FBM.FWPoint(e.left,e.top))
                  , rt = n(u, new FBM.FWPoint(e.right,e.top))
                  , ut = n(u, new FBM.FWPoint(e.right,e.bottom))
                  , ft = n(u, new FBM.FWPoint(e.left,e.bottom))
                  , et = r.FromMapPoint(it.x, it.y)
                  , ot = r.FromMapPoint(rt.x, rt.y)
                  , st = r.FromMapPoint(ut.x, ut.y)
                  , ht = r.FromMapPoint(ft.x, ft.y);
                i = "M" + Math.round(et.x) + " " + Math.round(et.y) + "L" + Math.round(ot.x) + " " + Math.round(ot.y) + "L" + Math.round(st.x) + " " + Math.round(st.y) + "L" + Math.round(ht.x) + " " + Math.round(ht.y) + " Z"
            }
            return i
        }
        ;
        this.getAnchorPoint = function() {
            var t, i = h.getCoordSys();
            return e instanceof FBM.FWPolygon ? t = n(i, e.getExteriorRing().getPath().getPath()[0]) : e instanceof FBM.FWMultiPolygon ? t = n(i, e.getArray()[0].getExteriorRing().getPath().getPath()[0]) : e instanceof FBM.FWCircle ? t = n(i, e.getCenter()) : e instanceof FBM.FWEnvelope && (t = n(i, new FBM.FWPoint(e.left,e.top))),
            t
        }
        ;
        this.redraw = function(n) {
            var r, u, f, s, c;
            if (o && h && e) {
                if (!a) {
                    o.hide();
                    return
                }
                var i = h.getMapBase()
                  , l = h.getCoordSys()
                  , v = h.getRawBound()
                  , t = this.getEnvelope();
                if (l == FBM.FWCoordSys.EPSG3857 && (r = FBM.WGS84ToGoo(t.left, t.top),
                u = FBM.WGS84ToGoo(t.right, t.bottom),
                t = new FBM.FWEnvelope(r.x,r.y,u.x,u.y)),
                !v.Intersect(t))
                    return o.hide();
                if (o.show(),
                !n) {
                    if (st == i.getScale())
                        return this.update();
                    st = i.getScale()
                }
                f = this.getAnchorPoint();
                s = i.FromMapPoint(f.x, f.y);
                ft = s.x;
                et = s.y;
                o.transform("t0,0");
                c = this.createPathStr();
                o.attr({
                    path: c
                })
            }
        }
        ;
        this.getMapBase = function() {
            if (h)
                return h.getMapBase()
        }
        ;
        this.init = function() {
            h && (ut = c === undefined ? h.getPaper() : c.paper.main,
            o = ut.path(""),
            o.attr({
                "stroke-width": y,
                stroke: nt,
                "stroke-opacity": b,
                "stroke-linejoin": w,
                "stroke-linecap": p,
                "stroke-dasharray": k,
                fill: v,
                "fill-opacity": g,
                opacity: l
            }),
            ht && (h.overlay.updateArrayOrder(this),
            h.overlay.updateElementOrder(this)),
            h.overlay.push(this),
            this.bindEvents(o),
            this.redraw(),
            this.setDraggable(this.draggable))
        }
        ;
        f != undefined && (typeof f.advancedLayer != "undefined" && (c = f.advancedLayer),
        typeof f.updateOrder != "undefined" && typeof f.updateOrder == "boolean" && (ht = f.updateOrder),
        typeof f.visible != "undefined" && typeof f.visible == "boolean" && (a = f.visible),
        typeof f.path != "undefined" && f.path instanceof FBM.FWPolygon && (e = f.path),
        typeof f.clickable != "undefined" && typeof f.clickable == "boolean" && (tt = f.clickable),
        typeof f.fillColor != "undefined" && typeof f.fillColor == "string" && (v = f.fillColor),
        typeof f.fillOpacity != "undefined" && typeof f.fillOpacity == "number" && (g = f.fillOpacity),
        typeof f.opacity != "undefined" && typeof f.opacity == "number" && (l = f.opacity),
        typeof f.strokeWeight != "undefined" && typeof f.strokeWeight == "number" && (y = f.strokeWeight),
        typeof f.strokeLinecap != "undefined" && typeof f.strokeLinecap == "string" && (p = f.strokeLinecap),
        typeof f.strokeLinejoin != "undefined" && typeof f.strokeLinejoin == "string" && (w = f.strokeLinejoin),
        typeof f.strokeOpacity != "undefined" && typeof f.strokeOpacity == "number" && (b = f.strokeOpacity),
        typeof f.zIndex != "undefined" && typeof f.zIndex == "number" && (it = f.zIndex),
        typeof f.strokeColor != "undefined" && typeof f.strokeColor == "string" && (nt = f.strokeColor),
        typeof f.strokeDasharray != "undefined" && typeof f.strokeDasharray == "string" && (k = f.strokeDasharray),
        typeof f.draggable != "undefined" && typeof f.draggable == "boolean" && this.setDraggable(f.draggable));
        this.init()
    }
    ;
    FBM.extend(FBM.Graphic, FBM.FWFill);
    FBM.RegisterEvent(FBM.FWFill, ["click", "mousedown", "mouseup", "mousemove", "mouseout", "mouseover", "dblclick", "rightclick", "zindex_changed", "position_changed"])
}
)();
/*! D:\FW_API\scripts\FWLine.js*/
(function() {
    function n(n) {
        n.cancelBubble = !0;
        n.stopPropagation && n.stopPropagation()
    }
    function t(n, t) {
        var r = n.getMapBase()
          , u = r.getPackageOffset()
          , i = r.ToMapPoint(t.clientX - u.x, t.clientY - u.y);
        return n.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? FBM.GooToWGS84(i.x, i.y) : i
    }
    var i = function(n, t) {
        return n == FBM.FWCoordSys.EPSG3857 ? FBM.WGS84ToGoo(t.x, t.y) : t
    };
    FBM.FWLine = function(r, u, f) {
        function ni(n, t) {
            for (var r, u = c / 2, nt = s.getCoordSys(), w = a instanceof FBM.FWMultiLineString ? a.getArray() : [a], y = "", b = "", p = 0; p < w.length; p++)
                if (r = w[p].getPath(),
                ht != null && t != null && (r = ht.call(this, s, r, t)),
                r != null && r.length > 1) {
                    if (r = r.map(function(n) {
                        return i(nt, n)
                    }),
                    v == null && (v = r[0]),
                    r = r.map(function(t) {
                        return {
                            x: (t.x - v.x) / n,
                            y: (t.y - v.y) / n
                        }
                    }),
                    h) {
                        var f = r[0]
                          , d = r[1]
                          , l = r[r.length - 1]
                          , g = r[r.length - 2]
                          , tt = [{
                            p: {
                                x: f.x,
                                y: f.y
                            },
                            d: 1,
                            x: d.x - f.x,
                            y: d.y - f.y
                        }, {
                            p: {
                                x: l.x,
                                y: l.y
                            },
                            d: -1,
                            x: g.x - l.x,
                            y: g.y - l.y
                        }];
                        tt.forEach(function(n) {
                            var t = Math.hypot(n.x, n.y);
                            n.x /= t;
                            n.y /= t;
                            k == "square" && (n.p = {
                                x: n.p.x - u * n.x,
                                y: n.p.y - u * n.y
                            });
                            b += "M" + (n.p.x - u * n.y).toFixed(2) + "," + (n.p.y + u * n.x).toFixed(2) + "L" + (n.p.x + u * n.y).toFixed(2) + "," + (n.p.y - u * n.x).toFixed(2)
                        })
                    }
                    y += "M" + r.map(function(n) {
                        return n.x.toFixed(2) + "," + n.y.toFixed(2)
                    }).join("L")
                }
            e && e.node.setAttribute("d", y);
            o && o.node.setAttribute("d", y);
            h && h.node.setAttribute("d", b)
        }
        var bt = 2, s = r, g, a = u, nt = !0, ct = !0, et = !0, b = 1, c = 1, it = "#000000", y = "none", p = [], k = "square", tt = "round", w = 1, d = null, rt = null, ut, ft = new FBM.FWEnvelope(0,0,0,0), ot = 0, lt = "", v = null, st = null, at = null, vt = null, yt = null, pt = null, e = null, o = null, h = null, ht = null, l = null, wt;
        this.setBeforeDraw = function(n) {
            ht = n
        }
        ;
        this.getBeforeDraw = function() {
            return ht
        }
        ;
        this.setCallOptions = function(n) {
            l = Object.mergeOptions({}, n)
        }
        ;
        this.getCallOptions = function() {
            return Object.mergeOptions({}, l)
        }
        ;
        this.getEnvelope = function() {
            if (this.getPath) {
                var n = this.getPath();
                if (n)
                    return n.Envelope
            }
            return null
        }
        ;
        this.getBounds = function() {
            return this.calEnv(),
            ft
        }
        ;
        var kt = function(i) {
            n(i);
            var r = t(s, i)
              , f = r.x - this.spos.x
              , e = r.y - this.spos.y
              , u = a.Envelope
              , o = u.left - this.senv.left
              , h = u.top - this.senv.top;
            a.transform(1, 0, 0, 1, f - o, e - h);
            this.update();
            this.editable && vt != null && vt.call(this, this)
        }
        .bind(this)
          , dt = function(t) {
            (Math.abs(this.sclientx - t.clientX) > bt || Math.abs(this.sclienty - t.clientY) > bt) && (this.dragMoved = !0);
            n(t);
            DetachEvent(document.body, "mousemove", kt, !0);
            DetachEvent(document.body, "mouseup", dt, !0);
            !this.dragMoved && this.editable ? at != null && at.call(this, this) : yt != null && yt.call(this, this)
        }
        .bind(this)
          , gt = function(i) {
            this.sclientx = i.clientX;
            this.sclienty = i.clientY;
            this.dragMoved = !1;
            this.selected = !1;
            n(i);
            this.spos = t(s, i);
            var r = a.Envelope;
            this.senv = new FBM.FWEnvelope(r.left,r.top,r.right,r.bottom);
            AttachEvent(document.body, "mousemove", kt, !0);
            AttachEvent(document.body, "mouseup", dt, !0)
        }
        .bind(this);
        this.clone = function() {
            var n = new FBM.FWLine(null,this.getPath(),this.getOptions());
            return n.setTitle(this.getTitle()),
            n
        }
        ;
        this.setClickCallback = function(n) {
            at = n
        }
        ;
        this.setMoveCallback = function(n) {
            vt = n
        }
        ;
        this.setMovedCallback = function(n) {
            yt = n
        }
        ;
        this.getEditable = function() {
            return this.editable
        }
        ;
        this.setEditable = function(n) {
            this.editable = n;
            this.setDraggable(n)
        }
        ;
        this.getDraggable = function() {
            return this.draggable
        }
        ;
        this.setDraggable = function(n) {
            (this.draggable = n,
            e) && (n ? e.mousedown(gt) : e.unmousedown(gt))
        }
        ;
        this.isPointInEnvelope = function(n, t) {
            var i = a;
            return i !== undefined && i != null && (i.getEnvelope && (i = i.getEnvelope()),
            i.left) ? n >= i.left && n <= i.right && t >= i.bottom && t <= i.top : !1
        }
        ;
        this.calEnv = function() {
            for (var t = a.getPath(), r = Infinity, u = -Infinity, i = -Infinity, f = Infinity, n = 0; n < t.length; n++)
                r = Math.min(r, t[n].x),
                f = Math.min(f, t[n].y),
                u = Math.max(u, t[n].x),
                i = Math.max(i, t[n].y);
            return ft.left = r,
            ft.right = u,
            ft.top = i,
            ft.bottom = f,
            new FBM.FWEnvelope(r,i,u,i)
        }
        ;
        this.getMap = function() {
            return s
        }
        ;
        this.setMap = function(n) {
            if (e && e.remove(),
            e = null,
            o && o.remove(),
            o = null,
            h && h.remove(),
            h = null,
            n == null) {
                if (!s)
                    return;
                s.overlay.remove(this);
                FBM.FWEvent.clearInstanceListeners(this);
                s = null
            }
            n instanceof FBM.FWOnlineMap && (s = n,
            wt.call(this))
        }
        ;
        this.getPath = function() {
            return a
        }
        ;
        this.setPath = function(n) {
            n instanceof FBM.FWLineString && (a = n,
            v = null,
            this.redraw(),
            FBM.FWEvent.trigger(this, "position_changed"))
        }
        ;
        this.getVisible = function() {
            return nt
        }
        ;
        this.setVisible = function(n) {
            nt = n;
            this.redraw()
        }
        ;
        this.getClickable = function() {
            return et
        }
        ;
        this.setClickable = function(n) {
            typeof n == "boolean" && (et = n,
            n ? FBM.FWEvent.releaseEventLock(this, "click") : FBM.FWEvent.lockEvent(this, "click"),
            FBM.FWEvent.trigger(this, "clickable_changed"))
        }
        ;
        this.getStrokeColor = function() {
            return it
        }
        ;
        this.setStrokeColor = function(n) {
            it = n;
            e && e.attr({
                stroke: it
            })
        }
        ;
        this.getStrokeOpacity = function() {
            return w
        }
        ;
        this.setStrokeOpacity = function(n) {
            w = n;
            e && e.attr({
                "stroke-opacity": w
            });
            o && o.attr({
                "stroke-opacity": w
            });
            h && h.attr({
                "stroke-opacity": w
            })
        }
        ;
        this.getStrokeLinecap = function() {
            return k
        }
        ;
        this.setStrokeLinecap = function(n) {
            k = n;
            e && e.attr({
                "stroke-linecap": k
            });
            o && o.attr({
                "stroke-linecap": k
            })
        }
        ;
        this.getStrokeLinejoin = function() {
            return tt
        }
        ;
        this.setStrokeLinejoin = function(n) {
            tt = n;
            e && e.attr({
                "stroke-linejoin": tt
            });
            o && o.attr({
                "stroke-linejoin": tt
            })
        }
        ;
        this.getOpacity = function() {
            return b
        }
        ;
        this.setOpacity = function(n) {
            b = n;
            e && e.attr({
                opacity: b
            });
            o && o.attr({
                opacity: b
            })
        }
        ;
        this.getStrokeWeight = function() {
            return c
        }
        ;
        this.setStrokeWeight = function(n) {
            c = n;
            "strokeWeight"in l && (l.strokeWeight = c);
            e && e.node.setAttribute("stroke-width", c);
            o && o.node.setAttribute("stroke-width", c + 2)
        }
        ;
        this.getStrokeDasharray = function() {
            return y
        }
        ;
        this.setStrokeDasharray = function(n) {
            y = n;
            y && (p = y.split(/[ ,]/).map(function(n) {
                var t = parseFloat(n);
                return isNaN(t) ? 0 : t
            }));
            e && e.node.setAttribute("stroke-dasharray", p.join(" "));
            o && o.node.setAttribute("stroke-dasharray", p.join(" "))
        }
        ;
        this.getIcons = function() {
            return ut
        }
        ;
        this.setIcons = function(n) {
            ut = n
        }
        ;
        this.getTitle = function() {
            return lt
        }
        ;
        this.setTitle = function(n) {
            lt = n;
            e && e.attr({
                title: lt
            });
            FBM.FWEvent.trigger(this, "title_changed")
        }
        ;
        this.getZIndex = function() {
            return ot
        }
        ;
        this.setZIndex = function(n) {
            typeof n == "number" && e && (ot = parseFloat(n),
            s.overlay.updateElementOrder(this),
            FBM.FWEvent.trigger(this, "zindex_changed"))
        }
        ;
        this.getPaper = function() {
            return g != null ? g.paper.main : s.getPaper()
        }
        ;
        this.getAdvancedLayer = function() {
            return g
        }
        ;
        this.setAdvancedLayer = function(n) {
            g = n
        }
        ;
        this.redraw = function() {
            var f, h, r, t, u, i, w;
            if (a) {
                if (!nt)
                    return this.update();
                var b = s.getCoordSys()
                  , k = s.getRawBound()
                  , n = this.getEnvelope();
                if (b == FBM.FWCoordSys.EPSG3857 && (f = FBM.WGS84ToGoo(n.left, n.top),
                h = FBM.WGS84ToGoo(n.right, n.bottom),
                n = new FBM.FWEnvelope(f.x,f.y,h.x,h.y)),
                ct = k.Intersect(n),
                !ct)
                    return this.update();
                if (r = s.getZoom(),
                v == null || r != st) {
                    st = r;
                    t = l;
                    "leveled"in l && (t = Object.mergeOptions({}, l, l.leveled._, l.leveled[r]));
                    c = t.strokeWeight || c;
                    y = t.strokeDasharray;
                    p = y ? y.split(/[ ,]/).map(function(n) {
                        var t = parseFloat(n);
                        return isNaN(t) ? 0 : t
                    }) : [];
                    e && e.node.setAttribute("stroke-width", c);
                    o && o.node.setAttribute("stroke-width", c + 2);
                    u = {
                        "stroke-dashoffset": (l && l.direction == 1 ? -1 : 1) * 4 * p.reduce(function(n, t) {
                            return n + t
                        }, 0),
                        "stroke-dasharray": p.join(" ")
                    };
                    for (i in u)
                        e && e.node.setAttribute(i, u[i]),
                        o && o.node.setAttribute(i, u[i]);
                    w = s.getMapBase().getCellSizeX();
                    ni.call(this, w, t)
                }
                this.update()
            }
        }
        ;
        this.update = function() {
            var n;
            if (a && e) {
                if (!nt || !ct) {
                    e.node.style.display = "none";
                    o && (o.node.style.display = "none");
                    h && (h.node.style.display = "none");
                    return
                }
                if (e.node.style.display = "",
                o && (o.node.style.display = ""),
                h && (h.node.style.display = ""),
                v) {
                    var r = s.getMapBase()
                      , i = r.FromMapPoint(v.x, v.y)
                      , t = {
                        transform: "matrix(1,0,0,-1," + i.x.toFixed(2) + "," + i.y.toFixed(2) + ")"
                    };
                    for (n in t)
                        e.node.setAttribute(n, t[n]),
                        o && o.node.setAttribute(n, t[n]),
                        h && h.node.setAttribute(n, t[n])
                }
            }
        }
        ;
        wt = function() {
            if (s) {
                v = null;
                st = null;
                var n = s.getPaper();
                g != null && (n = g.paper.main);
                e = n.path();
                ut && (pt = n.createMarker(icons));
                rt && (h = n.path());
                d && (o = n.path());
                this.updateOptions();
                s.overlay.add(this);
                this.bindEvents(e);
                this.redraw();
                this.setDraggable(this.draggable)
            }
        }
        ;
        this.getMapBase = function() {
            if (s)
                return s.getMapBase()
        }
        ;
        this.getGraphicElement = function() {
            return {
                g: [o, e, h],
                s: []
            }
        }
        ;
        this.getEventElement = function() {
            return s == null ? null : e
        }
        ;
        this.updateOptions = function(n) {
            var r, t, i;
            if (n && (n.map instanceof FBM.FWOnlineMap && this.setMap(n.map),
            typeof n.advancedLayer !== undefined && this.setAdvancedLayer(n.advancedLayer),
            typeof n.visible != "undefined" && typeof n.visible == "boolean" && (nt = n.visible ? !0 : !1),
            typeof n.path != "undefined" && n.path instanceof FBM.FWLineString && this.setPath(n.path),
            typeof n.clickable != "undefined" && typeof n.clickable == "boolean" && (et = n.clickable),
            typeof n.opacity != "undefined" && typeof n.opacity == "number" && (b = n.opacity),
            typeof n.strokeWeight != "undefined" && typeof n.strokeWeight == "number" && (c = n.strokeWeight),
            typeof n.strokeOpacity != "undefined" && typeof n.strokeOpacity == "number" && (w = n.strokeOpacity),
            typeof n.zIndex != "undefined" && typeof n.zIndex == "number" && (ot = n.zIndex),
            typeof n.strokeColor != "undefined" && typeof n.strokeColor == "string" && (it = n.strokeColor),
            typeof n.strokeDasharray != "undefined" && typeof n.strokeDasharray == "string" && (y = n.strokeDasharray,
            y && (p = y.split(/[ ,]/).map(function(n) {
                var t = parseFloat(n);
                return isNaN(t) ? 0 : t
            }))),
            typeof n.strokeLinecap != "undefined" && typeof n.strokeLinecap == "string" && (k = n.strokeLinecap),
            typeof n.strokeLinejoin != "undefined" && typeof n.strokeLinejoin == "string" && (tt = n.strokeLinejoin),
            "strokeBorder"in n && (n.strokeBorder == null || typeof n.strokeBorder == "string" || typeof n.strokeBorder == "function") && (d = n.strokeBorder),
            "strokeCap"in n && (n.strokeCap == null || typeof n.strokeCap == "string" || typeof n.strokeCap == "function") && (rt = n.strokeCap),
            typeof n.draggable != "undefined" && typeof n.draggable == "boolean" && this.setDraggable(n.draggable),
            typeof n.beforeDraw != "undefined" && this.setBeforeDraw(n.beforeDraw),
            "icons"in n && (ut = n.icons),
            this.setCallOptions(n)),
            s) {
                if (r = p,
                e) {
                    ut && (t.marker = pt = paper.createMarker(icons, pt));
                    d && !o && (e.node.style["-webkit-filter"] = [[1, 0], [-1, 0], [0, 1], [0, -1]].map(function(n) {
                        return "drop-shadow(" + n[0] + "px " + n[1] + "px 0px " + d + ")"
                    }).join(" "),
                    e.node.style.filter = [[1, 0], [-1, 0], [0, 1], [0, -1]].map(function(n) {
                        return "drop-shadow(" + n[0] + "px " + n[1] + "px 0px " + d + ")"
                    }).join(" "));
                    e.node.setAttribute("stroke", it);
                    e.node.setAttribute("stroke-width", c);
                    o && o.node.setAttribute("stroke", d);
                    o && o.node.setAttribute("stroke-width", c + 2);
                    t = {
                        opacity: b,
                        "stroke-opacity": w,
                        "stroke-dashoffset": (l && l.direction == 1 ? -1 : 1) * 4 * r.reduce(function(n, t) {
                            return n + t
                        }, 0),
                        "stroke-dasharray": r.join(" "),
                        "stroke-linecap": k,
                        "stroke-linejoin": tt
                    };
                    for (i in t)
                        e.node.setAttribute(i, t[i]),
                        o && o.node.setAttribute(i, t[i])
                }
                if (h) {
                    t = {
                        opacity: b,
                        "stroke-opacity": rt ? w : 0,
                        stroke: rt,
                        "stroke-width": 1
                    };
                    for (i in t)
                        h.node.setAttribute(i, t[i])
                }
            }
            v = null;
            st = null
        }
        ;
        this.getOptions = function() {
            return {
                visible: nt,
                clickable: et,
                zIndex: ot,
                opacity: this.getOpacity(),
                strokeWeight: this.getStrokeWeight(),
                strokeOpacity: this.getStrokeOpacity(),
                strokeLinecap: this.getStrokeLinecap(),
                strokeLinejoin: this.getStrokeLinejoin(),
                strokeColor: this.getStrokeColor(),
                strokeDasharray: this.getStrokeDasharray(),
                strokeBorder: d,
                strokeCap: rt,
                draggable: this.getDraggable(),
                icons: this.getIcons()
            }
        }
        ;
        this.updateOptions(f);
        wt.call(this)
    }
    ;
    FBM.extend(FBM.Graphic, FBM.FWLine);
    FBM.RegisterEvent(FBM.FWLine, ["click", "mousedown", "mouseup", "mousemove", "mouseout", "mouseover", "dblclick", "rightclick", "zindex_changed", "position_changed"])
}
)();
/*! D:\FW_API\scripts\FWGOverlay.js*/
(function() {
    FBM.FWGroundOverlay = function(n, t, i, r, u) {
        var s = ["MSIE", "Gecko", "Edge"], h = DeviceTest(), c = 1, e = null, o = null, a, f, l = 0, v = !0, y = this;
        this.map = null;
        this.url = null;
        this.layerID;
        this.params = [];
        this.advancedLayer = null;
        this.advLayer = null;
        this.coordSys = null;
        this.mapBounds = new FBM.FWEnvelope(0,0,0,0);
        this.getUrl = function() {
            var n = null;
            if (this.map) {
                this.mapBounds = this.getMapBound(this.map.getBounds());
                var t = this.map.getMapBase()
                  , i = t.getClientWidth()
                  , r = t.getClientHeight();
                n = this.url + "?Left=" + this.mapBounds.left + "&Top=" + this.mapBounds.top + "&Right=" + this.mapBounds.right + "&Bottom=" + this.mapBounds.bottom + "&Width=" + i + "&Height=" + r;
                this.params.length > 0 && (n += "&" + this.params.join("&"))
            }
            return n
        }
        ;
        this.getMapBound = function(n) {
            var t = new FBM.FWEnvelope(0,0,0,0), i, r;
            if (n !== undefined)
                switch (this.coordSys) {
                case FBM.FWCoordSys.EPSG3857:
                    i = FBM.WGS84ToGoo(n.left, n.top);
                    r = FBM.WGS84ToGoo(n.right, n.bottom);
                    t.left = i.x;
                    t.top = i.y;
                    t.right = r.x;
                    t.bottom = r.y;
                    break;
                case FBM.FWCoordSys.EPSG3826:
                    t = n;
                    break;
                case FBM.FWCoordSys.EPSG3825:
                    t = n
                }
            return t
        }
        ;
        this.getMap = function() {
            return this.map
        }
        ;
        this.getEventElement = function() {
            return f
        }
        ;
        this.getPaper = function() {
            var n = null, t;
            return this.advLayer ? (this.setAdvancedLayer(this.advLayer),
            t = this.getAdvancedLayer(),
            n = t.paper.main) : n = this.map.getPaper(),
            n
        }
        ;
        this.showGraphic = function(n) {
            n.target && n.target.graphic.show()
        }
        ;
        this.setMap = function(n) {
            var t, r, i;
            if (f && (f.node != null && f.node.setAttribute("href", ""),
            f.remove()),
            n == null) {
                if (!this.map)
                    return;
                this.map.overlay.containing(this) && this.map.overlay.remove(this);
                FBM.FWEvent.clearInstanceListeners(this);
                this.removeAdvancedLayer();
                this.map = null;
                return
            }
            if (n instanceof FBM.FWOnlineMap) {
                if (n.overlay.containing(this))
                    return;
                this.map = n;
                this.coordSys = this.map.getCoordSys();
                a = this.getPaper();
                t = null;
                this.url != null ? t = this.getUrl() : (this.mapBounds = this.getMapBound(o),
                t = e.getUrl());
                f = a.image(t, 10, 10, 80, 80);
                r = y;
                this.url != null && (i = f.node,
                i.graphic = f,
                i.setAttribute("externalResourcesRequired", "true"),
                s.indexOf(h) >= 0 || i.addEventListener("load", r.showGraphic));
                f.attr({
                    opacity: c
                });
                this.map.overlay.add(this);
                this.bindEvents(f);
                this.redraw();
                this.update()
            }
        }
        ;
        this.getClickable = function() {
            return v
        }
        ;
        this.setClickable = function(n) {
            typeof n == "boolean" && (v = n,
            n ? FBM.FWEvent.releaseEventLock(this, "click") : FBM.FWEvent.lockEvent(this, "click"),
            FBM.FWEvent.trigger(this, "clickable_changed"))
        }
        ;
        this.getOpacity = function() {
            return c
        }
        ;
        this.setZIndex = function(n) {
            typeof n == "number" && f && (l = parseFloat(n),
            this.map.overlay.updateElementOrder(this),
            FBM.FWEvent.trigger(this, "zindex_changed"))
        }
        ;
        this.getMapBase = function() {
            if (this.map)
                return this.map.getMapBase()
        }
        ;
        this.getZIndex = function() {
            return l
        }
        ;
        this.setOpacity = function(n) {
            typeof n == "number" && n < 1 && n >= 0 && (c = n,
            f && f.attr({
                opacity: n
            }),
            this.redraw(),
            this.update())
        }
        ;
        this.getImage = function() {
            return this.url != null ? this.url : e
        }
        ;
        this.setImage = function(n) {
            var u, i, t;
            if (n instanceof FBM.FWImage) {
                if (e = n,
                !f)
                    return;
                f.attr({
                    src: e.getUrl()
                });
                this.redraw();
                this.update()
            } else if (typeof n == "string" && (this.url = n,
            this.url.indexOf("?") > -1)) {
                var r = this.url.indexOf("?")
                  , s = this.url.substring(0, r)
                  , o = this.url.substr(r + 1, this.url.length - r);
                if (this.url = s,
                o.length > 0)
                    for (u = o.split("&"),
                    i = 0; i < u.length; i++)
                        if (t = u[i],
                        t.length > 0) {
                            if (t.toUpperCase().indexOf("LEFT") >= 0)
                                continue;
                            if (t.toUpperCase().indexOf("TOP") >= 0)
                                continue;
                            if (t.toUpperCase().indexOf("RIGHT") >= 0)
                                continue;
                            if (t.toUpperCase().indexOf("BOTTOM") >= 0)
                                continue;
                            if (t.toUpperCase().indexOf("WIDTH") >= 0)
                                continue;
                            if (t.toUpperCase().indexOf("HEIGHT") >= 0)
                                continue;
                            this.params.push(t)
                        }
            }
        }
        ;
        this.getBounds = function() {
            return o
        }
        ;
        this.setBounds = function(n) {
            n instanceof FBM.FWEnvelope && (o = n,
            this.map && (this.mapBounds = this.getMapBound(o)),
            this.redraw(),
            this.update())
        }
        ;
        this.redraw = function() {
            var r, u, t, i, n, e;
            this.map && (DEBUG_MODE && console.log("redraw"),
            r = this.map.getMapBase(),
            u = r.FromMapPoint(100, 100),
            u.x || u.y) && (t = 1,
            i = 1,
            this.url != null ? (t = r.getClientWidth(),
            i = r.getClientHeight(),
            s.indexOf(h) >= 0 ? (f.node.style.display = "none",
            n = new Image,
            n.addEventListener("load", function() {
                f.node.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", this.src);
                f.node.setAttribute("width", n.width);
                f.node.setAttribute("height", n.height);
                f.node.style.display = "";
                n = null
            }, !1),
            n.src = this.getUrl()) : (f.hide(),
            f.attr({
                width: t,
                height: i,
                src: this.getUrl()
            }))) : (e = this.map.getMapBase().FromMapPoint(this.mapBounds.left, this.mapBounds.top),
            t = Math.abs(this.map.getMapBase().FromMapDistX(Math.abs(this.mapBounds.right - this.mapBounds.left))),
            i = Math.abs(this.map.getMapBase().FromMapDistY(Math.abs(this.mapBounds.bottom - this.mapBounds.top))),
            f.attr({
                x: e.x,
                y: e.y,
                width: t,
                height: i
            })))
        }
        ;
        this.update = function() {
            if (this.map) {
                DEBUG_MODE && console.log("update");
                var n = this.map.getMapBase().FromMapPoint(this.mapBounds.left, this.mapBounds.top);
                f.attr({
                    x: n.x,
                    y: n.y
                });
                s.indexOf(h) >= 0
            }
        }
        ;
        this.getLayerId = function() {
            return this.layerID
        }
        ;
        this.setLayerId = function(n) {
            this.layerID = n
        }
        ;
        this.getAdvancedLayer = function() {
            return this.advancedLayer
        }
        ;
        this.setAdvancedLayer = function(n) {
            this.advLayer = n;
            this.map != null && (this.removeAdvancedLayer(),
            n && (this.advancedLayer = this.map.addIndependentContainer("GOverlay", this)))
        }
        ;
        this.removeAdvancedLayer = function() {
            this.advancedLayer != null && (this.map.removeIndependentContainer(this.advancedLayer),
            this.map.removeAdvancedLayer(this),
            this.advancedLayer = null)
        }
        ;
        this.removeLayer = function() {
            this.removeAdvancedLayer();
            this.map !== undefined && this.map.removeLayer(this)
        }
        ;
        this.getNode = function() {
            if (this.map) {
                if (this.advancedLayer) {
                    var n = this.getAdvancedLayer();
                    return n != null ? [n.div.main, n.div.shadow] : this.map.getPanes().graphicLayer
                }
                return this.map.getPanes().graphicLayer
            }
        }
        ;
        this.setImage(t);
        this.setBounds(i);
        this.setAdvancedLayer(u);
        this.setMap(n);
        this.setZIndex(l);
        this.setOpacity(r);
        this.redraw()
    }
    ;
    FBM.extend(FBM.Graphic, FBM.FWGroundOverlay);
    FBM.RegisterEvent(FBM.FWGroundOverlay, ["zindex_changed", "click", "dblclick", "rightclick", "mousemove", "mousedown", "mouseup", "mouseover", "mouseout"])
}
)();
/*! D:\FW_API\scripts\Geometry.js*/
FBM.FWGeometry = function() {}
;
FBM.Geometry = FBM.FWGeometry;
FBM.FWGeometry.prototype.srs = null;
FBM.FWGeometry.prototype.lon = NaN;
FBM.FWGeometry.prototype.lat = NaN;
FBM.FWGeometry.prototype.getType = function() {
    return this.type
}
;
FBM.FWGeometry.prototype.fromWKT = function(n) {
    var o = function(n, t) {
        return n.slice(0, t.length) == t
    }, y = /^\s*\(?(.*?)\)?\s*$/, h = /\s+/, p = /\s*,\s*/, tt = /\)\s*,\s*\(/, w = /^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/.exec(n), f, s, et, it, rt, g, c, ht, ut, ft, nt, l, a, e, u, r, t, b, i, k, d, v, ct;
    if (!w || w.length <= 0)
        throw "Invalid WKT : " + n;
    if (f = w[1].toUpperCase(),
    s = w[2],
    o(f, "POINT"))
        return b = [],
        i = s.split(h),
        {
            type: "POINT",
            geometry: new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1]))
        };
    if (o(f, "LINESTRING")) {
        for (r = [],
        u = s.split(p),
        t = 0; t < u.length; t++)
            i = u[t].split(h),
            r.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])));
        if (c = new FBM.FWLineString(r),
        c)
            return {
                type: "LINESTRING",
                geometry: c
            }
    } else if (o(f, "POLYGON")) {
        for (l = y.exec(s)[1].split(tt),
        a = [],
        e = 0; e < l.length; e++) {
            for (u = l[e].split(p),
            r = [],
            t = 0; t < u.length; t++)
                b = [],
                i = u[t].split(h),
                r.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])));
            k = new FBM.FWLineString(r);
            d = new FBM.FWLinearRing(k);
            a.push(d)
        }
        if (v = new FBM.FWPolygon(a),
        v)
            return {
                type: "POLYGON",
                geometry: v
            }
    } else {
        if (o(f, "MULTIPOINT")) {
            var et = new sg.geometry.MultiPoint
              , ot = s.split(p)
              , st = [];
            for (t = 0; t < ot.length; t++)
                b = [],
                i = y.exec(ot[t])[1].split(h),
                st.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])));
            return et = FBM.FWMultiPoint(st),
            {
                type: "MULTIPOINT",
                geometry: et
            }
        }
        if (o(f, "MULTILINESTRING")) {
            for (it = y.exec(s)[1].split(tt),
            rt = [],
            g = 0; g < it.length; g++) {
                for (r = [],
                u = it[g].split(p),
                t = 0; t < u.length; t++)
                    i = u[t].split(h),
                    r.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])));
                c = new FBM.FWLineString(r);
                c && rt.push(c)
            }
            return ht = new FBM.FWMultiLineString(rt),
            {
                type: "MULTILINESTRING",
                geometry: ht
            }
        }
        if (o(f, "MULTIPOLYGON")) {
            for (ut = y.exec(s)[1].split(/\)\s*\)\s*,\s*\(\s*\(/),
            ft = [],
            nt = 0; nt < ut.length; nt++) {
                for (l = y.exec(ut[nt])[1].split(tt),
                a = [],
                e = 0; e < l.length; e++) {
                    for (u = l[e].split(p),
                    r = [],
                    t = 0; t < u.length; t++)
                        b = [],
                        i = u[t].split(h),
                        r.push(new FBM.FWPoint(parseFloat(i[0]),parseFloat(i[1])));
                    k = new FBM.FWLineString(r);
                    d = new FBM.FWLinearRing(k);
                    a.push(d)
                }
                v = new FBM.FWPolygon(a);
                v && ft.push(v)
            }
            return ct = new FBM.FWMultiPolygon(ft),
            {
                type: "MULTIPOLYGON",
                geometry: ct
            }
        }
        if (o(f, "GEOMETRYCOLLECTION"))
            return null;
        throw "Unknown WKT geometry type : " + f;
    }
}
;
FBM.FWGeometry.prototype.toWkt = function(n) {
    if (n.toWkt)
        return n.toWkt()
}
;
FBM.FWGeometry.PointToLineSegment = function(n, t, i) {
    var s = 0, l = n.x - t.x, a = n.y - t.y, f = i.x - t.x, e = i.y - t.y, v = l * f + a * e, y = f * f + e * e, o = v / y, r, u;
    o < 0 || t.x == i.x && t.y == i.y ? (s = -1,
    r = t.x,
    u = t.y) : o > 1 ? (s = 1,
    r = i.x,
    u = i.y) : (r = t.x + o * f,
    u = t.y + o * e);
    var h = n.x - r
      , c = n.y - u
      , p = Math.sqrt(h * h + c * c);
    return {
        fit: s,
        point: {
            x: r,
            y: u
        },
        distance: p
    }
}
;
FBM.FWGeometry.Transform = function(n, t) {
    var u, f, r, l, c, i, h, a;
    if (n && t) {
        if (n instanceof FBM.FWPoint)
            return r = t(n.x, n.y),
            new FBM.FWPoint(r.x,r.y);
        if (n instanceof FBM.FWLineString) {
            for (u = [],
            i = 0; i < n.path.length; i++)
                f = n.path[i],
                r = t(f.x, f.y),
                u.push(new FBM.FWPoint(r.x,r.y));
            return new FBM.FWLineString(u)
        }
        if (n instanceof FBM.FWLinearRing)
            return l = FBM.FWGeometry.Transform(n.linestring, t),
            new FBM.FWLinearRing(l);
        if (n instanceof FBM.FWEnvelope) {
            var e = new FBM.FWPoint(n.left,n.top)
              , o = new FBM.FWPoint(n.right,n.bottom)
              , e = FBM.FWGeometry.Transform(e, t)
              , o = FBM.FWGeometry.Transform(o, t);
            return new FBM.FWEnvelope(e.x,e.y,o.x,o.y)
        }
        if (n instanceof FBM.FWCircle) {
            var s = new FBM.FWCircle
              , v = n.getCenter()
              , h = n.getRadius()
              , y = FBM.FWGeometry.Transform(v, t);
            return s.setCenter(y),
            s.setRadius(h),
            s
        }
        if (n instanceof FBM.FWPolygon) {
            for (c = [],
            i = 0; i < n.rings_.length; i++)
                h = n.rings_[i],
                a = FBM.FWGeometry.Transform(h, t),
                c.push(a);
            return new FBM.FWPolygon(c)
        }
    }
}
;
FBM.FWPoint = function(n, t, i) {
    this.srs = i ? i : null;
    this.srs == FBM.FWCoordSys.EPSG3857 && (this.lon = parseFloat(n),
    this.lat = parseFloat(t));
    this.x = parseFloat(n);
    this.y = parseFloat(t);
    this.Envelope = new FBM.FWEnvelope(this.x,this.y,this.x,this.y)
}
;
FBM.extend(FBM.FWGeometry, FBM.FWPoint);
FBM.FWPoint.prototype.transform = function(n, t, i, r, u, f) {
    var e = this.x
      , o = this.y;
    this.x = e * n + o * i + u;
    this.y = e * t + o * r + f
}
;
FBM.FWPoint.prototype.nearestPoint = function(n, t, i) {
    var r = null, f = null, e = Infinity, u;
    if (t !== undefined && (e = t),
    u = !0,
    i.snapPoint !== undefined && (u = i.snapPoint),
    n instanceof FBM.FWPoint && u) {
        var a = n.x
          , v = n.y
          , o = this.x
          , s = this.y
          , h = a - o
          , c = v - s
          , l = Math.sqrt(h * h + c * c);
        l <= e && (r = new FBM.FWPoint(o,s),
        f = l)
    }
    return r != null ? {
        point: r,
        distance: f
    } : null
}
;
FBM.FWPoint.prototype.isEmpty = function() {
    return IsNumeric(this.x) || IsNumeric(this.y) ? !0 : !1
}
;
FBM.FWPoint.prototype.setEmpty = function() {
    this.x = null;
    this.y = null
}
;
FBM.FWPoint.prototype.isSimple = function() {
    return !0
}
;
FBM.FWPoint.prototype.getEnvelope = function() {
    return this.Envelope
}
;
FBM.FWPoint.prototype.getBounds = function() {
    return this.Envelope
}
;
FBM.FWPoint.prototype.type = "FWPoint";
FBM.FWPoint.prototype.toGeoJson = function() {
    return {
        type: "Point",
        coordinates: [this.x, this.y]
    }
}
;
FBM.FWPoint.prototype.toWkt = function() {
    return "POINT(" + this.x + " " + this.y + ")"
}
;
FBM.FWSize = function(n, t) {
    this.width = parseFloat(n);
    this.height = parseFloat(t)
}
;
FBM.FWEnvelope = function(n, t, i, r) {
    this.left = parseFloat(n);
    this.right = parseFloat(i);
    this.top = parseFloat(t);
    this.bottom = parseFloat(r);
    this.renderer = null
}
;
FBM.extend(FBM.FWGeometry, FBM.FWEnvelope);
FBM.FWEnvelope.prototype.type = "FWEnvelope";
FBM.FWEnvelope.prototype.Intersect = function(n) {
    return (n instanceof FBM.FWEnvelope) ? n.left && (this.left == null || this.left > n.right == this.right > this.left) ? !1 : n.top && (this.top == null || this.top < n.bottom == this.bottom < this.top) ? !1 : n.right && (this.right == null || this.right < n.left == this.left < this.right) ? !1 : n.bottom && (this.bottom == null || this.bottom > n.top == this.top > this.bottom) ? !1 : !0 : !1
}
;
FBM.FWEnvelope.prototype.Extend = function(n) {
    n instanceof FBM.FWEnvelope && (n.left && (this.left == null || this.left > n.left == this.right >= this.left) && (this.left = n.left),
    n.top && (this.top == null || this.top < n.top == this.bottom <= this.top) && (this.top = n.top),
    n.right && (this.right == null || this.right < n.right == this.left <= this.right) && (this.right = n.right),
    n.bottom && (this.bottom == null || this.bottom > n.bottom == this.top >= this.bottom) && (this.bottom = n.bottom))
}
;
FBM.FWEnvelope.prototype.Shrink = function(n) {
    n.constructor == FBM.FWEnvelope && (n.left && (this.left == null || this.left < n.left == this.right >= this.left) && (this.left = n.left),
    n.top && (this.top == null || this.top > n.top == this.bottom <= this.top) && (this.top = n.top),
    n.right && (this.right == null || this.right > n.right == this.left <= this.right) && (this.right = n.right),
    n.bottom && (this.bottom == null || this.bottom < n.bottom == this.top >= this.bottom) && (this.bottom = n.bottom))
}
;
FBM.FWEnvelope.prototype.toString = function() {
    return Math.min(this.left, this.right) + " " + Math.min(this.top, this.bottom) + "," + Math.max(this.left, this.right) + " " + Math.max(this.top, this.bottom)
}
;
FBM.FWEnvelope.prototype.nearestPoint = function(n, t, i) {
    var u = null, f = null, e = Infinity, r;
    if (t !== undefined && (e = t),
    n instanceof FBM.FWPoint) {
        var s = new FBM.FWPoint(this.left,this.top)
          , h = new FBM.FWPoint(this.right,this.top)
          , c = new FBM.FWPoint(this.right,this.bottom)
          , l = new FBM.FWPoint(this.left,this.bottom)
          , a = new FBM.FWPoint(this.left,this.top)
          , v = [s, h, c, l, a]
          , o = new FBM.FWLineString(v);
        o.nearestPoint && (r = o.nearestPoint(n, e, i),
        r != null && (r.point != null && (u = r.point),
        r.distance != null && (f = r.distance)))
    }
    return u != null ? {
        point: u,
        distance: f
    } : null
}
;
FBM.FWEnvelope.prototype.transform = function(n, t, i, r, u, f) {
    var e = new FBM.FWPoint(this.left,this.top)
      , o = new FBM.FWPoint(this.right,this.bottom);
    e.transform(n, t, i, r, u, f);
    o.transform(n, t, i, r, u, f);
    this.left = e.x;
    this.top = e.y;
    this.right = o.x;
    this.bottom = o.y;
    this.renderer && this.renderer.redraw()
}
;
FBM.FWEnvelope.prototype.isEmpty = function() {
    var n = IsNumeric(this.left)
      , t = IsNumeric(this.top)
      , i = IsNumeric(this.right)
      , r = IsNumeric(this.bottom);
    return n == !0 && t == !0 && i == !0 && r == !0 ? !0 : !1
}
;
FBM.FWEnvelope.prototype.setEmpty = function() {
    this.left = null;
    this.top = null;
    this.right = null;
    this.bottom = null
}
;
FBM.FWEnvelope.prototype.getLeft = function() {
    return this.left
}
;
FBM.FWEnvelope.prototype.getTop = function() {
    return this.top
}
;
FBM.FWEnvelope.prototype.getRight = function() {
    return this.right
}
;
FBM.FWEnvelope.prototype.getBottom = function() {
    return this.bottom
}
;
FBM.FWEnvelope.prototype.setLeft = function(n) {
    this.left = n
}
;
FBM.FWEnvelope.prototype.setTop = function(n) {
    this.top = n
}
;
FBM.FWEnvelope.prototype.setRight = function(n) {
    this.right = n
}
;
FBM.FWEnvelope.prototype.setBottom = function(n) {
    this.bottom = n
}
;
FBM.FWEnvelope.prototype.getWidth = function() {
    return Math.abs(this.left - this.right)
}
;
FBM.FWEnvelope.prototype.getHeight = function() {
    return Math.abs(this.top - this.bottom)
}
;
FBM.FWEnvelope.prototype.getEnvelope = function() {
    return this
}
;
FBM.FWEnvelope.prototype.getBounds = function() {
    return this
}
;
FBM.FWEnvelope.prototype.contains = function(n) {
    return n.x >= this.left && n.x <= this.right && n.y >= this.bottom && n.y <= this.top
}
;
FBM.FWLineString = function(n) {
    this.path = n;
    this.renderer = null;
    this.Envelope = new FBM.FWEnvelope(0,0,0,0);
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWGeometry, FBM.FWLineString);
FBM.FWLineString.prototype.type = "FWLineString";
FBM.FWLineString.prototype.nearestPoint = function(n, t, i) {
    var s = null, e = null, l = Infinity, h, c, f, r, b, k, o, u;
    if (t !== undefined && (l = t),
    h = !0,
    i.snapEdge !== undefined && (h = i.snapEdge),
    c = !0,
    i.snapVertex !== undefined && (c = i.snapVertex),
    n instanceof FBM.FWPoint && (h || c)) {
        if (c) {
            var y = n.x, p = n.y, r = Infinity, f;
            for (u = 0; u < this.path.length; u++) {
                var a = this.path[u].x
                  , v = this.path[u].y
                  , w = Math.sqrt((y - a) * (y - a) + (p - v) * (p - v));
                w < r && (r = w,
                f = new FBM.FWPoint(a,v))
            }
            r <= l && (s = new FBM.FWPoint(f.x,f.y),
            e = r)
        }
        if (h) {
            for (r = Infinity,
            u = 0; u < this.path.length - 1; u++)
                b = this.path[u],
                k = this.path[u + 1],
                o = FBM.FWGeometry.PointToLineSegment(n, b, k),
                o.fit == 0 && o.distance < r && (r = o.distance,
                f = new FBM.FWPoint(o.point.x,o.point.y));
            r <= l && (e != null ? r < e && (s = new FBM.FWPoint(f.x,f.y),
            e = r) : (s = new FBM.FWPoint(f.x,f.y),
            e = r))
        }
    }
    return s != null ? {
        point: s,
        distance: e
    } : null
}
;
FBM.FWLineString.prototype.getPath = function() {
    return this.path
}
;
FBM.FWLineString.prototype.setPath = function(n) {
    this.path = n;
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWLineString.prototype.isEmpty = function() {}
;
FBM.FWLineString.prototype.setEmpty = function() {}
;
FBM.FWLineString.prototype.getLength = function() {
    for (var t = 0, u = 0, i = 0, r = 0, n = 0; n < this.path.length - 1; n++)
        i = this.path[n].x - this.path[n + 1].x,
        r = this.path[n].y - this.path[n + 1].y,
        u = Math.sqrt(i * i + r * r),
        t = t + u;
    return t
}
;
FBM.FWLineString.prototype.startPoint = function() {
    return this.path[0]
}
;
FBM.FWLineString.prototype.endPoint = function() {
    return this.path[this.path.length - 1]
}
;
FBM.FWLineString.prototype.isSimple = function() {}
;
FBM.FWLineString.prototype.transform = function(n, t, i, r, u, f) {
    for (var e = 0; e < this.path.length; e++)
        this.path[e].transform(n, t, i, r, u, f);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWLineString.prototype.value = function(n) {
    return this.path[n]
}
;
FBM.FWLineString.prototype.getEnvelope = function() {
    return this.Envelope
}
;
FBM.FWLineString.prototype.getBounds = function() {
    return this.Envelope
}
;
FBM.FWLineString.prototype.isClosed = function() {
    return this.path[0].x == this.path[this.path.length - 1].x && this.path[0].y == this.path[this.path.length - 1].y ? !0 : !1
}
;
FBM.FWLineString.prototype.updateEnvelope = function() {
    for (var t = this.path, i = Infinity, r = -Infinity, u = -Infinity, f = Infinity, n = 0; n < t.length; n++)
        i = Math.min(i, t[n].x),
        f = Math.min(f, t[n].y),
        r = Math.max(r, t[n].x),
        u = Math.max(u, t[n].y);
    this.Envelope.setLeft(i);
    this.Envelope.setRight(r);
    this.Envelope.setTop(u);
    this.Envelope.setBottom(f)
}
;
FBM.FWLineString.prototype.toGeoJson = function() {
    for (var t = [], n = 0; n < this.path.length; n++)
        t.push([this.path[n].x, this.path[n].y]);
    return {
        type: "LineString",
        coordinates: t
    }
}
;
FBM.FWLineString.prototype.toWkt = function() {
    for (var n = "LINESTRING(", t = 0; t < this.path.length; t++)
        n += this.path[t].x + " " + this.path[t].y + ",";
    return n[n.length - 1] == "," && (n = n.substring(0, n.length - 1)),
    n + ")"
}
;
FBM.FWLinearRing = function(n) {
    this.linestring = n;
    this.linestring.updateEnvelope();
    this.renderer = null
}
;
FBM.extend(FBM.FWGeometry, FBM.FWLinearRing);
FBM.FWLinearRing.prototype.nearestPoint = function(n, t, i) {
    var r = this.getPath();
    return r !== undefined && r.nearestPoint ? r.nearestPoint(n, t, i) : null
}
;
FBM.FWLinearRing.prototype.getPath = function() {
    return this.linestring
}
;
FBM.FWLinearRing.prototype.setPath = function(n) {
    this.linestring = n;
    this.linestring.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWLinearRing.prototype.getBounds = function() {
    return this.linestring.getBounds()
}
;
FBM.FWLinearRing.prototype.getEnvelope = function() {
    return this.linestring.getEnvelope()
}
;
FBM.FWLinearRing.prototype.type = "FWLinearRing";
FBM.FWPolygon = function(n) {
    this.rings_ = n;
    this.empty_ = !0;
    this.extIdx = 0;
    this.ext_ = n[this.extIdx];
    this.renderer = n.renderer;
    this.Envelope = new FBM.FWEnvelope(0,0,0,0);
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWGeometry, FBM.FWPolygon);
FBM.FWPolygon.prototype.type = "FWPolygon";
FBM.FWPolygon.prototype.nearestPoint = function(n, t, i) {
    var o = null, c = null, l = Infinity, u, s, f, h, r, a, e;
    for (t !== undefined && (l = t),
    u = Infinity,
    f = 0; f < this.rings_.length; f++)
        h = this.rings_[f],
        h.nearestPoint && (r = h.nearestPoint(n, t, i),
        r != null && (r.point != null && (a = r.point),
        r.distance != null && (e = r.distance),
        e != null && e < u && (s = a,
        u = e)));
    return u <= l && (o = new FBM.FWPoint(s.x,s.y),
    c = u),
    o != null ? {
        point: o,
        distance: c
    } : null
}
;
FBM.FWPolygon.prototype.getEnvelope = function() {
    return this.Envelope
}
;
FBM.FWPolygon.prototype.getBounds = function() {
    return this.Envelope
}
;
FBM.FWPolygon.prototype.isEmpty = function() {
    return !0
}
;
FBM.FWPolygon.prototype.setEmpty = function() {
    this.empty_ = !0
}
;
FBM.FWPolygon.prototype.getArea = function() {
    for (var n, u = 0, t = this.rings_[this.extIdx].getPath().getPath(), f = t.length, i = t[f - 1], r = 0; r < f; r++)
        n = t[r],
        u += n.x * i.y - i.x * n.y,
        i = n;
    return Math.abs(u * .5)
}
;
FBM.FWPolygon.prototype.isSimple = function() {}
;
FBM.FWPolygon.prototype.updateEnvelope = function() {
    for (var t, n, i = Infinity, r = -Infinity, u = -Infinity, f = Infinity, e = 0; e < this.rings_.length; e++)
        for (t = this.rings_[e].getPath().getPath(),
        n = 0; n < t.length; n++)
            i = Math.min(i, t[n].x),
            f = Math.min(f, t[n].y),
            r = Math.max(r, t[n].x),
            u = Math.max(u, t[n].y);
    this.Envelope.left = i;
    this.Envelope.right = r;
    this.Envelope.top = u;
    this.Envelope.bottom = f
}
;
FBM.FWPolygon.prototype.transform = function(n, t, i, r, u, f) {
    for (var e = 0; e < this.rings_.length; e++)
        this.rings_[e].getPath().transform(n, t, i, r, u, f);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWPolygon.prototype.setExterior = function(n) {
    this.extIdx = this.rings_[this.rings_.indexOf(n)];
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWPolygon.prototype.setInterior = function(n, t) {
    this.rings_[n].setPath(t)
}
;
FBM.FWPolygon.prototype.addInterior = function(n) {
    this.rings_.push(n);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWPolygon.prototype.removeInterior = function(n) {
    this.rings_.splice(n, 1);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWPolygon.prototype.removeAllInterior = function() {
    var n = this.rings_.length - this.extIdx + 1;
    this.rings_.splice(0, this.extIdx);
    this.rings_.splice(1, n);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWPolygon.prototype.getExteriorRing = function() {
    return this.rings_[this.extIdx]
}
;
FBM.FWPolygon.prototype.getInteriorRings = function() {
    var n = this.rings_.slice(0, this.extIdx)
      , t = this.rings_.slice(this.extIdx + 1, this.rings_.length - this.extIdx + 1);
    return n.concat(t)
}
;
FBM.FWPolygon.prototype.getNumInteriorRing = function() {
    return path_.length - 1
}
;
FBM.FWPolygon.prototype.type = "FWPolygon";
FBM.FWPolygon.prototype.toGeoJson = function() {
    for (var r, t, n, u = [], i = 0; i < this.rings_.length; i++) {
        for (r = [],
        t = this.rings_[i].getPath().getPath(),
        n = 0; n < t.length; n++)
            r.push([t[n].x, t[n].y]);
        u.push(r)
    }
    return {
        type: "Polygon",
        coordinates: u
    }
}
;
FBM.FWPolygon.prototype.toWkt = function() {
    for (var i, t, n = "POLYGON(", r = 0; r < this.rings_.length; r++) {
        for (n += "(",
        i = this.rings_[r].getPath().getPath(),
        t = 0; t < i.length; t++)
            n += i[t].x + " " + i[t].y + ",";
        n[n.length - 1] == "," && (n = n.substring(0, n.length - 1));
        n += "),"
    }
    return n[n.length - 1] == "," && (n = n.substring(0, n.length - 1)),
    n + ")"
}
;
FBM.FWCircle = function() {
    var i = 36
      , t = new FBM.FWPoint(0,0)
      , n = 0;
    this.renderer = null;
    this.getBounds = function(i) {
        if (i == FBM.FWCoordSys.EPSG3857) {
            var r = FBM.WGS84ToGoo(t.x, t.y)
              , e = r.x - n
              , o = r.x + n
              , s = r.y + n
              , h = r.y - n
              , u = FBM.GooToWGS84(e, s)
              , f = FBM.GooToWGS84(o, h);
            return new FBM.FWEnvelope(u.x,u.y,f.x,f.y)
        }
        return new FBM.FWEnvelope(t.x - n,t.y + n,t.x + n,t.y - n)
    }
    ;
    this.setCenter = function(n) {
        n instanceof FBM.FWPoint && (t = n,
        this.renderer && this.renderer.update())
    }
    ;
    this.getCenter = function() {
        return t
    }
    ;
    this.setRadius = function(t) {
        typeof t == "number" && (n = t,
        this.renderer && this.renderer.redraw())
    }
    ;
    this.getRadius = function() {
        return n
    }
    ;
    this.setVertexCount = function(n) {
        typeof n == "number" && (i = n,
        i < 30 && (i = 30),
        i > 120 && (i = 120),
        this.renderer && this.renderer.redraw())
    }
    ;
    this.getVertexCount = function() {
        return i
    }
    ;
    this.transform = function(n, i, r, u, f, e) {
        t.transform(n, i, r, u, f, e);
        this.renderer && this.renderer.redraw()
    }
}
;
FBM.extend(FBM.FWGeometry, FBM.FWCircle);
FBM.FWCircle.prototype.type = "FWCircle";
FBM.FWCircle.prototype.nearestPoint = function(n, t, i) {
    var a = null, w = null, s = Infinity, h, c, r, u;
    if (t !== undefined && (s = t),
    h = !0,
    i.snapPoint !== undefined && (h = i.snapPoint),
    c = !0,
    i.snapEdge !== undefined && (c = i.snapEdge),
    r = Infinity,
    u = null,
    n instanceof FBM.FWPoint && (c || h)) {
        var f = this.getCenter()
          , l = this.getRadius()
          , v = n.x - f.x
          , y = n.y - f.y
          , e = Math.sqrt(v * v + y * y);
        if (h && e <= s && (r = e,
        u = new FBM.FWPoint(f.x,f.y)),
        c) {
            var o = Infinity
              , p = null
              , b = l / e
              , k = f.x + v * b
              , d = f.y + y * b;
            p = new FBM.FWPoint(k,d);
            o = e - l > 0 ? e - l : l - e;
            o <= s && (u != null ? o < r && (r = o,
            u = p) : (r = o,
            u = p))
        }
    }
    return r <= s && (a = new FBM.FWPoint(u.x,u.y),
    w = r),
    a != null ? {
        point: a,
        distance: w
    } : null
}
;
FBM.FWMultiGeometry = function() {}
;
FBM.extend(FBM.FWGeometry, FBM.FWMultiGeometry);
FBM.FWMultiGeometry.prototype.getArray = function() {
    return this.geoms
}
;
FBM.FWMultiGeometry.prototype.getAt = function(n) {
    return this.geoms[n]
}
;
FBM.FWMultiGeometry.prototype.getLength = function() {
    return this.geoms.length
}
;
FBM.FWMultiGeometry.prototype.getBounds = function() {
    return this.Envelope
}
;
FBM.FWMultiGeometry.prototype.getEnvelope = function() {
    return this.Envelope
}
;
FBM.FWMultiGeometry.prototype.transform = function(n, t, i, r, u, f) {
    for (var e = 0; e < this.geoms.length; e++)
        this.geoms[e].transform(n, t, i, r, u, f);
    this.updateEnvelope();
    this.renderer && this.renderer.redraw()
}
;
FBM.FWMultiGeometry.prototype.updateEnvelope = function() {
    var t, e, n;
    if (!this.geoms || !this.geoms.length)
        return null;
    var i = Infinity
      , r = -Infinity
      , u = -Infinity
      , f = Infinity;
    for (t = 0; t < this.geoms.length; t++)
        e = this.geoms[t],
        n = e.getBounds(),
        i = Math.min(i, n.left),
        r = Math.max(r, n.top),
        u = Math.max(u, n.right),
        f = Math.min(f, n.bottom);
    this.Envelope = new FBM.FWEnvelope(i,r,u,f)
}
;
FBM.FWMultiPoint = function(n) {
    this.geoms = n;
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWMultiGeometry, FBM.FWMultiPoint);
FBM.FWMultiPoint.prototype.type = "FWMultiPoint";
FBM.FWMultiPoint.prototype.toGeoJson = function() {
    for (var t, i = [], n = 0; n < this.geoms.length; n++)
        t = this.geoms[n],
        i.push([t.x, t.y]);
    return {
        type: "MultiPoint",
        coordinates: i
    }
}
;
FBM.FWMultiPoint.prototype.toWkt = function() {
    for (var n = "MULTIPOINT(", t = 0; t < this.geoms.length; t++)
        n += this.geoms[t].x + " " + this.geoms[t].y + ",";
    return n[n.length - 1] == "," && (n = n.substring(0, n.length - 1)),
    n + ")"
}
;
FBM.FWMultiPolygon = function(n) {
    this.geoms = n;
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWMultiGeometry, FBM.FWMultiPolygon);
FBM.FWMultiPolygon.prototype.type = "FWMultiPolygon";
FBM.FWMultiPolygon.prototype.toGeoJson = function() {
    for (var u, f, t, e, i, n, o = [], r = 0; r < this.geoms.length; r++) {
        for (u = this.geoms[r],
        f = [],
        t = 0; t < u.rings_.length; t++) {
            for (e = [],
            i = u.rings_[t].getPath().getPath(),
            n = 0; n < i.length; n++)
                e.push([i[n].x, i[n].y]);
            f.push(e)
        }
        o.push(f)
    }
    return {
        type: "MultiPolygon",
        coordinates: o
    }
}
;
FBM.FWMultiPolygon.toWkt = function() {
    for (var f, i, r, t, n = "MULTIPOLYGON(", u = 0; u < this.geoms.length; u++) {
        for (n += "(",
        f = this.geoms[u],
        i = 0; i < f.rings_.length; i++) {
            for (n += "(",
            r = f.rings_[i].getPath().getPath(),
            t = 0; t < r.length; t++)
                n += r[t].x + " " + r[t].y + ",";
            n[n.length - 1] == "," && (n = n.substring(0, n.length - 1));
            n += "),"
        }
        n[n.length - 1] == "," && (n = n.substring(0, n.length - 1));
        n += "),"
    }
    return n[n.length - 1] == "," && (n = n.substring(0, n.length - 1)),
    n + ")"
}
;
FBM.FWMultiLineString = function(n) {
    this.geoms = n;
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWMultiGeometry, FBM.FWMultiLineString);
FBM.FWMultiLineString.prototype.type = "FWMultiLineString";
FBM.FWMultiLineString.prototype.toGeoJson = function() {
    for (var i, r, n, u, f = [], t = 0; t < this.geoms.length; t++) {
        for (i = this.geoms[t],
        r = [],
        n = 0; n < i.path.length; n++)
            u = i.path[n],
            r.push([u.x, u.y]);
        f.push(r)
    }
    return {
        type: "MultiLineString",
        coordinates: f
    }
}
;
FBM.FWMultiLineString.prototype.toWkt = function() {
    for (var i, t, n = "MULTILINESTRING(", r = 0; r < this.geoms.length; r++) {
        for (n += "(",
        i = this.geoms[r],
        t = 0; t < i.path.length; t++)
            n += i.path[t].x + " " + i.path[t].y + ",";
        n[n.length - 1] == "," && (n = n.substring(0, n.length - 1));
        n += "),"
    }
    return n[n.length - 1] == "," && (n = n.substring(0, n.length - 1)),
    n + ")"
}
;
FBM.FWGeometryCollection = function(n) {
    this.geoms = n;
    this.updateEnvelope()
}
;
FBM.extend(FBM.FWMultiGeometry, FBM.FWGeometryCollection);
FBM.FWGeometryCollection.prototype.type = "FWGeometryCollection";
FBM.FWGeometryCollection.prototype.toGeoJson = function() {
    for (var i, t = [], n = 0; n < this.geoms.length; n++)
        i = this.geoms[n],
        t.push(i.toGeoJson());
    return {
        type: "GeometryCollection",
        geometries: t
    }
}
;
/*! D:\FW_API\scripts\FWSpherical.js*/
FBM.FWGeometry.FWSpherical = function() {
    var n = {}
      , t = 6378137;
    return n.EARTH_RADIUS = 6378137,
    n.computeSignedArea = function(n, i) {
        for (var f, e, o = typeof i == "number" ? i : t, s = 0, u = n.length, h = n[u - 1].x, c = n[u - 1].y, r = 0; r < u; r++)
            f = n[r].x,
            e = n[r].y,
            s += FBM.math.toRadian(f - h) * (2 + Math.sin(FBM.math.toRadian(c)) + Math.sin(FBM.math.toRadian(e))),
            h = f,
            c = e;
        return s * o * o / 2
    }
    ,
    n.computeArea = function(t, i) {
        return Math.abs(n.computeSignedArea(t), i)
    }
    ,
    n.computeDistanceBetween = function(n, i, r) {
        var e = typeof r == "number" ? r : t
          , u = FBM.math.toRadian(n.y)
          , f = FBM.math.toRadian(i.y)
          , o = FBM.math.toRadian(i.x - n.x);
        return e * Math.acos(Math.sin(u) * Math.sin(f) + Math.cos(u) * Math.cos(f) * Math.cos(o))
    }
    ,
    n.computeHeading = function(n, t) {
        var r = FBM.math.toRadian(n.y)
          , i = FBM.math.toRadian(t.y)
          , u = FBM.math.toRadian(t.x - n.x)
          , f = Math.sin(u) * Math.cos(i)
          , e = Math.cos(r) * Math.sin(i) - Math.sin(r) * Math.cos(i) * Math.cos(u);
        return FBM.math.toDegree(Math.atan2(f, e))
    }
    ,
    n.computeLength = function(t, i) {
        for (var u = 0, r = 0; r < t.length - 1; r++)
            u += n.computeDistanceBetween(t[r], t[r + 1], i);
        return u
    }
    ,
    n.computeOffset = function(n, i, r, u) {
        var h = typeof u == "number" ? u : t
          , o = FBM.math.toRadian(r)
          , f = FBM.math.toRadian(n.y)
          , c = FBM.math.toRadian(n.x)
          , e = i / h
          , s = Math.asin(Math.sin(f) * Math.cos(e) + Math.cos(f) * Math.sin(e) * Math.cos(o))
          , l = c + Math.atan2(Math.sin(o) * Math.sin(e) * Math.cos(f), Math.cos(e) - Math.sin(f) * Math.sin(s));
        return new FBM.FWPoint(FBM.math.toDegree(l),FBM.math.toDegree(s))
    }
    ,
    n.interpolate = function(n, t, i) {
        var s = FBM.math.toRadian(n.y)
          , e = FBM.math.toRadian(n.x)
          , h = FBM.math.toRadian(t.y)
          , c = FBM.math.toRadian(t.x)
          , u = Math.cos(s)
          , f = Math.sin(s)
          , o = Math.cos(h)
          , l = Math.sin(h)
          , a = Math.cos(c - e)
          , r = f * l + u * o * a;
        if (1 <= r)
            return t.slice();
        r = i * Math.acos(r);
        var v = Math.cos(r)
          , y = Math.sin(r)
          , b = Math.sin(c - e) * o
          , k = u * l - f * o * a
          , p = Math.atan2(b, k)
          , w = Math.asin(f * v + u * y * Math.cos(p))
          , d = e + Math.atan2(Math.sin(p) * y * u, v - f * Math.sin(w));
        return new FBM.FWPoint(FBM.math.toDegree(d),FBM.math.toDegree(w))
    }
    ,
    n
}();
/*! D:\FW_API\scripts\FWLabel.js*/
(function() {
    function t(n) {
        n.cancelBubble = !0;
        n.stopPropagation && n.stopPropagation()
    }
    FBM.FWLabel = function(n) {
        var r = 2
          , i = this;
        this.toMapPoint = function(n, t) {
            var r, e = i.map.getMapBase(), o = e.getPackageOffset(), u = e.ToMapPoint(n - o.x, t - o.y), f;
            switch (i.map.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                f = FBM.GooToWGS84(u.x, u.y);
                r = new FBM.FWPoint(f.x,f.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                r = u;
                break;
            case FBM.FWCoordSys.EPSG3825:
                r = u
            }
            return r
        }
        ;
        this.endDrag = function(n) {
            (i.sclientx - n.clientX > r || i.sclienty - n.clientY > r || i.sclientx - n.clientX < -r || i.sclienty - n.clientY < -r) && (i.dragMoved = !0);
            DetachEvent(document.body, "mousemove", i.textMove, !0);
            DetachEvent(document.body, "mouseup", i.endDrag, !0);
            !i.dragMoved && i.editable ? i.clickCallback != null && i.clickCallback.call(this, i) : i.movedCallback != null && i.movedCallback.call(this, i)
        }
        ;
        this.textMove = function(n) {
            var t = i.toMapPoint(n.clientX, n.clientY);
            t.x = t.x - i.soffsetx;
            t.y = t.y - i.soffsety;
            i.setPosition(t);
            i.editable && i.moveCallback != null && i.moveCallback.call(this, i)
        }
        ;
        this.textDrag = function(n) {
            i.sclientx = n.clientX;
            i.sclienty = n.clientY;
            var r = i.toMapPoint(i.sclientx, i.sclienty);
            i.soffsetx = r.x - i.position.x;
            i.soffsety = r.y - i.position.y;
            i.dragMoved = !1;
            t(n);
            AttachEvent(document.body, "mousemove", i.textMove, !0);
            AttachEvent(document.body, "mouseup", i.endDrag, !0)
        }
        ;
        this.setClickCallback = function(n) {
            this.clickCallback = n
        }
        ;
        this.setMoveCallback = function(n) {
            this.moveCallback = n
        }
        ;
        this.setMovedCallback = function(n) {
            this.movedCallback = n
        }
        ;
        n && this.setOptions(n)
    }
    ;
    FBM.extend(FBM.Graphic, FBM.FWLabel);
    var i = FBM.FWLabel
      , n = i.prototype;
    n.font = "";
    n.fontSize = 12;
    n.fontWeight = "normal";
    n.fontColor = "#000000";
    n.opacity = 1;
    n.backgroundColor = "";
    n.position = null;
    n.label = "";
    n.title = "";
    n.zIndex;
    n.offset = null;
    n.visible = !0;
    n.map = null;
    n.mapbase = null;
    n.elem = null;
    n.clone = function() {
        var n = {
            font: this.getFont(),
            fontSize: this.getFontSize(),
            fontWeight: this.getFontWeight(),
            fontColor: this.getFontColor(),
            opacity: this.getOpacity(),
            backgroundColor: this.getBackgroundColor(),
            position: this.getPosition(),
            label: this.getLabel(),
            title: this.getTitle(),
            offset: this.getOffset()
        };
        return new FBM.FWLabel(n)
    }
    ;
    n.getEventElement = function() {
        return this.elem
    }
    ;
    n.isPointInEnvelope = function() {
        return null
    }
    ;
    n.update = function() {
        function f(n, t) {
            return typeof n == "number" ? n : typeof n == "string" && n.slice(-1) == "%" ? t * parseFloat(n) / 100 : 0
        }
        var n, t, i, r;
        if (this.map) {
            switch (this.map.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                var e = this.mapbase.FromMapPoint(this.position.x, this.position.y)
                  , u = FBM.WGS84ToGoo(this.position.x, this.position.y)
                  , n = this.mapbase.FromMapPoint(u.x, u.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                n = this.mapbase.FromMapPoint(this.position.x, this.position.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
                n = this.mapbase.FromMapPoint(this.position.x, this.position.y)
            }
            t = n.x;
            i = n.y;
            this.offset && (r = this.elem.getBBox(),
            t += f(this.offset.x, r.width),
            i += f(this.offset.y, r.height));
            this.elem.transform("t" + t + "," + i)
        }
    }
    ;
    n.setVisible = function(n) {
        this.elem && (n == !0 ? this.elem.show() : n == !1 && this.elem.hide());
        this.visible = n;
        FBM.FWEvent.trigger(this, "visible_changed")
    }
    ;
    n.getVisible = function() {
        return this.visible
    }
    ;
    n.setZIndex = function(n) {
        n != undefined && (this.zIndex = n,
        this.elem) && (this.map.overlay.updateElementOrder(this),
        FBM.FWEvent.trigger(this, "zindex_changed"))
    }
    ;
    n.getZIndex = function() {
        return this.zIndex
    }
    ;
    n.setFont = function(n) {
        this.font = n;
        this.elem && this.elem.attr({
            "font-family": this.font
        })
    }
    ;
    n.getFont = function() {
        return this.font
    }
    ;
    n.setFontSize = function(n) {
        this.fontSize = n;
        this.elem && this.elem.attr({
            "font-size": this.fontSize
        })
    }
    ;
    n.getFontSize = function() {
        return this.fontSize
    }
    ;
    n.setSize = function(n) {
        this.size = n
    }
    ;
    this.getSize = function() {
        return this.size
    }
    ;
    n.setFontColor = function(n) {
        this.fontColor = n;
        this.elem && this.elem.attr({
            fill: this.fontColor
        })
    }
    ;
    n.getFontColor = function() {
        return this.fontColor
    }
    ;
    n.setOpacity = function(n) {
        this.opacity = n;
        this.elem && this.elem.attr({
            opacity: this.opacity
        })
    }
    ;
    n.getOpacity = function() {
        return this.opacity
    }
    ;
    n.setBackgroundColor = function(n) {
        this.backgroundColor = n
    }
    ;
    n.getBackgroundColor = function() {
        return this.backgroundColor
    }
    ;
    n.setPosition = function(n) {
        this.position = n;
        this.update();
        FBM.FWEvent.trigger(this, "position_changed")
    }
    ;
    n.getPosition = function() {
        return this.position
    }
    ;
    n.setLabel = function(n) {
        this.label = n;
        this.elem && this.elem.attr({
            text: this.label
        });
        FBM.FWEvent.trigger(this, "label_changed")
    }
    ;
    n.getLabel = function() {
        return this.label
    }
    ;
    n.setTitle = function(n) {
        (this.title = n,
        this.elem) && (this.elem.attr({
            title: this.title
        }),
        FBM.FWEvent.trigger(this, "title_changed"))
    }
    ;
    n.getTitle = function() {
        return this.title
    }
    ;
    n.setFontWeight = function(n) {
        this.fontWeight = n;
        this.elem && this.elem.attr({
            "font-weight": this.fontWeight
        })
    }
    ;
    n.getFontWeight = function() {
        return this.fontWeight
    }
    ;
    n.destroy = function() {
        this.map && (this.map.overlay.remove(this),
        this.elem && this.elem.remove())
    }
    ;
    n.getOffset = function() {
        return this.offset
    }
    ;
    n.setOffset = function(n) {
        (n instanceof FBM.FWPoint || "x"in n && "y"in n) && (this.offset = n,
        this.update())
    }
    ;
    n.setMap = function(n) {
        if (this.destroy(),
        n == null && this.map) {
            this.map = null;
            FBM.FWEvent.clearInstanceListeners(this);
            return
        }
        n instanceof FBM.FWOnlineMap && (this.map = n,
        paper = this.getPaper(),
        this.elem = paper.text(0, 0, this.label),
        this.map.overlay.add(this),
        this.mapbase = this.map.getMapBase(),
        this.elem.attr({
            "font-family": this.font,
            fill: this.fontColor,
            "font-weight": this.fontWeight,
            "font-size": this.fontSize,
            text: this.label,
            opacity: this.opacity
        }),
        this.bindEvents(),
        this.update())
    }
    ;
    n.getMap = function() {
        return this.map
    }
    ;
    n.getMapBase = function() {
        return this.mapbase
    }
    ;
    n.editable = !1;
    n.getEditable = function() {
        return this.editable
    }
    ;
    n.setEditable = function(n) {
        this.editable = n;
        this.setDraggable(n)
    }
    ;
    n.draggable = !1;
    n.getDraggable = function() {
        return this.draggable
    }
    ;
    n.setDraggable = function(n) {
        (this.draggable = n,
        FBM.FWEvent.trigger(this, "draggable_changed"),
        this.elem) && (this.elem && n == !0 ? this.elem.mousedown(this.textDrag) : this.elem && n == !1 && this.elem.unmousedown(this.textDrag))
    }
    ;
    n.clickable = !1;
    n.getClickable = function() {
        return this.clickable
    }
    ;
    n.setClickable = function(n) {
        typeof n == "boolean" && (this.clickable = n,
        n ? FBM.FWEvent.releaseEventLock(this, "click") : FBM.FWEvent.lockEvent(this, "click"),
        FBM.FWEvent.trigger(this, "clickable_changed"))
    }
    ;
    n.advancedLayer = null;
    n.getAdvancedLayer = function() {
        return this.advancedLayer
    }
    ;
    n.setAdvancedLayer = function(n) {
        this.advancedLayer = n
    }
    ;
    n.getPaper = function() {
        return this.advancedLayer != null ? this.advancedLayer.paper.main : this.map.getPaper()
    }
    ;
    n.getShadowPaper = function() {
        return this.advancedLayer != null ? this.advancedLayer.paper.shadow : this.map.getShadowPaper()
    }
    ;
    n.setOptions = function(n) {
        n.offset !== undefined && this.setOffset(n.offset);
        var t = {};
        n.font && (t["font-family"] = this.font = n.font);
        n.fontColor && (t.fill = this.fontColor = n.fontColor);
        n.fontWeight && (t["font-weight"] = this.fontWeight = n.fontWeight);
        n.fontSize && (t["font-size"] = this.fontSize = n.fontSize);
        n.label && (t.text = this.label = n.label);
        n.opacity !== undefined && (t.opacity = this.opacity = n.opacity);
        this.elem && this.elem.attr(t);
        n.label && FBM.FWEvent.trigger(this, "label_changed");
        n.backgroundColor && (this.backgroundColor = n.backgroundColor);
        n.clickable !== undefined && this.setClickable(n.clickable);
        n.draggable !== undefined && this.setDraggable(n.draggable);
        n.position && (this.position = n.position,
        FBM.FWEvent.trigger(this, "position_changed"));
        n.map && this.setMap(n.map);
        n.zIndex !== undefined && this.setZIndex(n.zIndex);
        n.visible !== undefined && this.setVisible(n.visible);
        this.update()
    }
    ;
    FBM.RegisterEvent(FBM.FWLabel, ["label_changed", "zindex_changed", "click", "dblclick", "rightclick", "mousemove", "mousedown", "mouseup", "mouseover", "mouseout"])
}
)();
/*! D:\FW_API\scripts\FWInfoWindow.js*/
FBM.FWInfoWindow = function(n, t, i) {
    var c = "", u, f, e, o, l, a = this, s, h, r;
    o = document.createElement("img");
    u = document.createElement("div");
    f = document.createElement("div");
    e = document.createElement("div");
    l = document.createElement("div");
    o.src = FBM.RES_PATH + "Sample/Angle.png";
    o.style.position = "absolute";
    o.style.height = "21px";
    o.style.width = "34px";
    o.style.zIndex = 1e6;
    u.style.position = "absolute";
    u.style.border = "solid 1px #AAAAAA";
    u.style.backgroundColor = "#ffffff";
    u.style.opacity = 1;
    u.style.borderRadius = "5px";
    u.style.overflow = "auto";
    f.style.width = "auto";
    f.style.height = "auto";
    f.style.position = "absolute";
    f.style.overflow = "auto";
    f.style.margin = "10px";
    f.style["word-break"] = "keep-all";
    e.style.position = "absolute";
    e.top = "5px";
    e.style.width = "15px";
    e.style.height = "15px";
    e.style.overflow = "auto";
    e.style.right = "5px";
    e.style.zIndex = 1e6;
    e.style.backgroundImage = 'url("' + FBM.RES_PATH + 'Sample/Close.png")';
    this.onCloseClick = function() {
        a.close()
    }
    ;
    AttachEvent(e, "click", this.onCloseClick);
    u.appendChild(f);
    r = {
        position: t || new FBM.FWPoint(0,0),
        pixelOffset: new FBM.FWSize(0,0),
        zIndex: 1e6,
        disableAutoPan: !0
    };
    this.getElement = function() {
        return u
    }
    ;
    this.open = function(n) {
        if (n.infoWindowLayer.containing(this)) {
            this.update();
            return
        }
        n.getHPack().appendChild(u);
        n.getHPack().appendChild(o);
        n.getHPack().appendChild(e);
        n.infoWindowLayer.add(this);
        s = n;
        h = s.getMapBase();
        u.style.zIndex = r.zIndex;
        f.innerHTML = '<p style="white-space: nowrap">' + c + "<\/p>";
        u.style.width = f.scrollWidth + 40 > r.maxWidth ? r.maxWidth + 40 + "px" : f.scrollWidth + 40 + "px";
        o.style.display = "inline";
        e.style.display = "inline";
        u.style.height = f.scrollHeight + 30 + "px";
        this.update();
        this.panToCenter()
    }
    ;
    this.close = function() {
        s && s.infoWindowLayer.containing(this) && (FBM.FWEvent.trigger(this, "closeclick"),
        s.infoWindowLayer.remove(this),
        o.parentNode && o.parentNode.removeChild(o),
        e.parentNode && e.parentNode.removeChild(e))
    }
    ;
    this.setContent = function(n) {
        typeof n == "string" ? c = n : n instanceof HTMLElement && f.appendChild(n);
        c = n;
        f.innerHTML = '<p style="white-space: nowrap">' + c + "<\/p>";
        u.style.width = f.scrollWidth + 40 > r.maxWidth ? r.maxWidth + 40 + "px" : f.scrollWidth + 40 + "px";
        u.style.height = f.scrollHeight + 30 + "px";
        FBM.FWEvent.trigger(this, "content_changed")
    }
    ;
    this.setPosition = function(n) {
        n instanceof FBM.FWPoint && (n.x !== r.position.x || n.y !== r.position.y) && (r.position = n,
        this.update(),
        FBM.FWEvent.trigger(this, "position_changed"))
    }
    ;
    this.getPosition = function() {
        return r.position
    }
    ;
    this.getContentPane = function() {
        return f
    }
    ;
    this.setMaxWidth = function(n) {
        r.maxWidth = n;
        u.style.width = f.scrollWidth + 40 > r.maxWidth ? r.maxWidth + 40 + "px" : f.scrollWidth + 40 + "px";
        u.style.height = f.scrollHeight + 30 + "px"
    }
    ;
    this.setZIndex = function(n) {
        n !== r.zIndex && (r.zIndex = n,
        u.style.zIndex = n,
        o.style.zIndex = n,
        e.style.zIndex = n,
        this.update(),
        FBM.FWEvent.trigger(this, "zindex_changed"))
    }
    ;
    this.getZIndex = function() {
        return r.zIndex
    }
    ;
    this.setPixelOffset = function(n) {
        r.pixelOffset = n;
        this.update()
    }
    ;
    this.disableAutoPan = function(n) {
        typeof n == "boolean" && (r.disableAutoPan = n)
    }
    ;
    this.putOpacity = function(n) {
        u.style.opacity = n;
        o.style.opacity = n;
        e.style.opacity = n;
        u.style.filter = "alpha(opacity=" + n * 100 + ")";
        o.style.filter = "alpha(opacity=" + n * 100 + ")";
        e.style.filter = "alpha(opacity=" + n * 100 + ")"
    }
    ;
    this.panToCenter = function() {
        if (r.disableAutoPan == !1 && h && s) {
            var n = h.FromMapPoint(r.position.x, r.position.y)
              , t = parseInt(n.x) - u.offsetWidth / 2
              , i = parseInt(n.y) - u.offsetHeight / 2
              , f = h.ToMapPoint(t, i);
            s.setCenter(r.position)
        }
    }
    ;
    this.setMessageText = function(n) {
        this.setContent(n)
    }
    ;
    this.setOptions = function(n) {
        n != undefined && (typeof n.disableAutoPan == "boolean" && this.disableAutoPan(n.disableAutoPan),
        n.position instanceof FBM.FWPoint && this.setPosition(n.position),
        typeof n.maxWidth == "number" && this.setMaxWidth(n.maxWidth),
        n.pixelOffset instanceof FBM.FWSize && this.setPixelOffset(n.pixelOffset),
        typeof n.zIndex == "number" && this.setZIndex(n.zIndex),
        typeof n.messageText == "string" && this.setMessageText(n.messageText),
        typeof n.opacity == "number" && this.putOpacity(n.opacity),
        this.update())
    }
    ;
    this.update = function() {
        var i, t, n;
        if (typeof h != "undefined" && s) {
            i = s.getCoordSys();
            switch (i) {
            case FBM.FWCoordSys.EPSG3857:
                t = FBM.WGS84ToGoo(r.position.x, r.position.y);
                n = h.FromMapPoint(t.x, t.y);
                break;
            case FBM.FWCoordSys.EPSG3826:
                n = h.FromMapPoint(r.position.x, r.position.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
                n = h.FromMapPoint(r.position.x, r.position.y)
            }
            u.style.left = parseInt(n.x) + r.pixelOffset.width + "px";
            u.style.top = parseInt(n.y) - 19 - parseInt(u.offsetHeight) + r.pixelOffset.height + "px";
            o.style.left = parseInt(n.x) + r.pixelOffset.width + "px";
            o.style.top = parseInt(n.y) - 19 + r.pixelOffset.height + "px";
            e.style.left = parseInt(n.x) + u.clientWidth + r.pixelOffset.width - 20 + "px";
            e.style.top = parseInt(u.style.top) + 5 + "px"
        }
    }
    ;
    this.setContent(n);
    this.setOptions({
        position: t
    });
    this.setOptions(i)
}
;
FBM.RegisterEvent(FBM.FWInfoWindow, ["closeclick", "content_changed", "position_changed", "zindex_changed", "domready"]);
/*! D:\FW_API\scripts\FWImage.js*/
FBM.FWImage = function(n, t, i, r, u) {
    var f = "";
    this.setUrl = function(n) {
        typeof n == "string" && (f = n)
    }
    ;
    this.getUrl = function() {
        return f
    }
    ;
    this.setOptions = function(n) {
        n.scale && (this.scale = n.scale);
        n.hotSpot && (this.anchor = n.hotSpot)
    }
    ;
    Object.defineProperty(this, "bounding", {
        get: function() {
            return new FBM.FWEnvelope(-this.anchor.x,-this.anchor.y,this.size.width - this.anchor.x,this.size.height - this.anchor.y)
        }
    });
    this.createElement = function(n, t) {
        function u() {
            var i = this.scaledSize ? this.scaledSize : this.size
              , r = this.scaledSize ? 1 : this.scale || 1
              , u = n.image(this.getUrl(), 0, 0, i.width * r, i.height * r);
            t && t(u)
        }
        var r, i;
        if (!this.getUrl()) {
            r = n.image("", 0, 0, 0, 0);
            t && t(r);
            return
        }
        this.scale ? (i = document.createElement("img"),
        i.onload = function(n) {
            this.size = new FBM.FWSize(n.srcElement.width,n.srcElement.height);
            u.call(this)
        }
        .bind(this),
        i.src = this.getUrl()) : u.call(this)
    }
    ;
    this.updateElement = function(n, t) {
        var u = t.x, f = t.y, i, r;
        this.anchor && (u = t.x - this.anchor.x,
        f = t.y - this.anchor.y);
        i = this.scaledSize || this.size;
        r = this.scaledSize ? 1 : this.scale || 1;
        n.attr({
            x: u,
            y: f,
            width: i.width * r,
            height: i.height * r,
            "clip-rect": u + "," + f + "," + i.width * r + "," + i.height * r
        })
    }
    ;
    this.size = t instanceof FBM.FWSize ? t : new FBM.FWSize(32,32);
    this.anchor = r instanceof FBM.FWPoint ? r : new FBM.FWPoint(this.size.width / 2 - 1,this.size.height - 1);
    u instanceof FBM.FWSize && (this.scaledSize = u);
    i instanceof FBM.FWPoint && (this.origin = i);
    this.setUrl(n)
}
;
FBM.extend(FBM.MVCObject, FBM.FWImage);
/*! D:\FW_API\scripts\FWSymbol.js*/
FBM.FWSymbol = function() {
    FBM.FWSymbolStyle = {
        FORWARD_CLOSED_ARROW: 0,
        FORWARD_OPEN_ARROW: 1,
        BACKWARD_CLOSED_ARROW: 2,
        BACKWARD_OPEN_ARROW: 3,
        CIRCLE: 4,
        DOUBLE_CIRCLE: 5,
        TRIPLE_CIRCLE: 6,
        CIRCLE_SPOT: 7,
        TRIANGLE: 8,
        INVERT_TRIANGLE: 9,
        SQUARE: 10,
        PENTAGON: 11,
        HEXAGON: 12,
        OCTAGON: 13,
        PENTASTAR: 14,
        HEXASTAR: 15
    };
    var t = [FBM.FWSymbolStyle.FORWARD_OPEN_ARROW, FBM.FWSymbolStyle.BACKWARD_OPEN_ARROW]
      , n = function() {
        this.anchor = new FBM.FWPoint(0,0);
        this.symbolStyle = FBM.FWSymbolStyle.CIRCLE;
        this.size = new FBM.FWSize(48,48);
        this.rotation = 0;
        this.opacity = 1;
        this.fillColor = "#ffffff";
        this.fillOpacity = 0;
        this.strokeColor = "#000000";
        this.strokeWeight = 2;
        this.strokeOpacity = 1;
        Object.defineProperty(this, "xPixel", {
            get: function() {
                return this.size.width
            },
            set: function(n) {
                this.size.width = n
            }
        });
        Object.defineProperty(this, "yPixel", {
            get: function() {
                return this.size.height
            },
            set: function(n) {
                this.size.height = n
            }
        });
        Object.defineProperty(this, "bounding", {
            get: function() {
                return new FBM.FWEnvelope(-this.anchor.x,-this.anchor.y,this.size.width - this.anchor.x,this.size.height - this.anchor.y)
            }
        });
        this.createElement = function(n, i) {
            var f = this.symbolStyle in FBM.FWSymbol.SymbolPath ? FBM.FWSymbol.SymbolPath[this.symbolStyle] : this.symbolStyle, r, u;
            if (!f)
                throw "Invalid SymbolStyle or path";
            r = n.path(f);
            u = t.some(function(n) {
                return n == this.symbolStyle
            }
            .bind(this));
            r.attr({
                opacity: this.opacity,
                fill: u ? null : this.fillColor,
                "fill-opacity": u ? 0 : this.fillOpacity,
                stroke: this.strokeColor,
                "stroke-opacity": this.strokeOpacity,
                "stroke-width": this.strokeWeight
            });
            i && i(r)
        }
        ;
        this.updateElement = function(n, t) {
            var i = n.getBBox(!0)
              , r = this.size.width / i.width
              , u = this.size.height / i.height;
            n.transform("t" + (t.x - this.anchor.x) + "," + (t.y - this.anchor.y) + "r" + this.rotation + "," + this.anchor.x + "," + this.anchor.y + "s" + r + "," + u + ",0,0")
        }
    };
    return FBM.extend(FBM.MVCObject, n),
    n.SymbolPath = ["M0 0 L 100 50 L0 100L50 50Z", "M0 0 L 100 50 L0 100", "M100 0 L 0 50 L100 100L50 50Z", "M100 0 L 0 50 L100 100", "M0 50 A 50 50 0 0 1 100 50 A50 50 0 0 1 0 50z", "M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50zM25 50A25 25 0 0 1 75 50 A25 25 0 0 1 25 50z", "M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50zM16.67 50A33.33 33.33 0 0 1 83.33 50 A33.33 33.33 0 0 1 16.67 50zM33.33 50A16.67 16.67 0 0 1 66.67 50 A16.67 16.67 0 0 1 33.33 50z", "M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50ZM45 45L55 55M55 45L45 55", "M50 0L7 75L93 75Z", "M93 25L7 25L50 100Z", "M0 0L100 0L100 100L0 100Z", "M50 0L2 35L21 90L79 90L98 35Z", "M50 0L7 25L7 75L50 100L93 75L93 25Z", "M50 0L15 15L0 50L15 85L50 100L85 85L100 50L85 15Z", "M50 0L35 30L2 35 L26 58L21 90L50 75L79 90L74\t58L98 35L65\t30Z", "M50,0L38,28L7,25L25,50L7,75L37,72L50,100L62,72L93,75L75,50L93,25L63,28Z"],
    n
}();
/*! D:\FW_API\scripts\FWMarker.js*/
(function() {
    function t(n) {
        n.cancelBubble = !0;
        n.stopPropagation && n.stopPropagation()
    }
    FBM.FWMarker = function(n, i, r, u, f) {
        function s(n) {
            var t = Math.abs(e.sclientx - n.clientX)
              , i = Math.abs(e.sclienty - n.clientY);
            this.dragMoved = t > o || i > o;
            DetachEvent(document.body, "mousemove", h, !0);
            DetachEvent(document.body, "mouseup", s, !0);
            !e.dragMoved && e.editable ? e.clickCallback != null && e.clickCallback.call(this, e) : e.movedCallback != null && e.movedCallback.call(this, e)
        }
        function h(n) {
            var t = e.toMapPoint(n.clientX, n.clientY);
            t.x -= e.soffsetx;
            t.y -= e.soffsety;
            e.setPosition(t);
            e.editable && e.moveCallback != null && e.moveCallback.call(this, e)
        }
        var o = 2
          , e = this;
        this.toMapPoint = function(n, t) {
            var i, f = this.map.getMapBase(), e = f.getPackageOffset(), r = f.ToMapPoint(n - e.x, t - e.y), u;
            switch (this.map.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                u = FBM.GooToWGS84(r.x, r.y);
                i = new FBM.FWPoint(u.x,u.y);
                break;
            case FBM.FWCoordSys.EPSG3825:
            case FBM.FWCoordSys.EPSG3826:
                i = r
            }
            return i
        }
        ;
        this.markDrag = function(n) {
            e.sclientx = n.clientX;
            e.sclienty = n.clientY;
            var i = e.toMapPoint(e.sclientx, e.sclienty);
            e.soffsetx = i.x - e.position.x;
            e.soffsety = i.y - e.position.y;
            e.dragMoved = !1;
            t(n);
            AttachEvent(document.body, "mousemove", h, !0);
            AttachEvent(document.body, "mouseup", s, !0)
        }
        ;
        this.setClickCallback = function(n) {
            this.clickCallback = n
        }
        ;
        this.setMoveCallback = function(n) {
            this.moveCallback = n
        }
        ;
        this.setMovedCallback = function(n) {
            this.movedCallback = n
        }
        ;
        this.getNode = function() {
            if (this.map && this.advancedLayer) {
                var n = this.getAdvancedLayer();
                return n != null ? [n.div.main, n.div.shadow] : this.map.getPanes().graphicLayer
            }
        }
        ;
        i instanceof FBM.FWPoint && (this.position = i);
        r && (this.title = r);
        u != undefined && (this.icon = u);
        f && this.setMarkerOptions(f);
        n && this.setMap(n)
    }
    ;
    FBM.extend(FBM.Graphic, FBM.FWMarker);
    var n = FBM.FWMarker.prototype;
    n.elem = null;
    n.map = null;
    n.gPos = null;
    n.icon = new FBM.FWImage(FBM.RES_PATH + "marker2.png",new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(9,28));
    n.shadow = new FBM.FWImage(FBM.RES_PATH + "shadow2.png",new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(9,25));
    n.clone = function() {
        var n = new FBM.FWMarker(null,this.getPosition(),this.getTitle(),this.getIcon());
        return n.setShadow(this.getShadow()),
        n.setInfoAnchorPoint(this.getInfoAnchorPoint()),
        n.setFlat(this.getFlat()),
        n
    }
    ;
    n.isPointInEnvelope = function(n, t, i) {
        var r = this.position
          , u = this.icon;
        if (!r || !u)
            return null;
        var f = (n - r.x) / i
          , o = (r.y - t) / i
          , e = u.bounding;
        return f >= e.left && f <= e.right && o >= bnt.top && t <= bnt.bottom
    }
    ;
    n.getBounds = n.getEnvelope = function() {
        return new FBM.FWEnvelope(this.position.x,this.position.y,this.position.x,this.position.y)
    }
    ;
    n.setMap = function(n) {
        if (n === null) {
            this.destroy();
            this.map = null;
            return
        }
        (this.destroy(),
        n instanceof FBM.FWOnlineMap) && (this.map = n,
        this.map && this.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (this.gPos = FBM.WGS84ToGoo(this.position.x, this.position.y)),
        this.redrawMarker(),
        this.map.overlay.add(this),
        this.update())
    }
    ;
    n.getMap = function() {
        return this.map
    }
    ;
    n.getMapBase = function() {
        if (this.map)
            return this.map.getMapBase()
    }
    ;
    n.destroy = function() {
        this.map && (this.elem && this.elem.remove(),
        this.sImg && this.sImg.remove(),
        this.map.overlay.remove(this),
        this.elem = null,
        this.sImg = null)
    }
    ;
    n.getGraphicElement = function() {
        return this.elem ? {
            g: [this.elem],
            s: [this.sImg]
        } : null
    }
    ;
    n.getEventElement = function() {
        return this.elem
    }
    ;
    n.title = "";
    n.getTitle = function() {
        return this.title
    }
    ;
    n.setTitle = function(n) {
        (this.title = n,
        this.elem) && (this.elem.attr({
            title: this.title
        }),
        FBM.FWEvent.trigger(this, "title_changed"))
    }
    ;
    n.position = null;
    n.getPosition = function() {
        return this.position
    }
    ;
    n.setPosition = function(n) {
        n instanceof FBM.FWPoint && (this.position = n,
        this.map && this.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (this.gPos = FBM.WGS84ToGoo(this.position.x, this.position.y)),
        this.update(),
        FBM.FWEvent.trigger(this, "position_changed"))
    }
    ;
    this.infoAnchorPosition = null;
    n.getInfoAnchorPoint = function() {
        return this.infoAnchorPoint
    }
    ;
    n.setInfoAnchorPoint = function(n) {
        this.infoAnchorPoint = n
    }
    ;
    n.getIcon = function() {
        return this.icon
    }
    ;
    n.setIcon = function(n) {
        (n == null || n instanceof FBM.FWImage || n instanceof FBM.FWSymbol) && this.icon != n && (this.icon = n,
        this.redrawMarker(),
        FBM.FWEvent.trigger(this, "icon_changed"))
    }
    ;
    n.clickable = !1;
    n.getClickable = function() {
        return this.clickable
    }
    ;
    n.setClickable = function(n) {
        typeof n == "boolean" && (this.clickable = n,
        n ? FBM.FWEvent.releaseEventLock(this, "click") : FBM.FWEvent.lockEvent(this, "click"),
        FBM.FWEvent.trigger(this, "clickable_changed"))
    }
    ;
    n.visible = !0;
    n.getVisible = function() {
        return this.visible
    }
    ;
    n.setVisible = function(n, t) {
        (this.visible = n,
        this.map) && (this.elem && (this.icon && this.visible === !0 ? this.elem.show() : this.elem.hide()),
        this.sImg && (this.visible === !0 && this.flat === !1 ? this.sImg.show() : this.sImg.hide()),
        t || this.update(),
        FBM.FWEvent.trigger(this, "visible_changed"))
    }
    ;
    n.cursor = null;
    n.getCursor = function() {
        return this.cursor
    }
    ;
    n.setCursor = function(n) {
        (this.cursor = n,
        this.elem) && (this.elem.attr({
            cursor: this.cursor
        }),
        FBM.FWEvent.trigger(this, "cursor_changed"))
    }
    ;
    n.zIndex = 0;
    n.getZIndex = function() {
        return this.zIndex
    }
    ;
    n.setZIndex = function(n) {
        (this.zIndex = parseInt(n),
        this.map) && FBM.FWEvent.trigger(this, "zindex_changed")
    }
    ;
    n.editable = !1;
    n.getEditable = function() {
        return this.editable
    }
    ;
    n.setEditable = function(n) {
        this.editable = n;
        this.setDraggable(n)
    }
    ;
    n.draggable = !1;
    n.getDraggable = function() {
        return this.draggable
    }
    ;
    n.setDraggable = function(n) {
        (this.draggable = n,
        FBM.FWEvent.trigger(this, "draggable_changed"),
        this.elem) && (this.elem && n == !0 ? this.elem.mousedown(this.markDrag) : this.elem && n == !1 && this.elem.unmousedown(this.markDrag))
    }
    ;
    n.flat = !0;
    n.getFlat = function() {
        return this.flat
    }
    ;
    n.setFlat = function(n) {
        this.flat = n;
        this.sImg && this.sImg[this.visible && !this.flat ? "show" : "hide"]();
        FBM.FWEvent.trigger(this, "flat_changed")
    }
    ;
    n.getShadow = function() {
        return this.shadow
    }
    ;
    n.setShadow = function(n) {
        this.shadow = n;
        FBM.FWEvent.trigger(this, "shadow_changed")
    }
    ;
    n.advancedLayer = null;
    n.getAdvancedLayer = function() {
        return this.advancedLayer
    }
    ;
    n.setAdvancedLayer = function(n) {
        this.advancedLayer = n
    }
    ;
    n.getPaper = function() {
        return this.advancedLayer != null ? this.advancedLayer.paper.main : this.map.getPaper()
    }
    ;
    n.getShadowPaper = function() {
        return this.advancedLayer != null ? this.advancedLayer.paper.shadow : this.map.getShadowPaper()
    }
    ;
    n.setMarkerOptions = function(n) {
        n && (n.advancedLayer !== undefined && this.setAdvancedLayer(n.advancedLayer),
        n.visible !== undefined && this.setVisible(n.visible),
        n.icon != undefined && this.setIcon(n.icon),
        n.shadow !== undefined && this.setShadow(n.shadow),
        n.title != undefined && this.setTitle(n.title),
        n.position !== undefined && this.setPosition(n.position),
        n.infoAnchor !== undefined && this.setInfoAnchorPoint(n.infoAnchor),
        n.clickable !== undefined && this.setClickable(n.clickable),
        n.cursor !== undefined && this.setCursor(n.cursor),
        n.zIndex != undefined && this.setZIndex(n.zIndex),
        n.draggable !== undefined && this.setDraggable(n.draggable),
        n.flat !== undefined && this.setFlat(n.flat),
        n.shape !== undefined && this.setShape(n.shape))
    }
    ;
    n.redrawMarker = function() {
        this.map && (this.shadow && !this.flat && this.shadow.createElement(this.getShadowPaper(), function(n) {
            this.sImg && (this.sImg.node.parentNode.insertBefore(n.node, this.sImg.node),
            this.sImg.remove());
            this.sImg = n;
            this.sImg[this.visible ? "show" : "hide"]()
        }
        .bind(this)),
        this.icon == null ? this.elem && this.elem.hide() : (this.icon instanceof FBM.FWImage || this.icon instanceof FBM.FWSymbol) && this.icon.createElement(this.getPaper(), function(n) {
            this.elem && (n && this.elem.node.parentNode.insertBefore(n.node, this.elem.node),
            this.elem.remove());
            this.elem = n;
            var t = {};
            this.cursor && (t.cursor = this.cursor);
            this.title && (t.title = this.title);
            n && n.attr(t);
            this.bindEvents();
            this.update()
        }
        .bind(this)))
    }
    ;
    n.update = function() {
        var r, i;
        if (this.map && this.position) {
            var u = this.map.getRawBound()
              , n = this.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? this.gPos : this.position
              , t = u.contains(n);
            (this.elem && this.elem[t && this.icon && this.visible ? "show" : "hide"](),
            this.sImg && this.sImg[t && this.visible && !this.flat ? "show" : "hide"](),
            t) && (r = this.map.getMapBase(),
            i = r.FromMapPoint(n.x, n.y),
            this.icon && this.elem && this.icon.updateElement(this.elem, i),
            this.shadow && this.sImg && this.flat === !1 && this.shadow.updateElement(this.sImg, i))
        }
    }
    ;
    FBM.RegisterEvent(FBM.FWMarker, ["clickable_changed", "icon_changed", "position_changed", "title_changed", "visible_changed", "zindex_changed", "click", "mousedown", "mouseup", "mouseover", "mouseout", "mousemove", "cursor_changed", "draggable_changed", "flat_changed", "shadow_changed", "shape_changed", "dblclick", "rightclick"])
}
)();
/*! D:\FW_API\scripts\FWDrawing.js*/
FBM.FWDrawing = function() {
    var e, r;
    FBM.FWOverlayType = {
        NONE: "NONE",
        CIRCLE: "CIRCLE",
        MARKER: "MARKER",
        POLYGON: "POLYGON",
        LINESTRING: "LINESTRING",
        ENVELOPE: "ENVELOPE",
        LABEL: "LABEL",
        EDIT: "EDIT",
        MODIFY: "MODIFY"
    };
    FBM.FWModifyType = {
        STARTED: "STARTED",
        ATTRIBUTE: "ATTRIBUTE",
        SAVE: "SAVE",
        DELETE: "DELETE",
        CANCEL: "CANCEL"
    };
    var c = function(n, t, i, r) {
        var u = this;
        this.manager = n;
        this.mode = t;
        this.active = !1;
        this.activeImage = i;
        this.inactiveImage = r;
        this.div = document.createElement("div");
        this.img = document.createElement("img");
        this.div.appendChild(this.img);
        this.setActive = function(n) {
            this.active = n;
            this.img.src = this.active ? u.activeImage : u.inactiveImage
        }
        ;
        this.destructor = function() {
            div.parentNode && div.parentNode.removeChild(this.div);
            this.div = null;
            this.img = null
        }
        ;
        this.setActive(!1);
        this.div.onclick = function() {
            var n = u.manager.getDrawingMode() == u.mode ? FBM.FWOverlayType.NONE : u.mode;
            u.manager.setDrawingMode(n)
        }
    }
      , l = function(n, t, i, r) {
        var u = this;
        this.manager = n;
        this.mode = t;
        this.active = !0;
        this.enabledImage = i;
        this.disabledImage = r;
        this.div = document.createElement("div");
        this.img = document.createElement("img");
        this.div.appendChild(this.img);
        this.setActive = function(n) {
            this.active = n;
            this.img.src = this.active ? u.enabledImage : u.disabledImage
        }
        ;
        this.destructor = function() {
            div.parentNode && div.parentNode.removeChild(this.div);
            this.div = null;
            this.img = null
        }
        ;
        this.setActive(!0);
        this.div.onclick = function() {
            u.active && u.manager.setModifyMode(u.mode)
        }
    }
      , f = function(n) {
        n.cancelBubble = !0;
        n.stopPropagation && n.stopPropagation()
    }
      , s = function(n, t) {
        this.buttons = [];
        n && (this.manager = n);
        this.position = FBM.FWControlPosition.BOTTOM_RIGHT;
        this.div = document.createElement("div");
        util.disableSelect(this.div);
        this.table = document.createElement("table");
        this.div.appendChild(this.table);
        this.row = this.table.insertRow(-1);
        n.map && this.setMap(n.map);
        t && this.setOptions(t)
    }
      , u = s.prototype;
    u.setMap = function(n) {
        this.map != n && (this.map = n,
        this.position && n.controls[this.position].push(this.div))
    }
    ;
    u.setImages = function(n) {
        this.images = n
    }
    ;
    u.setVisible = function(n) {
        this.div.style.display = n ? "" : "none"
    }
    ;
    u.setPosition = function(n) {
        if (this.manager.map) {
            var t = this.manager.map.controls[this.position].indexOf(this.div);
            t >= 0 && (this.manager.map.controls[this.position].removeAt(t),
            this.manager.map.controls[n].push(this.div),
            this.position = n)
        }
    }
    ;
    u.setOptions = function(n) {
        n.images && this.setImages(n.images);
        n.controlPosition && this.setPosition(n.controlPosition);
        n.modifyModes && this.setModes(n.modifyModes)
    }
    ;
    u.setButtonState = function(n, t) {
        for (var r, u = !1, i = 0; i < this.buttons.length; i++)
            r = this.buttons[i],
            r.mode == n && (r.setActive(t),
            u = !0);
        return u
    }
    ;
    u.setModes = function(n) {
        var t, i, r;
        for (this.div.innerHTML = "",
        this.table = document.createElement("table"),
        this.div.appendChild(this.table),
        this.buttons = [],
        this.row = this.table.insertRow(-1),
        t = 0; t < n.length; t++)
            i = new l(this.manager,n[t],this.images.enabled[n[t]],this.images.disabled[n[t]]),
            r = this.row.insertCell(-1),
            r.appendChild(i.div),
            this.buttons.push(i)
    }
    ;
    e = function(n, t) {
        this.buttons = [];
        n && (this.manager = n);
        this.labelEnabled = !0;
        this.position = FBM.FWControlPosition.BOTTOM_RIGHT;
        this.div = document.createElement("div");
        util.disableSelect(this.div);
        this.table = document.createElement("table");
        this.div.appendChild(this.table);
        this.row = this.table.insertRow(-1);
        n.map && this.setMap(n.map);
        t && this.setOptions(t)
    }
    ;
    r = e.prototype;
    r.setMap = function(n) {
        this.map != n && (this.map = n,
        this.position && n.controls[this.position].push(this.div))
    }
    ;
    r.setImages = function(n) {
        this.images = n
    }
    ;
    r.setVisible = function(n) {
        this.div.style.display = n ? "" : "none"
    }
    ;
    r.setPosition = function(n) {
        if (this.manager.map) {
            var t = this.manager.map.controls[this.position].indexOf(this.div);
            t >= 0 && (this.manager.map.controls[this.position].removeAt(t),
            this.manager.map.controls[n].push(this.div),
            this.position = n)
        }
    }
    ;
    r.clearAllGraphics = function() {
        this.map == map
    }
    ;
    r.getAllGraphics = function() {
        this.map == map
    }
    ;
    r.setOptions = function(n) {
        n.images && this.setImages(n.images);
        n.controlPosition && this.setPosition(n.controlPosition);
        n.drawingModes && this.setModes(n.drawingModes)
    }
    ;
    r.toggleMode = function(n) {
        for (var i, t = 0; t < this.buttons.length; t++)
            i = this.buttons[t],
            i.setActive(n == i.mode)
    }
    ;
    r.setModes = function(n) {
        var t, i, r;
        for (this.div.innerHTML = "",
        this.table = document.createElement("table"),
        this.div.appendChild(this.table),
        this.buttons = [],
        this.row = this.table.insertRow(-1),
        t = 0; t < n.length; t++)
            (n[t] != "LABEL" || this.labelEnabled) && (i = new c(this.manager,n[t],this.images.active[n[t]],this.images.inactive[n[t]]),
            r = this.row.insertCell(-1),
            r.appendChild(i.div),
            this.buttons.push(i))
    }
    ;
    var h = {
        marker: FBM.RES_PATH + "marker2.png",
        shadow: FBM.RES_PATH + "shadow2.png"
    }
      , t = function(n) {
        var i = 0, r = 0, t;
        return n.getBoundingClientRect && (t = n.getBoundingClientRect(),
        i = t.left,
        r = t.top),
        new FBM.FWPoint(i,r)
    }
      , o = function(n) {
        var st;
        DEBUG_MODE && console.log("FWDrawing : " + n);
        var r = this, y = !1, p, it, rt, g, nt, lt, at, a = null, ni, o;
        this.overlayForwardEvent = !0;
        this.circleDblClick = !1;
        this.envelopeDblClick = !1;
        this.drawingMode = FBM.FWOverlayType.NONE;
        this.useDefaultControl = !0;
        this.graphicSelectedCallback = null;
        this.moveGraphicByKey = !0;
        this.moveNodeByKey = !1;
        var hi = !1
          , ci = "圖形"
          , ti = 1
          , c = []
          , w = null
          , v = FBM.FWOverlayType.MODIFY
          , u = []
          , d = -1
          , b = []
          , k = null
          , tt = null
          , ft = {
            flat: !0,
            draggable: !0
        }
          , ot = {
            flat: !0,
            draggable: !1,
            clickable: !0
        }
          , li = function(n) {
            var b, t, s, a, y, f, e, i, o;
            if (r.getDrawingMode() != FBM.FWOverlayType.MODIFY && r.setDrawingMode(FBM.FWOverlayType.MODIFY),
            b = r.getDrawingMode(),
            b == FBM.FWOverlayType.MODIFY) {
                if (r.moveNodeByKey && r.selectVertex(!1, null),
                n instanceof FBM.FWMarker)
                    t = n.position,
                    t !== undefined && (r.clearModifies(),
                    w = n,
                    v = FBM.FWOverlayType.MARKER,
                    s = r.options.modifyIndicateOptions.circleCenter,
                    f = new FBM.FWPoint(t.x,t.y),
                    u.push(new FBM.FWMarker(r.map,f,"",s,ot)));
                else if (n instanceof FBM.FWLabel)
                    t = n.position,
                    t !== undefined && (r.clearModifies(),
                    w = n,
                    v = FBM.FWOverlayType.LABEL,
                    s = r.options.modifyIndicateOptions.circleCenter,
                    f = new FBM.FWPoint(t.x,t.y),
                    u.push(new FBM.FWMarker(r.map,f,"",s,ot)));
                else if (n.getPath && (t = n.getPath()),
                t !== undefined) {
                    r.clearModifies();
                    w = n;
                    var nt = r.options.modifyDrawingOptions.lineOptions
                      , it = r.options.modifyDrawingOptions.circleOptions
                      , h = r.options.modifyIndicateOptions.node
                      , s = r.options.modifyIndicateOptions.circleCenter;
                    if (k = new FBM.FWLine(r.map,null,nt),
                    tt = new FBM.FWFill(r.map,null,it),
                    t instanceof FBM.FWPolygon) {
                        if (v = FBM.FWOverlayType.POLYGON,
                        a = t.getExteriorRing(),
                        a != null && (y = a.getPath(),
                        y != null && (e = y.getPath(),
                        e != null)))
                            for (i = 0; i < e.length; i++)
                                f = new FBM.FWPoint(e[i].x,e[i].y),
                                u.push(new FBM.FWMarker(r.map,f,"",h,ft))
                    } else if (t instanceof FBM.FWLineString)
                        for (v = FBM.FWOverlayType.LINESTRING,
                        e = t.getPath(),
                        i = 0; i < e.length; i++)
                            f = new FBM.FWPoint(e[i].x,e[i].y),
                            u.push(new FBM.FWMarker(r.map,f,"",h,ft));
                    else if (t instanceof FBM.FWEnvelope) {
                        v = FBM.FWOverlayType.ENVELOPE;
                        var rt = t.left
                          , l = t.top
                          , p = t.right
                          , ut = t.bottom;
                        u.push(new FBM.FWMarker(r.map,new FBM.FWPoint(rt,l),"",h,ft));
                        u.push(new FBM.FWMarker(r.map,new FBM.FWPoint(p,ut),"",h,ft))
                    } else if (t instanceof FBM.FWCircle) {
                        v = FBM.FWOverlayType.CIRCLE;
                        var c = t.getCenter(), p = t.getRadius(), et = new FBM.FWPoint(c.x,c.y), l;
                        if (r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857) {
                            var d = FBM.Geometry.Transform(c, FBM.WGS84ToGoo)
                              , f = new FBM.FWPoint(d.x + p,d.y)
                              , g = FBM.Geometry.Transform(f, FBM.GooToWGS84);
                            l = new FBM.FWPoint(g.x,g.y)
                        } else
                            l = new FBM.FWPoint(c.x + p,c.y);
                        u.push(new FBM.FWMarker(r.map,et,"",s,ft));
                        u.push(new FBM.FWMarker(r.map,l,"",h,ft))
                    }
                }
                for (i = 0; i < u.length; i++)
                    o = u[i],
                    o && o.setEditable && (o.setEditable(!0),
                    r.moveNodeByKey && o.setClickCallback(r.vertexSelected),
                    o.setMoveCallback(r.vertexDragged),
                    FBM.FWEvent.addListener(o, "rightclick", r.vertexRemove));
                r.redrawModifies();
                r.moveGraphicByKey && w != null && r.map.setKeyboardEdit(!0, r.onKeyboardKey);
                r.graphicSelectedCallback && r.graphicSelectedCallback.call(this, n)
            }
        };
        this.snapToGraphics = function(n) {
            var o = new FBM.FWPoint(n.x,n.y), w = new FBM.FWPoint(n.x,n.y), l, e, b, a, k, i, v, s, f, t, u, h, p;
            if (r.options.snapOptions.snapping && (l = r.map.getMapBase(),
            l != null && (e = l.ToMapDistX(r.options.snapOptions.tolerance),
            k = 1,
            e > 0)))
                for (r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = new FBM.FWPoint(n.x,n.y),
                a = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                i = new FBM.FWPoint(i.x + e,i.y),
                i = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                b = i.x - a.x),
                v = Infinity,
                s = 0; s < c.length; s++)
                    if (f = c[s],
                    f != null && (f.getPath ? t = f.getPath() : f.position && (t = f.position),
                    t !== undefined && t != null)) {
                        if (u = null,
                        t.nearestPoint)
                            if (r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857)
                                if (t instanceof FBM.FWCircle) {
                                    var d = t.getCenter()
                                      , i = FBM.Geometry.Transform(d, FBM.WGS84ToGoo)
                                      , g = t.getRadius()
                                      , y = new FBM.FWCircle;
                                    y.setCenter(i);
                                    y.setRadius(g);
                                    u = y.nearestPoint(w, e, r.options.snapOptions)
                                } else
                                    u = t.nearestPoint(a, b, r.options.snapOptions);
                            else
                                u = t.nearestPoint(w, e, r.options.snapOptions);
                        u != null && (h = u.point,
                        p = u.distance,
                        h !== undefined && p < v && (v = p,
                        o = new FBM.FWPoint(h.x,h.y),
                        r.map.getCoordSys() != FBM.FWCoordSys.EPSG3857 || t instanceof FBM.FWCircle || (o = FBM.Geometry.Transform(o, FBM.WGS84ToGoo))))
                    }
            return o
        }
        ;
        this.onKeyboardKey = function(n, t) {
            var a = t.getMapBase(), e, o, s, f, i;
            if (n == FBM.KeyboardEditor.DEL)
                (r.moveGraphicByKey || r.moveNodeByKey) && (r.moveNodeByKey && d >= 0 && d < u.length || r.moveGraphicByKey && u.length > 0 && w != null && r.setModifyMode(FBM.FWModifyType.DELETE));
            else {
                e = 0;
                o = 0;
                n == FBM.KeyboardEditor.UP ? o = 1 : n == FBM.KeyboardEditor.DOWN ? o = -1 : n == FBM.KeyboardEditor.LEFT ? e = -1 : n == FBM.KeyboardEditor.RIGHT && (e = 1);
                var h = a.ToMapDistX(1)
                  , c = h * e
                  , l = h * o;
                if (r.moveGraphicByKey || r.moveNodeByKey)
                    if (r.moveNodeByKey && d >= 0 && d < u.length)
                        f = u[d],
                        i = f.getPosition(),
                        t.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.WGS84ToGoo)),
                        i.transform(1, 0, 0, 1, c, l),
                        t.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.GooToWGS84)),
                        f.setPosition(i),
                        f.update(),
                        r.redrawModifies();
                    else if (r.moveGraphicByKey && u.length > 0) {
                        for (s = 0; s < u.length; s++)
                            f = u[s],
                            i = f.getPosition(),
                            t.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.WGS84ToGoo)),
                            i.transform(1, 0, 0, 1, c, l),
                            t.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.GooToWGS84)),
                            f.setPosition(i),
                            f.update();
                        r.redrawModifies()
                    }
            }
        }
        ;
        this.selectVertex = function(n, t) {
            var i, e, f, o;
            r.moveNodeByKey && (d >= 0 && d < u.length && (i = u[d],
            i !== undefined && (e = r.options.modifyIndicateOptions.node,
            i.setIcon(e)),
            d = -1),
            n && t !== undefined && (f = u.indexOf(t),
            f >= 0 && (d = f,
            o = r.options.modifyIndicateOptions.move,
            t.setIcon(o))))
        }
        ;
        this.vertexSelected = function(n) {
            r.selectVertex(!0, n);
            r.redrawModifies()
        }
        ;
        this.vertexDragged = function(n) {
            var t, i;
            r.moveNodeByKey && r.selectVertex(!1, null);
            t = n.getPosition();
            r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (t = FBM.Geometry.Transform(t, FBM.WGS84ToGoo));
            i = r.snapToGraphics(t);
            r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.GooToWGS84));
            n.setPosition(i);
            n.update();
            r.redrawModifies()
        }
        ;
        this.vertexRemove = function(n) {
            var t = n.target, i, f;
            t != null && (i = u.indexOf(t),
            i >= 0 && (r.moveNodeByKey && i == d && selecteVertex(!1, null),
            f = u.length,
            (v == FBM.FWOverlayType.POLYGON || v == FBM.FWOverlayType.LINESTRING) && (t.setEditable && (r.moveNodeByKey && t.setClickCallback(null),
            t.setMoveCallback(null),
            t.setEditable(!1),
            t.setMap(null),
            t = null),
            u.splice(i, 1)),
            r.moveNodeByKey));
            r.redrawModifies()
        }
        ;
        this.pseudoAdd = function(n) {
            var i = n.target, f, e, t;
            i != null && (f = b.indexOf(i),
            f >= 0 && (e = u.length,
            (v == FBM.FWOverlayType.POLYGON || v == FBM.FWOverlayType.LINESTRING) && (t = new FBM.FWMarker(r.map,i.position,"",r.options.modifyIndicateOptions.node,ft),
            t.setEditable && (t.setEditable(!0),
            r.moveNodeByKey && t.setClickCallback(r.vertexSelected),
            t.setMoveCallback(r.vertexDragged),
            FBM.FWEvent.addListener(t, "rightclick", r.vertexRemove)),
            u.splice(f + 1, 0, t))));
            r.redrawModifies()
        }
        ;
        this.redrawModifies = function() {
            var f, o, n, s, e, h, t;
            for (k != null && k.setPath(null),
            tt != null && tt.setPath(null),
            i = 0; i < b.length; i++)
                t = b[i],
                t && t.setMap(null);
            b = [];
            f = !0;
            u.length <= 1 && (f = !1);
            r.moveGraphicByKey && (v == FBM.FWOverlayType.MARKER || v == FBM.FWOverlayType.LABEL) && u.length <= 1 && (f = !0);
            n = [];
            s = r.options.modifyIndicateOptions.pseudo;
            switch (v) {
            case FBM.FWOverlayType.POLYGON:
                for (u.length < 3 && (f = !1),
                i = 0; i < u.length; i++)
                    n.push(u[i].position),
                    i > 0 && (e = new FBM.FWPoint((u[i].position.x + u[i - 1].position.x) / 2,(u[i].position.y + u[i - 1].position.y) / 2),
                    b.push(new FBM.FWMarker(r.map,e,"",s,ot)));
                n.push(u[0].position);
                e = new FBM.FWPoint((u[0].position.x + u[u.length - 1].position.x) / 2,(u[0].position.y + u[u.length - 1].position.y) / 2);
                b.push(new FBM.FWMarker(r.map,e,"",s,ot));
                o = new FBM.FWLineString(n);
                break;
            case FBM.FWOverlayType.LINESTRING:
                for (u.length < 2 && (f = !1),
                i = 0; i < u.length; i++)
                    n.push(u[i].position),
                    i > 0 && (e = new FBM.FWPoint((u[i].position.x + u[i - 1].position.x) / 2,(u[i].position.y + u[i - 1].position.y) / 2),
                    b.push(new FBM.FWMarker(r.map,e,"",s,ot)));
                o = new FBM.FWLineString(n);
                break;
            case FBM.FWOverlayType.ENVELOPE:
                n.push(new FBM.FWPoint(u[0].position.x,u[0].position.y));
                n.push(new FBM.FWPoint(u[1].position.x,u[0].position.y));
                n.push(new FBM.FWPoint(u[1].position.x,u[1].position.y));
                n.push(new FBM.FWPoint(u[0].position.x,u[1].position.y));
                n.push(new FBM.FWPoint(u[0].position.x,u[0].position.y));
                o = new FBM.FWLineString(n);
                break;
            case FBM.FWOverlayType.CIRCLE:
                n.push(new FBM.FWPoint(u[0].position.x,u[0].position.y));
                n.push(new FBM.FWPoint(u[1].position.x,u[1].position.y));
                o = new FBM.FWLineString(n);
                h = r.createCircle(u[0].position, u[1].position);
                tt != null && tt.setPath(h)
            }
            for (i = 0; i < b.length; i++)
                t = b[i],
                t && FBM.FWEvent.addListener(t, "click", r.pseudoAdd);
            k != null && k.setPath(o);
            r.modifyControl && r.modifyControl.setButtonState("SAVE", f)
        }
        ;
        this.createCircle = function(n, t) {
            var i = n
              , f = t;
            r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? (i = FBM.Geometry.Transform(n, FBM.WGS84ToGoo),
            f = FBM.Geometry.Transform(t, FBM.WGS84ToGoo)) : (i = n,
            f = t);
            var e = i.x - f.x
              , o = i.y - f.y
              , s = Math.sqrt(e * e + o * o)
              , u = new FBM.FWCircle;
            return u.setCenter(i),
            u.setRadius(s),
            r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (u = FBM.Geometry.Transform(u, FBM.GooToWGS84)),
            u
        }
        ;
        this.createEnvelope = function(n, t) {
            return new FBM.FWEnvelope(n.x > t.x ? t.x : n.x,n.y < t.y ? t.y : n.y,n.x < t.x ? t.x : n.x,n.y > t.y ? t.y : n.y)
        }
        ;
        this.getAllGraphics = function() {
            return c
        }
        ;
        this.takeAllGraphics = function() {
            var t, n, u;
            for (this.setDrawingMode(FBM.FWOverlayType.NONE, !0),
            t = [],
            i = 0; i < c.length; i++)
                n = c[i],
                n && (n.setEditable && n.setEditable(!1),
                t.push(n));
            return c = [],
            u = new FBM.OverlayCompleteEvent(r.map,"GRAPHICS","TAKE"),
            FBM.FWEvent.trigger_(r, "overlay_complete", u),
            t
        }
        ;
        this.cloneAllGraphics = function() {
            var u = [], n, t, f;
            for (i = 0; i < c.length; i++)
                n = c[i],
                n && n.clone && (t = n.clone(),
                n.geoJsonProperties && (t.geoJsonProperties = n.geoJsonProperties),
                u.push(t));
            return f = new FBM.OverlayCompleteEvent(r.map,"GRAPHICS","CLONE"),
            FBM.FWEvent.trigger_(r, "overlay_complete", f),
            u
        }
        ;
        this.clearAllGraphics = function() {
            var u = this.getDrawingMode(), n, t;
            for (u == FBM.FWOverlayType.MODIFY && this.setModifyMode(FBM.FWModifyType.CANCEL, !1),
            i = 0; i < c.length; i++)
                n = c[i],
                n && (n.setEditable && n.setEditable(!1),
                n.setMap(null));
            c = [];
            t = new FBM.OverlayCompleteEvent(r.map,"GRAPHICS","CLEAR");
            FBM.FWEvent.trigger_(r, "overlay_complete", t)
        }
        ;
        this.clearModifies = function() {
            var n;
            for (r.moveNodeByKey && r.selectVertex(!1, null),
            i = 0; i < u.length; i++)
                n = u[i],
                n && (n.setEditable && n.setEditable(!1),
                n.click_ && FBM.FWEvent.removeListener(n.click_[0]),
                n.setMap(null));
            for (u = [],
            k != null && (k.click_ && FBM.FWEvent.removeListener(k.click_[0]),
            k.setMap(null),
            k = null),
            tt != null && (tt.click_ && FBM.FWEvent.removeListener(tt.click_[0]),
            tt.setMap(null),
            tt = null),
            i = 0; i < b.length; i++)
                n = b[i],
                n && (n.click_ && FBM.FWEvent.removeListener(n.click_[0]),
                n.setMap(null));
            b = []
        }
        ;
        st = "{}";
        this.setModifyMode = function(n, t) {
            var d = !0, e, i, b, g, nt, p, tt, it, rt, f, o, s;
            t !== undefined && typeof t == "boolean" && (d = t);
            switch (n) {
            case FBM.FWModifyType.SAVE:
                if (k != null) {
                    i = k.getPath();
                    switch (v) {
                    case FBM.FWOverlayType.POLYGON:
                        b = i.getPath();
                        b.splice(-1, 1);
                        i = new FBM.FWLineString(b);
                        g = new FBM.FWLinearRing(i);
                        nt = new FBM.FWPolygon([g]);
                        e = nt;
                        break;
                    case FBM.FWOverlayType.LINESTRING:
                        e = i;
                        break;
                    case FBM.FWOverlayType.ENVELOPE:
                        var h = i.path[0].x
                          , l = i.path[0].y
                          , a = i.path[2].x
                          , y = i.path[2].y;
                        h >= a && (p = h,
                        h = a,
                        a = p);
                        l < y && (p = l,
                        l = y,
                        y = p);
                        tt = new FBM.FWEnvelope(h,l,a,y);
                        e = tt;
                        break;
                    case FBM.FWOverlayType.CIRCLE:
                        it = r.createCircle(i.path[0], i.path[1]);
                        e = it
                    }
                } else
                    (v == FBM.FWOverlayType.MARKER || v == FBM.FWOverlayType.LABEL) && (rt = new FBM.FWPoint(u[0].position.x,u[0].position.y),
                    e = rt);
                e !== undefined && (w != null && (f = c.indexOf(w),
                f >= 0 && (o = c[f],
                st = o.geoJsonProperties,
                s = new FBM.OverlayCompleteEvent(o,v,"DEL"),
                FBM.FWEvent.trigger_(r, "overlay_complete", s),
                o.setMap(null),
                c.splice(f, 1)),
                w = null),
                r.addGraphic(e, v));
                break;
            case FBM.FWModifyType.DELETE:
                w != null && (f = c.indexOf(w),
                f >= 0 && (o = c[f],
                s = new FBM.OverlayCompleteEvent(o,v,"DEL"),
                FBM.FWEvent.trigger_(r, "overlay_complete", s),
                o.setMap(null),
                c.splice(f, 1)),
                w = null);
                break;
            case FBM.FWModifyType.CANCEL:
                w = null
            }
            n != FBM.FWModifyType.STARTED && n != FBM.FWModifyType.ATTRIBUTE && (r.moveGraphicByKey && w == null && r.map.setKeyboardEdit(!1, null),
            r.clearModifies(),
            d && r.getDrawingMode() != FBM.FWOverlayType.EDIT && (s = new FBM.OverlayCompleteEvent(r.map,n),
            FBM.FWEvent.trigger_(r, "modify_complete", s),
            r.setDrawingMode(FBM.FWOverlayType.EDIT)))
        }
        ;
        this.addGraphic = function(n, t, i, u) {
            var f, o, e, s;
            if (n) {
                e = null;
                i && (e = i);
                switch (t) {
                case FBM.FWOverlayType.POLYGON:
                    f = new FBM.FWFill(r.map,n,e == null ? r.options.polygonOptions : e);
                    o = "polygon_complete";
                    break;
                case FBM.FWOverlayType.LINESTRING:
                    f = new FBM.FWLine(r.map,n,e == null ? r.options.polylineOptions : e);
                    o = "linestring_complete";
                    break;
                case FBM.FWOverlayType.ENVELOPE:
                    f = new FBM.FWFill(r.map,n,e == null ? r.options.envelopeOptions : e);
                    o = "envelope_complete";
                    break;
                case FBM.FWOverlayType.CIRCLE:
                    f = new FBM.FWFill(r.map,n,e == null ? r.options.circleOptions : e);
                    o = "circle_complete";
                    break;
                case FBM.FWOverlayType.MARKER:
                    f = new FBM.FWMarker(r.map,n);
                    f.setMarkerOptions(e == null ? r.options.markerOptions : e);
                    o = "marker_complete";
                    break;
                case FBM.FWOverlayType.LABEL:
                    f = new FBM.FWLabel(e == null ? r.options.labelOptions : e);
                    f.setPosition(n);
                    f.setMap(r.map);
                    o = "label_complete"
                }
                hi && f.setTitle && (f.setTitle(ci + " " + ti),
                ti++);
                f.geoJson = ai(f, t);
                f.geoJsonProperties = u ? u : st != "{}" ? st : "{}";
                c.push(f);
                s = new FBM.OverlayCompleteEvent(f,t,"ADD");
                FBM.FWEvent.trigger_(r, o, s);
                FBM.FWEvent.trigger_(r, "overlay_complete", s)
            }
        }
        ;
        this.load = function(n) {
            var i = function(n) {
                var t, u, i;
                if (n.geoJsonProperties ? t = n.geoJsonProperties : n.properties && (t = n.properties),
                n instanceof FBM.FWMarker)
                    r.addGraphic(n.position, FBM.FWOverlayType.MARKER, null, t);
                else if (n instanceof FBM.FWLabel)
                    r.addGraphic(n.position, FBM.FWOverlayType.LABEL, null, t);
                else if (n instanceof FBM.FWLine)
                    r.addGraphic(n.getPath(), FBM.FWOverlayType.LINESTRING, null, t);
                else if (n instanceof FBM.FWFill)
                    u = n.getPath(),
                    u instanceof FBM.FWEnvelope ? r.addGraphic(u, FBM.FWOverlayType.ENVELOPE, null, t) : u instanceof FBM.FWCircle ? r.addGraphic(u, FBM.FWOverlayType.CIRCLE, null, t) : u instanceof FBM.FWPolygon && r.addGraphic(u, FBM.FWOverlayType.POLYGON, null, t);
                else if (n.geometry instanceof FBM.FWMultiPoint)
                    for (i = 0; i < n.geometry.geoms.length; i++)
                        r.addGraphic(n.geometry.geoms[i], FBM.FWOverlayType.MARKER, null, t);
                else if (n.geometry instanceof FBM.FWPoint)
                    r.addGraphic(n.geometry, FBM.FWOverlayType.MARKER, null, t);
                else if (n.geometry instanceof FBM.FWMultiLineString)
                    for (i = 0; i < n.geometry.geoms.length; i++)
                        r.addGraphic(n.geometry.geoms[i], FBM.FWOverlayType.LINESTRING, null, t);
                else if (n.geometry instanceof FBM.FWLineString)
                    r.addGraphic(n.geometry, FBM.FWOverlayType.LINESTRING, null, t);
                else if (n.geometry instanceof FBM.FWEnvelope)
                    r.addGraphic(n.geometry, FBM.FWOverlayType.ENVELOPE, null, t);
                else if (n.geometry instanceof FBM.FWCircle)
                    r.addGraphic(n.geometry, FBM.FWOverlayType.CIRCLE, null, t);
                else if (n.geometry instanceof FBM.FWMultiPolygon)
                    for (i = 0; i < n.geometry.geoms.length; i++)
                        r.addGraphic(n.geometry.geoms[i], FBM.FWOverlayType.POLYGON, null, t);
                else
                    n.geometry instanceof FBM.FWPolygon && r.addGraphic(n.geometry, FBM.FWOverlayType.POLYGON, null, t)
            }, u, t, f;
            if (this.setDrawingMode(FBM.FWOverlayType.NONE, !0),
            n instanceof Array)
                for (u = n.length,
                t = 0; t < u; t++)
                    i(n[t]);
            else
                i(n);
            f = new FBM.OverlayCompleteEvent(r.map,"GRAPHICS","LOAD");
            FBM.FWEvent.trigger_(r, "overlay_complete", f);
            this.getMap().getMapBase().RefreshMap()
        }
        ;
        var ai = function(n, t) {
            var u, i, e, f, o, s, h, c, y, p, w;
            if (t == FBM.FWOverlayType.MARKER)
                u = n.position.toGeoJson();
            else if (t == FBM.FWOverlayType.LABEL)
                u = n.getPosition().toGeoJson();
            else if (t == FBM.FWOverlayType.ENVELOPE)
                i = [],
                n.getPath && (n = n.getPath()),
                i.push([n.getLeft(), n.getTop()]),
                i.push([n.getRight(), n.getTop()]),
                i.push([n.getRight(), n.getBottom()]),
                i.push([n.getLeft(), n.getBottom()]),
                i.push([n.getLeft(), n.getTop()]),
                u = {
                    type: "Polygon",
                    coordinates: [i]
                };
            else if (t == FBM.FWOverlayType.CIRCLE) {
                n.getPath && (n = n.getPath());
                e = r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? FBM.WGS84toTWD97(n.getCenter().x, n.getCenter().y) : n.getCenter();
                var b = e.x
                  , k = e.y
                  , l = n.getRadius()
                  , a = []
                  , v = [];
                for (f = 0; f <= 360; f += 12)
                    o = b + Math.sin(f * Math.PI / 180) * l,
                    s = k + Math.cos(f * Math.PI / 180) * l,
                    r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 ? (c = FBM.TWD97toWGS84(o, s),
                    h = new FBM.FWPoint(c.x,c.y)) : h = new FBM.FWPoint(o,s),
                    v.push(h);
                y = new FBM.FWLineString(v);
                p = new FBM.FWLinearRing(y);
                a.push(p);
                w = new FBM.FWPolygon(a);
                u = w.toGeoJson()
            } else
                (t == FBM.FWOverlayType.POLYGON || t == FBM.FWOverlayType.LINESTRING) && (u = n.getPath().toGeoJson());
            return u
        }, et, vt = function(n, t) {
            var i, u = n.slice();
            if (t && u.pop(),
            r.getDrawingMode() == FBM.FWOverlayType.POLYGON) {
                var f = new FBM.FWLineString(u)
                  , e = new FBM.FWLinearRing(f)
                  , o = new FBM.FWPolygon([e]);
                i = o
            } else
                i = new FBM.FWLineString(u);
            return r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(i, FBM.GooToWGS84)),
            i
        }, l;
        this.enterEnvMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.ENVELOPE)
        }
        ;
        this.enterEnvelopeMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.ENVELOPE)
        }
        ;
        this.enterCircleMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.CIRCLE)
        }
        ;
        this.enterPolyMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.POLYGON)
        }
        ;
        this.enterPolygonMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.POLYGON)
        }
        ;
        this.enterLineStrMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.LINESTRING)
        }
        ;
        this.enterLineMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.LINESTRING)
        }
        ;
        this.enterMarkMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.MARKER)
        }
        ;
        this.enterMarkerMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.MARKER)
        }
        ;
        this.enterLabelMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.LABEL)
        }
        ;
        this.enterEditMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.EDIT)
        }
        ;
        this.enterModifyMode = function() {
            this.setDrawingMode(FBM.FWOverlayType.MODIFY)
        }
        ;
        this.graphicMoved = function(n) {
            var t, i, u;
            n && (t = "UNKNOWN",
            n instanceof FBM.FWMarker ? t = "MARKER" : n instanceof FBM.FWLabel ? t = "LABEL" : n.getPath && (i = n.getPath(),
            i instanceof FBM.FWEnvelope ? t = "ENVELOPE" : i instanceof FBM.FWCircle ? t = "CIRCLE" : i instanceof FBM.FWPolygon || i instanceof FBM.FWMultiPolygon ? t = "POLYGON" : (i instanceof FBM.FWLineString || i instanceof FBM.FWMultiLineString) && (t = "LINESTRING")),
            u = new FBM.OverlayCompleteEvent(n,t,"MOVED"),
            FBM.FWEvent.trigger_(r, "graphic_moved", u))
        }
        ;
        this.cancelSegDrawing = function() {
            if (a = null,
            l != null) {
                l.setMap(null);
                var n = c.indexOf(l);
                n >= 0 && c.splice(n, 1);
                l = null
            }
            DetachEvent(o, "mousemove", ht);
            DetachEvent(o, "dblclick", yt)
        }
        ;
        this.cancelEditingMode = function() {
            for (this.useDefaultControl && (o.style.cursor = "default"),
            i = 0; i < c.length; i++) {
                var n = c[i];
                n.setEditable && (n.setEditable(!1),
                n.setClickCallback(null),
                n.setMovedCallback(null))
            }
        }
        ;
        this.setCircleDblClick = function(n) {
            this.circleDblClick = n
        }
        ;
        this.setEnvelopeDblClick = function(n) {
            this.envelopeDblClick = n
        }
        ;
        this.isCircleDblClick = function() {
            return this.circleDblClick
        }
        ;
        this.isEnvelopeDblClick = function() {
            return this.envelopeDblClick
        }
        ;
        var ut = "fwoverlay"
          , yt = function(n) {
            var e;
            if (n.currentTarget.className == ut) {
                util.disableDefault(n);
                f(n);
                DEBUG_MODE && console.log("drawEnd.");
                DetachEvent(o, "mousemove", ht);
                DetachEvent(o, "dblclick", yt);
                var s = r.getDrawingMode()
                  , h = r.map.getMapBase()
                  , i = t(o)
                  , c = n.clientX - i.x
                  , v = n.clientY - i.y
                  , u = h.ToMapPoint(c, v);
                u = r.snapToGraphics(u);
                e = vt(a, !0);
                a = null;
                r.addGraphic(e, s);
                l != null && (l.setMap(null),
                l = null)
            }
        }
          , ii = function(n) {
            var i, h;
            if (n.currentTarget.className == ut && (DEBUG_MODE && console.log("drawSegment."),
            DetachEvent(o, "mouseup", ii),
            g = null,
            nt = null,
            !y)) {
                i = r.getDrawingMode();
                a || (a = []);
                a.length <= 0 && (AttachEvent(o, "dblclick", yt),
                i == FBM.FWOverlayType.POLYGON ? l = new FBM.FWFill(r.map,null,r.options.polygonOptions) : i == FBM.FWOverlayType.LINESTRING && (l = new FBM.FWLine(r.map,null,r.options.polylineOptions)));
                var c = r.map.getMapBase()
                  , f = t(o)
                  , e = n.clientX - f.x
                  , s = n.clientY - f.y
                  , u = c.ToMapPoint(e, s);
                u = r.snapToGraphics(u);
                a.push(u);
                ni || (ni = r.map.getPaper().path("M" + e + "," + s));
                h = vt(a);
                l != null && l.setPath(h)
            }
        }
          , ht = function(n) {
            var i = n.clientX, u = n.clientY, s;
            if ((it != i || rt != u) && (it = i,
            rt = u,
            DEBUG_MODE && console.log("drawMove."),
            y || (y = !gt(i, u, g, nt),
            y && DEBUG_MODE && console.log("drawMoved.")),
            !g || !nt || !y) && a && !(a.length <= 0) && l) {
                var h = r.map.getMapBase()
                  , e = t(o)
                  , c = i - e.x
                  , v = u - e.y
                  , f = h.ToMapPoint(c, v);
                f = r.snapToGraphics(f);
                s = vt(a.concat(f));
                l.setPath(s)
            }
        }
          , pt = function(n) {
            n.currentTarget.className == ut && (DEBUG_MODE && console.log("drawStart."),
            util.disableDefault(n),
            it = g = n.clientX,
            rt = nt = n.clientY,
            y = !1,
            AttachEvent(o, "mouseup", ii),
            AttachEvent(o, "mousemove", ht))
        }
          , ri = function(n) {
            var s, u, e, h;
            if (n.currentTarget.className == ut) {
                util.disableDefault(n);
                f(n);
                DEBUG_MODE && console.log("drawEnd.");
                DetachEvent(o, "mousemove", wt);
                DetachEvent(o, "dblclick", ri);
                var v = n.clientX
                  , y = n.clientY
                  , p = r.map.getMapBase()
                  , c = t(o)
                  , w = v - c.x
                  , b = y - c.y
                  , i = p.ToMapPoint(w, b);
                i = r.snapToGraphics(i);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (s = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                i = new FBM.FWPoint(s.x,s.y));
                u = r.getDrawingMode();
                h = a[0];
                u == FBM.FWOverlayType.CIRCLE ? e = r.createCircle(h, i) : u == FBM.FWOverlayType.ENVELOPE && (e = r.createEnvelope(h, i));
                a = null;
                e && r.addGraphic(e, u);
                l != null && (l.setMap(null),
                l = null)
            }
        }
          , ui = function(n) {
            var u, f;
            if (DEBUG_MODE && console.log("simpleUp."),
            DetachEvent(o, "mouseup", ui),
            !y) {
                u = r.getDrawingMode();
                a || (a = []);
                a.length <= 0 && (AttachEvent(o, "dblclick", ri),
                u == FBM.FWOverlayType.CIRCLE ? l = new FBM.FWFill(r.map,null,r.options.circleOptions) : u == FBM.FWOverlayType.ENVELOPE && (l = new FBM.FWFill(r.map,null,r.options.envelopeOptions)));
                var s = r.map.getMapBase()
                  , e = t(o)
                  , h = n.clientX - e.x
                  , c = n.clientY - e.y
                  , i = s.ToMapPoint(h, c);
                i = r.snapToGraphics(i);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (f = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                i = new FBM.FWPoint(f.x,f.y));
                a.push(i)
            }
        }
          , wt = function(n) {
            var u = n.clientX, f = n.clientY, e, s, h, c;
            if ((it != u || rt != f) && (it = u,
            rt = f,
            DEBUG_MODE && console.log("simpleMove."),
            y || (y = !gt(u, f, g, nt),
            y && DEBUG_MODE && console.log("simpleMoved.")),
            a && !(a.length <= 0) && l)) {
                var p = r.map.getMapBase()
                  , v = t(o)
                  , w = u - v.x
                  , b = f - v.y
                  , i = p.ToMapPoint(w, b);
                i = r.snapToGraphics(i);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (e = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                i = new FBM.FWPoint(e.x,e.y));
                s = r.getDrawingMode();
                c = a[0];
                s == FBM.FWOverlayType.CIRCLE ? h = r.createCircle(c, i) : s == FBM.FWOverlayType.ENVELOPE && (h = r.createEnvelope(c, i));
                l && l.setPath(h)
            }
        }
          , bt = function(n) {
            var i;
            if (n.currentTarget.className == ut) {
                DEBUG_MODE && console.log("simpleStart.");
                util.disableDefault(n);
                it = g = n.clientX;
                rt = nt = n.clientY;
                y = !1;
                var f = r.map.getMapBase()
                  , u = t(o)
                  , e = g - u.x
                  , s = nt - u.y
                  , h = f.ToMapPoint(e, s);
                p = r.snapToGraphics(h);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(p, FBM.GooToWGS84),
                p = new FBM.FWPoint(i.x,i.y));
                AttachEvent(o, "mousemove", wt);
                AttachEvent(o, "mouseup", ui)
            }
        }
          , fi = function(n) {
            var s, h, u, i, c;
            if (n.currentTarget.className == ut) {
                if (util.disableDefault(n),
                f(n),
                DetachEvent(o, "mousemove", ei, !1),
                DetachEvent(o, "mouseup", fi, !1),
                s = n.clientX,
                h = n.clientY,
                DEBUG_MODE && console.log("dragEnd X = " + s + ", Y = " + h),
                u = null,
                i = r.getDrawingMode(),
                i == FBM.FWOverlayType.CIRCLE || i == FBM.FWOverlayType.ENVELOPE) {
                    var l = t(o)
                      , a = s - l.x
                      , v = h - l.y
                      , y = r.map.getMapBase()
                      , w = y.ToMapPoint(a, v)
                      , e = r.snapToGraphics(w);
                    r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (c = FBM.Geometry.Transform(e, FBM.GooToWGS84),
                    e = new FBM.FWPoint(c.x,c.y));
                    i == FBM.FWOverlayType.CIRCLE ? u = r.createCircle(p, e) : i == FBM.FWOverlayType.ENVELOPE && (u = r.createEnvelope(p, e))
                }
                u && r.addGraphic(u, i);
                et != null && (et.setMap(null),
                et = null)
            }
        }
          , ei = function(n) {
            var u = n.clientX, f = n.clientY, e, s, h;
            if (it != u || rt != f) {
                it = u;
                rt = f;
                DEBUG_MODE && console.log("dragMove.");
                var c = t(o)
                  , l = u - c.x
                  , a = f - c.y
                  , v = r.map.getMapBase()
                  , y = v.ToMapPoint(l, a)
                  , i = r.snapToGraphics(y);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (e = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                i = new FBM.FWPoint(e.x,e.y));
                h = r.getDrawingMode();
                DEBUG_MODE && console.log("Move (" + i.x + "," + i.y + ")-(" + p.x + "," + p.y + ")");
                h == FBM.FWOverlayType.CIRCLE ? s = r.createCircle(p, i) : h == FBM.FWOverlayType.ENVELOPE && (s = r.createEnvelope(p, i));
                et && et.setPath(s)
            }
        }
          , kt = function(n) {
            var i;
            if (n.currentTarget.className == ut) {
                util.disableDefault(n);
                f(n);
                it = lt = n.clientX;
                rt = at = n.clientY;
                DEBUG_MODE && console.log("dragStart X = " + lt + ", Y = " + at);
                var u = t(o)
                  , e = lt - u.x
                  , s = at - u.y
                  , h = r.map.getMapBase()
                  , c = h.ToMapPoint(e, s);
                p = r.snapToGraphics(c);
                r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (i = FBM.Geometry.Transform(p, FBM.GooToWGS84),
                p = new FBM.FWPoint(i.x,i.y));
                DEBUG_MODE && console.log("clickPoint X= " + p.x + ", Y = " + p.y);
                switch (r.getDrawingMode()) {
                case FBM.FWOverlayType.ENVELOPE:
                    et = new FBM.FWFill(r.map,null,r.options.envelopeOptions);
                    break;
                case FBM.FWOverlayType.CIRCLE:
                    et = new FBM.FWFill(r.map,null,r.options.circleOptions)
                }
                AttachEvent(o, "mousemove", ei);
                AttachEvent(o, "mouseup", fi)
            }
        }
          , oi = function(n) {
            var u, e, i, s, h;
            if (n.currentTarget.className == ut && (util.disableDefault(n),
            f(n),
            DetachEvent(o, "mousemove", si),
            DetachEvent(o, "mouseup", oi),
            !y)) {
                if (u = n.clientX,
                e = n.clientY,
                DEBUG_MODE && console.log("clickEnd X = " + u + ", Y = " + e),
                i = null,
                s = r.getDrawingMode(),
                s == FBM.FWOverlayType.MARKER || s == FBM.FWOverlayType.LABEL) {
                    var c = t(o)
                      , l = u - c.x
                      , a = e - c.y
                      , v = r.map.getMapBase()
                      , p = v.ToMapPoint(l, a);
                    i = r.snapToGraphics(p);
                    r.map.getCoordSys() == FBM.FWCoordSys.EPSG3857 && (h = FBM.Geometry.Transform(i, FBM.GooToWGS84),
                    i = new FBM.FWPoint(h.x,h.y))
                }
                i !== null && (DEBUG_MODE && console.log("Add Point X= " + i.x + ", Y = " + i.y),
                r.addGraphic(i, r.drawingMode))
            }
        }
          , si = function(n) {
            if (util.disableDefault(n),
            f(n),
            !y) {
                var t = n.clientX
                  , i = n.clientY;
                y = !gt(t, i, g, nt);
                y && DEBUG_MODE && console.log("clickMoved.")
            }
        }
          , dt = function(n) {
            n.currentTarget.className == ut && (util.disableDefault(n),
            g = n.clientX,
            nt = n.clientY,
            y = !1,
            DEBUG_MODE && console.log("clickStart : X = " + g + ", Y = " + nt),
            AttachEvent(o, "mouseup", oi),
            AttachEvent(o, "mousemove", si))
        }
          , gt = function(n, t, i, r) {
            var u = !1;
            return (n - 1 === i || n === i || n + 1 === i) && (t - 1 === r || t === r || t + 1 === r) && (u = !0),
            u
        };
        this.setDrawingMode = function(n, t) {
            var f = this.drawingMode, u, e;
            if (f != n) {
                f != FBM.FWOverlayType.NONE && (f == FBM.FWOverlayType.POLYGON || f == FBM.FWOverlayType.LINESTRING ? r.cancelSegDrawing() : f == FBM.FWOverlayType.EDIT ? r.cancelEditingMode() : f == FBM.FWOverlayType.MODIFY && (t ? r.setModifyMode(FBM.FWModifyType.CANCEL, !0) : r.setModifyMode(FBM.FWModifyType.CANCEL, !1)));
                o = this.map.getPanes().graphicLayer;
                DetachEvent(o, "mousedown", dt);
                DetachEvent(o, "mousedown", kt);
                DetachEvent(o, "mousedown", pt);
                DetachEvent(o, "mousemove", ht);
                DetachEvent(o, "mousedown", bt);
                DetachEvent(o, "mousemove", wt);
                r.useDefaultControl && (o.style.cursor = "crosshair");
                this.map.setOverlayForwardEvent(!1);
                switch (n) {
                case FBM.FWOverlayType.ENVELOPE:
                    this.envelopeDblClick ? AttachEvent(o, "mousedown", bt) : AttachEvent(o, "mousedown", kt);
                    this.drawingMode = FBM.FWOverlayType.ENVELOPE;
                    break;
                case FBM.FWOverlayType.CIRCLE:
                    this.circleDblClick ? AttachEvent(o, "mousedown", bt) : AttachEvent(o, "mousedown", kt);
                    this.drawingMode = FBM.FWOverlayType.CIRCLE;
                    break;
                case FBM.FWOverlayType.POLYGON:
                    AttachEvent(o, "mousedown", pt);
                    this.drawingMode = FBM.FWOverlayType.POLYGON;
                    break;
                case FBM.FWOverlayType.LINESTRING:
                    AttachEvent(o, "mousedown", pt);
                    this.drawingMode = FBM.FWOverlayType.LINESTRING;
                    break;
                case FBM.FWOverlayType.MARKER:
                    AttachEvent(o, "mousedown", dt);
                    this.drawingMode = FBM.FWOverlayType.MARKER;
                    break;
                case FBM.FWOverlayType.LABEL:
                    AttachEvent(o, "mousedown", dt);
                    this.drawingMode = FBM.FWOverlayType.LABEL;
                    break;
                case FBM.FWOverlayType.EDIT:
                    for (r.useDefaultControl && (this.modifyControl.setVisible(!1),
                    this.drawingControl.setVisible(!0),
                    o.style.cursor = "pointer"),
                    i = 0; i < c.length; i++)
                        u = c[i],
                        u.setEditable && (u.setClickCallback(li),
                        u.setEditable(!0),
                        u.setMovedCallback(r.graphicMoved));
                    this.drawingMode = FBM.FWOverlayType.EDIT;
                    break;
                case FBM.FWOverlayType.MODIFY:
                    for (r.useDefaultControl && (this.modifyControl.setVisible(!0),
                    this.drawingControl.setVisible(!1),
                    o.style.cursor = "default"),
                    i = 0; i < c.length; i++)
                        u = c[i],
                        u.setEditable && (u.setEditable(!1),
                        u.setClickCallback(null));
                    this.drawingMode = FBM.FWOverlayType.MODIFY;
                    break;
                case FBM.FWOverlayType.NONE:
                    r.cancelEditingMode();
                    this.map.setOverlayForwardEvent(this.overlayForwardEvent);
                    this.drawingMode = FBM.FWOverlayType.NONE
                }
                e = new FBM.OverlayCompleteEvent(r.map,this.drawingMode);
                FBM.FWEvent.trigger_(r, "drawmodeChanged", e);
                FBM.FWEvent.trigger_(r, "drawmode_changed", e);
                (n == FBM.FWOverlayType.NONE || n == FBM.FWOverlayType.MODIFY || FBM.FWOverlayType.EDIT) && FBM.FWEvent.trigger(r.map, "resize");
                this.drawingControl && this.drawingControl.toggleMode(n)
            }
        }
        ;
        this.defaultModifyModes = [FBM.FWModifyType.DELETE, FBM.FWModifyType.CANCEL, FBM.FWModifyType.SAVE];
        this.defaultDrawingModes = [FBM.FWOverlayType.ENVELOPE, FBM.FWOverlayType.POLYGON, FBM.FWOverlayType.CIRCLE, FBM.FWOverlayType.LINESTRING, FBM.FWOverlayType.LABEL, FBM.FWOverlayType.MARKER, FBM.FWOverlayType.EDIT];
        var vi = {
            inactive: {
                ENVELOPE: FBM.RES_PATH + "rect.png",
                CIRCLE: FBM.RES_PATH + "circle.png",
                MARKER: FBM.RES_PATH + "mark.png",
                LABEL: FBM.RES_PATH + "label.png",
                POLYGON: FBM.RES_PATH + "poly.png",
                LINESTRING: FBM.RES_PATH + "line.png",
                EDIT: FBM.RES_PATH + "edit.png"
            },
            active: {
                ENVELOPE: FBM.RES_PATH + "rect2.png",
                CIRCLE: FBM.RES_PATH + "circle2.png",
                MARKER: FBM.RES_PATH + "mark2.png",
                LABEL: FBM.RES_PATH + "label2.png",
                POLYGON: FBM.RES_PATH + "poly2.png",
                LINESTRING: FBM.RES_PATH + "line2.png",
                EDIT: FBM.RES_PATH + "edit2.png"
            }
        }
          , yi = {
            enabled: {
                ATTRIBUTE: FBM.RES_PATH + "attribute.png",
                SAVE: FBM.RES_PATH + "save.png",
                CANCEL: FBM.RES_PATH + "cancel.png",
                DELETE: FBM.RES_PATH + "delete.png"
            },
            disabled: {
                ATTRIBUTE: FBM.RES_PATH + "attribute2.png",
                SAVE: FBM.RES_PATH + "save2.png",
                CANCEL: FBM.RES_PATH + "cancel2.png",
                DELETE: FBM.RES_PATH + "delete2.png"
            }
        }
          , ct = {
            EDIT: FBM.RES_PATH + "vertex_edit.png",
            MOVE: FBM.RES_PATH + "vertex_move.png",
            ADD: FBM.RES_PATH + "vertex_add.png",
            CIRCLE_CENTER: FBM.RES_PATH + "circle_center.png"
        }
          , pi = new FBM.FWImage(ct.EDIT,new FBM.FWSize(21,21),new FBM.FWPoint(0,0),new FBM.FWPoint(10,10))
          , wi = new FBM.FWImage(ct.MOVE,new FBM.FWSize(21,21),new FBM.FWPoint(0,0),new FBM.FWPoint(10,10))
          , bi = new FBM.FWImage(ct.ADD,new FBM.FWSize(21,21),new FBM.FWPoint(0,0),new FBM.FWPoint(10,10))
          , ki = new FBM.FWImage(ct.CIRCLE_CENTER,new FBM.FWSize(21,21),new FBM.FWPoint(0,0),new FBM.FWPoint(10,10));
        (this.options = {
            drawingControl: !0,
            drawingControlOptions: {
                drawingModes: this.defaultDrawingModes,
                images: vi,
                controlPosition: FBM.FWControlPosition.BOTTOM_RIGHT
            },
            modifyControl: !1,
            modifyControlOptions: {
                modifyModes: this.defaultModifyModes,
                images: yi,
                controlPosition: FBM.FWControlPosition.BOTTOM_RIGHT
            },
            labelOptions: {
                fontSize: 20,
                fontColor: "#FF0000",
                font: "微軟正黑體",
                fontWeight: "normal",
                opacity: 1,
                label: "文字標記"
            },
            markerOptions: {
                title: "",
                clickable: !0,
                cursor: "",
                zIndex: "auto",
                flat: !1,
                icon: new FBM.FWImage(h.marker,new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(11,30)),
                shadow: new FBM.FWImage(h.shadow,new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(9,25))
            },
            polylineOptions: {
                clickable: !1,
                strokeWeight: 1,
                zIndex: "auto",
                strokeColor: "#555555",
                strokeLinecap: "round",
                strokeLinejoin: "round"
            },
            polygonOptions: {
                clickable: !1,
                opacity: 1,
                fillColor: "#eeaaaa",
                fillOpacity: .5,
                strokeWeight: 2,
                zIndex: "auto",
                strokeColor: "#555555",
                strokeOpacity: 1,
                strokeLinecap: "round",
                strokeLinejoin: "round"
            },
            circleOptions: {
                clickable: !1,
                opacity: 1,
                fillColor: "#eeaaaa",
                fillOpacity: .5,
                strokeWeight: 2,
                zIndex: "auto",
                strokeColor: "#555555",
                strokeOpacity: 1
            },
            envelopeOptions: {
                clickable: !1,
                opacity: 1,
                fillColor: "#eeaaaa",
                fillOpacity: .5,
                strokeWeight: 2,
                zIndex: "auto",
                strokeColor: "#555555",
                strokeOpacity: 1
            },
            modifyDrawingOptions: {
                lineOptions: {
                    clickable: !1,
                    strokeWeight: 1,
                    zIndex: "auto",
                    strokeColor: "#FFFF22",
                    strokeOpacity: 1
                },
                circleOptions: {
                    clickable: !1,
                    opacity: 1,
                    fillColor: "#00000000",
                    fillOpacity: 0,
                    strokeWeight: 1,
                    zIndex: "auto",
                    strokeColor: "#FFFF22",
                    strokeOpacity: 1
                }
            },
            modifyIndicateOptions: {
                node: pi,
                move: wi,
                pseudo: bi,
                circleCenter: ki
            },
            snapOptions: {
                snapping: !0,
                tolerance: 10,
                snapPoint: !0,
                snapEdge: !0,
                snapVertex: !0
            }
        },
        this.modifyControl = new s(this,this.options.modifyControlOptions),
        this.modifyControl.setVisible(!1),
        this.drawingControl = new e(this,this.options.drawingControlOptions),
        this.useDefaultControl || this.drawingControl.setVisible(!1),
        n) && (this.map = null)
    }
      , n = o.prototype;
    return n.setGraphicSelectedCallback = function(n) {
        this.graphicSelectedCallback = n
    }
    ,
    n.modifySelectedGraphic = function(n) {
        this.setModifyMode(n)
    }
    ,
    n.getDefaultControlVisible = function() {
        return this.useDefaultControl
    }
    ,
    n.setDefaultControlVisible = function(n) {
        if (this.useDefaultControl = n,
        n) {
            var t = this.getDrawingMode();
            t != FBM.FWOverlayType.MODIFY ? (this.modifyControl && this.modifyControl.setVisible(!1),
            this.drawingControl && this.drawingControl.setVisible(!0)) : (this.drawingControl && this.drawingControl.setVisible(!1),
            this.modifyControl && this.modifyControl.setVisible(!0))
        } else
            this.drawingControl && this.drawingControl.setVisible(!1),
            this.modifyControl && this.modifyControl.setVisible(!1)
    }
    ,
    n.getDrawingMode = function() {
        return this.drawingMode
    }
    ,
    n.getMap = function() {
        return this.map
    }
    ,
    n.setMap = function(n) {
        this.map = n;
        this.overlayForwardEvent = this.map.getOverlayForwardEvent();
        this.drawingControl && this.drawingControl.setMap(this.map);
        this.modifyControl && this.modifyControl.setMap(this.map)
    }
    ,
    n.clearAllGraphics = function() {
        this.drawingControl && this.drawingControl.manager && this.drawingControl.manager.clearAllGraphics()
    }
    ,
    n.getAllGraphics = function() {
        this.drawingControl && this.drawingControl.manager && this.drawingControl.manager.getAllGraphics()
    }
    ,
    n.getSnapping = function() {
        return this.options.snapOptions.snapping
    }
    ,
    n.getSnapTolerance = function() {
        return this.options.snapOptions.tolerance
    }
    ,
    n.getSnapToPoint = function() {
        return this.options.snapOptions.snapPoint
    }
    ,
    n.getSnapToEdge = function() {
        return this.options.snapOptions.snapEdge
    }
    ,
    n.getSnapToVertex = function() {
        return this.options.snapOptions.snapVertex
    }
    ,
    n.setSnapping = function(n) {
        n !== undefined && typeof n == "boolean" && (this.options.snapOptions.snapping = n)
    }
    ,
    n.setSnapTolerance = function(n) {
        n !== undefined && typeof n == "number" && (this.options.snapOptions.tolerance = n)
    }
    ,
    n.setSnapToPoint = function(n) {
        n !== undefined && typeof n == "boolean" && (this.options.snapOptions.snapPoint = n)
    }
    ,
    n.setSnapToEdge = function(n) {
        n !== undefined && typeof n == "boolean" && (this.options.snapOptions.snapEdge = n)
    }
    ,
    n.setSnapToVertex = function(n) {
        n !== undefined && typeof n == "boolean" && (this.options.snapOptions.snapVertex = n)
    }
    ,
    n.setSnapOptions = function(n) {
        n && (n.snapping !== undefined && this.setSnapping(n.snapping),
        n.tolerance !== undefined && this.setSnapTolerance(n.tolerance),
        n.snapPoint !== undefined && this.setSnapToPoint(n.snapPoint),
        n.snapEdge !== undefined && this.setSnapToEdge(n.snapEdge),
        n.snapVertex !== undefined && this.setSnapToVertex(n.snapVertex))
    }
    ,
    n.getSnapOptions = function() {
        return this.options.snapOptions
    }
    ,
    n.setMarkerOptions = function(n) {
        n && (n.clickable !== undefined && (this.options.markerOptions.clickable = n.clickable),
        n.title !== undefined && (this.options.markerOptions.title = n.title),
        n.zIndex !== undefined && (this.options.markerOptions.zIndex = n.zIndex),
        n.opacity !== undefined && (this.options.markerOptions.opacity = n.opacity),
        n.cursor !== undefined && (this.options.markerOptions.cursor = n.cursor),
        n.flat !== undefined && (this.options.markerOptions.flat = n.flat),
        n.icon !== undefined && (this.options.markerOptions.icon = n.icon),
        n.shadow !== undefined && (this.options.markerOptions.shadow = n.shadow))
    }
    ,
    n.setLabelOptions = function(n) {
        n && (n.fontSize !== undefined && (this.options.labelOptions.fontSize = n.fontSize),
        n.fontColor !== undefined && (this.options.labelOptions.fontColor = n.fontColor),
        n.font !== undefined && (this.options.labelOptions.font = n.font),
        n.fontWeight !== undefined && (this.options.labelOptions.fontWeight = n.fontWeight),
        n.opacity !== undefined && (this.options.labelOptions.opacity = n.opacity),
        n.label !== undefined && (this.options.labelOptions.label = n.label))
    }
    ,
    n.setLineOptions = function(n) {
        n && (n.clickable !== undefined && (this.options.polylineOptions.clickable = n.clickable),
        n.opacity !== undefined && (this.options.polylineOptions.opacity = n.opacity),
        n.zIndex !== undefined && (this.options.polylineOptions.zIndex = n.zIndex),
        n.strokeWeight !== undefined && (this.options.polylineOptions.strokeWeight = n.strokeWeight),
        n.strokeDasharray !== undefined && (this.options.polylineOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.options.polylineOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.options.polylineOptions.strokeOpacity = n.strokeOpacity),
        n.strokeLinecap !== undefined && (this.options.polylineOptions.strokeLinecap = n.strokeLinecap),
        n.strokeLinejoin !== undefined && (this.options.polylineOptions.strokeLinejoin = n.strokeLinejoin))
    }
    ,
    n.setPolygonOptions = function(n) {
        n && (n.clickable !== undefined && (this.options.polygonOptions.clickable = n.clickable),
        n.opacity !== undefined && (this.options.polygonOptions.opacity = n.opacity),
        n.zIndex !== undefined && (this.options.polygonOptions.zIndex = n.zIndex),
        n.fillColor !== undefined && (this.options.polygonOptions.fillColor = n.fillColor),
        n.fillOpacity !== undefined && (this.options.polygonOptions.fillOpacity = n.fillOpacity),
        n.strokeWeight !== undefined && (this.options.polygonOptions.strokeWeight = n.strokeWeight),
        n.strokeDasharray !== undefined && (this.options.polygonOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.options.polygonOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.options.polygonOptions.strokeOpacity = n.strokeOpacity),
        n.strokeLinecap !== undefined && (this.options.polygonOptions.strokeLinecap = n.strokeLinecap),
        n.strokeLinejoin !== undefined && (this.options.polygonOptions.strokeLinejoin = n.strokeLinejoin))
    }
    ,
    n.setCircleOptions = function(n) {
        n && (n.clickable !== undefined && (this.options.circleOptions.clickable = n.clickable),
        n.zIndex !== undefined && (this.options.circleOptions.zIndex = n.zIndex),
        n.opacity !== undefined && (this.options.circleOptions.opacity = n.opacity),
        n.fillColor !== undefined && (this.options.circleOptions.fillColor = n.fillColor),
        n.fillOpacity !== undefined && (this.options.circleOptions.fillOpacity = n.fillOpacity),
        n.strokeWeight !== undefined && (this.options.circleOptions.strokeWeight = n.strokeWeight),
        n.strokeDasharray !== undefined && (this.options.circleOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.options.circleOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.options.circleOptions.strokeOpacity = n.strokeOpacity))
    }
    ,
    n.setEnvOptions = function(n) {
        n && this.setEnvelopeOptions(n)
    }
    ,
    n.setEnvelopeOptions = function(n) {
        n && (n.clickable !== undefined && (this.options.envelopeOptions.clickable = n.clickable),
        n.opacity !== undefined && (this.options.envelopeOptions.opacity = n.opacity),
        n.fillColor !== undefined && (this.options.envelopeOptions.fillColor = n.fillColor),
        n.fillOpacity !== undefined && (this.options.envelopeOptions.fillOpacity = n.fillOpacity),
        n.strokeWeight !== undefined && (this.options.envelopeOptions.strokeWeight = n.strokeWeight),
        n.zIndex !== undefined && (this.options.envelopeOptions.zIndex = n.zIndex),
        n.strokeDasharray !== undefined && (this.options.envelopeOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.options.envelopeOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.options.envelopeOptions.strokeOpacity = n.strokeOpacity))
    }
    ,
    n.setModifyDrawingOptions = function(n) {
        n && (n.lineOptions && (n.lineOptions.clickable !== undefined && (this.options.modifyDrawingOptions.lineOptions.clickable = n.lineOptions.clickable),
        n.lineOptions.zIndex !== undefined && (this.options.modifyDrawingOptions.lineOptions.zIndex = n.lineOptions.zIndex),
        n.lineOptions.opacity !== undefined && (this.options.modifyDrawingOptions.lineOptions.opacity = n.lineOptions.opacity),
        n.lineOptions.strokeDasharray !== undefined && (this.options.modifyDrawingOptions.lineOptions.strokeDasharray = n.lineOptions.strokeDasharray),
        n.lineOptions.strokeWeight !== undefined && (this.options.modifyDrawingOptions.lineOptions.strokeWeight = n.lineOptions.strokeWeight),
        n.lineOptions.strokeColor !== undefined && (this.options.modifyDrawingOptions.lineOptions.strokeColor = n.lineOptions.strokeColor),
        n.lineOptions.strokeOpacity !== undefined && (this.options.modifyDrawingOptions.lineOptions.strokeOpacity = n.lineOptions.strokeOpacity)),
        n.circleOptions && (n.circleOptions.clickable !== undefined && (this.options.modifyDrawingOptions.circleOptions.clickable = n.circleOptions.clickable),
        n.circleOptions.zIndex !== undefined && (this.options.modifyDrawingOptions.circleOptions.zIndex = n.circleOptions.zIndex),
        n.circleOptions.opacity !== undefined && (this.options.modifyDrawingOptions.circleOptions.opacity = n.circleOptions.opacity),
        n.circleOptions.fillColor !== undefined && (this.options.modifyDrawingOptions.circleOptions.fillColor = n.circleOptions.fillColor),
        n.circleOptions.fillOpacity !== undefined && (this.options.modifyDrawingOptions.circleOptions.fillOpacity = n.circleOptions.fillOpacity),
        n.circleOptions.strokeDasharray !== undefined && (this.options.modifyDrawingOptions.circleOptions.strokeDasharray = n.circleOptions.strokeDasharray),
        n.circleOptions.strokeWeight !== undefined && (this.options.modifyDrawingOptions.circleOptions.strokeWeight = n.circleOptions.strokeWeight),
        n.circleOptions.strokeColor !== undefined && (this.options.modifyDrawingOptions.circleOptions.strokeColor = n.circleOptions.strokeColor),
        n.circleOptions.strokeOpacity !== undefined && (this.options.modifyDrawingOptions.circleOptions.strokeOpacity = n.circleOptions.strokeOpacity)))
    }
    ,
    n.setModifyIndicateOptions = function(n) {
        n && (n.node !== undefined && (this.options.modifyIndicateOptions.node = n.node),
        n.move !== undefined && (this.options.modifyIndicateOptions.move = n.move),
        n.pseudo !== undefined && (this.options.modifyIndicateOptions.pseudo = n.pseudo),
        n.circleCenter !== undefined && (this.options.modifyIndicateOptions.circleCenter = n.circleCenter))
    }
    ,
    n.setDrawingControlOptions = function(n) {
        n && this.drawingControl && this.drawingControl.setOptions(n)
    }
    ,
    n.setModifyControlOptions = function(n) {
        n && this.modifyControl && this.modifyControl.setOptions(n)
    }
    ,
    n.setOptions = function(n) {
        n && (n.drawingControl == !0 ? this.drawingControl.setVisible(!0) : n.drawingControl == !1 && this.drawingControl.setVisible(!1),
        n.drawingControlOptions && this.drawingControl.setOptions(n.drawingControlOptions),
        n.modifyControl == !0 ? this.modifyControl.setVisible(!0) : n.modifyControl == !1 && this.modifyControl.setVisible(!1),
        n.modifyControlOptions && this.modifyontrol.setOptions(n.modifyControlOptions),
        this.setCircleOptions(this.options.circleOptions),
        this.setEnvelopeOptions(this.options.envelopeOptions),
        this.setMarkerOptions(this.options.markerOptions),
        this.setLabelOptions(this.options.labelOptions),
        this.setLineOptions(this.options.polylineOptions),
        this.setPolygonOptions(this.options.polygonOptions),
        this.setModifyDrawingOptions(this.options.modifyDrawingOptions),
        this.setModifyIndicateOptions(this.options.modifyIndicateOptions),
        this.setSnapOptions(this.options.snapOptions),
        n.circleOptions && this.setCircleOptions(n.circleOptions),
        n.envelopeOptions && this.setEnvelopeOptions(n.envelopeOptions),
        n.markerOptions && this.setMarkerOptions(n.markerOptions),
        n.labelOptions && this.setLabelOptions(n.labelOptions),
        n.polylineOptions && this.setLineOptions(n.polylineOptions),
        n.polygonOptions && this.setPolygonOptions(n.polygonOptions),
        n.modifyDrawingOptions && this.setModifyDrawingOptions(n.modifyDrawingOptions),
        n.modifyIndicateOptions && this.setModifyIndicateOptions(n.modifyIndicateOptions),
        n.snapOptions && this.setSnapOptions(n.snapOptions),
        this.options.circleOptions.editable = !1,
        this.options.envelopeOptions.editable = !1,
        this.options.markerOptions.editable = !1,
        this.options.labelOptions.editable = !1,
        this.options.polylineOptions.editable = !1,
        this.options.polygonOptions.editable = !1,
        this.options.circleOptions.draggable = !1,
        this.options.envelopeOptions.draggable = !1,
        this.options.markerOptions.draggable = !1,
        this.options.labelOptions.draggable = !1,
        this.options.polylineOptions.draggable = !1,
        this.options.polygonOptions.draggable = !1)
    }
    ,
    n.getGeoJson = function(n) {
        var u = "\r\n", t, f, e, r;
        if (n !== undefined && (u = n),
        t = "",
        f = this.getAllGraphics(),
        f !== undefined) {
            for (t += "{" + u,
            t += '"type": "FeatureCollection",' + u,
            t += '"features": [' + u,
            e = 0; e < f.length; e++) {
                var o = f[e]
                  , i = o.geoJson
                  , s = o.geoJsonProperties;
                if (t += "{" + u,
                t += '"type": "Feature",' + u,
                t += '"properties": ' + s + "," + u,
                t += '"geometry": {' + u,
                t += '"type": "' + i.type + '",' + u,
                t += '"coordinates": [',
                i.type != "Polygon")
                    if (i.type == "Point")
                        t += i.coordinates[0] + "," + i.coordinates[1];
                    else
                        for (r = 0; r < i.coordinates.length; r++)
                            i.type != "Point" && (t += "["),
                            t += i.coordinates[r][0] + "," + i.coordinates[r][1],
                            i.type != "Point" && (t += "]"),
                            r < i.coordinates.length - 1 && (t += ",");
                else {
                    for (t += "[",
                    r = 0; r < i.coordinates[0].length; r++)
                        i.type != "Point" && (t += "["),
                        t += i.coordinates[0][r][0] + "," + i.coordinates[0][r][1],
                        i.type != "Point" && (t += "]"),
                        r < i.coordinates[0].length - 1 && (t += ",");
                    t += "]"
                }
                t += "]";
                t += "}";
                t += "}";
                e < f.length - 1 && (t += "," + u)
            }
            t += "]" + u;
            t += "}"
        }
        return t
    }
    ,
    n.setGeoJsonProperties = function(n, t) {
        n !== undefined && (n.geoJsonProperties = t)
    }
    ,
    FBM.RegisterEvent(o, ["marker_complete", "label_complete", "envelope_complete", "circle_complete", "linestring_complete", "polygon_complete", "overlay_complete", "modify_complete", "drawmode_changed", "drawmode_changed", "drawmodeChanged", "graphic_moved", "keydown"]),
    o
}();
/*! D:\FW_API\scripts\CommonData.js*/
(function() {
    FBM.MapIdInfo = FBM.MapIdInfo || {};
    FBM.FWMapServiceId = FBM.FWMapServiceId || {};
    FBM.FWMapId = FBM.FWMapId || {};
    FBM.CacheExtend3857 = FBM.CacheExtend3857 || {};
    FBM.ThemeLayerID = {
        REGION: "M05",
        REGION_119: "M06",
        EOC: "M11",
        FIREDEPARTMENT: "M12",
        POLICEDEPARTMENT: "M13",
        NASC: "M14",
        SOCIALSERVICE: "M15",
        SHELTERS: "M18",
        NASC_LANDING: "M19",
        INDUSTRY: "M21",
        SCHOOL: "M22",
        DEBRISFLOW_P: "M08"
    };
    FBM.ThemeLayerID.MEDICAL = "M17";
    FBM.ThemeTileID = {
        LANDUSE: "T04"
    };
    FBM.FWMapTypeId = {
        FWMAP: "FWMAP",
        FWMAP_D: "FWMAP_D"
    };
    FBM.FWMapTypeIdCode = {
        FWMAP: "B01"
    };
    FBM.FWMapTypeId_zh_TW = {
        FWMAP: "FWMAP",
        FWMAP_D: "FWMAP_D"
    };
    FBM.MapTypeDocumentNameGoogle = {};
    Object.defineProperty(FBM.MapTypeDocumentNameGoogle, "FWMAP", {
        get: function() {
            return window._RootPath + "Agent/EPSG3857/Agent_FWMAP3857.aspx"
        },
        enumerable: !0
    });
    Object.defineProperty(FBM.MapTypeDocumentNameGoogle, "FWMAP_D", {
        get: function() {
            return window._RootPath + "Agent/EPSG3857/Agent_FWMAPDARK.aspx"
        },
        enumerable: !0
    });
    FBM.MapTypeIndexViewId_zh_TW = {
        FWMAP: "FWMAP索引"
    };
    FBM.MapTypeIndexViewDocumentNameGoogle = {};
    Object.defineProperty(FBM.MapTypeIndexViewDocumentNameGoogle, "FWMAP", {
        get: function() {
            return window._RootPath + "Agent/EPSG3857/Agent_FWMAP3857_IV.aspx"
        },
        enumerable: !0
    });
    Object.defineProperty(FBM.MapTypeIndexViewDocumentNameGoogle, "FWMAP_D", {
        get: function() {
            return window._RootPath + "Agent/EPSG3857/Agent_FWMAPDARK_IV.aspx"
        },
        enumerable: !0
    });
    FBM.MapTypeBackgroundColor = {
        FWMAP: "#a5bfdd",
        FWMAP_D: "#000000"
    };
    FBM.MapTypeMaxZoomLevel = {
        EPSG3825: {},
        EPSG3826: {},
        EPSG3857: {
            FWMAP: 9,
            FWMAP_D: 9
        }
    }
}
)();
/*! D:\FW_API\scripts\FWMarkerCluster.js*/
FBM.FWMarkerCluster = function() {
    function u() {
        this.clusters.forEach(function(n) {
            n.symbols.forEach(function(n) {
                n.setMap(null)
            });
            n.symbols = null;
            n.markers = null
        });
        this.clusters = []
    }
    var f = -1
      , t = "#f0f0f0"
      , e = 12
      , o = new FBM.FWImage(FBM.RES_PATH + "clusters/cluster-2-9.png",new FBM.FWSize(36,36),null,new FBM.FWPoint(18,18))
      , s = new FBM.FWImage(FBM.RES_PATH + "clusters/cluster-10-99.png",new FBM.FWSize(48,48),null,new FBM.FWPoint(24,24))
      , h = new FBM.FWImage(FBM.RES_PATH + "clusters/cluster-100-999.png",new FBM.FWSize(64,64),null,new FBM.FWPoint(32,32))
      , c = new FBM.FWImage(FBM.RES_PATH + "clusters/cluster-999up.png",new FBM.FWSize(72,72),null,new FBM.FWPoint(36,36))
      , r = function(n) {
        if (!n)
            return null;
        var i = n.reduce(function(n, t) {
            var i = t.getPosition();
            return n.minx = Math.min(n.minx, i.x),
            n.miny = Math.min(n.miny, i.y),
            n.maxx = Math.max(n.maxx, i.x),
            n.maxy = Math.max(n.maxy, i.y),
            n
        }, {
            minx: Infinity,
            miny: Infinity,
            maxx: -Infinity,
            maxy: -Infinity
        })
          , t = new FBM.FWEnvelope;
        return t.left = i.minx,
        t.top = i.maxy,
        t.right = i.maxx,
        t.bottom = i.miny,
        t
    }
      , i = function(n, t, i) {
        var u = this;
        this.map = n ? n : null;
        this.clickable = !0;
        this.clusters = [];
        this.markers = [];
        t && (this.markers = t.map(function(n) {
            return n
        }));
        this.clickHandler = function() {
            u.clickable && FBM.FWEvent.trigger_(u, "clusterclick", {
                specifiedCluster: this.cluster.markers,
                clusterEnvelope: r(this.cluster.markers)
            })
        }
        ;
        FBM.FWEvent.addListener(n, "idle", function() {
            u.redrawViewport()
        });
        i && (typeof i.bounds == "number" && (this.bounds = i.bounds),
        typeof i.maxZoom == "number" && (this.maxZoom = i.maxZoom),
        i.scaleClass && typeof i.scaleClass.length == "number" && (this.scaleClass = i.scaleClass),
        i.style && typeof i.style.length == "number" && (this.styles = i.style),
        i.updateCenter && (this.updateCenter = i.updateCenter))
    }
      , n = i.prototype;
    return n.clusters = null,
    n.cursor = "default",
    n.visible = !0,
    n.zIndex = 0,
    n.bounds = 30,
    n.map = null,
    n.markers = null,
    n.scaleClass = [9, 99, 999],
    n.styles = [{
        icon: o,
        label: new FBM.FWPoint(0,0),
        labelColor: t,
        labelSize: 12
    }, {
        icon: s,
        labelColor: t,
        labelSize: 14
    }, {
        icon: h,
        labelColor: t,
        labelSize: 16
    }, {
        icon: c,
        labelColor: t,
        labelSize: 18
    }],
    n.setMarkers = function(n) {
        this.markers = n;
        this.redrawViewport()
    }
    ,
    n.getClickable = function() {
        return this.clickable
    }
    ,
    n.setClickable = function(n) {
        this.clickable = n
    }
    ,
    n.addMarkers = function(n, t) {
        this.markers = this.markers.concat(n);
        t && this.redrawAll()
    }
    ,
    n.addMarker = function(n, t) {
        this.markers.push(n);
        t && this.redrawAll()
    }
    ,
    n.clearAll = function() {
        u.call(this);
        this.markers = []
    }
    ,
    n.redrawAll = n.redrawViewport = function() {
        function r(n, t) {
            return Math.hypot(n.x - t.x, n.y - t.y)
        }
        function o(t, i) {
            var u = n.clusters.map(function(n) {
                return {
                    c: n,
                    d: r(t, n.center)
                }
            }).reduce(function(n, t) {
                return t.d <= n.d ? t : n
            }, {
                c: null,
                d: i
            });
            return u.c
        }
        function s(n) {
            var t = {
                center: {
                    x: 0,
                    y: 0
                },
                markers: [],
                symbols: []
            };
            return n && (t.centerLonLat = {
                x: n.x,
                y: n.y
            }),
            t
        }
        function h(n, t, i, r) {
            (n.updateCenter || t.markers.length == 0) && (t.center.x = (t.center.x * t.markers.length + r.x) / (t.markers.length + 1),
            t.center.y = (t.center.y * t.markers.length + r.y) / (t.markers.length + 1));
            t.markers.push(i);
            i.parentCluster = t
        }
        function c(n, i) {
            var o, u;
            if (!(i.symbols.length > 0)) {
                var c = i.centerLonLat ? i.centerLonLat : i.center
                  , s = new FBM.FWPoint(c.x,c.y)
                  , h = i.markers.length
                  , r = null
                  , f = null;
                h == 1 ? (r = new FBM.FWMarker(n.map,s,i.markers[0].getTitle(),i.markers[0].getIcon(),{
                    flat: !0,
                    clickable: !0,
                    visible: n.visible,
                    zIndex: n.zIndex
                }),
                FBM.FWEvent.copyEvent(i.markers[0], r),
                r.annotation = i.markers[0].annotation) : h > 1 && (o = n.scaleClass.findIndex(function(n) {
                    return i.markers.length <= n
                }),
                u = o < 0 || o > n.styles.length - 1 ? n.styles[n.styles.length - 1] : n.styles[o],
                r = new FBM.FWMarker(n.map,s,null,null,{
                    icon: u.icon,
                    title: i.markers.length,
                    flat: !0,
                    clickable: !0,
                    visible: n.visible,
                    zIndex: n.zIndex
                }),
                f = new FBM.FWLabel({
                    map: n.map,
                    position: s,
                    fontColor: u.labelColor ? u.labelColor : t,
                    fontSize: u.labelSize ? u.labelSize : e,
                    fontWeight: "bold",
                    opacity: 1,
                    zIndex: n.zIndex + 1,
                    label: h.toString()
                }),
                f.setVisible(n.visible),
                u.labelAnchor && f.setOffset(u.labelAnchor));
                r && (r.cluster = i,
                i.symbols.push(r),
                FBM.FWEvent.addListener(r, "click", n.clickHandler));
                f && (f.cluster = i,
                i.symbols.push(f),
                FBM.FWEvent.addListener(f, "click", n.clickHandler))
            }
        }
        var i, n;
        if (!this.map)
            return !1;
        if (u.call(this),
        i = this.map.getZoom(),
        i > this.maxZoom || i == f)
            return this.markers.forEach(function(n) {
                n.setMap(this.map)
            }),
            !1;
        n = this;
        var l = this.map.getMapBase()
          , a = l.ToMapDistX(this.bounds * 2)
          , v = this.map.getCoordSys() == FBM.FWCoordSys.EPSG3857
          , y = this.getExtendedBounds();
        return this.markers.forEach(function(t) {
            var u, i, r;
            (t.setMap(null),
            u = null,
            i = t.getPosition(),
            v && (u = i,
            t.gPos || (t.gPos = FBM.WGS84ToGoo(i.x, i.y)),
            i = t.gPos),
            y.contains(i)) && (r = o(i, a),
            r == null && n.clusters.push(r = s(u)),
            h(n, r, t, i))
        }),
        this.clusters.forEach(function(t) {
            c(n, t)
        }),
        this.map.getPanes().overlay.RebuildElement(),
        !0
    }
    ,
    n.getClustersCounts = function() {
        return this.clusters ? this.clusters.length : 0
    }
    ,
    n.getExtendedBounds = function() {
        var n = this.map.getRawBound()
          , t = this.bounds
          , i = {
            x: n.left,
            y: n.top
        }
          , r = {
            x: n.right,
            y: n.bottom
        }
          , u = this.map.getMapBase().FromMapDistX(t)
          , f = this.map.getMapBase().FromMapDistY(t);
        return new FBM.FWEnvelope(i.x - u,i.y + f,r.x + u,r.y - f)
    }
    ,
    n.getScaleClass = function() {
        return this.scaleClass
    }
    ,
    n.setScaleClass = function(n) {
        this.scaleClass = n
    }
    ,
    n.setClusterStyle = function(n) {
        this.styles = n
    }
    ,
    n.getClusterStyle = function() {
        return this.styles
    }
    ,
    n.removeMarker = function(n, t) {
        this.removeMarkers([n], t)
    }
    ,
    n.removeMarkers = function(n, t) {
        this.markers = this.markers.filter(function(t) {
            return n.find(function(n) {
                return t == n
            }) == null
        });
        t && this.redrawAll()
    }
    ,
    n.setVisible = function(n, t) {
        this.visible = n;
        t && this.redrawAll()
    }
    ,
    n.getVisible = function() {
        return this.visible
    }
    ,
    n.setSearchBounds = function(n) {
        this.bounds = n
    }
    ,
    n.getSearchBounds = function() {
        return this.bounds
    }
    ,
    n.getCursor = function() {
        return this.cursor
    }
    ,
    n.setCursor = function(n, t) {
        this.cursor = n;
        t && this.redrawAll()
    }
    ,
    n.getZIndex = function() {
        return this.zIndex
    }
    ,
    n.setZIndex = function(n, t) {
        this.zIndex = n;
        t && this.redrawAll()
    }
    ,
    n.maxZoom = Infinity,
    n.getMaxZoom = function() {
        return this.maxZoom
    }
    ,
    n.setMaxZoom = function(n) {
        this.maxZoom = n
    }
    ,
    n.getClusterBounds = function() {
        return r(this.markers)
    }
    ,
    FBM.RegisterEvent(i, ["clusterclick"]),
    i
}();
/*! D:\FW_API\scripts\FWData.js*/
FBM.FWData = function() {
    var r = "Unable to import GeoJSON", e = ["Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon", "GeometryCollection"], o = function(n, t, i, r) {
        return i == r ? {
            x: n,
            y: t
        } : FBM[i + "to" + r](n, t)
    }, t = function(n, t, i) {
        var r = o(n[0], n[1], t, i);
        return new FBM.FWPoint(r.x,r.y)
    }, u = function(n, i, f) {
        switch (n.type) {
        case "Point":
            return t(n.coordinates, i, f);
        case "MultiPoint":
            return new FBM.FWMultiPoint(n.coordinates.map(function(n) {
                return t(n, i, f)
            }));
        case "LineString":
            return new FBM.FWLineString(n.coordinates.map(function(n) {
                return t(n, i, f)
            }));
        case "MultiLineString":
            return new FBM.FWMultiLineString(n.coordinates.map(function(n) {
                return new FBM.FWLineString(n.map(function(n) {
                    return t(n, i, f)
                }))
            }));
        case "Polygon":
            return new FBM.FWPolygon(n.coordinates.map(function(n, r) {
                var u = n.map(function(n) {
                    return t(n, i, f)
                });
                return r == 0 && (u = u.reverse()),
                new FBM.FWLinearRing(new FBM.FWLineString(u))
            }));
        case "MultiPolygon":
            return new FBM.FWMultiPolygon(n.coordinates.map(function(n) {
                return new FBM.FWPolygon(n.map(function(n) {
                    return new FBM.FWLinearRing(new FBM.FWLineString(n.map(function(n) {
                        return t(n, i, f)
                    })))
                }))
            }));
        case "GeometryCollection":
            return new FBM.FWGeometryCollection(n.geometries.map(function(n) {
                return u(n)
            }));
        default:
            throw r;
        }
    }, s = function(n, t, i, r) {
        for (var e = [], u = 0; u < n.features.length; u++)
            e.push(f(n.features[u], t, i, r));
        return e
    }, f = function(n, t, i, r) {
        var o = u(n.geometry, i, r)
          , f = n.properties
          , e = n.id;
        return t && t.idPropertyName && f && f[t.idPropertyName] && (e = f[t.idPropertyName]),
        new FBM.FWGraphic({
            geometry: o,
            properties: f,
            id: e
        })
    }, i = function(n) {
        this.graphics = [];
        n.map && (this.map = n.map);
        n.style && (this.style = n.style);
        n.beforeGraphicDraw && (this.beforeGraphicDraw = n.beforeGraphicDraw)
    }, n;
    return i.prototype = new FBM.MVCObject,
    n = i.prototype,
    n.graphics = null,
    n.map = null,
    n.style = null,
    n.visible = !0,
    n.beforeGraphicDraw = null,
    n.add = function(n) {
        if ((n instanceof FBM.FWGraphic))
            return this.graphics.push(n),
            this.bindTo("style", n, "style"),
            n.draw(this.map),
            this.bindEvents(n),
            FBM.FWEvent.trigger_(this, "addgraphic", n),
            n
    }
    ,
    n.bindEvents = function(n) {
        var t = this;
        FBM.FWEvent.addListener(n, "setproperty", function(n) {
            t.redraw(n.graphic);
            FBM.FWEvent.trigger_(t, "setproperty", n)
        });
        FBM.FWEvent.addListener(n, "setgeometry", function(n) {
            t.redraw(n.graphic);
            FBM.FWEvent.trigger_(t, "setgeometry", n)
        });
        FBM.FWEvent.addListener(n, "removeproperty", function(n) {
            t.redraw(n.graphic);
            FBM.FWEvent.trigger_(t, "removeproperty", n)
        });
        FBM.FWEvent.addListener(n, "mousedown", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "mousedown", i)
        });
        FBM.FWEvent.addListener(n, "mouseup", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "mouseup", i)
        });
        FBM.FWEvent.addListener(n, "mousemove", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "mousemove", i)
        });
        FBM.FWEvent.addListener(n, "mouseover", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "mouseover", i)
        });
        FBM.FWEvent.addListener(n, "dblclick", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "dblclick", i)
        });
        FBM.FWEvent.addListener(n, "click", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "click", i)
        });
        FBM.FWEvent.addListener(n, "rightclick", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "rightclick", i)
        });
        FBM.FWEvent.addListener(n, "mouseout", function(i) {
            i.graphic = n;
            FBM.FWEvent.trigger_(t, "mouseout", i)
        })
    }
    ,
    n.removeAllGraphics = function() {
        this.forEach(function(n) {
            this.remove(n)
        })
    }
    ,
    n.remove = function(n) {
        if (n && this.contains(n)) {
            n.clear();
            var t = this.graphics.indexOf(n);
            this.graphics.splice(t, 1);
            FBM.FWEvent.trigger_(this, "removegraphic", n)
        }
    }
    ,
    n.forEach = function(n, t) {
        for (var r = this.graphics.slice(0), i = 0; i < r.length; i++)
            n.call(t, r[i])
    }
    ,
    n.contains = function(n) {
        if (!(n instanceof FBM.FWGraphic))
            return !1;
        for (var t = 0; t < this.graphics.length; t++)
            if (this.graphics[t] == n)
                return !0;
        return !1
    }
    ,
    n.getGraphicById = function(n) {
        for (var t = 0; t < this.graphics.length; t++)
            if (this.graphics[t].id === n)
                return this.graphics[t]
    }
    ,
    n.setVisible = function(n) {
        this.visible = n
    }
    ,
    n.getVisible = function() {
        return this.visible
    }
    ,
    n.getMap = function() {
        return this.map
    }
    ,
    n.setMap = function(n) {
        this.clearAll();
        this.map = n;
        this.map && this.redrawAll()
    }
    ,
    n.clearAll = function() {
        this.forEach(function(n) {
            return n.clear()
        })
    }
    ,
    n.getStyle = function() {
        return this.style
    }
    ,
    n.setStyle = function(n) {
        this.set("style", n);
        this.redrawAll()
    }
    ,
    n.redrawAll = function() {
        if (this.visible) {
            var n = this;
            this.forEach(function(t) {
                t.redraw(n.map)
            })
        }
    }
    ,
    n.redraw = function(n) {
        this.visible && (that = this,
        this.contains(n) && n.redraw(that.map))
    }
    ,
    n.overrideStyle = function(n, t) {
        n instanceof FBM.FWGraphic && (n.ownStyle = t,
        n.redraw(this.map))
    }
    ,
    n.revertStyle = function(n) {
        n instanceof FBM.FWGraphic && (n.ownStyle = null,
        n.redraw(this.map))
    }
    ,
    n.loadGeoJson = function(n, t, i) {
        var r, u = this;
        u.opts = t;
        r = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP");
        r.onreadystatechange = function() {
            if (r.readyState == 4 && r.status == 200) {
                var n = r.responseText
                  , t = JSON.parse(n)
                  , f = u.addGeoJson(t, u.opts);
                i.call(undefined, f)
            }
        }
        ;
        r.open("GET", n, !0);
        r.send()
    }
    ,
    n.addGeoJson = function(n, t) {
        var i, c, o, h, a, v, y, p, l;
        if (!n)
            throw r;
        i = "WGS84";
        n.crs && n.crs.type == "name" && n.crs.properties && (c = n.crs.properties.name,
        c == "urn:ogc:def:crs:EPSG::3826" ? i = "TWD97" : c == "urn:ogc:def:crs:EPSG::3825" ? i = "TWD67" : c == "urn:ogc:def:crs:EPSG::3857" && (i = "Goo"));
        o = null;
        switch (this.map.getCoordSys()) {
        case FBM.FWCoordSys.EPSG3857:
            o = "WGS84";
            break;
        case FBM.FWCoordSys.EPSG3826:
            o = "TWD97";
            break;
        case FBM.FWCoordSys.EPSG3825:
            o = "TWD67";
            break;
        default:
            throw "Invalid Map CRS";
        }
        if (h = null,
        e.indexOf(n.type) >= 0)
            a = u(n, i, o),
            v = new FBM.FWGraphic({
                geometry: a
            }),
            h = [v];
        else if (n.type == "Feature")
            y = f(n, t, i, o),
            h = [y];
        else if (n.type == "FeatureCollection")
            p = s(n, t, i, o),
            h = p;
        else
            throw r;
        for (l = 0; l < h.length; l++)
            this.add(h[l]);
        return h
    }
    ,
    FBM.RegisterEvent(i, ["addgraphic", "removegraphic", "removeproperty", "setgeometry", "setproperty", "click", "dblclick", "mousedown", "mouseup", "mouseout", "mouseover", "mousemove", "rightclick"]),
    i
}();
FBM.FWTrafficArea = {
    T: [121.01260564528188, 23.815813925743036, 0],
    N: [121.40544595736694, 24.889799519736368, 3],
    W: [120.68473336757104, 24.165732835747811, 3],
    S: [120.30891500454227, 23.057018882387645, 3]
};
Object.defineProperty(Array.prototype, "matrix", {
    value: function() {
        return this.map(function(n) {
            return {
                x: n.x * M[0] + n.y * M[1] + M[2],
                y: n.x * M[3] + n.y * M[4] + M[5]
            }
        })
    }
});
FBM.FWTraffic = function() {
    function s(n, t, i) {
        function s(n, t, i) {
            function r(n, t, i) {
                var r = {
                    x: n[0],
                    y: n[1]
                };
                return t != i && (r = FBM[t + "to" + i](r.x, r.y)),
                new FBM.FWPoint(r.x,r.y)
            }
            switch (n.type) {
            case "Point":
                return r(n.coordinates, t, i);
            case "MultiPoint":
                return new FBM.FWMultiPoint(n.coordinates.map(function(n) {
                    return r(n, t, i)
                }));
            case "LineString":
                return new FBM.FWLineString(n.coordinates.map(function(n) {
                    return r(n, t, i)
                }));
            case "MultiLineString":
                return new FBM.FWMultiLineString(n.coordinates.map(function(n) {
                    return new FBM.FWLineString(n.map(function(n) {
                        return r(n, t, i)
                    }))
                }));
            case "Polygon":
                return new FBM.FWPolygon(n.coordinates.map(function(n, u) {
                    var f = n.map(function(n) {
                        return r(n, t, i)
                    });
                    return u == 0 && (f = f.reverse()),
                    new FBM.FWLinearRing(new FBM.FWLineString(f))
                }));
            case "MultiPolygon":
                return new FBM.FWMultiPolygon(n.coordinates.map(function(n) {
                    return new FBM.FWPolygon(n.map(function(n) {
                        return new FBM.FWLinearRing(new FBM.FWLineString(n.map(function(n) {
                            return r(n, t, i)
                        })))
                    }))
                }));
            case "GeometryCollection":
                return new FBM.FWGeometryCollection(n.geometries.map(function(n) {
                    return s(n)
                }));
            default:
                throw u;
            }
        }
        function h(n, t, i, r) {
            var f = s(n.geometry, i, r)
              , u = n.id;
            return t && "idPropertyName"in t && n.properties && t.idPropertyName in n.properties && (u = n.properties[t.idPropertyName]),
            new FBM.FWGraphic({
                id: u,
                geometry: f,
                properties: n.properties
            })
        }
        var r, e, f;
        if (!n)
            throw u;
        if (r = "WGS84",
        n.crs && n.crs.type == "name" && n.crs.properties && (e = n.crs.properties.name,
        e == "urn:ogc:def:crs:EPSG::3826" ? r = "TWD97" : e == "urn:ogc:def:crs:EPSG::3825" ? r = "TWD67" : e == "urn:ogc:def:crs:EPSG::3857" && (r = "Goo")),
        f = null,
        o.indexOf(n.type) >= 0)
            f = [new FBM.FWGraphic({
                geometry: s(n, r, t)
            })];
        else if (n.type == "Feature")
            f = [h(n, i, r, t)];
        else if (n.type == "FeatureCollection")
            f = n.features.map(function(n) {
                return h(n, i, r, t)
            });
        else
            throw u;
        return f
    }
    function h(n, t) {
        var e = n.length, u, i, r, f, o, s;
        if (!(e <= 1)) {
            for (u = [],
            i = 0; i < e - 1; i++)
                r = [n[i + 1].y - n[i].y, n[i].x - n[i + 1].x],
                f = Math.hypot(r[0], r[1]),
                r[0] *= t / f,
                r[1] *= t / f,
                o = [n[i].x + r[0], n[i].y + r[1]],
                s = [n[i + 1].x + r[0], n[i + 1].y + r[1]],
                u.push(o),
                u.push(s);
            return u
        }
    }
    function l(n, t, i) {
        function c(n) {
            return typeof n == "array" || n instanceof Array ? n.length == 1 ? n.push(n[0], 0, 0) : n.length == 2 ? n.push(0, 0) : n.length == 3 && n.push(n[2]) : n = [n, n, 0, 0],
            n
        }
        function y(n) {
            return [1, n[0], -n[3] * n[0], -n[1], 1, n[2] * n[1]]
        }
        function p(n) {
            return [n[0], 0, n[2] * (1 - n[0]), 0, n[1], n[3] * (1 - n[1])]
        }
        function w(n) {
            return [1, 0, n[0], 0, 1, n[1]]
        }
        var r, a, f, o, s, e, u, l, v;
        if (!(n && t && i) || (r = null,
        t instanceof FBM.FWLineString ? r = t.getPath() : t instanceof Array && (r = t),
        a = n.getCoordSys(),
        f = 1,
        a == FBM.FWCoordSys.EPSG3857 && (f = 1 / 111319.49),
        o = n.getMapBase().getCellSizeX(),
        s = o * i.thresh * f,
        s > 0 && (r = FBM.simplifyLineString(r, s)),
        r == null || r.length <= 1) || r.every(function(n, t, i) {
            return i[0].x == n.x && i[0].y == n.y
        }))
            return null;
        if (i.skew && (r = r.matrix(y(c(i.skew)))),
        i.scale && (r = r.matrix(p(c(i.scale)))),
        i.translate && (r = r.matrix(w(c(i.translate)))),
        e = parseFloat(o * i.offsetWidth * (i.direction == 0 ? 1 : -1)),
        e != 0) {
            if (u = [],
            r != null && r.reduce(function(n, t) {
                return (n == null || n.x != t.x || n.y != t.y) && u.push(t),
                t
            }, null),
            u.length <= 1)
                return null;
            try {
                "turf"in window && "lineString"in turf ? (l = turf.lineString(u.map(function(n) {
                    return [n.x, n.y]
                })),
                l != null && (v = turf.lineOffset(l, e, {
                    units: "meters"
                }),
                r = v.geometry.coordinates.map(function(n) {
                    return new FBM.FWPoint(n[0],n[1])
                }))) : (u = h(u, e * f),
                r = u.map(function(n) {
                    return new FBM.FWPoint(n[0],n[1])
                }))
            } catch (b) {}
        }
        return t instanceof FBM.FWLineString ? new FBM.FWLineString(r) : t instanceof Array ? r : null
    }
    function f(n, t, i) {
        return (new Array(i + 1).join(t) + n).substr(n.length)
    }
    function e(n, t) {
        function i(i) {
            i.graphic = n;
            i.graphics = [n];
            n.relIDs && t && (i.graphics = i.graphics.concat(n.relIDs.map(function(n) {
                return t[n]
            })));
            FBM.FWEvent.trigger_(r, i.type, i)
        }
        var r = this;
        FBM.FWEvent.addListener(n, "setgeometry", function(t) {
            n.redraw(r.map);
            i(t)
        });
        FBM.FWEvent.addListener(n, "setproperty", i);
        FBM.FWEvent.addListener(n, "removeproperty", i);
        FBM.FWEvent.addListener(n, "mousedown", i);
        FBM.FWEvent.addListener(n, "mouseup", i);
        FBM.FWEvent.addListener(n, "mousemove", i);
        FBM.FWEvent.addListener(n, "mouseover", i);
        FBM.FWEvent.addListener(n, "dblclick", i);
        FBM.FWEvent.addListener(n, "click", i);
        FBM.FWEvent.addListener(n, "rightclick", i);
        FBM.FWEvent.addListener(n, "mouseout", i)
    }
    function t() {
        return this.trafficDatas[this.type && this.type in this.trafficDatas ? this.type : "section"]
    }
    function i() {
        function i(t) {
            var i, r;
            if (this.annotationDatas) {
                while (t >= 0) {
                    if (t in this.annotationDatas)
                        break;
                    t--
                }
                if (this._Label != t || !this.visibleStation) {
                    if (this.annotationDatas && this._Label in this.annotationDatas && this.annotationDatas[this._Label].aDatas && this.annotationDatas[this._Label].aDatas.forEach(function(n) {
                        n.setVisible(!1)
                    }),
                    !this.visibleStation) {
                        this._Label = null;
                        return
                    }
                    if (this._Label = t,
                    !(t < 0)) {
                        if (i = this.annotationDatas[t],
                        !i.aDatas) {
                            r = i.aDatas = [];
                            function u(t, i) {
                                var f = Object.mergeOptions({}, i, t.style), e;
                                "data"in t && t.data.forEach(function(n) {
                                    u(n, f)
                                });
                                "label"in t && (e = new FBM.FWPoint(t.x,t.y),
                                label = new FBM.FWLabel(Object.mergeOptions(f, {
                                    map: n,
                                    position: e,
                                    label: t.label,
                                    zIndex: 10
                                })),
                                label.setVisible(!1),
                                r.push(label))
                            }
                            u(i)
                        }
                        i.aDatas.forEach(function(n) {
                            n.setVisible(!0)
                        })
                    }
                }
            }
        }
        function r(t) {
            var r, i, u;
            if (this.stationDatas && this.stationDatas.service && (this._Mark != t || !this.visibleStation)) {
                if (this._Mark != null && this.stationDatas && this.stationDatas.aDatas && this.stationDatas.aDatas.forEachKey(function(n, t) {
                    t.forEachKey(function(n, t) {
                        t.setVisible(!1)
                    })
                }),
                !this.visibleStation) {
                    this._Mark = null;
                    return
                }
                if (r = this,
                this._Mark = t,
                i = this.stationDatas.service.find(function(n) {
                    return n.level.indexOf(t + 8) >= 0
                }),
                i && "pic_size"in i) {
                    var f = parseInt(i.pic_size.width)
                      , o = parseInt(i.pic_size.height)
                      , s = new FBM.FWSize(f,o)
                      , h = new FBM.FWPoint(f / 2,o / 2);
                    this.stationIcons.forEachKey(function(n, t) {
                        t.forEachKey(function(n, t) {
                            t && (t.size = s,
                            t.anchor = h)
                        })
                    })
                }
                i && i.data && (u = this.stationDatas.aDatas = this.stationDatas.aDatas || {},
                i.data.forEach(function(i) {
                    var f, o, s;
                    i.pos = i.pos || new FBM.FWPoint(i.long,i.lat);
                    i.id in u || (u[i.id] = {});
                    f = u[i.id][i.directionid];
                    f ? f.setPosition(i.pos) : (f = u[i.id][i.directionid] = new FBM.FWMarker(n,i.pos,"",null,{
                        zIndex: 1e3,
                        clickable: !0,
                        flat: !0
                    }),
                    o = r.sstyles[i.id] || r.sstyles._ || {},
                    f.level = o[i.directionid] || o._ || null,
                    f.leveled_icon = r.stationIcons[f.level in r.stationIcons ? f.level : "_"] || {},
                    e.call(r, f));
                    f.station = i;
                    s = f.leveled_icon[t in f.leveled_icon ? t : "_"];
                    f.setIcon(s);
                    f.setVisible(!!s)
                }))
            }
        }
        var n = this.map
          , t = this.map.getLevel();
        i.call(this, t);
        r.call(this, t)
    }
    var u = "Unable to import GeoJSON", o = ["Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon", "GeometryCollection"], r = function(n) {
        this.init(n)
    }, n;
    return r.prototype = new FBM.MVCObject,
    n = r.prototype,
    n.gstyles = {},
    n.map = null,
    n.visibleRoad = !0,
    n.visibleStation = !0,
    n.trafficDatas = {},
    n.annotationDatas = null,
    n.sstyles = {},
    n.stationIcons = {},
    n.stationDatas = {},
    n.add = function(n) {
        if (n instanceof FBM.FWGraphic) {
            this.remove(n);
            var i = t.call(this);
            return i.rDatas || (i.rDatas = {}),
            i.rDatas[n.id] = n,
            n.draw(this.map),
            e.call(this, n, i.rDatas),
            n
        }
    }
    ,
    n.removeAllGraphics = function() {
        var i = this
          , n = t.call(this);
        n.rDatas && (n.rDatas.forEachKey(function(n, t) {
            t.clear();
            FBM.FWEvent.trigger_(i, "removegraphic", t)
        }),
        n.rDatas = null,
        delete n.rDatas)
    }
    ,
    n.remove = function(n) {
        var i, r;
        n && this.contains(n) && (i = t.call(this),
        i.rDatas && (r = i.rDatas[n.id],
        delete i.rDatas[r.id],
        r.clear(),
        FBM.FWEvent.trigger_(this, "removegraphic", r)))
    }
    ,
    n.forEach = function(n, i) {
        var r = t.call(this);
        r.rDatas && r.rDatas.forEachKey(function(t, r) {
            return n.call(i, r)
        })
    }
    ,
    n.contains = function(n) {
        if (!(n instanceof FBM.FWGraphic))
            return !1;
        var i = t.call(this);
        return i.rDatas ? n.id in i.rDatas ? !0 : !1 : !1
    }
    ,
    n.getGraphicById = function(n) {
        var i = t.call(this);
        return i.rDatas ? n in i.rDatas ? i.rDatas[n] : null : null
    }
    ,
    n.setVisible = function(n) {
        this.setRoadVisible(n);
        this.setStationVisible(n)
    }
    ,
    n.getVisible = function() {
        return this.visibleRoad || this.visibleStation
    }
    ,
    n.setRoadVisible = function(n) {
        this.visibleRoad = n;
        var i = t.call(this);
        i.rDatas && i.rDatas.forEachKey(function(t, i) {
            i.gs_.forEach(function(t) {
                t.setVisible(n)
            })
        })
    }
    ,
    n.getRoadVisible = function() {
        return this.visibleRoad
    }
    ,
    n.setStationVisible = function(n) {
        this.visibleStation = n;
        i.call(this)
    }
    ,
    n.getStationVisible = function() {
        return this.visibleStation
    }
    ,
    n.getMap = function() {
        return this.map
    }
    ,
    n.setMap = function(n) {
        var r, t;
        this.clearAll();
        this.map = n;
        this.map && (this.setRoadData(this.type, this.SRDCB),
        r = this,
        i.call(this),
        this.map && (t = null,
        FBM.FWEvent.addListener(this.map, "zoom_changed", function() {
            t && FBM.FWEvent.removeListener(t);
            t = FBM.FWEvent.addListenerOnce(this.map, "idle", function() {
                i.call(r)
            })
        })))
    }
    ,
    n.clearAll = function() {
        var n = t.call(this);
        n.rDatas && n.rDatas.forEachKey(function(n, t) {
            return t.clear()
        });
        n.rDatas = {};
        this.annotationDatas && this.annotationDatas.forEachKey(function(n, t) {
            t.aDatas && (t.aDatas.forEach(function(n) {
                n.setMap(null);
                delete n
            }),
            t.aDatas = [])
        });
        this.stationDatas && this.stationDatas.aDatas && this.stationDatas.aDatas.forEachKey(function(n, t) {
            t.forEachKey(function(n, t) {
                t.setMap(null);
                delete t
            })
        });
        this.stationDatas.aDatas = {}
    }
    ,
    n.redrawAll = function() {
        if (this.visibleRoad) {
            var r = this.map
              , n = t.call(this);
            n.rDatas && n.rDatas.forEachKey(function(n, t) {
                return t.redraw(r)
            })
        }
        this.visibleStation && (this._Label = -1,
        this._Mark = -1,
        i.call(this))
    }
    ,
    n.redraw = function(n) {
        this.visibleRoad && this.contains(n) && n.redraw(this.map)
    }
    ,
    n.refreshStationData = function(n) {
        var i = this.stationDatas.aDatas = this.stationDatas.aDatas || {}, t;
        if ((n instanceof Array))
            return t = this,
            n.filter(function(n) {
                return n != null
            }).forEach(function(n) {
                var r = t.stationIcons[n.level in t.stationIcons ? n.level : "_"], u;
                "id"in n || (n.id = "_");
                "directionid"in n || (n.directionid = "_");
                n.id in t.sstyles || (t.sstyles[n.id] = {});
                t.sstyles[n.id][n.directionid] = n.level;
                u = [n.id];
                n.id == "_" && (u = Object.keys(i));
                u.filter(function(n) {
                    return n in i
                }).forEach(function(u) {
                    var f = i[u]
                      , e = [n.directionid];
                    n.directionid == "_" && (e = Object.keys(f));
                    e.filter(function(n) {
                        return n in f
                    }).map(function(n) {
                        return f[n]
                    }).forEach(function(i) {
                        i.level = n.level;
                        i.leveled_icon = r;
                        var u = r[t._Mark in r ? t._Mark : "_"];
                        i.setIcon(u);
                        i.setVisible(!!u)
                    })
                })
            }),
            {
                status: !0,
                message: "success"
            }
    }
    ,
    n.refreshRoadData = function(n) {
        if (n instanceof Array) {
            var t = this
              , i = [];
            return n.filter(function(n) {
                return n != null
            }).forEach(function(n) {
                var r = {}, u;
                "opacity"in n && (r.opacity = n.opacity);
                "strokeOpacity"in n && (r.strokeOpacity = n.strokeOpacity);
                "strokeColor"in n && (r.strokeColor = n.strokeColor);
                "strokeBorder"in n && (r.strokeBorder = n.strokeBorder);
                t.gstyles[n.locationId] = r;
                u = t.getGraphicById(n.locationId);
                u ? u.setOwnStyle(Object.mergeOptions(u.ownStyle, t.gstyles[n.locationId])) : i.push(n.locationId)
            }),
            console.groupCollapsed("refresh not found"),
            console.log(new Date),
            console.log(i),
            console.groupEnd(),
            {
                status: !0,
                message: "success"
            }
        }
    }
    ,
    n.setRoadData = function(n, i) {
        var r, u, e, f;
        if (this._acttype == n)
            return {
                status: !1,
                message: "road type set already"
            };
        if (this.type = n,
        this.SRDCB = i,
        this.trafficDatas && this.trafficDatas.forEachKey(function(n, t) {
            t.rDatas && t.rDatas.forEachKey(function(n, t) {
                t.gs_.forEach(function(n) {
                    n.setVisible(!1)
                })
            })
        }),
        !(n && n in this.trafficDatas))
            return {
                status: !1,
                message: "not supported road type"
            };
        if (this._acttype = n,
        r = this,
        u = t.call(this),
        u.rDatas)
            u.rDatas.forEachKey(function(n, t) {
                t.gs_.forEach(function(n) {
                    n.setVisible(!0)
                })
            }),
            i && i.apply(r);
        else {
            u.rDatas = [];
            e = 0;
            f = null;
            switch (this.map.getCoordSys()) {
            case FBM.FWCoordSys.EPSG3857:
                f = "WGS84";
                break;
            case FBM.FWCoordSys.EPSG3826:
                f = "TWD97";
                break;
            case FBM.FWCoordSys.EPSG3825:
                f = "TWD67";
                break;
            default:
                throw "Invalid Map CRS";
            }
            (function o(n) {
                "data"in n && n.data.forEach(function(t) {
                    if (t.constructor != String)
                        return o.call(r, t);
                    e++;
                    var h = new AjaxAgent(null,!0,!1);
                    h.Open("GET", FBM.TRAFICDATA_PATH + t + ".json");
                    h.SendRequest(null, function(t) {
                        var i = s(JSON.parse(t.responseText), f);
                        i.forEach(function(t) {
                            var i, f;
                            t.id = t.properties.ID ? t.properties.ID : t.properties.KEY_ID ? t.properties.KEY_ID : t.properties.locationId ? t.properties.locationId : t.properties.SECTIONID;
                            i = [{
                                g: t,
                                d: 0
                            }];
                            n.twoWay && u.twoWayProc && (f = u.twoWayProc(t),
                            i.unshift({
                                g: new FBM.FWGraphic({
                                    geometry: t.geometry,
                                    properties: {
                                        ID: f
                                    },
                                    id: f
                                }),
                                d: 1
                            }));
                            i.forEach(function(t) {
                                "relIDs"in u && (t.g.relIDs = u.relIDs[t.g.id]);
                                t.g.setStyle(n.style);
                                t.g.setOwnStyle(Object.mergeOptions(r.gstyles[t.g.id], r.style, {
                                    direction: t.d
                                }));
                                r.add(t.g)
                            })
                        })
                    }, function() {
                        e--;
                        e == 0 && (r.map.overlay.RebuildElement(),
                        FBM.FWEvent.trigger(r, "loaded"),
                        i && i.apply(r))
                    })
                })
            }
            ).call(this, u)
        }
        return {
            status: !0,
            message: "success"
        }
    }
    ,
    n.setStationIcon = function(t, i) {
        var r = this;
        t = t || "_";
        t in n.stationIcons || (n.stationIcons[t] = {});
        Array.isArray(i) || (i = [i]);
        i.forEach(function(n) {
            if ((n == null || n.constructor == String || typeof n == "string") && (n = {
                icon: n
            }),
            "icon"in n && (n.icon == null || n.icon.constructor == String || typeof n.icon == "string")) {
                "levels"in n ? Array.isArray(n.levels) || (n.levels = [n.levels]) : n.levels = ["_"];
                var i = null;
                n.icon != null && (i = new FBM.FWImage(n.icon));
                n.levels.forEach(function(n) {
                    r.stationIcons[t][n] = i
                })
            }
        })
    }
    ,
    n.init = function(t) {
        t.map && (this.map = t.map);
        t.type && (this.type = t.type);
        t.style && (this.style = t.style);
        var r = this;
        "stationIcon"in t && t.stationIcon.forEachKey(function(n, t) {
            r.setStationIcon(n, t)
        });
        this.events.forEach(function(n) {
            n in t && FBM.FWEvent.addListener(r, n, t[n])
        });
        new Promise(function(t, i) {
            var u = new AjaxAgent(null,!0,!1);
            u.Open("GET", FBM.TRAFICDATA_PATH + "FWData.json");
            u.SendRequest(null, function(i) {
                function u(n, t) {
                    var i = t.id.split("-");
                    return i[3] = f((parseInt(i[3]) + (i[2] == "N" || i[2] == "W" ? n : -n)).toString(), "0", i[3].length),
                    i[2] = i[2] == "N" ? "S" : i[2] == "S" ? "N" : i[2] == "W" ? "E" : i[2] == "E" ? "W" : i[2],
                    i.join("-")
                }
                var e = JSON.parse(i.responseText);
                n.trafficDatas = e.traffic;
                n.annotationDatas = e.annotation;
                "section"in n.trafficDatas && (n.trafficDatas.section.twoWayProc = function(n) {
                    return f((parseInt(n.id) + 1).toString(), "0", n.id.length)
                }
                );
                "ukm"in n.trafficDatas && (n.trafficDatas.ukm.twoWayProc = u.bind(null, 1e3));
                "u5m"in n.trafficDatas && (n.trafficDatas.u5m.twoWayProc = u.bind(null, 500));
                "u1m"in n.trafficDatas && (n.trafficDatas.u1m.twoWayProc = u.bind(null, 100));
                n.trafficDatas && n.trafficDatas.forEachKey(function(n, t) {
                    return function i(n, t) {
                        n.constructor != String && "data"in n && (n.style = t ? Object.mergeOptions({}, t, n.style) : Object.mergeOptions({
                            beforeDraw: l
                        }, n.style),
                        n.data.forEach(function(t) {
                            return i(t, n.style)
                        }))
                    }(t)
                });
                r.setRoadData(r.type, r.SRDCB);
                t()
            }, null, i)
        }
        ).then(function() {
            var t = new AjaxAgent(null,!0,!1);
            t.Open("GET", FBM.TRAFICDATA_PATH + "FWService.json");
            t.SendRequest(null, function(t) {
                var f = JSON.parse(t.responseText), u;
                n.stationDatas = f;
                i.call(r);
                r.map && (u = null,
                FBM.FWEvent.addListener(r.map, "zoom_changed", function() {
                    u && FBM.FWEvent.removeListener(u);
                    u = FBM.FWEvent.addListenerOnce(r.map, "idle", function() {
                        i.call(r)
                    })
                }))
            })
        })
    }
    ,
    FBM.RegisterEvent(r, ["addgraphic", "removegraphic", "removeproperty", "setgeometry", "setproperty", "click", "dblclick", "mousedown", "mouseup", "mouseout", "mouseover", "mousemove", "rightclick", "loaded", ]),
    r
}();
/*! D:\FW_API\scripts\FWOverlayView.js*/
(function() {
    FBM.FWOverlayView = function() {}
    ;
    var n = FBM.FWOverlayView.prototype;
    n.setMap = function(n) {
        n == null ? (this.map.removeLayer(this),
        this.map = null) : n instanceof FBM.FWOnlineMap && (this.map = n,
        this.map.addLayer(this))
    }
    ;
    n.getMap = function() {
        return this.map
    }
    ;
    n.getPanes = function() {
        return this.map ? this.map.getPanes() : null
    }
    ;
    n.getProjection = function() {
        if (!this.map)
            return null;
        var t = this.map
          , n = t.getMapBase()
          , i = t.getCoordSys();
        return {
            fromDivToMap: function(t) {
                var r, u, f;
                return i == FBM.FWCoordSys.EPSG3857 ? (r = n.ToMapPoint(t.x, t.y),
                u = FBM.WGS84ToGoo(r.x, r.y),
                new FBM.FWPoint(u.x,u.y)) : (f = n.ToMapPoint(t.x, t.y),
                new FBM.FWPoint(f.x,f.y))
            },
            fromMapToDiv: function(t) {
                var r, u, f;
                return i == FBM.FWCoordSys.EPSG3857 ? (r = FBM.WGS84ToGoo(t.x, t.y),
                u = n.FromMapPoint(r.x, r.y),
                new FBM.FWPoint(u.x,u.y)) : (f = n.FromMapPoint(t.x, t.y),
                new FBM.FWPoint(f.x,f.y))
            }
        }
    }
    ;
    n.Initialize = function() {
        this.onAdd()
    }
    ;
    n.UpdateElement = function() {
        this.onDraw()
    }
    ;
    n.RebuildElement = function() {
        this.onDraw()
    }
    ;
    n.RemoveSelf = function() {
        this.onRemove()
    }
}
)();
/*! D:\FW_API\scripts\request.js*/
FBM.request = function() {
    var n = {}, i = 0, u = function(n) {
        var t = document.createElement("form"), r, u, i, f;
        t.setAttribute("method", n.method ? n.method : "POST");
        r = "multipart/form-data";
        t.setAttribute("enctype", r);
        t.setAttribute("encoding", r);
        for (u in n.data)
            i = document.createElement("input"),
            i.type = "hidden",
            i.name = u,
            i.value = n.data[u],
            t.appendChild(i);
        return f = document.createElement("input"),
        f.type = "submit",
        t.appendChild(f),
        document.body.appendChild(t),
        t
    }, f = function(n, t) {
        var o = "sgIFrame" + i, f = document.createElement("iframe"), s, r, e;
        f.setAttribute("id", o);
        f.setAttribute("name", o);
        f.setAttribute("width", "0");
        f.setAttribute("height", "0");
        f.setAttribute("border", "0");
        f.setAttribute("style", "width: 0; height: 0; border: none;");
        s = t.form ? t.form : u(t);
        document.body.appendChild(f);
        r = document.getElementById(o);
        e = function() {
            r.detachEvent ? r.detachEvent("onload", e) : r.removeEventListener("load", e, !1);
            r.contentDocument ? content = r.contentDocument.body.innerHTML : r.contentWindow ? content = r.contentWindow.document.body.innerHTML : r.document && (content = r.document.body.innerHTML);
            t.callback && t.callback.call(this, JSON.parse(content));
            r.parentNode.removeChild(r)
        }
        ;
        r.addEventListener && r.addEventListener("load", e, !0);
        r.attachEvent && r.attachEvent("onload", e);
        s.setAttribute("target", o);
        s.setAttribute("action", n);
        s.submit();
        i++
    }, t;
    n.iframe = f;
    var r = function(n, t, i) {
        return n.indexOf("?") >= 0 ? n + "&" + t + "=" + i : n + "?" + t + "=" + i
    }
      , e = function(t, i, u, f) {
        var c = DeviceTest(), o, h, s, e;
        (typeof n.ajaxCount__ != "number" && (n.ajaxCount__ = 0),
        o = "sn" + n.ajaxCount__,
        h = function() {
            i.apply(this, arguments);
            delete FBM.request.getJSON[o]
        }
        ,
        FBM.request.getJSON[o] = h,
        u && (t = r(u, "serv", encodeURIComponent(t))),
        t = r(t, "jsonp", encodeURIComponent("FBM.request.getJSON['" + o + "']")),
        s = document.getElementsByTagName("head"),
        s.length != 0) && (e = document.createElement("script"),
        e.type = "text/javascript",
        c == "MSIE" ? e.onreadystatechange = function() {
            this.readyState && this.readyState !== "loaded" && this.readyState !== "complete" || (this.parentNode.removeChild(e),
            e = undefined)
        }
        : e.onload = function() {
            this.parentNode.removeChild(e);
            e = undefined
        }
        ,
        e.onerror = function() {
            f && f.call(this);
            this.parentNode.removeChild(e);
            e = undefined
        }
        ,
        n.ajaxCount__++,
        e.src = t,
        s[0].appendChild(e))
    }
      , o = function() {
        return window.XMLHttpRequest ? new XMLHttpRequest : window.ActiveXObject ? new ActiveXObject("Microsoft.XMLHTTP") : void 0
    };
    return n.getJSON = e,
    t = function(n, t, i) {
        if (n.readyState == 4) {
            if (n.status != 200 && n.status != 304) {
                i && i.call(this, n.status);
                return
            }
            t && t.call(this, n)
        }
    }
    ,
    n.ajax = function(n, i) {
        var r = o()
          , h = "get"
          , u = !1
          , f = null
          , c = null
          , l = null
          , e = null
          , s = null;
        (i && (i.method === "post" && (h = "post"),
        i.async === !1 && (u = !1),
        i.async === !1 && (f = null),
        i.user && (c = i.user),
        i.password && (l = i.password),
        i.error && (e = i.error),
        i.complete && (s = i.complete)),
        r.open(h, n, u, c, l),
        f && r.setRequestHeader("Content-type", "application/x-www-form-urlencoded"),
        u === !0 && (r.onreadystatechange = function() {
            t(r, s, e)
        }
        ),
        r.readyState != 4) && (r.send(f),
        u === !1 && t(r, s, e))
    }
    ,
    n.get = function(t, i) {
        i.method = "get";
        n.ajax.call(this, t, i)
    }
    ,
    n.post = function(t, i) {
        i.method = "post";
        n.ajax.call(this, t, i)
    }
    ,
    n
}();
/*! D:\FW_API\scripts\GFX.js*/
(function() {
    var n = "http://www.w3.org/2000/svg"
      , t = "http://www.w3.org/1999/xlink"
      , r = function(n) {
        for (var e, t, o, u, f = "", i = [], r = 0; r < n.length; r++)
            e = n[r],
            (e == "t" || e == "r") && i.push(r);
        for (t = 0; t < i.length; t++)
            o = n.slice(i[t] + 1, i[t + 1]),
            n[i[t]] == "t" ? (u = "translate(" + o + ") ",
            f += u) : n[i[t]] == "r" && (u = "rotate(" + o + ") ",
            f += u);
        return f
    }
      , u = function(n, t) {
        var i = document.createElement("img");
        i.style.cssText = "position:absolute;left:-9999em;top:-9999em";
        i.onload = function() {
            t.call(this);
            this.onload = null;
            document.body.removeChild(this)
        }
        ;
        i.onerror = function() {
            document.body.removeChild(this)
        }
        ;
        document.body.appendChild(i);
        i.src = n
    }
      , i = function(n, t) {
        return function() {
            return "xxxxxxxx-sxxx-gxxx-xxxx-xxxxxxxxxxxx".replace(n, t).toUpperCase()
        }
    }(/[xy]/g, function(n) {
        var t = Math.random() * 16 | 0
          , i = n == "x" ? t : t & 3 | 8;
        return i.toString(16)
    });
    ISURL = /^url\(['"]?([^\)]+?)['"]?\)$/i;
    FBM.gfxSurface = function(i) {
        var r = i;
        this.shapes = [];
        this.sets = [];
        this.defs = document.createElementNS(n, "defs");
        r.appendChild(this.defs);
        this.getDefID_ = function() {
            this.defs.childNodes.length
        }
        ;
        this.element = function() {
            return r
        }
        ;
        this.rect = function(t, i, u, f) {
            var e = document.createElementNS(n, "rect");
            return e.setAttribute("width", u),
            e.setAttribute("height", f),
            e.setAttribute("x", t),
            e.setAttribute("y", i),
            r.appendChild(e),
            e = new FBM.gfxElement(e),
            this.shapes.push(e),
            e.surfacnode = this,
            e
        }
        ;
        this.image = function(i, u, f, e, o) {
            var s = document.createElementNS(n, "image");
            return s.setAttribute("width", e),
            s.setAttribute("height", o),
            s.setAttribute("x", u),
            s.setAttribute("y", f),
            s.setAttributeNS(t, "href", i),
            r.appendChild(s),
            s = new FBM.gfxElement(s,"image"),
            this.shapes.push(s),
            s.surfacnode = this,
            s.type = "image",
            s
        }
        ;
        this.text = function(t, i, u) {
            var f = document.createElementNS(n, "text");
            return f.setAttribute("x", t),
            f.setAttribute("y", i),
            f.textContent = u,
            r.appendChild(f),
            f = new FBM.gfxElement(f),
            this.shapes.push(f),
            f.surfacnode = this,
            f
        }
        ;
        this.circle = function(t, i, u) {
            var f = document.createElementNS(n, "circle");
            return f.setAttribute("cx", t),
            f.setAttribute("cy", i),
            f.setAttribute("r", u),
            r.appendChild(f),
            f = new FBM.gfxElement(f),
            this.shapes.push(f),
            f.surfacnode = this,
            f
        }
        ;
        this.path = function(t) {
            var i = document.createElementNS(n, "path");
            return i.setAttributeNS(null, "d", t),
            r.appendChild(i),
            i = new FBM.gfxElement(i),
            this.shapes.push(i),
            i.surfacnode = this,
            i
        }
        ;
        this.clear = function() {}
        ;
        this.group = function() {
            var t = document.createElementNS(n, "g");
            return t.style.display = "block",
            r.appendChild(t),
            t = new FBM.gfxElement(t,"group"),
            this.shapes.push(t),
            t.surfacnode = this,
            t
        }
    }
    ;
    FBM.gfxElement = function(n, t) {
        this.node = n;
        this.type = t;
        this.type == "group" && (this.shapes = [])
    }
    ;
    FBM.gfxElement.prototype.node = null;
    FBM.gfxElement.prototype.surfacnode = null;
    FBM.gfxElement.prototype.patternId = null;
    FBM.gfxElement.prototype.type = null;
    FBM.gfxElement.prototype.getBBox = function(n) {
        return n ? this.node.getBBox() : this.node.getBoundingClientRect()
    }
    ;
    FBM.gfxElement.prototype.element = function() {
        return this.node
    }
    ;
    FBM.gfxElement.prototype.hide = function() {
        return this.node.style.visibility = "hidden"
    }
    ;
    FBM.gfxElement.prototype.show = function() {
        return this.node.style.visibility = "visible"
    }
    ;
    FBM.gfxElement.prototype.attr = function(r) {
        var u, c, l, f, e, o, h, s;
        for (u in r)
            switch (u) {
            case "path":
                this.node.setAttribute("d", r[u]);
                break;
            case "fill":
                if (typeof r[u] == "object") {
                    if (c = r[u].type,
                    c == "pattern") {
                        if (l = r[u].src,
                        this.pattern && this.pattern.parentNode.removeChild(this.pattern),
                        f = document.createElementNS(n, "pattern"),
                        this.pattern = f,
                        r[u].width == "100%" && r[u].height == "100%") {
                            f.setAttribute("patternContentUnits", "objectBoundingBox");
                            f.setAttribute("width", 1);
                            f.setAttribute("height", 1);
                            f.setAttribute("x", 0);
                            f.setAttribute("y", 0);
                            this.patternId = i();
                            f.setAttribute("id", this.patternId);
                            e = document.createElementNS(n, "image");
                            f.img = e;
                            var v = this.node
                              , y = this.patternId
                              , a = this.surfacnode;
                            e.setAttribute("x", "0");
                            e.setAttribute("y", "0");
                            e.setAttribute("width", "1");
                            e.setAttribute("height", "1");
                            e.setAttribute("preserveAspectRatio", "none");
                            f.appendChild(e);
                            a.defs.appendChild(f)
                        } else {
                            f.setAttribute("patternUnits", "userSpaceOnUse");
                            f.setAttribute("width", r[u].width);
                            f.setAttribute("height", r[u].height);
                            f.setAttribute("x", r[u].x ? r[u].x : 0);
                            f.setAttribute("y", r[u].y ? r[u].y : 0);
                            this.patternId = i();
                            f.setAttribute("id", this.patternId);
                            e = document.createElementNS(n, "image");
                            f.appendChild(e);
                            f.img = e;
                            var v = this.node
                              , y = this.patternId
                              , a = this.surfacnode;
                            a.defs.appendChild(f);
                            e.setAttribute("x", "0");
                            e.setAttribute("y", "0");
                            e.setAttribute("width", r[u].width);
                            e.setAttribute("height", r[u].height)
                        }
                        e.setAttributeNS(t, "href", l);
                        v.setAttribute("fill", "url(#" + y + ")")
                    }
                } else
                    this.node.setAttribute(u, r[u]);
                break;
            case "stroke-dasharray":
                for (o = "",
                h = parseInt(this.node.getAttributeNS(null, "stroke-width")),
                s = 0; s < r[u].length; s++)
                    r[u][s] === "_" ? o += h * 4 + "," : r[u][s] === "." ? o += h + "," : r[u][s] === "~" ? o += h * 8 + "," : r[u][s] === "-" && (o += h * 2 + ","),
                    o += h + ",";
                o[o.length - 1] == "," && (o = o.substring(0, o.length - 1));
                this.node.setAttribute("stroke-dasharray", o);
                break;
            default:
                this.node.setAttribute(u, r[u])
            }
    }
    ;
    FBM.gfxElement.prototype.setRotate = function(n, t, i) {
        var r = this.node.getAttributeNS(null, "transform"), u;
        rot = t === undefined && i === undefined ? " rotate(" + n + ")" : " rotate(" + n + " " + t + " " + i + ")";
        u = /rotate\(*.\)/;
        r = r.replace(u, rot);
        this.node.setAttributeNS(null, "transform", r)
    }
    ;
    FBM.gfxElement.prototype.setTranslate = function(n, t) {
        var i = this.node.getAttributeNS(null, "transform")
          , r = "translate(" + n + " " + t + ")";
        i = i.replace(/translate\(*.\)/, r);
        this.node.setAttributeNS(null, "transform", i)
    }
    ;
    FBM.gfxElement.prototype.transform = function(n) {
        this.node.setAttributeNS(null, "transform", r(n))
    }
    ;
    FBM.gfxElement.prototype.translate = function(n, t) {
        var i = this.node.getAttributeNS(null, "transform");
        i += " translate(" + n + " " + t + ")";
        this.node.setAttributeNS(null, "transform", i)
    }
    ;
    FBM.gfxElement.prototype.rotate = function(n, t, i) {
        var r = this.node.getAttributeNS(null, "transform");
        r += t === undefined && i === undefined ? " rotate(" + n + ")" : " rotate(" + n + " " + t + " " + i + ")";
        this.node.setAttributeNS(null, "transform", r)
    }
    ;
    FBM.gfxElement.prototype.scale = function(n, t) {
        var i = this.node.getAttributeNS(null, "transform");
        i += t === undefined ? " scale(" + n + ")" : " scale(" + n + " " + t + ")";
        this.node.setAttributeNS(null, "transform", i)
    }
    ;
    FBM.gfxElement.prototype.remove = function() {
        this.pattern && this.pattern.parentNode && this.pattern.parentNode.removeChild(this.pattern);
        this.node && this.node.parentNode && this.node.parentNode.removeChild(this.node)
    }
    ;
    FBM.gfxElement.prototype.insertBefore = function(n) {
        this.surfacnode.element().insertBefore(this.node, n.node)
    }
    ;
    FBM.gfxElement.prototype.rect = function(t, i, r, u) {
        var f = document.createElementNS(n, "rect");
        return f.setAttribute("width", r),
        f.setAttribute("height", u),
        f.setAttribute("x", t),
        f.setAttribute("y", i),
        this.node.appendChild(f),
        f = new FBM.gfxElement(f),
        this.shapes.push(f),
        f.surfacnode = this.surfacnode,
        f
    }
    ;
    FBM.gfxElement.prototype.image = function(i, r, u, f, e) {
        var o = document.createElementNS(n, "image");
        return o.setAttribute("width", f),
        o.setAttribute("height", e),
        o.setAttribute("x", r),
        o.setAttribute("y", u),
        o.setAttributeNS(t, "href", i),
        this.node.appendChild(o),
        o = new FBM.gfxElement(o,"image"),
        this.shapes.push(o),
        o.surfacnode = this.surfacnode,
        o
    }
    ;
    FBM.gfxElement.prototype.text = function(t, i, r) {
        var u = document.createElementNS(n, "text");
        return u.setAttribute("x", t),
        u.setAttribute("y", i),
        u.textContent = r,
        this.node.appendChild(u),
        u = new FBM.gfxElement(u),
        this.shapes.push(u),
        u.surfacnode = this.surfacnode,
        u
    }
    ;
    FBM.gfxElement.prototype.circle = function(t, i, r) {
        var u = document.createElementNS(n, "circle");
        return u.setAttribute("cx", t),
        u.setAttribute("cy", i),
        u.setAttribute("r", r),
        this.node.appendChild(u),
        u = new FBM.gfxElement(u),
        this.shapes.push(u),
        u.surfacnode = this.surfacnode,
        u
    }
    ;
    FBM.gfxElement.prototype.path = function(t) {
        var i = document.createElementNS(n, "path");
        return i.setAttributeNS(null, "d", t),
        this.node.appendChild(i),
        i = new FBM.gfxElement(i),
        this.shapes.push(i),
        i.surfacnode = this.surfacnode,
        i
    }
    ;
    FBM.gfxElement.prototype.clear = function() {}
    ;
    FBM.gfxElement.prototype.group = function() {
        var t = document.createElementNS(n, "g");
        return this.node.appendChild(t),
        t = new FBM.gfxElement(t,"group"),
        this.shapes.push(t),
        t.surfacnode = this.surfacnode,
        t
    }
    ;
    FBM.createSurface = function(t, i, r) {
        if (!FBM.features.svg)
            return null;
        var u = document.createElementNS(n, "svg")
          , i = typeof i == "number" ? i : "100%"
          , r = typeof r == "number" ? r : "100%";
        return u.setAttribute("width", i),
        u.setAttribute("height", r),
        u.setAttribute("overflow", "hidden"),
        u.style.position = "absolute",
        t.appendChild(u),
        new FBM.gfxSurface(u)
    }
}
)();
/*! D:\FW_API\scripts\FWRender.js*/
FBM.renderers = FBM.renderers || function() {
    var n = {};
    return n.Renderer = function() {
        this.getColor = function(n) {
            var f, r, o;
            if (this.colorInfo && (f = n.attributes,
            f)) {
                var c = parseFloat(f[this.colorInfo.field])
                  , l = (c - this.colorInfo.minValue) / (this.colorInfo.maxValue - this.colorInfo.minValue)
                  , s = this.colorInfo.colors.length;
                if (s >= 2) {
                    var a = 1 / (s - 1)
                      , h = l / a
                      , e = Math.floor(h)
                      , v = e + 1
                      , u = h - e
                      , t = this.colorInfo.colors[e]
                      , i = this.colorInfo.colors[v];
                    if (!i)
                        return r = this.colorInfo.colors[this.colorInfo.colors.length - 1],
                        o = new FBM.Color(r.r,r.g,r.b,r.a),
                        o;
                    var y = t.r + (i.r - t.r) * u
                      , p = t.g + (i.g - t.g) * u
                      , w = t.b + (i.b - t.b) * u
                      , b = t.a + (i.a - t.a) * u
                      , o = new FBM.Color(y,p,w,b);
                    return o
                }
            }
        }
        ;
        this.getRotationAngle = function(n) {
            var t, i, r, u;
            if (this.rotationInfo && (t = n.attributes,
            t))
                return i = parseFloat(t[this.rotationInfo.field]),
                u = this.rotationInfo.type,
                u == "geographic" ? r = 270 - i : u == "arithmetic" && (r = i),
                r
        }
        ;
        this.getSize = function(n) {
            var t;
            if (this.propotionalSymbolInfo && (t = n.attributes,
            t)) {
                var r = this.propotionalSymbolInfo.maxSize
                  , u = this.propotionalSymbolInfo.minSize
                  , i = parseFloat(t[this.propotionalSymbolInfo.field]);
                return i > r ? r : i < u ? u : i
            }
        }
        ;
        this.setColorInfo = function(n) {
            return n && (this.colorInfo = n),
            this
        }
        ;
        this.setSizeInfo = function(n) {
            return n && (this.sizeInfo = n),
            this
        }
        ;
        this.setOpacityInfo = function(n) {
            return n && (this.opacityInfo = n),
            this
        }
        ;
        this.setProportionalSymbolInfo = function(n) {
            return n && (this.propotionalSymbolInfo = n),
            this
        }
        ;
        this.setRotationInfo = function(n) {
            return n && (this.rotationInfo = n),
            this
        }
    }
    ,
    n.ClassBreaksRenderer = function(n, t) {
        if (this.getSymbol = function(n) {
            for (var t = 0; t < this.infos.length; t++)
                if (this.infos[t].maxValue > n.attributes[this.attributeField] && this.infos[t].minValue <= n.attributes[this.attributeField])
                    return this.infos[t].symbol;
            return this.defaultSymbol
        }
        ,
        this.infos = [],
        !n)
            throw "Default Symbol must be provided";
        if (this.defaultSymbol = n,
        typeof t != "string")
            throw "Attribute field must be provided";
        this.attributeField = t
    }
    ,
    FBM.extend(n.Renderer, n.ClassBreaksRenderer),
    n.ClassBreaksRenderer.prototype.addBreak = function(n) {
        this.infos.push(n)
    }
    ,
    n.ClassBreaksRenderer.prototype.removeBreak = function(n) {
        var t = this.infos.indexOf(n);
        t >= 0 && this.infos.splice(t, 1)
    }
    ,
    n
}();
/*! D:\FW_API\scripts\GraphicLayer.js*/
(function() {
    var t = /\${[\w:]*}/g, n;
    FBM.GraphicsLayer = function() {
        this.map_ = null;
        this.surface_ = null;
        this.svgContainer = null;
        this.lastScale = null;
        this.surface = null;
        this.graphics = null;
        this.mouseEventEnabled = !0;
        this.renderer = null;
        this.infoTemplate = null;
        this.visible = !0;
        this.graphics = [];
        this.name = "Graphics Layer";
        this.title = "Graphics Layer";
        this.minScale = 0;
        this.maxScale = 0;
        this.getNode = function() {
            return this.node
        }
        ;
        this.templateReplace = function(n, i) {
            var f = i.match(t), u, r, e;
            if (f)
                for (u = 0; u < f.length; u++)
                    r = f[u].replace("{", "").replace("$", "").replace("}", "").split(":"),
                    e = "",
                    r.length <= 1 ? e = n.attributes[r[0]] ? n.attributes[r[0]] : "" : window[r[1]] && (e = window[r[1]].call(this, n.attributes[r[0]], r[0], n.attributes)),
                    i = i.replace(f[u], e);
            return i
        }
        ;
        this.add = function(n) {
            var t = this;
            n && (n.layer = this,
            n.draw(t.map_, new FBM.FWPoint(n.attributes.longitude,n.attributes.latitude)),
            this.graphics.push(n),
            FBM.FWEvent.trigger(n, "graphic-add"))
        }
        ;
        this.clear = function() {
            for (var n, i, t = 0; t < this.graphics.length; t++) {
                if (n = this.graphics[t],
                !(n instanceof FBM.Graphic))
                    return;
                for (i = 0; i < n.shapes.length; i++)
                    n.shapes[i].remove();
                n.shapes = []
            }
            this.graphics = [];
            FBM.FWEvent.trigger(n, "graphic-clear")
        }
        ;
        this.setInfoTemplate = function(n) {
            tempe && (this.infoTemplate = n)
        }
        ;
        this.disableMouseEvents = function() {
            this.mouseEventEnabled = !1
        }
        ;
        this.enableMouseEvents = function() {
            this.mouseEventEnabled = !0
        }
        ;
        this.getMap = function() {
            return this.map_
        }
        ;
        this.isVisibleAtScale = function(n) {
            var t = this.minScale === 0 || n > this.minScale
              , i = this.maxScale === 0 || n < this.maxScale;
            return t && i
        }
        ;
        this.setMaxScale = function(n) {
            if (typeof n == "number" && (this.maxScale = n,
            this.map_)) {
                var t = this.map_.getMapBase().getScale();
                this.isVisibleAtScale(t) || (this.node.style.visibility = "hidden")
            }
        }
        ;
        this.setMinScale = function(n) {
            if (typeof n == "number" && (this.minScale = n,
            this.map_)) {
                var t = this.map_.getMapBase().getScale();
                this.isVisibleAtScale(t) || (this.node.style.visibility = "hidden")
            }
        }
        ;
        this.setVisibility = function(n) {
            typeof n == "boolean" && (this.node && (this.node.style.visibility = n ? "visible" : "hidden"),
            this.visible = n)
        }
        ;
        this.setRenderer = function(n) {
            this.renderer = n;
            this.map_ && this.redraw()
        }
        ;
        this.redraw = function() {
            for (var n = 0; n < this.graphics.length; n++)
                this.graphics[n].draw()
        }
        ;
        this.remove = function(n) {
            var t, i;
            if (n instanceof FBM.Graphic) {
                for (t = 0; t < n.shapes.length; t++)
                    n.shapes[t].remove();
                n.shapes = [];
                i = this.graphics.indexOf(n);
                i > -1 && this.graphics.splice(i, 1);
                FBM.FWEvent.trigger(n, "graphic-remove")
            }
        }
        ;
        this.UpdateElement = function() {
            var i = this.map_.getMapBase().getScale(), t, r;
            i == this.lastScale && (t = this.map_.getMapBase().FromMapPoint(n.x, n.y),
            r = "t" + Math.round(t.x) + " " + Math.round(t.y),
            this.trans = t)
        }
        ;
        this.RebuildElement = function() {
            var n = this.map_.getMapBase().getScale()
              , t = n != this.lastScale;
            (this.isVisibleAtScale(n) || this.setVisibility(!1),
            t) && (this.lt_ = this.map_.getMapBase().ToMapPoint(0, 0),
            this.trans = new FBM.FWPoint(0,0),
            this.lastScale = this.map_.getMapBase().getScale(),
            this.visible && this.redraw())
        }
        ;
        this.Initialize = function(t) {
            var u = this, i, r;
            this.map_ = this.mapsa;
            this.map = t;
            i = this.map_.getMapBase().getClientWidth;
            r = this.map_.getMapBase().getClientHeight;
            this.lt_ = this.map_.getMapBase().ToMapPoint(0, 0);
            n = this.map_.getMapBase().ToMapPoint(0, 0);
            this.trans = new FBM.FWPoint(0,0);
            this.lastScale = this.map_.getMapBase().getScale();
            this.redraw()
        }
        ;
        this.RemoveSelf = function() {
            this.zoomStartEvt_ && this.zoomStartEvt_.remove();
            this.zoomEndEvt_ && this.zoomEndEvt_.remove()
        }
        ;
        FBM.RegisterEvent(FBM.GraphicsLayer, ["graphic-add", "graphic-remove", "graphic-clear", "drag-start", "drag", "drag-end", "click", "dblclick", "mousedown", "mouseup", "mouseout", "mouseover", "mousemove", "rightclick"])
    }
}
)();
/*! D:\FW_API\scripts\FWGraphicsLayer.js*/
(function() {
    FBM.FWGraphicsLayer = function(n, t) {
        this.map = null;
        this.advancedLayer = null;
        this.visible = !0;
        this.opacity = 1;
        this.graphics = [];
        this.name = null;
        this.title = null;
        var i = this;
        this.getNode = function() {
            if (this.map) {
                if (this.advancedLayer) {
                    var n = this.advancedLayer;
                    return n != null ? [n.div.main, n.div.shadow] : this.map.getPanes().graphicLayer
                }
                return this.map.getPanes().graphicLayer
            }
        }
        ;
        this.getAllGraphics = function() {
            return this.graphics
        }
        ;
        this.add = function(n, t) {
            n && (n instanceof FBM.FWFill || n instanceof FBM.FWLine || n instanceof FBM.FWMarker || n instanceof FBM.FWLabel) && (n.setAdvancedLayer(this.advancedLayer),
            n.setMap(this.map),
            n.setVisible(this.visible),
            n.redraw && n.redraw(!0),
            this.graphics.push(n),
            t == null && FBM.FWEvent.trigger(this, "graphic_add"))
        }
        ;
        this.load = function(n) {
            var i, t;
            if (n !== undefined && n != null) {
                if (n instanceof Array)
                    for (i = n.length,
                    t = 0; t < i; t++)
                        this.add(n[t], !0);
                else
                    this.add(n, !0);
                this.getMap().getMapBase().RefreshMap()
            }
        }
        ;
        this.removeAt = function(n) {
            if (n >= 0 && n < graphics.length) {
                var t = graphics[n];
                t != null && (t.setMap && (t.setMap(null),
                t = null),
                this.graphics.splice(n, 1))
            }
        }
        ;
        this.remove = function(n) {
            if (n !== undefined) {
                var t = this.graphics.indexOf(n);
                t >= 0 && this.removeAt(t);
                FBM.FWEvent.trigger(this, "graphic_remove")
            }
        }
        ;
        this.clear = function() {
            for (var n, i = this.graphics.length, t = 0; t < i; t++)
                n = this.graphics[t],
                n.setMap && n.setMap(null),
                n = null;
            this.graphics = [];
            FBM.FWEvent.trigger(this, "graphic_clear")
        }
        ;
        this.getName = function() {
            return this.name
        }
        ;
        this.setName = function(n) {
            this.name = n
        }
        ;
        this.getTitle = function() {
            return this.title
        }
        ;
        this.setTitle = function(n) {
            this.title = n
        }
        ;
        this.getMap = function() {
            return this.map
        }
        ;
        this.getOpacity = function() {
            return this.opacity
        }
        ;
        this.setOpacity = function(n) {
            typeof n == "number" && (this.opacity = n,
            this.opacity < 0 && (this.opacity = 0),
            this.opacity > 1 && (this.opacity = 1),
            this.advancedLayer && (this.advancedLayer.div.main.style.opacity = this.opacity,
            this.advancedLayer.div.main.style.filter = "alpha(opacity=" + this.opacity * 100 + ")",
            this.advancedLayer.div.shadow.style.opacity = this.opacity,
            this.advancedLayer.div.shadow.style.filter = "alpha(opacity=" + this.opacity * 100 + ")"))
        }
        ;
        this.getVisible = function() {
            return this.visible
        }
        ;
        this.setVisible = function(n) {
            var i, t;
            if (typeof n == "boolean" && (this.visible = n,
            this.graphics))
                for (i = this.graphics.length,
                t = 0; t < i; t++)
                    this.graphics[t].setVisible(n)
        }
        ;
        this.setOptions = function(n) {
            n !== undefined && (n.name !== undefined && this.setName(n.name),
            n.title !== undefined && this.setTitle(n.title),
            n.visible !== undefined && this.setVisible(n.visible),
            n.opacity !== undefined && this.setOpacity(n.opacity));
            this.name == null && (this.name = "FWGraphic_Layer");
            this.title == null && (this.title = this.name)
        }
        ;
        this.redraw = function() {
            for (var t = this.graphics.length, n = 0; n < t; n++)
                this.graphics[n].draw()
        }
        ;
        this.Initialize = function(n) {
            var t = this;
            this.map = n;
            this.redraw()
        }
        ;
        this.removeAdvancedLayer = function() {
            this.advancedLayer != null && (this.map.removeIndependentContainer(this.advancedLayer),
            this.advancedLayer = null)
        }
        ;
        this.removeLayer = function() {
            this.map && (this.clear(),
            this.removeAdvancedLayer());
            this.map = null
        }
        ;
        this.RemoveSelf = function() {
            this.removeLayer()
        }
        ;
        FBM.RegisterEvent(FBM.FWGraphicsLayer, ["add", "remove", "clear", "click", "dblclick", "mousedown", "mouseup", "mouseout", "mouseover", "mousemove", "rightclick"]);
        this.map = n;
        t && this.setOptions(t);
        this.map !== undefined && this.map != null && (this.advancedLayer = this.map.addIndependentContainer(this.name))
    }
}
)();
/*! D:\FW_API\scripts\FWVectorTiledLayer.js*/
FBM = FBM || {},
function() {
    var i = .00028
      , n = "http://www.opengis.net/gml"
      , t = "http://www.supergeo.com.tw/gml"
      , r = /[, ]/;
    FBM.FWVectorFeature = function(n) {
        this.mset = n.mset;
        this.mid = n.mid;
        this.fid = n.fid;
        this.count = 1;
        this.attr = n.attr;
        this.geom = n.geom;
        this.visible = !0;
        this.symbol
    }
    ;
    FBM.FWVectorFeatures = function(n) {
        var r, i, t;
        this.map = n;
        this.independentContainer = !1;
        this.format = null;
        this.queryable = !0;
        this.mFeatures = [];
        this.graphicSelectedCallback = null;
        this.position = FBM.FWControlPosition.LEFT_BOTTOM;
        this.div = document.createElement("div");
        this.div.style.background = "red";
        util.disableSelect(this.div);
        r = document.createTextNode(" ");
        i = document.createElement("BUTTON");
        i.className = "warning_text";
        i.style.color = "blue";
        i.appendChild(r);
        var u = document.createElement("table")
          , f = u.insertRow(-1)
          , e = f.insertCell(-1);
        e.appendChild(i);
        this.div.appendChild(u);
        this.div.style.display = "none";
        this.textTooManyGraphics = "圖形數量太多, 停止繪圖.";
        this.textForceDrawWaiting = "強制重繪, 請耐心稍候...";
        this.map.controls[this.position].push(this.div);
        this.setWarningText = function(n) {
            var t = this.div.getElementsByClassName("warning_text");
            t.length > 0 && (t[0].data = n,
            t[0].innerText = n);
            this.showWarning(!0)
        }
        ;
        this.showWarning = function(n) {
            this.div.style.display = n ? "" : "none"
        }
        ;
        this.closeWarning = function() {
            for (this.div.style.display = "none"; this.div.firstChild; )
                this.div.removeChild(this.div.firstChild);
            var n = this.map.controls[this.position].indexOf(this.div);
            n >= 0 && this.map.controls[this.position].removeAt(n)
        }
        ;
        this.infoWindowOptions = {
            maxWidth: 1e3,
            pixelOffset: {
                x: 0,
                y: 0
            }
        };
        this.messageBox = null;
        this.infoAttrFields = {};
        this.pointSymbol = null;
        this.lineSymbol = null;
        this.polygonSymbol = null;
        this.limitFeatures = !0;
        this.maxFeaturesAllow = 1e3;
        t = this;
        i.onclick = function() {
            t.setWarningText(t.textForceDrawWaiting);
            setTimeout(function() {
                t.draw(!0)
            }, 100)
        }
        ;
        this.setClickCallback = function(n) {
            this.graphicSelectedCallback = n
        }
        ;
        this.add = function(n) {
            var u = !1, i = n.mset + "_" + n.mid, r = null, t;
            this.mFeatures[i] !== undefined ? (r = this.mFeatures[i],
            t = r[n.fid],
            t !== undefined && (u = !0,
            t.count = t.count + 1,
            t.visible = !0)) : (this.mFeatures[i] = {},
            r = this.mFeatures[i]);
            u == !1 && (r[n.fid] = new FBM.FWVectorFeature(n))
        }
        ;
        this.getPointSymbol = function(n) {
            var i = null, t;
            return this.pointSymbol != null && (t = n[this.pointSymbol.field],
            t !== undefined && (i = this.pointSymbol.symbols[t])),
            i
        }
        ;
        this.getLineSymbol = function(n) {
            var i = null, t;
            return this.lineSymbol != null && (t = n[this.lineSymbol.field],
            t !== undefined && (i = this.lineSymbol.symbols[t])),
            i
        }
        ;
        this.getPolygonSymbol = function(n) {
            var i = null, t;
            return this.polygonSymbol != null && (t = n[this.polygonSymbol.field],
            t !== undefined && (i = this.polugonSymbol.symbols[t])),
            i
        }
        ;
        this.getAdvancedContainer = function() {
            return this.independentContainer == !0 ? (this.advancedLayer === undefined && (this.advancedLayer = this.map.addIndependentContainer("VectorTileLayer")),
            this.advancedLayer) : null
        }
        ;
        this.removeAdvancedLayer = function() {
            this.advancedLayer != null && (this.map.removeIndependentContainer(this.advancedLayer),
            this.advancedLayer = null)
        }
        ;
        this.removeAll = function() {
            var i, n, r, t;
            this.independentContainer == !0 && this.removeAdvancedLayer();
            for (i in this.mFeatures) {
                if (n = this.mFeatures[i],
                n !== undefined)
                    for (r in n)
                        t = n[r],
                        t !== undefined && (t.symbol !== undefined && (t.symbol.setMap(null),
                        t.symbol = null),
                        delete n[r]);
                delete this.mFeatures[i]
            }
        }
        ;
        this.draw = function(n) {
            var w, b, s, h, a, o, v, i, y, p, r, u, nt;
            DEBUG_MODE && console.log("Draw start...");
            w = performance.now();
            this.showWarning(!1);
            b = function(n, t, i) {
                var u = null, o = t.attr, r = t.geom, f, e;
                return r instanceof FBM.FWPolygon ? (u = new FBM.FWFill(n.map,r,i),
                u.setOpacity(.5)) : r instanceof FBM.FWLineString ? (u = new FBM.FWLine(n.map,r,i),
                u.setStrokeWeight(4)) : r instanceof FBM.FWPoint ? (f = i,
                e = n.getPointSymbol(o),
                e != null ? (f.flat = !0,
                u = new FBM.FWMarker(n.map,r,"",e,f)) : u = new FBM.FWMarker(n.map,r,"",null,f)) : r instanceof FBM.FWMultiPolygon ? (u = new FBM.FWFill(n.map,r,i),
                u.setOpacity(.5)) : r instanceof FBM.FWMultiLineString ? (u = new FBM.FWLine(n.map,r,i),
                u.setStrokeWeight(4)) : r instanceof FBM.FWMultiPoint ? (f = i,
                e = n.getPointSymbol(o),
                e != null ? (f.flat = !0,
                u = new FBM.FWMarker(n.map,r,"",e,f)) : u = new FBM.FWMarker(n.map,r,"",null,f)) : r instanceof Array,
                u
            }
            ;
            s = {};
            this.independentContainer == !0 && (h = this.getAdvancedContainer(),
            h != null && (s.advancedLayer = h));
            var f = this.map.getMapBase()
              , k = f.ToMapPoint(0, 0)
              , d = f.ToMapPoint(f.getClientWidth(), f.getClientHeight())
              , e = new FBM.FWEnvelope(k.x,k.y,d.x,d.y)
              , c = !1
              , l = 0
              , g = 0;
            for (a in this.mFeatures) {
                if (o = this.mFeatures[a],
                o !== undefined)
                    for (v in o)
                        if (i = o[v],
                        i !== undefined && i.visible && i.geom && (y = !0,
                        n === undefined && this.limitFeatures && l >= this.maxFeaturesAllow && (y = !1,
                        c = !0,
                        this.setWarningText(this.textTooManyGraphics)),
                        y && (p = !1,
                        r = i.geom.Envelope,
                        r != null && (r.left > e.right || r.right < e.left || r.bottom > e.top || r.top < e.bottom) && (i.visible = !1,
                        p = !0,
                        i.symbol !== undefined && i.symbol.getVisible() && i.symbol.setVisible(!1)),
                        p || (i.visible = !0,
                        i.symbol !== undefined ? i.symbol.getVisible() || i.symbol.setVisible(!0) : (g++,
                        u = b(this, i, s),
                        i.symbol = u,
                        u != null && (u.key = a,
                        u.id = v,
                        this.queryable && FBM.FWEvent.addListener(u, "click", t.showInfo))),
                        l++))),
                        c)
                            break;
                if (c)
                    break
            }
            nt = performance.now() - w;
            DEBUG_MODE && console.log("Drawing = " + l + " (Create = " + g + "), Time = " + nt)
        }
        ;
        this.remove = function(n, t, i) {
            var o = n + "_" + t, f = null, s, u, e, r;
            if (this.mFeatures[o] !== undefined)
                for (f = this.mFeatures[o],
                s = i.length,
                u = 0; u < s; u++)
                    e = i[u],
                    r = f[e],
                    r !== undefined && (r.count = r.count - 1,
                    r.count <= 0 && (r.symbol !== undefined && r.symbol != null && (r.symbol.setMap(null),
                    r.symbol = null),
                    delete f[e],
                    r = null))
        }
        ;
        this.setVisible = function(n, t, i, r) {
            var e = n + "_" + t, o = null, s, u, h, f;
            if (this.mFeatures[e] !== undefined)
                for (o = this.mFeatures[e],
                s = i.length,
                u = 0; u < s; u++)
                    h = i[u],
                    f = o[h],
                    f !== undefined && f.visible != r && (f.visible = r)
        }
        ;
        this.showInfo = function(n) {
            var f, l, e, i, s, a, h, r, u;
            if (n.stopPropagation(),
            f = n.target,
            f !== undefined && (l = t.mFeatures[f.key],
            l !== undefined && (e = l[f.id],
            e !== undefined))) {
                if (i = "",
                s = [],
                t.infoAttrFields.length > 0)
                    for (a = t.infoAttrFields.length,
                    h = 0; h < a; h++) {
                        var r = t.infoAttrFields[h]
                          , c = null
                          , o = null;
                        typeof r == "string" || r instanceof String ? (c = r,
                        o = r) : r instanceof Object && (c = r.name,
                        o = r.alias);
                        c != null && o != null && (u = e.attr[c],
                        u !== undefined && (i.length > 0 && (i = i + "<br />"),
                        i = i + o + ": " + u,
                        s.push({
                            field: o,
                            value: u
                        })))
                    }
                else
                    for (r in e.attr)
                        u = e.attr[r],
                        u !== undefined && (i.length > 0 && (i = i + "<br />"),
                        i = i + r + ": " + u,
                        s.push({
                            field: r,
                            value: u
                        }));
                t.graphicSelectedCallback ? t.graphicSelectedCallback.call(f, {
                    graphic: f,
                    point: n.point,
                    info: i,
                    attr: s
                }) : (t.messageBox == null && (t.messageBox = new FBM.FWInfoWindow(null,null,t.infoWindowOptions)),
                t.messageBox.setPosition(n.point),
                t.messageBox.setMessageText(i),
                t.messageBox.open(t.map))
            }
        }
        ;
        this.hideInfo = function() {
            t.messageBox != null && (t.messageBox.setMessageText(""),
            t.messageBox.close())
        }
        ;
        this.setQueryable = function(n) {
            var f, r, e, u, i;
            this.queryable = n;
            for (f in this.mFeatures)
                if (r = this.mFeatures[f],
                r !== undefined)
                    for (e in r)
                        u = r[e],
                        u !== undefined && (i = u.symbol,
                        i !== undefined && (n ? (FBM.FWEvent.addListener(i, "click", t.showInfo),
                        i.setCursor("pointer")) : (i.click_ !== undefined && FBM.FWEvent.removeListener(i.click_[0]),
                        i.setCursor("default"))))
        }
        ;
        this.getQueryable = function() {
            return this.queryable
        }
    }
    ;
    FBM.FWVectorTile = function(i, u) {
        this.map = null;
        this.url = null;
        this.req = null;
        this.loading = !1;
        this.loaded = !1;
        this.matrixSet = i.matrixSet;
        this.matrixId = i.matrixId;
        this.bound = i.bound;
        this.row = i.row;
        this.col = i.col;
        this.format = i.format;
        this.visible = !0;
        this.fid = [];
        var f = u;
        this.equals = function(n) {
            return this.matrixSet == n.matrixSet && this.matrixId == n.matrixId && this.row == n.row && this.col == n.col
        }
        ;
        this.setVisible = function(n) {
            if (this.visible = n,
            this.fid.length > 0) {
                var t = this.matrixSet
                  , i = this.matrixId
                  , r = f.getAllFeatures();
                r.setVisible(t, i, this.fid, n)
            }
        }
        ;
        this.getVisible = function() {
            return this.visible
        }
        ;
        this.clear = function() {
            if (this.fid.length > 0) {
                var n = this.matrixSet
                  , t = this.matrixId
                  , i = f.getAllFeatures();
                i.remove(n, t, this.fid)
            }
        }
        ;
        this.getJsonFeature = function(n, t) {
            var c = function(n, t) {
                var r = null, u, s, h, f, i;
                if (n !== undefined && n.length > 0)
                    if (r = [],
                    u = n.length,
                    t.intCoord) {
                        var e = t.scaleFactor
                          , o = t.vt.bound
                          , c = o.left
                          , l = o.bottom;
                        for (i = 0; i < u; i++)
                            s = c + n[i][0] * e,
                            h = l + n[i][1] * e,
                            r.push({
                                x: s,
                                y: h
                            })
                    } else if (f = n[0],
                    f instanceof Array)
                        for (i = 0; i < u; i++)
                            r.push({
                                x: n[i][0],
                                y: n[i][1]
                            });
                    else if (f.x !== undefined && f.y !== undefined)
                        for (i = 0; i < u; i++)
                            r.push(n[i]);
                return r
            }, l = function(n, t) {
                var e = null, f;
                if (n !== undefined && n.length > 0) {
                    var r = null
                      , u = null
                      , i = n;
                    t.intCoord ? (f = t.vt.bound,
                    r = f.left + i[0] * t.scaleFactor,
                    u = f.bottom + i[1] * t.scaleFactor) : i instanceof Array ? (r = i[0],
                    u = i[1]) : i.x !== undefined && i.y !== undefined && (r = i.x,
                    u = i.y);
                    r != null && u != null && (e = new FBM.FWPoint(r,u))
                }
                return e
            }, d = function(n, t) {
                var i = c(n, t), u, r, f;
                return i != null && (u = i.length,
                u > 2 && (r = i[0],
                f = i[u - 1],
                (r.x != f.x || r.y != f.y) && i.push(r))),
                i
            }, a = function(n, t) {
                var i = null
                  , r = c(n, t);
                return r != null && (i = new FBM.FWLineString(r)),
                i
            }, v = function(n, t) {
                var r = null, u = d(n, t), i;
                return u != null && (i = new FBM.FWLineString(u),
                i != null && (r = new FBM.FWLinearRing(i))),
                r
            }, y = function(n, t) {
                var o = null, i, u, f, r, e;
                if (n !== undefined && n.length > 0) {
                    if (i = [],
                    u = v(n[0], t),
                    u != null && i.push(u),
                    f = n.length,
                    f > 1)
                        for (r = 1; r < f; r++)
                            e = v(n[r], t),
                            e != null && i.push(e);
                    i.length > 0 && (o = new FBM.FWPolygon(i))
                }
                return o
            }, p = function(n, t) {
                var r = null, u = n.type, e, w, nt, o, s, b, c, k, tt, it, v, d, h, i, g, f;
                if (u !== undefined)
                    if (u == "GeometryCollection") {
                        if (e = n.geometries,
                        e.length > 0) {
                            for (w = [],
                            nt = e.length,
                            i = 0; i < nt; i++)
                                w.push(p(e[i], t));
                            r = w
                        }
                    } else if (u == "MultiPolygon") {
                        if (o = n.coordinates,
                        o.length > 0) {
                            for (s = [],
                            h = o.length,
                            i = 0; i < h; i++)
                                b = y(o[i], t),
                                b != null && s.push(b);
                            s.length > 0 && (r = new FBM.FWMultiPolygon(s))
                        }
                    } else if (u == "MultiLineString") {
                        if (c = n.coordinates,
                        c.length > 0) {
                            for (k = [],
                            tt = c.length,
                            i = 0; i < tt; i++)
                                it = c[i],
                                k.push(a(it, t));
                            r = new FBM.FWMultiLineString(k)
                        }
                    } else if (u == "MultiPoint") {
                        if (v = n.coordinates,
                        v.length > 0) {
                            for (d = [],
                            h = v.length,
                            i = 0; i < h; i++)
                                g = l(v[i], t),
                                g != null && d.push(g);
                            r = new FBM.FWMultiPoint(d)
                        }
                    } else
                        u == "Polygon" ? (f = n.coordinates,
                        r = y(f, t)) : u == "LineString" ? (f = n.coordinates,
                        r = a(f, t)) : u == "Point" && (f = n.coordinates,
                        r = l(f, t));
                return r
            }, g = function(n, t) {
                var r = null, i;
                if (n.type !== undefined && n.type == "Feature") {
                    var e = n.FID
                      , o = n.properties
                      , f = n.geometry;
                    f !== undefined && (i = p(f, t),
                    i != null && (u.coordSys == "EPSG3857" && (i = FBM.Geometry.Transform(i, FBM.GooToWGS84)),
                    r = {
                        fid: e,
                        attr: o,
                        geom: i
                    }))
                }
                return r
            }, u = this, e, r, w, o, h, s, i, k;
            if (n && (u.coordSys = this.map.getCoordSys(),
            n.type !== undefined && n.type == "FeatureCollection")) {
                if (e = n.features,
                r = [],
                e != null && e instanceof Array)
                    for (w = e.length,
                    o = 0; o < w; o++)
                        h = e[o],
                        h != null && (i = g(h, t),
                        i != null && r.push(i));
                if (r.length > 0) {
                    var nt = u.matrixSet
                      , tt = u.matrixId
                      , b = f.getAllFeatures()
                      , it = r.length;
                    for (s = 0; s < it; s++)
                        i = r[s],
                        i.mset = nt,
                        i.mid = tt,
                        b.add(i),
                        k = i.fid,
                        u.fid.push(k);
                    b.draw()
                }
                r = []
            }
        }
        ;
        this.getGmlFeature = function(i, u) {
            var l = function(n, t) {
                var f = null, u, s, h, i;
                if (n != null && n.length > 0)
                    if (f = [],
                    u = n[0].childNodes[0].nodeValue.split(r),
                    t.intCoord) {
                        var e = t.scaleFactor
                          , o = t.vt.bound
                          , c = o.left
                          , l = o.bottom;
                        for (i = 0; i < u.length; i += 2)
                            s = c + parseInt(u[i]) * e,
                            h = l + parseInt(u[i + 1]) * e,
                            f.push({
                                x: s,
                                y: h
                            })
                    } else
                        for (i = 0; i < u.length; i += 2)
                            f.push({
                                x: parseFloat(u[i]),
                                y: parseFloat(u[i + 1])
                            });
                return f
            }, p = function(t, i) {
                var u = null, r;
                return t !== undefined && (r = l(t.getElementsByTagNameNS(n, "coordinates"), i),
                r != null && r.length > 0 && (u = new FBM.FWPoint(parseFloat(r[0].x),parseFloat(r[0].y)))),
                u
            }, tt = function(t, i) {
                var r = l(t.getElementsByTagNameNS(n, "coordinates"), i), f, u, e;
                return r != null && (f = r.length,
                f > 2 && (u = r[0],
                e = r[f - 1],
                (u.x != e.x || u.y != e.y) && r.push(u))),
                r
            }, a = function(t, i) {
                var u = null, f, r;
                return t !== undefined && (f = null,
                r = l(t.getElementsByTagNameNS(n, "coordinates"), i),
                r != null && r.length > 0 && (u = new FBM.FWLineString(r))),
                u
            }, w = function(n, t) {
                var r = null, u = tt(n, t), i;
                return n != null && (i = a(n, t),
                i != null && (r = new FBM.FWLinearRing(i))),
                r
            }, b = function(t, i) {
                var h = null, f, o, e, s, r, u;
                if (t !== undefined) {
                    if (f = [],
                    o = t.getElementsByTagNameNS(n, "outerBoundaryIs"),
                    o != null && o.length > 0 && (r = o[0].getElementsByTagNameNS(n, "LinearRing"),
                    r != null && r.length > 0 && (u = w(r[0], i),
                    u != null && f.push(u))),
                    e = t.getElementsByTagNameNS(n, "innerBoundaryIs"),
                    e != null && e.length > 0)
                        for (s = 0; s < e.length; s++)
                            r = e[s].getElementsByTagNameNS(n, "LinearRing"),
                            r != null && r.length > 0 && (u = w(r[0], i),
                            u != null && f.push(u));
                    f.length > 0 && (h = new FBM.FWPolygon(f))
                }
                return h
            }, it = function(t, i) {
                var u = null, l = t.getElementsByTagNameNS(n, "MultiPoint"), v = t.getElementsByTagNameNS(n, "MultiLineString"), y = t.getElementsByTagNameNS(n, "MultiPolygon"), w = t.getElementsByTagNameNS(n, "Point"), k = t.getElementsByTagNameNS(n, "LineString"), d = t.getElementsByTagNameNS(n, "Polygon"), f, s, e, h, o, c, r;
                if (y.length > 0) {
                    if (f = y[0].getElementsByTagNameNS(n, "Polygon"),
                    f.length > 0) {
                        for (s = [],
                        r = 0; r < f.length; r++)
                            s.push(b(f[r], i));
                        u = new FBM.FWMultiPolygon(s)
                    }
                } else if (v.length > 0) {
                    if (e = v[0].getElementsByTagNameNS(n, "LineString"),
                    e.length > 0) {
                        for (h = [],
                        r = 0; r < e.length; r++)
                            h.push(a(e[r], i));
                        u = new FBM.FWMultiLineString(h)
                    }
                } else if (l.length > 0) {
                    if (o = l[0].getElementsByTagNameNS(n, "Point"),
                    o.length > 0) {
                        for (c = [],
                        r = 0; r < o.length; r++)
                            c.push(p(o[r], i));
                        u = new FBM.FWMultiPoint(c)
                    }
                } else
                    d.length > 0 ? u = b(d[0], i) : k.length > 0 ? u = a(k[0], i) : w.length > 0 && (u = p(w[0], i));
                return u
            }, rt = function(n, i) {
                var s = null, r, e, u;
                if (n !== undefined) {
                    var c = n.getAttribute("FID")
                      , f = n.getElementsByTagNameNS(t, "Fields")
                      , h = {}
                      , l = f.length;
                    for (r = 0; r < l; r++)
                        h[f[r].attributes[0].value] = f[r].textContent;
                    e = n.getElementsByTagNameNS(t, "_SHAPE_");
                    e !== undefined && (u = it(e[0], i),
                    o.coordSys == "EPSG3857" && (u = FBM.Geometry.Transform(u, FBM.GooToWGS84)),
                    s = {
                        fid: c,
                        attr: h,
                        geom: u
                    })
                }
                return s
            }, o = this, k, h, y, c, e, nt;
            if (i && i.documentElement && (o.coordSys = this.map.getCoordSys(),
            k = i.documentElement.getElementsByTagNameNS(n, "featureMember"),
            k !== undefined)) {
                var v = i.documentElement.getElementsByTagNameNS(t, "Feature")
                  , s = []
                  , d = v.length;
                if (v != null && d > 0)
                    for (h = 0; h < d; h++)
                        y = v[h],
                        y != null && (e = rt(y, u),
                        e != null && s.push(e));
                if (s.length > 0) {
                    var ut = o.matrixSet
                      , ft = o.matrixId
                      , g = f.getAllFeatures()
                      , et = s.length;
                    for (c = 0; c < et; c++)
                        e = s[c],
                        e.mset = ut,
                        e.mid = ft,
                        g.add(e),
                        nt = e.fid,
                        o.fid.push(nt);
                    g.draw()
                }
                s = []
            }
        }
    }
    ;
    FBM.FWVectorTileLayer = function(n, t, r, u, f, e) {
        function ct(n) {
            var i, r = n["ows:Operation"], u, e, o, t, f, s;
            if (r !== undefined && r instanceof Array)
                for (t = 0; t < r.length; t++)
                    if (u = r[t],
                    u !== undefined && (e = u["@name"],
                    e !== undefined && e == "GetTile" && (o = u["ows:DCP"],
                    o !== undefined && (i = o["ows:HTTP"]["ows:Get"],
                    i !== undefined))))
                        break;
            if (i !== undefined && i instanceof Array)
                for (t = 0; t < i.length; t++)
                    if (f = i[t],
                    f !== undefined && (xlnk = f["@xlink:href"],
                    xlnk !== undefined && (s = f["ows:Constraint"]["ows:AllowedValues"]["ows:Value"],
                    s !== undefined && s == "KVP"))) {
                        b = xlnk.indexOf("?") > 0 ? xlnk.slice(0, xlnk.indexOf("?")) : xlnk;
                        break
                    }
        }
        function lt(n) {
            var l = n["ows:OperationsMetadata"], r, f, e, o, t;
            if (l !== undefined && ct(l),
            r = null,
            f = n.Contents.Layer,
            f !== undefined) {
                if (f.length !== undefined) {
                    for (t = 0; t < f.length; t++)
                        if (o = f[t]["ows:Identifier"],
                        o && o == u.layer) {
                            r = f[t];
                            break
                        }
                    r == null && (r = f[0])
                } else
                    r = f;
                r != null && (u.format = r.Format,
                u.layer = r["ows:Identifier"])
            }
            if (e = n.Contents.TileMatrixSet,
            e !== undefined)
                if (e.length !== undefined) {
                    for (t = 0; t < e.length; t++)
                        if (o = e[t]["ows:Identifier"],
                        o && o == u.matrixSet) {
                            h = e[t];
                            break
                        }
                    h == null && (h = e[0])
                } else
                    h = e;
            if (h)
                for (u.matrixSet = h["ows:Identifier"],
                t = 0; t < h.TileMatrix.length; t++) {
                    var i = h.TileMatrix[t]
                      , a = i.TopLeftCorner
                      , s = parseFloat(a.split(" ")[0])
                      , c = parseFloat(a.split(" ")[1])
                      , v = parseFloat(i.ScaleDenominator)
                      , b = parseFloat(i.MatrixWidth)
                      , k = parseFloat(i.MatrixHeight)
                      , d = parseFloat(i.TileWidth)
                      , g = parseFloat(i.TileHeight)
                      , p = s + v * b * d * y
                      , w = c - v * k * g * y;
                    s && c && p && w && (i.left = s,
                    i.top = c,
                    i.right = p,
                    i.bottom = w)
                }
            return h
        }
        function pt() {
            var t, r, u, i, n;
            if (DEBUG_MODE && console.log("cleanTiles"),
            t = rt(a, h),
            t != null) {
                r = h["ows:Identifier"];
                u = t["ows:Identifier"];
                for (i in l)
                    n = l[i],
                    (n.matrixSet != r || n.matrixId != u) && (n.clear(),
                    n = null,
                    delete l[i]);
                o.draw()
            }
        }
        function wt() {
            clearTimeout(ft);
            ft = setTimeout(pt, 250)
        }
        var r = r, et = r.getPanes(), v = et.overlayviewLayer, p = typeof f.independentContainer == "boolean" ? f.independentContainer : !1, ot = n, b, k = typeof f.left == "number" ? f.left : null, d = typeof f.top == "number" ? f.top : null, g = typeof f.right == "number" ? f.right : null, nt = typeof f.bottom == "number" ? f.bottom : null, o = new FBM.FWVectorFeatures(r), l = {}, a, ut = !1, st = this, c, it, rt, ft;
        o.independentContainer = p;
        u.attrFields !== undefined && (o.infoAttrFields = u.attrFields);
        f.infoWindowOptions !== undefined && (o.infoWindowOptions = f.infoWindowOptions);
        f.limitFeatures !== undefined && (o.limitFeatures = f.limitFeatures);
        f.queryable !== undefined && (o.queryable = f.queryable);
        f.pointSymbol !== undefined && (o.pointSymbol = f.pointSymbol);
        f.lineSymbol !== undefined && (o.lineSymbol = f.lineSymbol);
        f.polygonSymbol !== undefined && (o.polygonSymbol = f.polygonSymbol);
        var y = typeof u.dpi == "number" ? 25.4 / u.dpi / 1e3 : i
          , tt = typeof u.tileWidth == "number" ? u.tileWidth : 256
          , ht = typeof u.tileHeight == "number" ? u.tileHeight : 256;
        f.container != null && (v = f.container);
        c = typeof f.opacity == "number" ? f.opacity : 1;
        c < 0 && (c = 0);
        c > 1 && (c = 1);
        var w = f.visible == !1 ? !1 : !0
          , h = null
          , s = document.createElement("div");
        s.style.position = "absolute";
        s.style.left = "0px";
        s.style.top = "0px";
        s.style.width = "100%";
        s.style.height = "100%";
        s.style.zIndex = "auto";
        s.style.display = w ? "" : "none";
        v.appendChild(s);
        this.moveToTop = function() {
            v && (v.removeChild(s),
            v.appendChild(s))
        }
        ;
        this.getLayerId = function() {
            return ot
        }
        ;
        this.getLayerContainer = function() {
            return s
        }
        ;
        this.getMatrixSetId = function() {
            return h["ows:Identifier"]
        }
        ;
        this.getOpacity = function() {
            return c
        }
        ;
        this.setOpacity = function(n) {
            typeof n == "number" && (c = n,
            c < 0 && (n = 0),
            c > 1 && (n = 1),
            s && (s.style.opacity = c,
            s.style.filter = "alpha(opacity=" + c * 100 + ")"))
        }
        ;
        this.getSource = function() {
            return t
        }
        ;
        this.RemoveSelf = function() {
            o != null && (o.closeWarning(),
            o.hideInfo(),
            o.removeAll());
            v.removeChild(s)
        }
        ;
        this.getBoundTiles = function(n, t, i, u) {
            var p, s, ft, et, h;
            if (!n || !t)
                return null;
            var f = t
              , d = parseFloat(f.MatrixWidth)
              , g = parseFloat(f.MatrixHeight);
            mIdx = d == 0 ? 1 : d - 1;
            mIdy = g == 0 ? 1 : g - 1;
            var w = i.left, b = i.top, st = i.right, ct = i.bottom, nt = [], c = f.left, l = f.top, tt = parseFloat(f.ScaleDenominator), lt = parseFloat(f.TileWidth), e = tt * lt * y, it = tt * ht * y, a, rt, v, ut, at = function(n, t) {
                var c = []
                  , f = Infinity
                  , e = -Infinity
                  , s = Infinity
                  , h = -Infinity
                  , i = 0
                  , r = 0
                  , u = [0, -1];
                for (o = Math.pow(Math.max(n, t), 2); o > 0; o--)
                    -n / 2 < i && i <= n / 2 && -t / 2 < r && r <= t / 2 && (c.push({
                        x: i,
                        y: r
                    }),
                    i < f && (f = i),
                    i > e && (e = i),
                    r < s && (s = r),
                    r > h && (h = r)),
                    (i === r || i < 0 && i === -r || i > 0 && i === 1 - r) && (u = [-u[1], u[0]]),
                    i += u[0],
                    r += u[1];
                return {
                    l: f,
                    r: e,
                    t: h,
                    b: s,
                    xy: c
                }
            };
            if (a = w <= c ? 0 : Math.floor((w - c) / e),
            rt = a + Math.ceil(Math.abs(w - st) / e) + 1,
            v = b >= l ? 0 : Math.floor((l - b) / e),
            ut = v + Math.ceil(Math.abs(ct - b) / e) + 1,
            p = at(rt - a, ut - v),
            s = p.xy,
            s.length > 0)
                for (ft = a - p.l,
                et = v - p.b,
                h = 0; h < s.length; h++) {
                    var k = s[h].x + ft
                      , o = s[h].y + et
                      , i = {
                        left: c + k * e,
                        top: l - o * it,
                        right: c + (k + 1) * e,
                        bottom: l - (o + 1) * it
                    }
                      , ot = new FBM.FWVectorTile({
                        matrixId: f["ows:Identifier"],
                        matrixSet: n,
                        bound: i,
                        col: k,
                        row: o,
                        format: u.format
                    },this);
                    ot.map = r;
                    nt.push(ot)
                }
            return nt
        }
        ;
        rt = function(n, t) {
            for (var o, r = 0, u = Infinity, f = n.ToMapDistX(tt), i = 0; i < t.TileMatrix.length; i++) {
                var s = parseFloat(t.TileMatrix[i].ScaleDenominator)
                  , h = s * tt * y
                  , e = Math.abs(h - f);
                e < u && (u = e,
                r = i)
            }
            return u / f > .1 && (o = parseFloat(t.TileMatrix[r].ScaleDenominator) * tt * y,
            o < f * 1.1) ? null : t.TileMatrix[r]
        }
        ;
        this.Initialize = function(n) {
            a = n;
            t = t.indexOf("?") > 0 ? t.slice(0, t.indexOf("?")) : t;
            b = t;
            FBM.getJSON(t + "?SERVICE=WMTS&REQUEST=GetCapabilities&VERSION=1.0.0", function(n) {
                if (it = n.Capabilities,
                !it)
                    throw "Service Error";
                lt(it);
                ut = !0;
                st.RebuildElement();
                e && e.call(this)
            }, FBM.PROXY_SERVICE2)
        }
        ;
        this.getAllFeatures = function() {
            return o
        }
        ;
        this.putVisible = function(n) {
            w = n;
            s.style.display = n ? "" : "none"
        }
        ;
        this.getVisible = function() {
            return w
        }
        ;
        this.setVisible = function(n) {
            this.putVisible(n)
        }
        ;
        this.removeLayer = function() {
            r.removeLayer(this)
        }
        ;
        var at = function(n) {
            return k !== null && n.left < k && (n.left = k),
            d !== null && n.top > d && (n.top = d),
            g !== null && n.right > g && (n.right = g),
            nt !== null && n.bottom < nt && (n.bottom = nt),
            n
        }
          , vt = function(n, t, i, r, u, f, e) {
            return n + "?SERVICE=WMTS&REQUEST=GetTile&VERSION=" + t + "&Layer=" + i.layer + "&Style=" + (i.style !== undefined ? i.style : "default") + "&Format=" + i.format + "&TileMatrixSet=" + r + "&TileMatrix=" + u + "&TileRow=" + f + "&TileCol=" + e
        }
          , yt = function(n) {
            var r = n.url, t, i;
            r != undefined && r != null && (n.loaded || n.loading || (n.loading = !0,
            t = n,
            i = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"),
            i.onreadystatechange = function() {
                var n, f, r, e, o, s, h, u;
                i.readyState == 4 && i.status == 200 && (n = i.responseText,
                t.loading = !1,
                t.loaded = !0,
                n.length > 0 && (f = t.map.getMapBase().getCellSizeX(),
                r = {
                    vt: t,
                    scaleFactor: f,
                    simTolenrance: f
                },
                DEBUG_MODE && console.log("loaded with data."),
                e = t.format.indexOf("xml"),
                o = t.format.indexOf("text"),
                o >= 0 && e < 0 && (r.intCoord = !0),
                s = t.format.indexOf("gml"),
                h = t.format.indexOf("json"),
                s >= 0 || e >= 0 ? (u = FBM.parseXML(n),
                t.getGmlFeature(u, r)) : h >= 0 && (u = JSON.parse(n),
                t.getJsonFeature(u, r))))
            }
            ,
            n.xhr = i,
            i.open("GET", n.url, !0),
            i.send()))
        };
        this.finished = !1;
        this.UpdateElement = function() {
            var c, e, o, f, n, v, d, t, g, s, nt;
            if (ut && w && h && (this.getAllFeatures().showWarning(!1),
            this.finished) && (c = rt(a, h),
            c != null)) {
                var y = h["ows:Identifier"]
                  , tt = c["ows:Identifier"]
                  , p = a.ToMapPoint(0, 0)
                  , k = a.ToMapPoint(a.getClientWidth(), a.getClientHeight())
                  , i = new FBM.FWEnvelope(p.x,p.y,k.x,k.y);
                i = at(i);
                for (f in l)
                    t = l[f],
                    t.matrixSet == y && t.matrixId == tt ? (e = t.bound,
                    e.left > i.right || e.right < i.left || e.bottom > i.top || e.top < i.bottom ? t.setVisible(!1) : t.setVisible(!0)) : (t.xhr.abort(),
                    t.clear(),
                    t = null,
                    delete l[f]);
                if (o = this.getBoundTiles(y, c, i, u),
                !o)
                    return null;
                for (f = 0; f < o.length; f++) {
                    n = o[f];
                    v = !1;
                    for (d in l)
                        if (t = l[d],
                        t.equals(n)) {
                            v = !0;
                            break
                        }
                    if (v)
                        continue;
                    else
                        g = vt(b, "1.0.0", u, n.matrixSet, n.matrixId, n.row, n.col),
                        s = new FBM.FWVectorTile({
                            matrixId: n.matrixId,
                            matrixSet: n.matrixSet,
                            bound: n.bound,
                            col: n.col,
                            row: n.row,
                            format: n.format
                        },this),
                        s.map = r,
                        s.url = g,
                        nt = n.matrixSet + "_" + n.matrixId + "_" + n.row + "_" + n.col,
                        l[nt] = s,
                        yt(s)
                }
                o = [];
                wt();
                this.finished = !1
            }
        }
        ;
        this.RebuildElement = function() {
            this.finished = !0;
            this.UpdateElement()
        }
        ;
        this.hideInfo = function() {
            o.hideInfo()
        }
        ;
        this.setClickCallback = function(n) {
            o.setClickCallback(n)
        }
        ;
        this.setQueryable = function(n) {
            o.setQueryable(n)
        }
        ;
        this.getQueryable = function() {
            return o.getQueryable()
        }
        ;
        this.getIndependentContainer = function() {
            return p
        }
        ;
        this.setIndependentContainer = function(n) {
            p = n;
            o.independentContainer = p
        }
        ;
        this.getAdvancedContainer = function() {
            return o.getAdvancedContainer()
        }
        ;
        this.getNode = function() {
            if (r) {
                if (p == !0) {
                    var n = o.getAdvancedContainer();
                    return n != null ? [n.div.main, n.div.shadow] : [r.getPanes().graphicLayer, r.getPanes().shadowLayer]
                }
                return [r.getPanes().graphicLayer, r.getPanes().shadowLayer]
            }
        }
        ;
        r.addLayer(this, !0)
    }
    ;
    FBM.RegisterEvent(FBM.FWVectorTileLayer, ["click", "mousemove", "mouseout", "mouseover", "dblclick", "rightclick"])
}();
/*! D:\FW_API\scripts\FW_KMLLayer.js*/
FBM = FBM || {},
function() {
    var n = ["Document", "Folder", "Placemark"]
      , t = function(t) {
        return n.indexOf(t) >= 0
    };
    FBM.FWKmlLayerOption = function() {
        this.map = null;
        this.preserveViewport = null;
        this.suppressInfoWindows = null;
        this.markerFitImageSize = !1
    }
    ;
    FBM.FWKmlLayerMetaData = function() {
        this.author = null;
        this.description = null;
        this.name = null;
        this.snippet = null
    }
    ;
    FBM.KmlMouseEvent = function() {
        this.feature = null;
        this.point = null;
        this.pixelOffset = null
    }
    ;
    FBM.KmlFeatureData = function() {
        this.author = null;
        this.description = null;
        this.name = null;
        this.snippet = null
    }
    ;
    FBM.KmlAuthor = function() {
        this.email = null;
        this.name = null;
        this.uri = null
    }
    ;
    FBM.FWKmlLayerStatus = {
        DOCUMENT_NOT_FOUND: "DOCUMENT_NOT_FOUND",
        DOCUMENT_TOO_LARGE: "DOCUMENT_TOO_LARGE",
        FETCH_ERROR: "FETCH_ERROR",
        INVALID_DOCUMENT: "INVALID_DOCUMENT",
        INVALID_REQUEST: "INVALID_REQUEST",
        LIMITS_EXCEEDED: "LIMITS_EXCEEDED",
        OK: "OK",
        TIMED_OUT: "TIMED_OUT",
        UNKNOWN: "UNKNOWN"
    };
    FBM.KMLLayer = function(n, i, r, u, f, e) {
        var s = this, ot = n, h = r, p = !1, c, l = "auto", a = !0, d, b;
        f && (f.zIndex !== undefined && typeof f.zIndex == "number" && (l = f.zIndex),
        f.visible !== undefined && typeof f.visible == "boolean" && (a = f.visible),
        f.independentContainer !== undefined && typeof f.independentContainer == "boolean" && (p = f.independentContainer,
        p == !0 && (c = h.addIndependentContainer("KML", this))));
        var v = h.getCoordSys(), o = {
            author: {
                email: "",
                name: "",
                uri: ""
            },
            description: "",
            name: "",
            snippet: ""
        }, y, u = new FBM.FWInfoWindow("",null,{
            pixelOffset: new FBM.FWSize(0,0)
        }), w = null, k = f.markerFitImageSize;
        this.overlays = [];
        this.points = [];
        this.polygons = [];
        this.polylines = [];
        this.groundoverlays = [];
        this.icons = [];
        this.getDefaultViewport = function() {
            var o, f, s, n, h, e;
            if (!w) {
                var t = Infinity
                  , i = -Infinity
                  , r = -Infinity
                  , u = Infinity;
                for (o = 0; o < this.overlays.length; o++)
                    n = this.overlays[o].getBounds(),
                    t = Math.min(t, n.left),
                    u = Math.min(u, n.bottom),
                    i = Math.max(i, n.right),
                    r = Math.max(r, n.top);
                for (f = 0; f < this.polylines.length; f++)
                    n = this.polylines[f].getPath().getEnvelope(),
                    t = Math.min(t, n.left),
                    u = Math.min(u, n.bottom),
                    i = Math.max(i, n.right),
                    r = Math.max(r, n.top);
                for (f = 0; f < this.groundoverlays.length; f++)
                    n = this.groundoverlays[f].getBounds(),
                    t = Math.min(t, n.left),
                    u = Math.min(u, n.bottom),
                    i = Math.max(i, n.right),
                    r = Math.max(r, n.top);
                for (s = 0; s < this.polygons.length; s++)
                    n = this.polygons[s].getBounds(),
                    t = Math.min(t, n.left),
                    u = Math.min(u, n.bottom),
                    i = Math.max(i, n.right),
                    r = Math.max(r, n.top);
                for (h = 0; h < this.points.length; h++)
                    e = this.points[h].getPosition(),
                    t = Math.min(t, e.x),
                    u = Math.min(u, e.y),
                    i = Math.max(i, e.x),
                    r = Math.max(r, e.y);
                if (!isFinite(t) || !isFinite(r) || !isFinite(i) || !isFinite(u))
                    return null;
                w = new FBM.FWEnvelope(t,r,i,u)
            }
            return w
        }
        ;
        this.getMetadata = function() {
            return o
        }
        ;
        this.getLayerId = function() {
            return ot
        }
        ;
        this.getStatus = function() {
            return y
        }
        ;
        this.removeMap = function() {
            h = null
        }
        ;
        d = function(n) {
            for (var f, r = n.split(/\s*[,]\s*/), u = [[]], t = u[0], i = 0; i < r.length; i++)
                r[i].match(/\s+/) ? (f = r[i].split(/\s+/),
                t.push(parseFloat(f[0])),
                u.push(t),
                t = [parseFloat(f[1])],
                u.push(t)) : t.push(parseFloat(r[i]));
            return u
        }
        ;
        this.parseCoordinates = function(n, t) {
            var f = n, o, u, e, r, i, s;
            if (f && (f = f.trim()),
            o = [],
            f)
                for (u = d(f),
                e = {
                    x: NaN,
                    y: NaN
                },
                r = 0; r < u.length; r++) {
                    switch (t) {
                    case "EPSG3826":
                        i = FBM.WGS84toTWD97(u[r][0], u[r][1]);
                        break;
                    case "EPSG3825":
                        i = FBM.WGS84toTWD97_119(u[r][0], u[r][1]);
                        break;
                    case "EPSG3857":
                        i = {
                            x: u[r][0],
                            y: u[r][1]
                        }
                    }
                    i.x && i.y && i.x != e.x && i.y != e.y && (o.push(new FBM.FWPoint(i.x,i.y)),
                    e.x = i.x,
                    e.y = i.y)
                }
            else
                s = 0;
            return o
        }
        ;
        this.setZIndex = function(n) {
            var t, i;
            for (l = n,
            t = 0; t < this.polygons.length; t++)
                this.polygons[t].setZIndex(l, !1);
            for (t = 0; t < this.polylines.length; t++)
                this.polylines[t].setZIndex(l, !1);
            for (t = 0; t < this.groundoverlays.length; t++)
                this.groundoverlays[t].setZIndex(l, !1);
            for (i = 0; i < this.points.length; i++)
                this.points[t].setZIndex(l, !1)
        }
        ;
        this.getZIndex = function() {
            return l
        }
        ;
        this.createPoint = function(n) {
            var t;
            switch (v) {
            case "EPSG3826":
                t = this.parseCoordinates(n.coordinates, "EPSG3826");
                break;
            case "EPSG3825":
                t = this.parseCoordinates(n.coordinates, "EPSG3825");
                break;
            case "EPSG3857":
                t = this.parseCoordinates(n.coordinates, "EPSG3857")
            }
            if (!(t.length < 1))
                return t[0]
        }
        ;
        this.parseRing = function(n, t) {
            var i, r, u;
            switch (t) {
            case "EPSG3826":
                i = this.parseCoordinates(n.coordinates, "EPSG3826");
                break;
            case "EPSG3825":
                i = this.parseCoordinates(n.coordinates, "EPSG3825");
                break;
            case "EPSG3857":
                i = this.parseCoordinates(n.coordinates, "EPSG3857")
            }
            return r = new FBM.FWLineString(i),
            u = new FBM.FWLinearRing(r),
            u
        }
        ;
        this.createPolygon = function(n) {
            var u = [], o = this.parseRing(n.outerBoundaryIs.LinearRing, v), t, f, e, r, i;
            if (u.push(o),
            t = n.innerBoundaryIs,
            t)
                if (t.length)
                    for (f = 0; f < t.length; f++)
                        if (t[f].LinearRing.length)
                            for (r = 0; r < t[f].LinearRing.length; r++)
                                i = this.parseRing(t[f].LinearRing[r], v),
                                u.push(i);
                        else
                            i = this.parseRing(t[f].LinearRing, v),
                            u.push(i);
                else if (t.LinearRing)
                    if (e = t.LinearRing,
                    e.length)
                        for (r = 0; r < e.length; r++)
                            i = this.parseRing(e[r], v),
                            u.push(i);
                    else
                        i = this.parseRing(e, v),
                        u.push(i);
                else
                    i = this.parseRing(t.LinearRing, v),
                    u.push(i);
            return new FBM.FWPolygon(u)
        }
        ;
        this.createPolyLine = function(n) {
            var t;
            switch (v) {
            case "EPSG3826":
                t = this.parseCoordinates(n.coordinates, "EPSG3826");
                break;
            case "EPSG3825":
                t = this.parseCoordinates(n.coordinates, "EPSG3825");
                break;
            case "EPSG3857":
                t = this.parseCoordinates(n.coordinates, "EPSG3857")
            }
            return new FBM.FWLineString(t)
        }
        ;
        this.handleGroundOverlay = function(n) {
            function i(n) {
                var e = new FBM.FWImage(n.Icon.href), u, t;
                switch (v) {
                case "EPSG3826":
                    var i = FBM.WGS84toTWD97(parseFloat(n.LatLonBox.west), parseFloat(n.LatLonBox.north))
                      , r = FBM.WGS84toTWD97(parseFloat(n.LatLonBox.east), parseFloat(n.LatLonBox.south))
                      , o = i.x
                      , c = i.y
                      , l = r.x
                      , a = r.y;
                    break;
                case "EPSG3825":
                    var i = FBM.WGS84toTWD97_119(parseFloat(n.LatLonBox.west), parseFloat(n.LatLonBox.north))
                      , r = FBM.WGS84toTWD97_119(parseFloat(n.LatLonBox.east), parseFloat(n.LatLonBox.south))
                      , o = i.x
                      , c = i.y
                      , l = r.x
                      , a = r.y;
                    break;
                case "EPSG3857":
                    var o = parseFloat(n.LatLonBox.west)
                      , c = parseFloat(n.LatLonBox.north)
                      , l = parseFloat(n.LatLonBox.east)
                      , a = parseFloat(n.LatLonBox.south)
                }
                u = new FBM.FWEnvelope(o,c,l,a);
                t = new FBM.FWGroundOverlay(h,e,u,1);
                FBM.FWEvent.addListener(t, "click", nt);
                FBM.FWEvent.addListener(t, "mousedown", tt);
                FBM.FWEvent.addListener(t, "mouseup", it);
                FBM.FWEvent.addListener(t, "mousemove", rt);
                FBM.FWEvent.addListener(t, "mouseout", ut);
                FBM.FWEvent.addListener(t, "dblclick", ft);
                FBM.FWEvent.addListener(t, "rightclick", et);
                f.suppressInfoWindows || FBM.FWEvent.addListener(t, "click", g);
                s.groundoverlays.push(t)
            }
            if (n.length)
                for (var t = 0; t < n.length; t++)
                    i(n[t]);
            else
                i(n)
        }
        ;
        this.handleNetworkLink = function(n) {
            var t = "", i, r;
            if (n.length)
                for (i = 0; i < n.length; i++) {
                    if (n[i].hasOwnProperty("Url"))
                        t = n[i].Url.href;
                    else if (n[i].hasOwnProperty("Link"))
                        t = n[i].Link.href;
                    else
                        continue;
                    t.indexOf(".kmz") == -1 && (r = FBM.PROXY_SERVICE2,
                    DEBUG_MODE && (r = FBM.PROXY_LOCAL),
                    FBM.getJSON(t, function(n) {
                        n.error || s.parseKML(n.kml)
                    }, r))
                }
            else {
                if (n.hasOwnProperty("Url"))
                    t = n.Url.href;
                else if (n.hasOwnProperty("Link"))
                    t = n.Link.href;
                else
                    return;
                t.indexOf(".kmz") == -1 && (r = FBM.PROXY_SERVICE2,
                DEBUG_MODE && (r = FBM.PROXY_LOCAL),
                FBM.getJSON(t, function(n) {
                    n.error || s.parseKML(n.kml)
                }, r))
            }
        }
        ;
        this.handleDescription = function() {}
        ;
        this.handleAuthor = function(n) {
            n.hasOwnProperty("atom:name") && (o.author.name = n["atom:name"]);
            n.hasOwnProperty("atom:link") && (o.author.uri = n["atom:link"]["@href"])
        }
        ;
        this.handleMultiGeometry = function(n) {
            var r = [], f, t, i, u;
            for (f in n)
                switch (f) {
                case "Point":
                    if (n.Point.length)
                        for (i = 0; i < n.Point.length; i++)
                            t = this.createPoint(n.Point[i]),
                            t && r.push(t);
                    else
                        this.createPoint(n.Point),
                        t = this.createPoint(n.Point),
                        t && r.push(t);
                    break;
                case "Polygon":
                    if (n.Polygon.length)
                        for (i = 0; i < n.Polygon.length; i++)
                            t = this.createPolygon(n.Polygon[i]),
                            t && r.push(t);
                    else
                        t = this.createPolygon(n.Polygon),
                        t && r.push(t);
                    break;
                case "LineString":
                    if (n.LineString.length)
                        for (i = 0; i < n.LineString.length; i++)
                            t = this.createPolyLine(n.LineString[i]),
                            t && r.push(t);
                    else
                        t = this.createPolyLine(n.LineString),
                        t && r.push(t);
                    break;
                case "MultiGeometry":
                    if (n.MultiGeometry.length)
                        for (i = 0; i < n.MultiGeometry.length; i++)
                            u = this.handleMultiGeometry(n.MultiGeometry[i]),
                            u && (r = r.concat(u));
                    else
                        u = this.handleMultiGeometry(n.MultiGeometry),
                        u && (r = r.concat(u))
                }
            return r
        }
        ;
        this.parseGeometry = function(n) {
            var i = [], t, r;
            return n.hasOwnProperty("Point") ? (t = this.createPoint(n.Point),
            t && i.push(t)) : n.hasOwnProperty("Polygon") ? (t = this.createPolygon(n.Polygon),
            t && i.push(t)) : n.hasOwnProperty("LineString") ? (t = this.createPolyLine(n.LineString),
            t && i.push(t)) : n.hasOwnProperty("MultiGeometry") && (r = this.handleMultiGeometry(n.MultiGeometry, n),
            r && (i = i.concat(r))),
            i
        }
        ;
        this.createRandomColor = function() {
            return {
                r: parseInt(Math.random() * 255),
                g: parseInt(Math.random() * 255),
                b: parseInt(Math.random() * 255)
            }
        }
        ;
        this.parseKmlColor = function(n, t, i) {
            var o = parseInt(n.substring(0, 2), 16), u = parseInt(n.substring(2, 4), 16), f = parseInt(n.substring(4, 6), 16), e = parseInt(n.substring(6, 8), 16), r;
            return i == "random" && (n == "ffffffff" ? (r = this.createRandomColor(),
            u = r.b,
            e = r.r,
            f = r.g) : (u *= Math.random(),
            f *= Math.random(),
            e *= Math.random())),
            {
                a: parseFloat(o / 255),
                b: parseInt(u),
                g: parseInt(f),
                r: parseInt(e)
            }
        }
        ;
        this.matchStyleMap = function(n, t, i, r) {
            var s, e, o, u, f;
            if (i && t && n) {
                if (s = "normal",
                r && (s = r),
                i = i.replace("#", ""),
                e = null,
                n instanceof Array) {
                    for (o = 0; o < n.length; o++)
                        if (n[o]["@id"] == i) {
                            if (u = n[o].Pair,
                            u)
                                for (f = 0; f < u.length; f++)
                                    if (u[f].key == s) {
                                        e = u[f].styleUrl;
                                        break
                                    }
                            if (e != null)
                                break
                        }
                } else if (n["@id"] == i && (u = n.Pair,
                u))
                    for (f = 0; f < u.length; f++)
                        if (u[f].key == s) {
                            e = u[f].styleUrl;
                            break
                        }
                return this.matchSharedStyle(t, e)
            }
        }
        ;
        this.matchSharedStyle = function(n, t) {
            if (t && n)
                if (t = t.replace("#", ""),
                n instanceof Array) {
                    for (var i = 0; i < n.length; i++)
                        if (n[i]["@id"] == t)
                            return n[i]
                } else if (n["@id"] == t)
                    return n
        }
        ;
        this.createStyle = function(n, t) {
            var i = {
                match: !1,
                fillColor: {
                    a: null,
                    r: null,
                    g: null,
                    b: null,
                    o: null
                },
                lineWidth: null,
                lineColor: {
                    a: null,
                    r: null,
                    g: null,
                    b: null
                },
                iconLink: null,
                iconScale: 1,
                iconHotSpot: {
                    x: null,
                    y: null,
                    xunits: null,
                    yunits: null
                }
            }, r;
            return n && (i.match = !0,
            n.PolyStyle && (n.PolyStyle.color && (r = this.parseKmlColor(n.PolyStyle.color, t, n.PolyStyle.colorMode),
            i.fillColor = r),
            n.PolyStyle.fill == "0" && (i.fillColor.a = 0),
            i.fillColor.o = n.PolyStyle.outline == "0" ? 0 : 1),
            n.LineStyle && (n.LineStyle.color && (r = this.parseKmlColor(n.LineStyle.color, t, n.LineStyle.colorMode),
            i.lineColor = r),
            typeof n.LineStyle.width == "string" && (i.lineWidth = parseFloat(n.LineStyle.width))),
            n.IconStyle && (n.IconStyle.Icon && n.IconStyle.Icon.href && (i.iconLink = n.IconStyle.Icon.href),
            n.IconStyle.scale && (i.iconScale = parseFloat(n.IconStyle.scale)),
            n.IconStyle.hotSpot && (i.iconHotSpot.x = parseFloat(n.IconStyle.hotSpot["@x"]),
            i.iconHotSpot.y = parseFloat(n.IconStyle.hotSpot["@y"]),
            i.iconHotSpot.xunits = n.IconStyle.hotSpot["@xunits"],
            i.iconHotSpot.yunits = n.IconStyle.hotSpot["@yunits"]))),
            i
        }
        ;
        this.colorToHex = function(n) {
            var t, i, r;
            if (typeof n.r == "number" || typeof n.g == "number" || typeof n.b == "number")
                return t = n.r.toString(16),
                n.r < 16 && (t = "0" + t),
                i = n.g.toString(16),
                n.g < 16 && (i = "0" + i),
                r = n.b.toString(16),
                n.b < 16 && (r = "0" + r),
                "#" + t + i + r
        }
        ;
        this.handlePlacemark = function(n, t) {
            var u = [], s, o, v, e, r, i, y;
            if (n.length)
                for (s = 0; s < n.length; s++)
                    o = this.parseGeometry(n[s]),
                    o && (u = u.concat(o));
            else
                o = this.parseGeometry(n),
                o && (u = u.concat(o));
            for (v = n.inStyle ? n.inStyle : this.matchSharedStyle(n.sharedStyle, n.styleUrl),
            v || (v = this.matchStyleMap(t, n.sharedStyle, n.styleUrl)),
            e = 0; e < u.length; e++)
                r = this.createStyle(v, e / u.length),
                !r.match,
                u[e]instanceof FBM.FWPolygon ? (i = new FBM.FWFill(h,u[e],{
                    advancedLayer: c,
                    fillColor: this.colorToHex(r.fillColor),
                    fillOpacity: r.fillColor.a,
                    fillOutline: r.fillColor.o,
                    strokeWeight: r.lineWidth,
                    strokeColor: this.colorToHex(r.lineColor),
                    strokeOpacity: r.lineColor.a,
                    visible: a,
                    zIndex: l
                }),
                this.polygons.push(i)) : u[e]instanceof FBM.FWLineString ? (i = new FBM.FWLine(h,u[e],{
                    advancedLayer: c,
                    strokeWeight: r.lineWidth,
                    strokeColor: this.colorToHex(r.lineColor),
                    strokeOpacity: r.lineColor.a,
                    visible: a,
                    zIndex: l
                }),
                this.polylines.push(i)) : u[e]instanceof FBM.FWPoint && (i = null,
                r.iconLink != null ? (y = new FBM.FWImage(r.iconLink),
                y.setOptions({
                    scale: r.iconScale,
                    hotSpot: r.iconHotSpot
                }),
                i = new FBM.FWMarker(h,u[e],n.name,y,{
                    advancedLayer: c,
                    visible: a,
                    zIndex: l,
                    flat: !0,
                    fitImageSize: k ? k : !1
                })) : i = new FBM.FWMarker(h,u[e],n.name,null,{
                    advancedLayer: c,
                    visible: a,
                    zIndex: l
                }),
                this.points.push(i)),
                i.targetPlacemark = n,
                FBM.FWEvent.addListener(i, "mouseover", st),
                FBM.FWEvent.addListener(i, "mouseout", ut),
                FBM.FWEvent.addListener(i, "click", nt),
                FBM.FWEvent.addListener(i, "mousedown", tt),
                FBM.FWEvent.addListener(i, "mousemove", rt),
                FBM.FWEvent.addListener(i, "mouseup", it),
                FBM.FWEvent.addListener(i, "dblclick", ft),
                FBM.FWEvent.addListener(i, "rightclick", et),
                f.suppressInfoWindows || FBM.FWEvent.addListener(i, "click", g)
        }
        ;
        this.getStyleColorById = function(n, t) {
            var i, r;
            if (styles)
                if (styles.length) {
                    for (i = 0; i < styles.length; i++)
                        if (t.slice(1, t.length) == styles[i].id) {
                            if (r = styles[i].colorMode,
                            r == "random")
                                return null;
                            if (n == "line" && styles[i].LineStyle)
                                return (r = styles[i].LineStyle.colorMode,
                                r == "random") ? null : {
                                    a: styles[i].LineStyle.color.slice(0, 2),
                                    b: styles[i].LineStyle.color.slice(2, 4),
                                    g: styles[i].LineStyle.color.slice(4, 6),
                                    r: styles[i].LineStyle.color.slice(6, 8)
                                };
                            if (n == "poly" && styles[i].PolyStyle)
                                return (r = styles[i].PolyStyle.colorMode,
                                r == "random") ? null : {
                                    a: styles[i].PolyStyle.color.slice(0, 2),
                                    b: styles[i].PolyStyle.color.slice(2, 4),
                                    g: styles[i].PolyStyle.color.slice(4, 6),
                                    r: styles[i].PolyStyle.color.slice(6, 8)
                                }
                        }
                } else {
                    if (n == "line" && styles.LineStyle)
                        return (r = styles.LineStyle.colorMode,
                        r == "random") ? null : {
                            a: styles.LineStyle.color.slice(0, 2),
                            b: styles.LineStyle.color.slice(2, 4),
                            g: styles.LineStyle.color.slice(4, 6),
                            r: styles.LineStyle.color.slice(6, 8)
                        };
                    if (n == "poly" && styles.PolyStyle)
                        return (r = styles.PolyStyle.colorMode,
                        r == "random") ? null : {
                            a: styles.PolyStyle.color.slice(0, 2),
                            b: styles.PolyStyle.color.slice(2, 4),
                            g: styles.PolyStyle.color.slice(4, 6),
                            r: styles.PolyStyle.color.slice(6, 8)
                        }
                }
        }
        ;
        this.getVisible = function() {
            return a
        }
        ;
        this.setVisible = function(n) {
            var t, i;
            for (a = n,
            t = 0; t < this.polygons.length; t++)
                this.polygons[t].setVisible(a);
            for (t = 0; t < this.polylines.length; t++)
                this.polylines[t].setVisible(a);
            for (t = 0; t < this.groundoverlays.length; t++)
                this.groundoverlays[t].setVisible(a);
            for (i = 0; i < this.points.length; i++)
                this.points[i].setVisible(a)
        }
        ;
        this.parseFeature = function(n, t) {
            var f = n.Style ? n.Style : null, o = n.StyleMap ? n.StyleMap : null, e, i, u, r;
            for (e in n) {
                i = n[e];
                switch (e) {
                case "Document":
                    if (i.inStyle = f ? f : null,
                    this.Schema = i.Schema,
                    i instanceof Array)
                        for (u = 0; u < i.length; u++)
                            r = i[u],
                            r.inStyle = r.Style ? r.Style : null,
                            this.parseFeature(r, i.Style);
                    else
                        this.parseFeature(i, i.Style);
                    break;
                case "Folder":
                    if (i.inStyle = f ? f : null,
                    i instanceof Array)
                        for (u = 0; u < i.length; u++)
                            r = i[u],
                            r.inStyle = r.Style ? r.Style : null,
                            this.parseFeature(r, t);
                    else
                        this.parseFeature(i, t);
                    break;
                case "Placemark":
                    if (i.inStyle = f ? f : null,
                    i.sharedStyle = t,
                    i instanceof Array)
                        for (u = 0; u < i.length; u++)
                            r = i[u],
                            r.inStyle = r.Style ? r.Style : null,
                            r.sharedStyle = t,
                            this.handlePlacemark(r, o);
                    else
                        i.inStyle = i.Style ? i.Style : null,
                        i.sharedStyle = t,
                        this.handlePlacemark(i, o);
                    break;
                case "GroundOverlay":
                    this.handleGroundOverlay(i);
                    break;
                case "NetworkLink":
                    this.handleNetworkLink(i)
                }
            }
        }
        ;
        this.parseKML = function(n) {
            var i;
            if (n)
                for (i in n)
                    if (t(i)) {
                        this.parseFeature(n[i], n[i].Style);
                        break
                    }
        }
        ;
        this.removeLayer = function() {
            var n;
            if (this.points.length > 0)
                for (n = 0; n < this.points.length; n++)
                    this.points[n].setMap(null);
            if (this.polygons.length > 0)
                for (n = 0; n < this.polygons.length; n++)
                    this.polygons[n].setMap(null);
            if (this.polylines.length > 0)
                for (n = 0; n < this.polylines.length; n++)
                    this.polylines[n].setMap(null);
            if (this.groundoverlays.length > 0)
                for (n = 0; n < this.groundoverlays.length; n++)
                    this.groundoverlays[n].setMap(null);
            this.points = [];
            this.polygons = [];
            this.polylines = [];
            this.groundoverlays = [];
            u && u.close();
            this.removeAdvancedLayer();
            this.removeMap()
        }
        ;
        var g = function(n) {
            var a, o, t, i, y, e, f, l, w, b, v, k, d, r;
            if (n.target.targetPlacemark) {
                if (a = "",
                o = n.target.targetPlacemark.name,
                n.target.targetPlacemark.hasOwnProperty("description") && (a = n.target.targetPlacemark.description.hasOwnProperty("#cdata-section") ? n.target.targetPlacemark.description["#cdata-section"] : n.target.targetPlacemark.description),
                t = "",
                o && (t = t + o + "<\/br>"),
                a.length > 0 && (t = t + a),
                i = n.target.targetPlacemark.ExtendedData,
                i) {
                    if (i.Data) {
                        for (y = i.Data.length ? i.Data : [i.Data],
                        t += "<br><table style='border: 1px solid black;'>",
                        r = 0; r < y.length; r++) {
                            var c = y[r]
                              , o = c["@name"]
                              , g = c.displayName
                              , p = c.value;
                            t += "<tr>";
                            t += "<td style='border: 1px solid black;'>";
                            t += g || o;
                            t += "<\/td>";
                            t += "<td style='border: 1px solid black;'>";
                            t += p;
                            t += "<\/td>";
                            t += "<\/tr>"
                        }
                        t += "<\/table>"
                    }
                    if (i.SchemaData)
                        for (e = i.SchemaData.length ? i.SchemaData : [i.SchemaData],
                        f = 0; f < e.length; f++) {
                            if (l = null,
                            e[f].SimpleData && (l = e[f].SimpleData.length ? e[f].SimpleData : [e[f].SimpleData]),
                            w = "",
                            s.Schema)
                                for (b = s.Schema.length ? s.Schema : [s.Schema],
                                v = 0; v < b.length; v++)
                                    if (k = b[v],
                                    d = k["@id"],
                                    d == e[f]["@schemaUrl"].replace("#", "")) {
                                        w = k["@name"];
                                        break
                                    }
                            if (l) {
                                for (t += "<br><table style='border: 1px solid black;'>",
                                r = 0; r < l.length; r++) {
                                    var c = l[r]
                                      , o = c["@name"]
                                      , p = c["#text"];
                                    t += "<tr>";
                                    t += "<td style='border: 1px solid black;'>";
                                    t += w + ":" + o;
                                    t += "<\/td>";
                                    t += "<td style='border: 1px solid black;' >";
                                    t += p === undefined ? "" : p;
                                    t += "<\/td>";
                                    t += "<\/tr>"
                                }
                                t += "<\/table>"
                            }
                        }
                }
                t.length > 0 && (u.setContent(t),
                u.setPosition(n.point),
                u.open(h))
            }
        }
          , nt = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "click", t)
        }
          , tt = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "mousedown", t)
        }
          , it = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "mouseup", t)
        }
          , rt = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "mousemove", t)
        }
          , st = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "mouseover", t)
        }
          , ut = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "mouseout", t)
        }
          , ft = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "dblclick", t)
        }
          , et = function(n) {
            var t = {
                featureData: {
                    author: o.author,
                    description: n.target.description,
                    name: n.target.name,
                    snippet: n.target.snippet
                },
                point: n.point,
                pixelOffset: 0
            };
            FBM.FWEvent.trigger_(s, "rightclick", t)
        };
        if (y = "loading",
        !i)
            throw "Invalid kml url";
        b = FBM.PROXY_SERVICE2;
        DEBUG_MODE && (b = FBM.PROXY_LOCAL);
        FBM.getJSON(i, function(n) {
            var t, i;
            if (!n || n.error) {
                y = FBM.FWKmlLayerStatus.FETCH_ERROR;
                typeof e == "function" && e.call(this, y);
                return
            }
            t = n.kml;
            t.Document ? (t.Document.hasOwnProperty("description") && (o.description = t.Document.description.hasOwnProperty("#cdata-section") ? t.Document.description["#cdata-section"] : t.Document.description),
            t.Document.hasOwnProperty("name") && (o.name = t.Document.name.hasOwnProperty("#cdata-section") ? t.Document.name["#cdata-section"] : t.Document.name),
            t.Document.hasOwnProperty("Snippet") && (o.snippet = t.Document.Snippet.hasOwnProperty("#cdata-section") ? t.Document.Snippet["#cdata-section"] : t.Document.Snippet),
            t.Document.hasOwnProperty("atom:author") && s.handleAuthor(t.Document["atom:author"]),
            s.Schema = t.Document.Schema) : (t.hasOwnProperty("description") && (o.description = t.description.hasOwnProperty("#cdata-section") ? t.description["#cdata-section"] : t.description),
            t.hasOwnProperty("name") && (o.name = t.name.hasOwnProperty("#cdata-section") ? t.name["#cdata-section"] : t.name),
            t.hasOwnProperty("Snippet") && (o.snippet = t.Snippet.hasOwnProperty("#cdata-section") ? t.Snippet["#cdata-section"] : t.Snippet),
            t.hasOwnProperty("atom:author") && s.handleAuthor(t["atom:author"]));
            s.parseKML(n.kml);
            y = FBM.FWKmlLayerStatus.OK;
            f && f.preserveViewport == !0 && (i = s.getDefaultViewport(),
            i && h.fitBounds(i));
            typeof e == "function" && e.call(s, y)
        }, b, function() {
            typeof e == "function" && e.call(this, FBM.FWKmlLayerStatus.FETCH_ERROR)
        });
        this.removeAdvancedLayer = function() {
            c != null && (h.removeIndependentContainer(c),
            h.removeAdvancedLayer(this),
            c = null,
            p = !1)
        }
        ;
        this.moveToTop = function() {
            c != null && h.moveIndependentContainerToTop(c)
        }
        ;
        this.getNode = function() {
            if (h)
                return p == !0 && c != null ? [c.div.main, c.div.shadow] : h.getPanes().graphicLayer
        }
    }
    ;
    FBM.RegisterEvent(FBM.KMLLayer, ["click", "mousemove", "mouseout", "mouseover", "dblclick", "rightclick"])
}();
/*! D:\FW_API\scripts\FW_TMSLayer.js*/
FBM = FBM || {};
FBM.TMSLayer = function() {
    function c(n, t, i, r, u, f, e, o, s, h) {
        var c, l, a, v, p, w, b, k, y = "不提供圖磚服務", d = !1, g;
        l = i;
        a = r;
        v = u;
        p = f;
        w = e;
        b = o;
        k = s;
        g = n;
        c = t.ownerDocument.createElement("img");
        c.onerror = function() {
            c && (y ? (c.alt = y,
            c.style.display = "") : (c.alt = "",
            c.style.display = "none"),
            c.onload = null,
            c.onerror = null);
            d = !0
        }
        ;
        c.onmousedown = function() {
            return !1
        }
        ;
        c.onload = function() {
            c && (c.alt = "",
            c.style.display = "");
            this.loaded = !0;
            FBM.FWEvent.trigger(h, "tilesloaded")
        }
        ;
        c.galleryImg = !1;
        c.hideFocus = !0;
        c.style.display = "none";
        c.style.MozUserSelect = "none";
        c.style.border = "0 none";
        c.style.position = "absolute";
        c.src = g;
        t.appendChild(c);
        this.setErrorTile = function(n) {
            y = n
        }
        ;
        this.IsComplete = function() {
            return c.loaded || c.readyState == "complete" || c.complete
        }
        ;
        this.getStatus = function() {
            return !d
        }
        ;
        this.getHObject = function() {
            return c
        }
        ;
        this.getScale = function() {
            return l
        }
        ;
        this.getLeft = function() {
            return p
        }
        ;
        this.getTop = function() {
            return w
        }
        ;
        this.getRight = function() {
            return b
        }
        ;
        this.getBottom = function() {
            return k
        }
        ;
        this.RemoveSelf = function() {
            c && (c.onmousedown = null,
            t.removeChild(c));
            c = null
        }
        ;
        this.ReloadStatus = function(n, t, i, r) {
            var f = n + i, u;
            n = Math.round(n);
            u = t + r;
            t = Math.round(t);
            c.style.left = n + "px";
            c.style.top = t + "px";
            c.style.width = Math.round(f - n) + "px";
            c.style.height = Math.round(u - t) + "px"
        }
        ;
        this.isEqual = function(n, t, i) {
            return l == n && a == t && v == i
        }
        ;
        this.getIndexX = function() {
            return a
        }
        ;
        this.getIndexY = function() {
            return v
        }
    }
    var r = "{x}"
      , u = "{y}"
      , f = "{z}"
      , o = 96
      , n = -20037508.3427892
      , t = 20037508.3427892
      , s = !0
      , e = !0
      , h = [{
        z: 0,
        x: n,
        y: t,
        sd: 591658710.909131
    }, {
        z: 1,
        x: n,
        y: t,
        sd: 295829355.454566
    }, {
        z: 2,
        x: n,
        y: t,
        sd: 147914677.727283
    }, {
        z: 3,
        x: n,
        y: t,
        sd: 73957338.8636414
    }, {
        z: 4,
        x: n,
        y: t,
        sd: 36978669.4318207
    }, {
        z: 5,
        x: n,
        y: t,
        sd: 18489334.7159103
    }, {
        z: 6,
        x: n,
        y: t,
        sd: 9244667.35795517
    }, {
        z: 7,
        x: n,
        y: t,
        sd: 4622333.67897759
    }, {
        z: 8,
        x: n,
        y: t,
        sd: 2311166.83948879
    }, {
        z: 9,
        x: n,
        y: t,
        sd: 1155583.4197444
    }, {
        z: 10,
        x: n,
        y: t,
        sd: 577791.709872198
    }, {
        z: 11,
        x: n,
        y: t,
        sd: 288895.854936099
    }, {
        z: 12,
        x: n,
        y: t,
        sd: 144447.92746805
    }, {
        z: 13,
        x: n,
        y: t,
        sd: 72223.9637340248
    }, {
        z: 14,
        x: n,
        y: t,
        sd: 36111.9818670124
    }, {
        z: 15,
        x: n,
        y: t,
        sd: 18055.9909335062
    }, {
        z: 16,
        x: n,
        y: t,
        sd: 9027.9954667531
    }, {
        z: 17,
        x: n,
        y: t,
        sd: 4513.99773337655
    }, {
        z: 18,
        x: n,
        y: t,
        sd: 2256.99886668828
    }, {
        z: 19,
        x: n,
        y: t,
        sd: 1128.49943334414
    }, {
        z: 20,
        x: n,
        y: t,
        sd: 564.249716672069
    }, {
        z: 21,
        x: n,
        y: t,
        sd: 282.124858336034
    }, {
        z: 22,
        x: n,
        y: t,
        sd: 141.062429168017
    }, {
        z: 23,
        x: n,
        y: t,
        sd: 70.5312145840086
    }, {
        z: 24,
        x: n,
        y: t,
        sd: 35.2656072920043
    }];
    return function(n, t, l, a, v, y) {
        var pt = n, ct = t, wt = l.getPanes(), w = wt.overlayviewLayer, lt = 25.4 / o / 1e3, it = 256, bt = 256, k = h, rt = k.length, yt;
        a && (a.tileWidth !== undefined && typeof a.tileWidth == "number" && (it = a.tileWidth),
        a.tileHeight !== undefined && typeof a.tileHeight == "number" && (bt = a.tileHeight),
        a.xTemplate !== undefined && (r = a.xTemplate),
        a.yTemplate !== undefined && (u = a.yTemplate),
        a.zTemplate !== undefined && (f = a.zTemplate),
        a.xEastPositive !== undefined && typeof a.xEastPositive == "boolean" && (s = a.xEastPositive),
        a.yNorthPositive !== undefined && typeof a.yNorthPositive == "boolean" && (e = a.yNorthPositive),
        a.levels !== undefined && (k = a.levels,
        rt = k.length),
        a.maxZoom !== undefined && (rt = a.maxZoom));
        rt < k.length && k.splice(rt + 1);
        var d = 1
          , tt = "auto"
          , nt = !0
          , ut = null
          , ft = null
          , et = null
          , ot = null
          , at = null;
        v && (v.container !== undefined && (w = v.container),
        v.opacity !== undefined && typeof v.opacity == "number" && (d = v.opacity),
        v.zIndex !== undefined && typeof v.zIndex == "number" && (tt = v.zIndex),
        v.visible !== undefined && typeof v.visible == "boolean" && (nt = v.visible),
        v.left !== undefined && typeof v.left == "number" && (ut = v.left),
        v.right !== undefined && typeof v.right == "number" && (et = v.right),
        v.top !== undefined && typeof v.top == "number" && (ft = v.top),
        v.bottom !== undefined && typeof v.bottom == "number" && (ot = v.bottom),
        v.errorTile !== undefined && (at = v.errorTile));
        var b = [], st = [], g, ht = !1, vt = this, p = document.createElement("div");
        p.style.position = "absolute";
        p.style.left = "0px";
        p.style.top = "0px";
        p.style.width = "100%";
        p.style.height = "100%";
        p.style.zIndex = tt;
        p.style.display = nt ? "" : "none";
        p.style.opacity = d;
        p.style.filter = "alpha(opacity=" + d * 100 + ")";
        w.appendChild(p);
        this.moveToTop = function() {
            w && (w.removeChild(p),
            w.appendChild(p))
        }
        ;
        this.moveLayerTo = function(n) {
            var t, r, i;
            w && p && (t = parseInt(n),
            isNaN(t) || (r = w.childNodes.length,
            r > 1 && (i = null,
            t <= 0 ? i = w.firstChild : t >= r || (i = w.childNodes[t]),
            w.removeChild(p),
            i ? w.insertBefore(p, i) : w.appendChild(p))))
        }
        ;
        this.getLayerId = function() {
            return pt
        }
        ;
        this.getOpacity = function() {
            return d
        }
        ;
        this.setOpacity = function(n) {
            typeof n == "number" && (d = n,
            d < 0 && (n = 0),
            d > 1 && (n = 1),
            p && (p.style.opacity = d,
            p.style.filter = "alpha(opacity=" + d * 100 + ")"))
        }
        ;
        this.getZIndex = function() {
            return tt
        }
        ;
        this.setZIndex = function(n) {
            tt = n;
            p && (p.style.zIndex = tt)
        }
        ;
        this.getSourceUrl = function() {
            return ct
        }
        ;
        this.getNode = function() {
            return p
        }
        ;
        this.RemoveSelf = function() {
            w && p && w.removeChild(p)
        }
        ;
        var kt = function(n, t, i, e) {
            return n.replace(r, e).replace(u, i).replace(f, t.z)
        }
          , dt = function(n, t, i) {
            var o, s, d, h, st, ht, a, rt, g, vt, ut;
            if (!n)
                return null;
            for (s = 0; s < n.length; s++)
                if (n[s].z == t.z) {
                    o = n[s];
                    break
                }
            if (!o)
                return null;
            var yt = function(n, t) {
                var c = []
                  , e = Infinity
                  , o = -Infinity
                  , s = Infinity
                  , h = -Infinity
                  , i = 0
                  , u = 0
                  , f = [0, -1];
                for (r = Math.pow(Math.max(n, t), 2); r > 0; r--)
                    -n / 2 < i && i <= n / 2 && -t / 2 < u && u <= t / 2 && (c.push({
                        x: i,
                        y: u
                    }),
                    i < e && (e = i),
                    i > o && (o = i),
                    u < s && (s = u),
                    u > h && (h = u)),
                    (i === u || i < 0 && i === -u || i > 0 && i === 1 - u) && (f = [-f[1], f[0]]),
                    i += f[0],
                    u += f[1];
                return {
                    l: e,
                    r: o,
                    t: h,
                    b: s,
                    xy: c
                }
            }, nt = i.left, tt = i.top, pt = i.right, wt = i.bottom, v = o.x, y = o.y, ft = o.sd, bt = ft * .0254 / 96, u = ft * it * lt, w, et, k, ot, r, f;
            if (!e && (w = nt <= v ? 0 : Math.floor((nt - v) / u),
            et = w + Math.ceil(Math.abs(nt - pt) / u) + 1,
            k = tt >= y ? 0 : Math.floor((y - tt) / u),
            ot = k + Math.ceil(Math.abs(wt - tt) / u) + 1,
            d = yt(et - w, ot - k),
            h = d.xy,
            h.length > 0))
                for (st = w - d.l,
                ht = k - d.b,
                a = 0; a < h.length; a++) {
                    for (f = h[a].x + st,
                    r = h[a].y + ht,
                    rt = !1,
                    g = 0; g < b.length; g++)
                        if (b[g].isEqual(t.z, f, r)) {
                            rt = !0;
                            break
                        }
                    rt || (vt = kt(ct, t, r, f),
                    ut = new c(vt,p,t.z,f,r,v + f * u,y - r * u,v + (f + 1) * u,y - (r + 1) * u,l),
                    ut.setErrorTile(at),
                    b.push(ut))
                }
        }
          , gt = function(n, t) {
            for (var u = 0, r = Infinity, f = n.ToMapDistX(it), i = 0; i < t.length; i++) {
                var o = t[i].sd
                  , s = o * it * lt
                  , e = Math.abs(s - f);
                e < r && (r = e,
                u = i)
            }
            return r / f > .1,
            t[u]
        };
        this.Initialize = function(n) {
            g = n;
            ht = !0;
            vt.RebuildElement();
            vt.UpdateElement();
            y && y.call(this)
        }
        ;
        this.setVisible = function(n) {
            nt = n;
            p.style.display = n ? "" : "none"
        }
        ;
        this.removeLayer = function() {
            l.removeLayer(this)
        }
        ;
        this.getVisible = function() {
            return nt
        }
        ;
        yt = function(n) {
            return ut !== null && n.left < ut && (n.left = ut),
            ft !== null && n.top > ft && (n.top = ft),
            et !== null && n.right > et && (n.right = et),
            ot !== null && n.bottom < ot && (n.bottom = ot),
            n
        }
        ;
        this.MoveTiles = function() {
            var e, r, t, n;
            if (ht && nt && k)
                for (e = [b, st],
                r = 0; r < e.length; r++)
                    for (t = e[r],
                    n = 0; n < t.length; n++) {
                        var i = g.FromMapPoint(t[n].getLeft(), t[n].getTop())
                          , o = g.FromMapPoint(t[n].getRight(), t[n].getBottom())
                          , u = o.x - i.x
                          , f = o.y - i.y;
                        u < 0 && (i.x -= u = -u);
                        f < 0 && (i.y -= f = -f);
                        t[n].ReloadStatus(i.x, i.y, u, f)
                    }
        }
        ;
        this.UpdateElement = function() {
            this.RebuildElement()
        }
        ;
        this.RebuildElement = function() {
            var r, u, s, f;
            if (ht && nt && k && (r = gt(g, k),
            r != null)) {
                var e = g.ToMapPoint(0, 0)
                  , o = g.ToMapPoint(g.getClientWidth(), g.getClientHeight())
                  , t = new FBM.FWEnvelope(e.x,e.y,o.x,o.y);
                for (t = yt(t),
                dt(k, r, t),
                DEBUG_MODE && console.log("getBoundTiles = " + b.length),
                u = [],
                s = b.length,
                i = 0; i < s; i++) {
                    var n = b[i]
                      , h = n.getScale()
                      , c = n.getLeft()
                      , l = n.getRight()
                      , a = n.getTop()
                      , v = n.getBottom()
                      , p = n.getIndexX()
                      , w = n.getIndexY()
                      , y = l < t.left || c > t.right || v > t.top || a < t.bottom;
                    !1 || y ? n.RemoveSelf() : h == r.z ? u.push(n) : n.IsComplete() && n.getStatus() ? st.push(n) : n.RemoveSelf()
                }
                b = u;
                DEBUG_MODE && console.log("tiles = " + b.length);
                this.MoveTiles();
                f = function() {
                    for (var t = !0, n = 0; n < b.length; n++)
                        if (b[n].IsComplete())
                            t = b[n].getStatus();
                        else
                            return setTimeout(f, 100);
                    if (t)
                        while (st.length > 0)
                            st.pop().RemoveSelf()
                }
                ;
                setTimeout(f, 100)
            }
        }
        ;
        l.addLayer(this, !0)
    }
}();
/*! D:\FW_API\scripts\FW_WMSLayer.js*/
FBM = FBM || {},
function() {
    var n = function(n) {
        this.left = n.left;
        this.top = n.top;
        this.right = n.right;
        this.bottom = n.bottom;
        this.src = n.src;
        this.width = n.width;
        this.height = n.height;
        this.layer = n.layer;
        this.loaded = !1;
        this.cancel = !1;
        this.node = document.createElement("img");
        this.node.style.position = "absolute";
        this.setSource = function(n) {
            this.loaded = !1;
            this.node.src = n
        }
        ;
        var t = this;
        this.node.onload = function() {
            if (t.cancel) {
                t.loaded = !1;
                return
            }
            t.loaded = !0;
            n.onload && n.onload.call(t)
        }
        ;
        this.src && (this.node.src = this.src);
        typeof this.width == "number" && (this.node.width = this.width);
        typeof this.height == "number" && (this.node.height = this.height);
        this.destroy = function() {
            this.node && this.node.parentNode && this.node.parentNode.removeChild(this.node)
        }
    };
    FBM.WMSLayer = function(t, i, r, u, f) {
        function ni() {
            dt = f.preserveViewport;
            e = document.createElement("div");
            e.style.position = "absolute";
            e.style.left = "0px";
            e.style.top = "0px";
            e.style.width = "100%";
            e.style.height = "100%";
            e.className = "FW_WMS";
            e.style.opacity = w;
            var n = parseInt(w * 100);
            h = y.getMapBase();
            it = i.indexOf("?") > 0 ? i.slice(0, i.indexOf("?")) : i;
            o.appendChild(e);
            y.addLayer(bt, !0)
        }
        function ti() {
            var a, i;
            if (y) {
                var r = h.getClientWidth()
                  , u = h.getClientHeight()
                  , n = h.ToMapPoint(0, 0)
                  , t = h.ToMapPoint(r, u)
                  , w = wt()
                  , v = ut != null ? ut + "=" + s : b == "1.3.0" ? "CRS=" + s : "SRS=" + s;
                switch (y.getCoordSys()) {
                case FBM.FWCoordSys.EPSG3857:
                    n = FBM.GooToWGS84(n.x, n.y);
                    t = FBM.GooToWGS84(t.x, t.y);
                    break;
                case FBM.FWCoordSys.EPSG3826:
                    s.indexOf("3826") < 0 && (s.indexOf("3825") >= 0 ? (n = FBM.TWD97toTWD97_119(n.x, n.y),
                    t = FBM.TWD97toTWD97_119(t.x, t.y)) : s.indexOf("4326") >= 0 && (n = FBM.TWD97toWGS84(n.x, n.y),
                    t = FBM.TWD97toWGS84(t.x, t.y)));
                    break;
                case FBM.FWCoordSys.EPSG3825:
                    s.indexOf("3825") < 0 && (s.indexOf("3826") >= 0 ? (n = FBM.TWD97_119toTWD97(n.x, n.y),
                    t = FBM.TWD97_119toTWD97(t.x, t.y)) : s.indexOf("4326") >= 0 && (n = FBM.TWD97_119toWGS84(n.x, n.y),
                    t = FBM.TWD97_119toWGS84(t.x, t.y)))
                }
                var f = n.x
                  , e = t.y
                  , o = t.x
                  , l = n.y;
                return b == "1.3.0" && s.indexOf("CRS:84") < 0 && s.indexOf("EPSG:4326") >= 0 && (f = t.y,
                e = n.x,
                o = n.y,
                l = t.x),
                a = f + "," + e + "," + o + "," + l,
                i = it + "?BBOX=" + a + "&WIDTH=" + r + "&HEIGHT=" + u,
                i += "&" + c.join("&"),
                i += "&" + v,
                p && (i = p + "?" + i),
                i
            }
        }
        function wt() {
            if (y) {
                var n = h.getClientWidth()
                  , t = h.getClientHeight()
                  , i = h.ToMapPoint(0, 0)
                  , r = h.ToMapPoint(n, t);
                return {
                    left: i.x,
                    top: i.y,
                    right: r.x,
                    bottom: r.y,
                    width: n,
                    height: t
                }
            }
        }
        var bt = this, kt = t, it, h, y = r, g = !0, p, rt = "auto", dt = !0, st, w = 1, ut = null, gt = r.getPanes(), o = gt.overlayviewLayer, ht, k, d, c, a, et, nt, v, e, ot, tt, l;
        f && (f.opacity !== undefined && typeof f.opacity == "number" && (w = f.opacity),
        f.visible !== undefined && typeof f.visible == "boolean" && (g = f.visible),
        f.container !== undefined && (o = f.container),
        f.proxy !== undefined && (ht = f.proxy.indexOf("?") > 0 ? f.proxy.slice(0, f.proxy.indexOf("?")) : f.proxy,
        p = ht));
        var b = "1.3.0"
          , s = "EPSG:4326"
          , ct = ""
          , lt = ""
          , at = "image/png"
          , vt = "0xFFFFFF"
          , yt = "TRUE";
        if (u && (u.version !== undefined && (b = u.version),
        u.srs !== undefined && (k = u.srs),
        u.crs !== undefined && (d = u.crs),
        k !== undefined && d !== undefined ? s = b == "1.3.0" ? k : d : (k !== undefined && (s = k),
        d !== undefined && (s = d)),
        u.cstag !== undefined && (ut = u.cstag),
        u.layers !== undefined && (ct = u.layers),
        u.styles !== undefined && (lt = u.styles),
        u.format !== undefined && (at = u.format),
        u.bgcolor !== undefined && (vt = u.bgcolor),
        u.transparent !== undefined && (yt = u.transparent)),
        c = [],
        c.push("SERVICE=WMS"),
        c.push("REQUEST=GetMap"),
        c.push("VERSION=" + b),
        c.push("LAYERS=" + ct),
        c.push("STYLES=" + lt),
        c.push("FORMAT=" + at),
        c.push("BGCOLOR=" + vt),
        c.push("TRANSPARENT=" + yt),
        a = i,
        a.indexOf("?") > -1) {
            var ft = a.indexOf("?")
              , i = a.substring(0, ft)
              , pt = a.substr(ft + 1, a.length - ft);
            if (a = i,
            pt.length > 0)
                for (et = pt.split("&"),
                nt = 0; nt < et.length; nt++)
                    if (v = et[nt],
                    v.length > 0) {
                        if (v.toUpperCase().indexOf("BBOX") >= 0)
                            continue;
                        if (v.toUpperCase().indexOf("WIDTH") >= 0)
                            continue;
                        if (v.toUpperCase().indexOf("HEIGHT") >= 0)
                            continue;
                        if (v.toUpperCase().indexOf("VERSION") >= 0)
                            continue;
                        c.push(v)
                    }
        }
        this.moveToTop = function() {
            o && (o.removeChild(e),
            o.appendChild(e))
        }
        ;
        this.moveLayerTo = function(n) {
            var t, r, i;
            o && layerContainer && (t = parseInt(n),
            isNaN(t) || (r = o.childNodes.length,
            r > 1 && (i = null,
            t <= 0 ? i = o.firstChild : t >= r || (i = o.childNodes[t]),
            o.removeChild(layerContainer),
            i ? o.insertBefore(layerContainer, i) : o.appendChild(layerContainer))))
        }
        ;
        this.RemoveSelf = function() {
            o && e && o.removeChild(e)
        }
        ;
        this.getLayerId = function() {
            return kt
        }
        ;
        this.getNode = function() {
            return e
        }
        ;
        this.getDefaultViewport = function() {}
        ;
        this.getUrl = function() {
            return it
        }
        ;
        this.removeLayer = function() {
            y.removeLayer(this)
        }
        ;
        this.getZIndex = function() {
            return rt
        }
        ;
        this.setZIndex = function(n) {
            rt = n;
            e && (e.style.zIndex = rt)
        }
        ;
        this.getVisible = function() {
            return g
        }
        ;
        this.setVisible = function(n) {
            g = n;
            e && (e.style.display = g ? "block" : "none")
        }
        ;
        this.putVisible = function(n) {
            this.setVisible(n)
        }
        ;
        this.setProxy = function(n) {
            if (n) {
                var t = n.indexOf("?") > 0 ? n.slice(0, n.indexOf("?")) : n;
                p = t
            }
        }
        ;
        this.getProxy = function() {
            return p
        }
        ;
        ot = function(n) {
            if (n) {
                var t = h.FromMapPoint(n.left, n.top);
                n.node.style.left = t.x + "px";
                n.node.style.top = t.y + "px"
            }
        }
        ;
        this.setOpacity = function(n) {
            if (e) {
                var t = parseInt(n * 100);
                e.style.filter = "alpha(opacity=" + t + ")";
                e.style.opacity = n
            }
            w = n
        }
        ;
        this.getOpacity = function() {
            return w
        }
        ;
        this.UpdateElement = function() {
            var n = h.getScale()
              , t = st / n;
            l && (l.node.width = l.node.width / t,
            l.node.height = l.node.height / t);
            ot(tt);
            ot(l);
            st = n
        }
        ;
        this.RebuildElement = function() {
            var i = this, t;
            this.temp && !this.temp.loaded && (this.temp.cancel = !0);
            t = wt();
            this.temp = new n({
                left: t.left,
                right: t.right,
                top: t.top,
                bottom: t.bottom,
                width: t.width,
                height: t.height,
                src: ti(),
                onload: function() {
                    tt = l;
                    e.appendChild(i.temp.node);
                    l = i.temp;
                    tt && tt.destroy();
                    i.temp = null;
                    FBM.FWEvent.trigger(i, "image_loaded")
                }
            })
        }
        ;
        ni()
    }
    ;
    FBM.RegisterEvent(FBM.WMSLayer, ["image_loaded"])
}();
FBM.WMSLayer.enumCoordinate = {
    WGS84: 0,
    TWD97: 1,
    GOOGLE: 2,
    TWD97_119: 3
};
/*! D:\FW_API\scripts\FW_WFSLayer.js*/
FBM = FBM || {};
FBM.WFSLayer = function() {
    var l = function(n, t) {
        this.mapCoordSys = n;
        this.dataCoordSys = t
    }
      , a = function(n) {
        for (var i = n.split("."), r = [], t = 0; t < i.length; t++)
            r.push(i[t]);
        return r
    }
      , y = function(n) {
        return n.replace(/^\s+|\s+$/g, "")
    }
      , t = function(n, t, i) {
        var r = n;
        return i == "EPSG3826" ? t == "EPSG3825" ? r = FBM.TWD97toTWD97_119(n.x, n.y) : t == "EPSG3857" && (r = FBM.TWD97toWGS84(n.x, n.y)) : i == "EPSG3825" ? t == "EPSG3826" ? r = FBM.TWD97_119toTWD97(n.x, n.y) : t == "EPSG3857" && (r = FBM.TWD97_119toWGS84(n.x, n.y)) : i == "EPSG4326" && (t == "EPSG3826" ? r = FBM.WGS84toTWD97(n.x, n.y) : t == "EPSG3825" && (r = FBM.WGS84toTWD97_119(n.x, n.y))),
        n = null,
        r
    }
      , i = function(n, i, r, u) {
        var l = 2, s, c, f, e;
        if (u && (l = parseFloat(u)),
        s = this.dataCoordSys,
        r !== undefined)
            switch (r) {
            case "EPSG:4326":
                s = "EPSG4326";
                break;
            case "EPSG:3826":
                s = "EPSG3826";
                break;
            case "EPSG:3825":
                s = "EPSG3825";
                break;
            case "EPSG:3857":
                s = "EPSG3857"
            }
        if (i[0] == "1" && i[1] == "0") {
            var n = n["#text"] || n
              , a = n.indexOf(",") >= 0
              , o = n.replace(/[\s]*$/gi, "").replace(/^[\s]*/gi, "").split(/[\s]+/)
              , h = [];
            if (a)
                for (f = 0; f < o.length; f++)
                    c = o[f].split(","),
                    e = new FBM.FWPoint(parseFloat(c[0]),parseFloat(c[1])),
                    e = t(e, this.mapCoordSys, s),
                    h.push(e);
            else
                for (f = 0; f < o.length; f += l)
                    e = new FBM.FWPoint(parseFloat(o[f]),parseFloat(o[f + 1])),
                    e = t(e, this.mapCoordSys, s),
                    h.push(e)
        } else {
            var n = n["#text"] || n
              , a = n.indexOf(",") >= 0
              , o = n.replace(/[\s]*$/gi, "").replace(/^[\s]*/gi, "").split(/[\s]+/)
              , h = [];
            if (a)
                for (f = 0; f < o.length; f++)
                    c = o[f].split(","),
                    e = new FBM.FWPoint(parseFloat(c[0]),parseFloat(c[1])),
                    e = t(e, this.mapCoordSys, s),
                    h.push(e);
            else
                for (f = 0; f < o.length; f += l)
                    e = new FBM.FWPoint(parseFloat(o[f]),parseFloat(o[f + 1])),
                    e = t(e, this.mapCoordSys, s),
                    h.push(e);
            return h
        }
        return h
    }
      , r = function(n, t, i) {
        var c = [], w, u, l, a, b, y, k, p, r, d;
        for (w in n)
            if (u = n[w],
            u && typeof u == "object")
                for (l in u)
                    switch (l) {
                    case t + ":MultiPolygon":
                        for (a = s(u[l], t, i),
                        r = 0; r < a.length; r++)
                            c.push(a[r]);
                        break;
                    case t + ":MultiSurface":
                        for (a = s(u[l], t, i),
                        r = 0; r < a.length; r++)
                            c.push(a[r]);
                        break;
                    case t + ":Polygon":
                        b = f(u, t, i);
                        c.push(b);
                        break;
                    case t + ":MultiLineString":
                        for (y = h(u[l], t, i),
                        r = 0; r < y.length; r++)
                            c.push(y[r]);
                        break;
                    case t + ":MultiCurve":
                        for (y = h(u[l], t, i),
                        r = 0; r < y.length; r++)
                            c.push(y[r]);
                        break;
                    case t + ":LineString":
                        k = e(u, t, i);
                        c.push(k);
                        break;
                    case t + ":MultiPoint":
                        for (p = v(u[l], t, i),
                        r = 0; r < p.length; r++)
                            c.push(p[r]);
                        break;
                    case t + ":Point":
                        d = o(u[t + ":Point"], t, i);
                        c.push(d)
                    }
        return c
    }
      , u = function(n, t, r, u) {
        var f = n[t + ":coordinates"] || n[t + ":posList"]
          , u = f["@srsName"]
          , e = f["@srsDimension"]
          , o = i(f, r, u, e)
          , s = new FBM.FWLineString(o);
        return new FBM.FWLinearRing(s)
    }
      , f = function(n, t, i) {
        var e = [], f = n[t + ":Polygon"], c = f["@srsName"], l = f[t + ":outerBoundaryIs"] || f[t + ":exterior"], a = l[t + ":LinearRing"], v = u(a, t, i, c), r, o, s, h;
        if (e.push(v),
        r = f[t + ":innerBoundaryIs"] || f[t + ":interior"],
        r)
            if (r instanceof Array)
                for (o = 0; o < r.length; o++)
                    s = r[o][t + ":LinearRing"],
                    h = u(s, t, i, c),
                    e.push(h);
            else
                s = r[t + ":LinearRing"],
                h = u(s, t, i, c),
                e.push(h);
        return new FBM.FWPolygon(e)
    }
      , s = function(n, t, i) {
        var r = n[t + ":polygonMember"] || n[t + ":surfaceMember"], o = [], u, e;
        if (r.length !== undefined)
            for (u = 0; u < r.length; u++)
                e = f(r[u], t, i),
                o.push(e);
        else
            e = f(r, t, i),
            o.push(e);
        return o
    }
      , e = function(n, t, r) {
        var u = n[t + ":LineString"], f = u["@srsName"], e = u["@srsDimension"], o = u[t + ":coordinates"] || u[t + ":posList"], s, h;
        return f || (f = o["@srsName"]),
        e || (e = o["@srsDimension"]),
        s = i(o, r, f, e),
        h = new FBM.FWLineString(s),
        h
    }
      , h = function(n, t, i) {
        var r = n[t + ":lineStringMember"] || n[t + ":curveMember"], o = [], u, f;
        if (r.length !== undefined)
            for (u = 0; u < r.length; u++)
                f = e(r[u], t, i),
                o.push(f);
        else
            f = e(r, t, i),
            o.push(f);
        return o
    }
      , o = function(n, t, r) {
        var u = n["@srsName"], f = n["@srsDimension"], e = n[t + ":coordinates"] || n[t + ":pos"], o;
        return u || (u = e["@srsName"]),
        f || (f = e["@srsDimension"]),
        o = i(e, r, u, f),
        o[0]
    }
      , v = function(n, t, i) {
        var r = n[t + ":pointMember"], e = [], u, f;
        if (r.length !== undefined)
            for (u = 0; u < r.length; u++)
                f = o(r[u], t, i),
                e.push(f);
        else
            f = o(r, t, i),
            e.push(f);
        return e
    }
      , c = function(n, t, i, r, u, f) {
        var l, o, a, v, y, h, p, c, e, s;
        if (this.zIndex = "auto",
        this.defaultViewport = null,
        this.preserveViewport = !0,
        this.serviceInfo = {
            VERSION: "1.0.0",
            REQUEST: "GetFeature",
            SERVICE: "WFS",
            SRSNAME: "EPSG:4326"
        },
        l = {
            marker: FBM.RES_PATH + "marker2.png",
            shadow: FBM.RES_PATH + "shadow2.png"
        },
        this.markerOptions = {
            title: "",
            clickable: !1,
            cursor: "",
            zIndex: "auto",
            flat: !1,
            icon: new FBM.FWImage(l.marker,new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(11,30)),
            shadow: new FBM.FWImage(l.shadow,new FBM.FWSize(31,30),new FBM.FWPoint(0,0),new FBM.FWPoint(9,25))
        },
        this.polylineOptions = {
            clickable: !1,
            strokeWeight: 2,
            zIndex: "auto",
            strokeColor: "#ff5555",
            strokeOpacity: 1
        },
        this.polygonOptions = {
            clickable: !1,
            opacity: 1,
            fillColor: "#eeaaaa",
            fillOpacity: .5,
            strokeWeight: 2,
            zIndex: "auto",
            strokeColor: "#ff5555",
            strokeOpacity: 1
        },
        this.callback = f,
        this.gs = [],
        i !== undefined && this.setMap(i),
        this.setName(n),
        r)
            for (e in r)
                s = r[e],
                this.serviceInfo[e.toUpperCase()] = s;
        if (o = t,
        o.indexOf("?") > -1 && (a = o.indexOf("?"),
        v = o.substr(a + 1, o.length - a),
        v.length > 0))
            for (y = v.split("&"),
            h = 0; h < y.length; h++)
                p = y[h],
                p.length > 0 && (c = p.split("="),
                c.length == 2 && (e = c[0].toUpperCase(),
                s = c[1],
                this.serviceInfo[e] = s));
        u && (u.preserveViewport && this.setPreserveViewport(u.preserveViewport),
        u.independentContainer && this.setIndependentContainer(u.independentContainer),
        u.visible && this.setVisible(u.visible),
        u.markerOptions && this.setMarkerOptions(u.markerOptions),
        u.polylineOptions && this.setLineOptions(u.polylineOptions),
        u.polygonOptions && this.setPolygonOptions(u.polygonOptions),
        u.zIndex !== undefined && this.setZIndex(u.zIndex));
        this.setUrl(t);
        this.update(this.callback)
    }
      , n = c.prototype;
    return n.update = function(n) {
        var u, o, e, h, y, c;
        if (this.url && this.map) {
            if (u = this.serviceInfo.TYPENAME,
            o = this.serviceInfo.VERSION,
            !o)
                throw "Invalid WFS version";
            if (!u)
                throw "Invalid Type Name";
            if (e = a(o),
            e.length != 3)
                throw "Invalid WFS version";
            var p = u.split(":")[0]
              , i = ""
              , s = ""
              , v = ""
              , t = this
              , f = "";
            for (h in this.serviceInfo)
                f.length > 0 && (f = f + "&"),
                f = f + h + "=" + this.serviceInfo[h];
            y = this.url + "?" + f;
            c = FBM.PROXY_SERVICE2;
            DEBUG_MODE && (c = FBM.PROXY_LOCAL);
            FBM.getJSON(y, function(f) {
                var o, nt, b, ot, lt, g, tt, d, k, c, it, a, st, p, h, ut, w, ft, et, ht, ct;
                if (!f || f.error) {
                    n.call(this, f.error);
                    return
                }
                for (nt in f)
                    nt.indexOf("FeatureCollection") >= 0 && (o = f[nt]);
                if (o) {
                    for (b in o)
                        b.indexOf("@xmlns:") >= 0 && ((o[b] == "http://www.opengis.net/gml" || o[b] == "http://www.opengis.net/gml/3.2") && (i = b.replace("@xmlns:", "")),
                        (o[b] == "http://www.opengis.net/wfs" || o[b] == "http://www.opengis.net/wfs/2.0") && (s = b.replace("@xmlns:", "")));
                    if (o["@xmlns"] && (o["@xmlns"] == "http://www.opengis.net/gml" ? v = i : o["@xmlns"] == "http://www.opengis.net/wfs" && (v = s)),
                    ot = t.map.getCoordSys(),
                    tt = o[i + ":boundedBy"],
                    tt !== undefined && (d = tt[i + ":Box"],
                    d !== undefined && (d["@srsName"] !== undefined && (g = d["@srsName"]),
                    d[i + ":coordinates"] !== undefined && (lt = d[i + ":coordinates"]))),
                    g !== undefined && (g = g.replace(":", "")),
                    l(ot, g),
                    k = o[i + ":featureMember"] || o[i + ":featureMembers"] || o[i + ":member"] || o[s + ":member"],
                    c = [],
                    k) {
                        if (k.length)
                            for (a = 0,
                            a = 0; a < k.length; a++)
                                for (st = k[a][u],
                                p = r(st, i, e),
                                h = 0; h < p.length; h++)
                                    c.push(p[h]);
                        else if (a = 0,
                        it = k[u],
                        it.length)
                            for (a = 0; a < k[u].length; a++)
                                for (p = r(k[u][a], i, e),
                                h = 0; h < p.length; h++)
                                    c.push(p[h]);
                        else
                            for (p = r(it, i, e),
                            h = 0; h < p.length; h++)
                                c.push(p[h]);
                        var rt = function(n, t) {
                            var i = n, r;
                            i || (i = {});
                            for (r in t)
                                t.hasOwnProperty(r) && (i[r] = t[r]);
                            return i
                        }
                          , y = null
                          , at = t.getIndependentContainer();
                        for (at == !0 && (ut = t.getAdvancedContainer(),
                        ut != null && (y = {
                            advancedLayer: ut
                        })),
                        w = 0; w < c.length; w++)
                            c[w]instanceof FBM.FWPolygon ? (y = rt(y, t.polygonOptions),
                            ft = new FBM.FWFill(t.map,c[w],y),
                            ft.setOpacity(.5),
                            t.gs.push(ft)) : c[w]instanceof FBM.FWLineString ? (y = rt(y, t.polylineOptions),
                            et = new FBM.FWLine(t.map,c[w],y),
                            et.setStrokeWeight(2),
                            t.gs.push(et)) : c[w]instanceof FBM.FWPoint && (y = rt(y, t.markerOptions),
                            ht = new FBM.FWMarker(t.map,c[w],null,null,y),
                            t.gs.push(ht));
                        t.setZIndex(t.zIndex);
                        t.setVisible(t.visible);
                        t.map && t.preserveViewport == !0 && (ct = t.getDefaultViewport(),
                        ct && t.map.fitBounds(t.getDefaultViewport()));
                        n && n.call(t)
                    }
                }
            }, c)
        }
    }
    ,
    n.setUrl = function(n) {
        this.url = n.indexOf("?") > 0 ? n.slice(0, n.indexOf("?")) : n
    }
    ,
    n.setPreserveViewport = function(n) {
        this.preserveViewport = n
    }
    ,
    n.setZIndex = function(n) {
        this.zIndex = n;
        for (var t = 0; t < this.gs.length; t++)
            this.gs[t].setZIndex(this.zIndex)
    }
    ,
    n.setName = function(n) {
        this.name = n
    }
    ,
    n.setMap = function(n) {
        this.map = n
    }
    ,
    n.getDefaultViewport = function() {
        var f, n;
        if (!this.defaultViewport) {
            var t = Infinity
              , i = -Infinity
              , r = -Infinity
              , u = Infinity;
            for (f = 0; f < this.gs.length; f++)
                (n = this.gs[f].getBounds(),
                n) && (t = Math.min(t, n.left),
                u = Math.min(u, n.bottom),
                i = Math.max(i, n.right),
                r = Math.max(r, n.top));
            this.defaultViewport = isFinite(t) && isFinite(r) && isFinite(i) && isFinite(u) ? new FBM.FWEnvelope(t,r,i,u) : null
        }
        return this.defaultViewport
    }
    ,
    n.getUrl = function() {
        return this.url
    }
    ,
    n.removeAdvancedLayer = function() {
        this.advancedLayer != null && (this.map.removeIndependentContainer(this.advancedLayer),
        this.map.removeAdvancedLayer(this),
        this.advancedLayer = null)
    }
    ,
    n.moveToTop = function() {
        this.advancedLayer != null && this.map.moveIndependentContainerToTop(this.advancedLayer)
    }
    ,
    n.removeLayer = function() {
        this.removeAdvancedLayer();
        for (var n = 0; n < this.gs.length; n++)
            this.gs[n].setMap(null),
            this.gs[n] = null;
        this.gs = [];
        this.map = null
    }
    ,
    n.getVisible = function() {
        return this.visible
    }
    ,
    n.getLayerId = function() {
        return this.name
    }
    ,
    n.setVisible = function(n) {
        this.visible = n;
        for (var t = 0; t < this.gs.length; t++)
            this.gs[t].setVisible(this.visible)
    }
    ,
    n.setMarkerOptions = function(n) {
        n && (n.clickable !== undefined && (this.markerOptions.clickable = n.clickable),
        n.title !== undefined && (this.markerOptions.title = n.title),
        n.zIndex !== undefined && (this.markerOptions.zIndex = n.zIndex),
        n.opacity !== undefined && (this.markerOptions.opacity = n.opacity),
        n.cursor !== undefined && (this.markerOptions.cursor = n.cursor),
        n.flat !== undefined && (this.markerOptions.flat = n.flat),
        n.icon !== undefined && (this.markerOptions.icon = n.icon),
        n.shadow !== undefined && (this.markerOptions.shadow = n.shadow))
    }
    ,
    n.setLineOptions = function(n) {
        n && (n.clickable !== undefined && (this.polylineOptions.clickable = n.clickable),
        n.opacity !== undefined && (this.polylineOptions.opacity = n.opacity),
        n.zIndex !== undefined && (this.polylineOptions.zIndex = n.zIndex),
        n.strokeWeight !== undefined && (this.polylineOptions.strokeWeight = n.strokeWeight),
        n.strokeDasharray !== undefined && (this.polylineOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.polylineOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.polylineOptions.strokeOpacity = n.strokeOpacity))
    }
    ,
    n.setPolygonOptions = function(n) {
        n && (n.clickable !== undefined && (this.polygonOptions.clickable = n.clickable),
        n.opacity !== undefined && (this.polygonOptions.opacity = n.opacity),
        n.zIndex !== undefined && (this.polygonOptions.zIndex = n.zIndex),
        n.fillColor !== undefined && (this.polygonOptions.fillColor = n.fillColor),
        n.fillOpacity !== undefined && (this.polygonOptions.fillOpacity = n.fillOpacity),
        n.strokeWeight !== undefined && (this.polygonOptions.strokeWeight = n.strokeWeight),
        n.strokeDasharray !== undefined && (this.polygonOptions.strokeDasharray = n.strokeDasharray),
        n.strokeColor !== undefined && (this.polygonOptions.strokeColor = n.strokeColor),
        n.strokeOpacity !== undefined && (this.polygonOptions.strokeOpacity = n.strokeOpacity))
    }
    ,
    n.getIndependentContainer = function() {
        return this.independentContainer
    }
    ,
    n.setIndependentContainer = function(n) {
        this.independentContainer = n;
        this.independentContainer == !0 && this.advancedLayer === undefined && (this.advancedLayer = this.map.addIndependentContainer("WFS", this))
    }
    ,
    n.getAdvancedContainer = function() {
        return this.independentContainer == !0 ? (this.advancedLayer === undefined && (this.advancedLayer = this.map.addIndependentContainer("WFS", this)),
        this.advancedLayer) : null
    }
    ,
    n.getNode = function() {
        if (this.map) {
            if (this.independentContainer == !0) {
                var n = this.getAdvancedContainer();
                return n != null ? [n.div.main, n.div.shadow] : this.map.getPanes().graphicLayer
            }
            return this.map.getPanes().graphicLayer
        }
    }
    ,
    c
}();
/*! D:\FW_API\scripts\FW_WMTSLayer.js*/
FBM = FBM || {};
FBM.WMTSLayer = function() {
    var r = this
      , t = .00028
      , n = function(n) {
        this.matrixId = n.matrixId;
        this.row = n.row;
        this.col = n.col;
        this.left = n.left;
        this.top = n.top;
        this.right = n.right;
        this.bottom = n.bottom
    };
    return n.prototype.equals = function(n) {
        return this.matrixId == n.matrixId && this.row == n.row && this.col == n.col
    }
    ,
    function(r, u, f, e, o, s) {
        function a(n, t) {
            return n ? n instanceof Array ? n : [n] : t
        }
        function d(n) {
            return !this || this.length <= 0 ? null : this.find(n) || this[0]
        }
        function et() {
            return !this || this.length <= 0 ? null : this[this.push(this.shift()) - 1]
        }
        function ot(n) {
            var t, r, i;
            return k ? (t = a(k.TileMatrix, null),
            !t || t.length <= 0) ? null : (r = n.ToMapDistX(1) / (.0254 / e.dpi),
            i = t.map(function(n) {
                return {
                    m: n,
                    d: Math.abs(Math.log(parseFloat(n.ScaleDenominator) / r))
                }
            }).reduce(function(n, t) {
                return n && n.d < t.d ? n : t
            }, null),
            i ? i.m : null) : null
        }
        function st(n, t) {
            if (t && t.length)
                return Object.keys(n).reduce(function(t, i) {
                    return t.replace("{" + i + "}", n[i])
                }, et.call(t) || "");
            var i = et.call(a(ut, null));
            return i += (i.indexOf("?") > 0 ? "&" : "?") + Object.keys(n).map(function(t) {
                return t + "=" + n[t]
            }).join("&"),
            typeof b == "boolean" && b && FBM.APIKEY && FBM.APPID ? i += "&APPID=" + FBM.APPID + "&APIKEY=" + FBM.APIKEY : typeof b == "string" && (i += "&" + b),
            i
        }
        function ht(n, t, i) {
            return st({
                SERVICE: "WMTS",
                REQUEST: "GetTile",
                VERSION: "1.0.0",
                Layer: e.layer,
                Format: e.format,
                Style: e.style,
                TileMatrixSet: e.matrixSet,
                TileMatrix: n,
                TileRow: t,
                TileCol: i
            }, ft)
        }
        function ct(t, r) {
            function l(n) {
                var i = Math.floor(Math.sqrt(n) / 2)
                  , t = 2 * i + 1;
                return {
                    x: Math.min(t, Math.max(0, t + i - Math.floor(Math.abs(n - t * (t + .5))))) - i,
                    y: Math.min(t, Math.max(0, t + i - Math.floor(Math.abs(n - t * (t - .5))))) - i
                }
            }
            function a(n, t, i, r) {
                var e = (i + n - 1) / 2, o = (r + t - 1) / 2, u, f;
                return n = Math.floor(n),
                t = Math.floor(t),
                u = Math.ceil(i) - n,
                f = Math.ceil(r) - t,
                new Array(u * f).fill(0).map(function(i, r) {
                    return {
                        x: r % u + n,
                        y: Math.floor(r / u) + t
                    }
                }).map(function(n) {
                    return {
                        xy: n,
                        d: Math.abs(n.x - e) + Math.abs(n.y - o)
                    }
                }).sort(function(n, t) {
                    return n.d - t.d
                }).map(function(n) {
                    return n.xy
                })
            }
            if (!t)
                return null;
            var v = parseFloat(t.TileWidth)
              , y = parseFloat(t.TileHeight)
              , u = parseFloat(t.ScaleDenominator) * v * (.0254 / e.dpi)
              , f = parseFloat(t.ScaleDenominator) * y * (.0254 / e.dpi)
              , h = t.TopLeftCorner.split(" ").map(parseFloat)
              , o = h[0]
              , s = h[1]
              , p = Math.max(r.left, nt || r.left)
              , w = Math.min(r.right, it || r.right)
              , b = Math.min(r.top, tt || r.top)
              , k = Math.max(r.bottom, rt || r.bottom)
              , d = (p - o) / u
              , g = (s - b) / f
              , ut = (w - o) / u
              , ft = (s - k) / f
              , et = t["ows:Identifier"]
              , c = a(d, g, ut, ft);
            return c.length > 0 ? c.map(function(t) {
                return new n({
                    matrixId: et,
                    col: t.x,
                    row: t.y,
                    left: o + t.x * u,
                    top: s - t.y * f,
                    right: o + (t.x + 1) * u,
                    bottom: s - (t.y + 1) * f
                })
            }) : null
        }
        function at(n, t) {
            (function i() {
                n() ? t() : setTimeout(i, 200)
            }
            )()
        }
        var c = null, h;
        f && (c = f.getPanes().overlayviewLayer);
        var l = null
          , g = !1
          , lt = r
          , w = !0
          , v = 1
          , nt = null
          , tt = null
          , it = null
          , rt = null
          , b = !0
          , y = null
          , k = null
          , ut = u
          , ft = null
          , p = [];
        o !== undefined && o !== null && (o.container != null && (c = o.container),
        o.appendKey != null && (b = o.appendKey),
        nt = typeof o.left == "number" ? o.left : null,
        tt = typeof o.top == "number" ? o.top : null,
        it = typeof o.right == "number" ? o.right : null,
        rt = typeof o.bottom == "number" ? o.bottom : null,
        v = typeof o.opacity == "number" ? Math.max(0, Math.min(1, o.opacity)) : 1,
        w = typeof o.visible == "boolean" ? o.visible : !0);
        e || (e = {});
        e.dpi = typeof e.dpi == "number" ? e.dpi : .0254 / t;
        e.style = typeof e.style == "string" ? e.style : "default";
        e.format = typeof e.format == "string" ? e.format : "image/png";
        h = document.createElement("div");
        h.className = "FW_WMTS";
        h.style.position = "absolute";
        h.style.left = "0px";
        h.style.top = "0px";
        h.style.width = "100%";
        h.style.height = "100%";
        h.style.display = w ? "" : "none";
        h.style.opacity = v;
        h.style.filter = "alpha(opacity=" + v * 100 + ")";
        c.appendChild(h);
        this.moveLayerTo = function(n) {
            if (c && h && !(c.childNodes.length <= 1)) {
                var t = parseInt(n);
                isNaN(t) || (t < 0 && (t += c.childNodes.length + 1),
                c.insertBefore(h, t < c.childNodes.length ? c.childNodes[Math.max(0, t)] : null))
            }
        }
        ;
        this.moveToTop = function() {
            this.moveLayerTo(-1)
        }
        ;
        this.RemoveSelf = function() {
            c.removeChild(h)
        }
        ;
        this.getNode = function() {
            return h
        }
        ;
        this.getLayerId = function() {
            return lt
        }
        ;
        this.getMatrixSetId = function() {
            return e.matrixSet
        }
        ;
        this.getSource = function() {
            return u
        }
        ;
        this.getVisible = function() {
            return w
        }
        ;
        this.putVisible = function(n) {
            h.style.display = (w = n) ? "" : "none"
        }
        ;
        this.setVisible = function(n) {
            this.putVisible(n)
        }
        ;
        this.getOpacity = function() {
            return v
        }
        ;
        this.setOpacity = function(n) {
            v = Math.max(0, Math.min(1, parseFloat(n)));
            h && (h.style.opacity = v,
            h.style.filter = "alpha(opacity=" + v * 100 + ")")
        }
        ;
        this.removeLayer = function() {
            f !== undefined && f.removeLayer(this)
        }
        ;
        this.Initialize = function(n) {
            l = n;
            var t = st({
                SERVICE: "WMTS",
                REQUEST: "GetCapabilities",
                VERSION: "1.0.0"
            });
            FBM.getJSON(t, function(n) {
                if (y = n.Capabilities,
                !y)
                    throw "Service Error";
                if (g = !0,
                y["ows:OperationsMetadata"] && a(y["ows:OperationsMetadata"]["ows:Operation"], []).some(function(n) {
                    return n["@name"] != "GetTile" || !n["ows:DCP"] || !n["ows:DCP"]["ows:HTTP"] ? !1 : a(n["ows:DCP"]["ows:HTTP"]["ows:Get"], []).some(function(n) {
                        return n["ows:Constraint"]["ows:AllowedValues"]["ows:Value"] != "KVP" ? !1 : (ut = n["@xlink:href"]) !== undefined
                    })
                }),
                y.Contents) {
                    var t = d.call(a(y.Contents.Layer, null), function(n) {
                        return n && n["ows:Identifier"] == e.layer
                    });
                    t && (e.layer = t["ows:Identifier"],
                    e.format = d.call(a(t.Format, null), function(n) {
                        return n == e.format
                    }),
                    t.Style && t.Style["@isDefault"] == "true" && (e.style = t.Style["ows:Identifier"] || ""),
                    ft = a(t.ResourceURL, []).filter(function(n) {
                        return n["@resourceType"] == "tile"
                    }).map(function(n) {
                        return n["@template"]
                    }));
                    k = d.call(a(y.Contents.TileMatrixSet, null), function(n) {
                        return n && n["ows:Identifier"] == e.matrixSet
                    });
                    e.matrixSet = k ? k["ows:Identifier"] : null
                }
                this.RebuildElement();
                this.UpdateElement();
                s && s.call(this)
            }
            .bind(this), DEBUG_MODE ? FBM.PROXY_LOCAL : FBM.PROXY_SERVICE2)
        }
        ;
        this.getTiles = function(n) {
            var i, t;
            if (n.handler) {
                if (i = ot(l),
                t = ct(i, new FBM.FWEnvelope(n.rl,n.rt,n.rr,n.rb)),
                !t)
                    return null;
                var u = i["ows:Identifier"]
                  , e = t.map(function(n) {
                    return ht(u, n.row, n.col)
                })
                  , r = t.map(function(n) {
                    return new FBM.FWPoint(n.left,n.top)
                });
                f.getCoordSys() == FBM.FWCoordSys.EPSG3857 && r.forEach(function(n) {
                    var t = FBM.GooToWGS84(n.x, n.y);
                    n.x = t.x;
                    n.y = t.y
                });
                n.handler.call(this, {
                    leftTopAnchor: r,
                    imageUrl: e
                })
            }
        }
        ;
        this.UpdateElement = this.RebuildElement = function() {
            function c() {
                this.ts.forEach(function(n) {
                    n.completed = !0;
                    n.img.parentNode.removeChild(n.img)
                });
                var n = p.indexOf(this);
                n >= 0 && p.splice(n, 1)
            }
            var r, t, n, u;
            if (g && w) {
                var f = l.ToMapPoint(0, 0)
                  , o = l.ToMapPoint(l.getClientWidth(), l.getClientHeight())
                  , s = ot(l)
                  , i = ct(s, new FBM.FWEnvelope(f.x,f.y,o.x,o.y));
                i && (r = s["ows:Identifier"],
                t = {
                    sid: e.matrixSet,
                    mid: r,
                    ts: []
                },
                n = p.pop(),
                n && (t.sid == n.sid && t.mid == n.mid && (t.ts = n.ts.filter(function(n) {
                    return i.some(function(t) {
                        return t.equals(n)
                    })
                }),
                n.ts = n.ts.filter(function(n) {
                    return !t.ts.some(function(t) {
                        return t.equals(n)
                    })
                }),
                i = i.filter(function(n) {
                    return !t.ts.some(function(t) {
                        return t.equals(n)
                    })
                })),
                n.ts.length > 0 && (n.ts.forEach(function(n) {
                    n.img.onload = n.img.onerror = null;
                    n.img.complete || (n.img.src = "")
                }),
                p.push(n))),
                i.length != 0 ? (u = .5,
                i.forEach(function(n) {
                    n.completed = !1;
                    n.img = document.createElement("img");
                    n.img.style.opacity = 0;
                    n.img.style.position = "absolute";
                    n.img.style.MozUserSelect = "none";
                    n.img.style.transition = "opacity " + u + "s linear 0s";
                    n.img.border = "0px";
                    n.img.galleryImg = !1;
                    n.img.hideFocus = !0;
                    n.img.onerror = function() {
                        n.completed = !0
                    }
                    ;
                    n.img.onload = function() {
                        n.completed = !0;
                        this.style.opacity = 1
                    }
                    ;
                    n.img.src = ht(r, n.row, n.col);
                    h.appendChild(n.img)
                }),
                t.ts.push.apply(t.ts, i),
                n && n.ts.length > 0 && at(function() {
                    return this.ts.every(function(n) {
                        return n.completed
                    })
                }
                .bind(t), function() {
                    setTimeout(c.bind(this), u * 1e3 + 100)
                }
                .bind(n))) : n && n.ts.length > 0 && c.call(n),
                p.push(t),
                p.forEach(function(n) {
                    n.ts.forEach(function(n) {
                        var t = l.FromMapPoint(n.left, n.top)
                          , i = l.FromMapPoint(n.right, n.bottom);
                        n.img.style.left = Math.round(t.x) + "px";
                        n.img.style.top = Math.round(t.y) + "px";
                        n.img.style.width = Math.round(i.x) - Math.round(t.x) + "px";
                        n.img.style.height = Math.round(i.y) - Math.round(t.y) + "px"
                    })
                }))
            }
        }
        ;
        f && f.addLayer && f.addLayer(this, !0)
    }
}();
/*! D:\FW_API\scripts\URI.js*/
/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.18.8
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
(function(n, t) {
    "use strict";
    typeof module == "object" && module.exports ? module.exports = t(require("./punycode"), require("./IPv6"), require("./SecondLevelDomains")) : typeof define == "function" && define.amd ? define(["./punycode", "./IPv6", "./SecondLevelDomains"], t) : n.URI = t(n.punycode, n.IPv6, n.SecondLevelDomains, n)
}
)(this, function(n, t, i, r) {
    "use strict";
    function u(n, t) {
        var i = arguments.length >= 1
          , r = arguments.length >= 2;
        if (!(this instanceof u))
            return i ? r ? new u(n,t) : new u(n) : new u;
        if (n === undefined) {
            if (i)
                throw new TypeError("undefined is not a valid argument for URI");
            n = typeof location != "undefined" ? location.href + "" : ""
        }
        if (n === null && i)
            throw new TypeError("null is not a valid argument for URI");
        return (this.href(n),
        t !== undefined) ? this.absoluteTo(t) : this
    }
    function s(n) {
        return n.replace(/([.*+?^=!:${}()|[\]\/\\])/g, "\\$1")
    }
    function h(n) {
        return n === undefined ? "Undefined" : String(Object.prototype.toString.call(n)).slice(8, -1)
    }
    function e(n) {
        return h(n) === "Array"
    }
    function k(n, t) {
        var r = {}, i, u, f;
        if (h(t) === "RegExp")
            r = null;
        else if (e(t))
            for (i = 0,
            u = t.length; i < u; i++)
                r[t[i]] = !0;
        else
            r[t] = !0;
        for (i = 0,
        u = n.length; i < u; i++)
            f = r && r[n[i]] !== undefined || !r && t.test(n[i]),
            f && (n.splice(i, 1),
            u--,
            i--);
        return n
    }
    function v(n, t) {
        var i, r, u;
        if (e(t)) {
            for (i = 0,
            r = t.length; i < r; i++)
                if (!v(n, t[i]))
                    return !1;
            return !0
        }
        for (u = h(t),
        i = 0,
        r = n.length; i < r; i++)
            if (u === "RegExp") {
                if (typeof n[i] == "string" && n[i].match(t))
                    return !0
            } else if (n[i] === t)
                return !0;
        return !1
    }
    function d(n, t) {
        if (!e(n) || !e(t) || n.length !== t.length)
            return !1;
        n.sort();
        t.sort();
        for (var i = 0, r = n.length; i < r; i++)
            if (n[i] !== t[i])
                return !1;
        return !0
    }
    function w(n) {
        return n.replace(/^\/+|\/+$/g, "")
    }
    function it(n) {
        return escape(n)
    }
    function b(n) {
        return encodeURIComponent(n).replace(/[!'()*]/g, it).replace(/\*/g, "%2A")
    }
    function a(n) {
        return function(t, i) {
            return t === undefined ? this._parts[n] || "" : (this._parts[n] = t || null,
            this.build(!i),
            this)
        }
    }
    function g(n, t) {
        return function(i, r) {
            return i === undefined ? this._parts[n] || "" : (i !== null && (i = i + "",
            i.charAt(0) === t && (i = i.substring(1))),
            this._parts[n] = i,
            this.build(!r),
            this)
        }
    }
    var tt = r && r.URI, f, o, y, c, p, l, nt;
    u.version = "1.18.8";
    f = u.prototype;
    o = Object.prototype.hasOwnProperty;
    u._parts = function() {
        return {
            protocol: null,
            username: null,
            password: null,
            hostname: null,
            urn: null,
            port: null,
            path: null,
            query: null,
            fragment: null,
            duplicateQueryParameters: u.duplicateQueryParameters,
            escapeQuerySpace: u.escapeQuerySpace
        }
    }
    ;
    u.duplicateQueryParameters = !1;
    u.escapeQuerySpace = !0;
    u.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;
    u.idn_expression = /[^a-z0-9\.-]/i;
    u.punycode_expression = /(xn--)/i;
    u.ip4_expression = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;
    u.ip6_expression = /^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
    u.find_uri_expression = /\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;
    u.findUri = {
        start: /\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,
        end: /[\s\r\n]|$/,
        trim: /[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,
        parens: /(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g
    };
    u.defaultPorts = {
        http: "80",
        https: "443",
        ftp: "21",
        gopher: "70",
        ws: "80",
        wss: "443"
    };
    u.invalid_hostname_characters = /[^a-zA-Z0-9\.-]/;
    u.domAttributes = {
        a: "href",
        blockquote: "cite",
        link: "href",
        base: "href",
        script: "src",
        form: "action",
        img: "src",
        area: "href",
        iframe: "src",
        embed: "src",
        source: "src",
        track: "src",
        input: "src",
        audio: "src",
        video: "src"
    };
    u.getDomAttribute = function(n) {
        if (!n || !n.nodeName)
            return undefined;
        var t = n.nodeName.toLowerCase();
        return t === "input" && n.type !== "image" ? undefined : u.domAttributes[t]
    }
    ;
    u.encode = b;
    u.decode = decodeURIComponent;
    u.iso8859 = function() {
        u.encode = escape;
        u.decode = unescape
    }
    ;
    u.unicode = function() {
        u.encode = b;
        u.decode = decodeURIComponent
    }
    ;
    u.characters = {
        pathname: {
            encode: {
                expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,
                map: {
                    "%24": "$",
                    "%26": "&",
                    "%2B": "+",
                    "%2C": ",",
                    "%3B": ";",
                    "%3D": "=",
                    "%3A": ":",
                    "%40": "@"
                }
            },
            decode: {
                expression: /[\/\?#]/g,
                map: {
                    "/": "%2F",
                    "?": "%3F",
                    "#": "%23"
                }
            }
        },
        reserved: {
            encode: {
                expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,
                map: {
                    "%3A": ":",
                    "%2F": "/",
                    "%3F": "?",
                    "%23": "#",
                    "%5B": "[",
                    "%5D": "]",
                    "%40": "@",
                    "%21": "!",
                    "%24": "$",
                    "%26": "&",
                    "%27": "'",
                    "%28": "(",
                    "%29": ")",
                    "%2A": "*",
                    "%2B": "+",
                    "%2C": ",",
                    "%3B": ";",
                    "%3D": "="
                }
            }
        },
        urnpath: {
            encode: {
                expression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,
                map: {
                    "%21": "!",
                    "%24": "$",
                    "%27": "'",
                    "%28": "(",
                    "%29": ")",
                    "%2A": "*",
                    "%2B": "+",
                    "%2C": ",",
                    "%3B": ";",
                    "%3D": "=",
                    "%40": "@"
                }
            },
            decode: {
                expression: /[\/\?#:]/g,
                map: {
                    "/": "%2F",
                    "?": "%3F",
                    "#": "%23",
                    ":": "%3A"
                }
            }
        }
    };
    u.encodeQuery = function(n, t) {
        var i = u.encode(n + "");
        return t === undefined && (t = u.escapeQuerySpace),
        t ? i.replace(/%20/g, "+") : i
    }
    ;
    u.decodeQuery = function(n, t) {
        n += "";
        t === undefined && (t = u.escapeQuerySpace);
        try {
            return u.decode(t ? n.replace(/\+/g, "%20") : n)
        } catch (i) {
            return n
        }
    }
    ;
    y = {
        encode: "encode",
        decode: "decode"
    };
    p = function(n, t) {
        return function(i) {
            try {
                return u[t](i + "").replace(u.characters[n][t].expression, function(i) {
                    return u.characters[n][t].map[i]
                })
            } catch (r) {
                return i
            }
        }
    }
    ;
    for (c in y)
        u[c + "PathSegment"] = p("pathname", y[c]),
        u[c + "UrnPathSegment"] = p("urnpath", y[c]);
    l = function(n, t, i) {
        return function(r) {
            var o, f, e, s;
            for (o = i ? function(n) {
                return u[t](u[i](n))
            }
            : u[t],
            f = (r + "").split(n),
            e = 0,
            s = f.length; e < s; e++)
                f[e] = o(f[e]);
            return f.join(n)
        }
    }
    ;
    u.decodePath = l("/", "decodePathSegment");
    u.decodeUrnPath = l(":", "decodeUrnPathSegment");
    u.recodePath = l("/", "encodePathSegment", "decode");
    u.recodeUrnPath = l(":", "encodeUrnPathSegment", "decode");
    u.encodeReserved = p("reserved", "encode");
    u.parse = function(n, t) {
        var i;
        return t || (t = {}),
        i = n.indexOf("#"),
        i > -1 && (t.fragment = n.substring(i + 1) || null,
        n = n.substring(0, i)),
        i = n.indexOf("?"),
        i > -1 && (t.query = n.substring(i + 1) || null,
        n = n.substring(0, i)),
        n.substring(0, 2) === "//" ? (t.protocol = null,
        n = n.substring(2),
        n = u.parseAuthority(n, t)) : (i = n.indexOf(":"),
        i > -1 && (t.protocol = n.substring(0, i) || null,
        t.protocol && !t.protocol.match(u.protocol_expression) ? t.protocol = undefined : n.substring(i + 1, i + 3) === "//" ? (n = n.substring(i + 3),
        n = u.parseAuthority(n, t)) : (n = n.substring(i + 1),
        t.urn = !0))),
        t.path = n,
        t
    }
    ;
    u.parseHost = function(n, t) {
        var i, r, u;
        if (n = n.replace(/\\/g, "/"),
        i = n.indexOf("/"),
        i === -1 && (i = n.length),
        n.charAt(0) === "[")
            r = n.indexOf("]"),
            t.hostname = n.substring(1, r) || null,
            t.port = n.substring(r + 2, i) || null,
            t.port === "/" && (t.port = null);
        else {
            var o = n.indexOf(":")
              , f = n.indexOf("/")
              , e = n.indexOf(":", o + 1);
            e !== -1 && (f === -1 || e < f) ? (t.hostname = n.substring(0, i) || null,
            t.port = null) : (u = n.substring(0, i).split(":"),
            t.hostname = u[0] || null,
            t.port = u[1] || null)
        }
        return t.hostname && n.substring(i).charAt(0) !== "/" && (i++,
        n = "/" + n),
        n.substring(i) || "/"
    }
    ;
    u.parseAuthority = function(n, t) {
        return n = u.parseUserinfo(n, t),
        u.parseHost(n, t)
    }
    ;
    u.parseUserinfo = function(n, t) {
        var r = n.indexOf("/"), f = n.lastIndexOf("@", r > -1 ? r : n.length - 1), i;
        return f > -1 && (r === -1 || f < r) ? (i = n.substring(0, f).split(":"),
        t.username = i[0] ? u.decode(i[0]) : null,
        i.shift(),
        t.password = i[0] ? u.decode(i.join(":")) : null,
        n = n.substring(f + 1)) : (t.username = null,
        t.password = null),
        n
    }
    ;
    u.parseQuery = function(n, t) {
        var e;
        if (!n)
            return {};
        if (n = n.replace(/&+/g, "&").replace(/^\?*&*|&+$/g, ""),
        !n)
            return {};
        var i = {}, h = n.split("&"), c = h.length, f, r, s;
        for (e = 0; e < c; e++)
            f = h[e].split("="),
            r = u.decodeQuery(f.shift(), t),
            s = f.length ? u.decodeQuery(f.join("="), t) : null,
            o.call(i, r) ? ((typeof i[r] == "string" || i[r] === null) && (i[r] = [i[r]]),
            i[r].push(s)) : i[r] = s;
        return i
    }
    ;
    u.build = function(n) {
        var t = "";
        return n.protocol && (t += n.protocol + ":"),
        !n.urn && (t || n.hostname) && (t += "//"),
        t += u.buildAuthority(n) || "",
        typeof n.path == "string" && (n.path.charAt(0) !== "/" && typeof n.hostname == "string" && (t += "/"),
        t += n.path),
        typeof n.query == "string" && n.query && (t += "?" + n.query),
        typeof n.fragment == "string" && n.fragment && (t += "#" + n.fragment),
        t
    }
    ;
    u.buildHost = function(n) {
        var t = "";
        if (n.hostname)
            t += u.ip6_expression.test(n.hostname) ? "[" + n.hostname + "]" : n.hostname;
        else
            return "";
        return n.port && (t += ":" + n.port),
        t
    }
    ;
    u.buildAuthority = function(n) {
        return u.buildUserinfo(n) + u.buildHost(n)
    }
    ;
    u.buildUserinfo = function(n) {
        var t = "";
        return n.username && (t += u.encode(n.username)),
        n.password && (t += ":" + u.encode(n.password)),
        t && (t += "@"),
        t
    }
    ;
    u.buildQuery = function(n, t, i) {
        var s = "", h, r, f, c;
        for (r in n)
            if (o.call(n, r) && r)
                if (e(n[r]))
                    for (h = {},
                    f = 0,
                    c = n[r].length; f < c; f++)
                        n[r][f] !== undefined && h[n[r][f] + ""] === undefined && (s += "&" + u.buildQueryParameter(r, n[r][f], i),
                        t !== !0 && (h[n[r][f] + ""] = !0));
                else
                    n[r] !== undefined && (s += "&" + u.buildQueryParameter(r, n[r], i));
        return s.substring(1)
    }
    ;
    u.buildQueryParameter = function(n, t, i) {
        return u.encodeQuery(n, i) + (t !== null ? "=" + u.encodeQuery(t, i) : "")
    }
    ;
    u.addQuery = function(n, t, i) {
        if (typeof t == "object")
            for (var r in t)
                o.call(t, r) && u.addQuery(n, r, t[r]);
        else if (typeof t == "string") {
            if (n[t] === undefined) {
                n[t] = i;
                return
            }
            typeof n[t] == "string" && (n[t] = [n[t]]);
            e(i) || (i = [i]);
            n[t] = (n[t] || []).concat(i)
        } else
            throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");
    }
    ;
    u.removeQuery = function(n, t, i) {
        var f, s, r;
        if (e(t))
            for (f = 0,
            s = t.length; f < s; f++)
                n[t[f]] = undefined;
        else if (h(t) === "RegExp")
            for (r in n)
                t.test(r) && (n[r] = undefined);
        else if (typeof t == "object")
            for (r in t)
                o.call(t, r) && u.removeQuery(n, r, t[r]);
        else if (typeof t == "string")
            i !== undefined ? h(i) === "RegExp" ? n[t] = !e(n[t]) && i.test(n[t]) ? undefined : k(n[t], i) : n[t] !== String(i) || e(i) && i.length !== 1 ? e(n[t]) && (n[t] = k(n[t], i)) : n[t] = undefined : n[t] = undefined;
        else
            throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");
    }
    ;
    u.hasQuery = function(n, t, i, r) {
        var f, s, c, l;
        switch (h(t)) {
        case "String":
            break;
        case "RegExp":
            for (f in n)
                if (o.call(n, f) && t.test(f) && (i === undefined || u.hasQuery(n, f, i)))
                    return !0;
            return !1;
        case "Object":
            for (s in t)
                if (o.call(t, s) && !u.hasQuery(n, s, t[s]))
                    return !1;
            return !0;
        default:
            throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter");
        }
        switch (h(i)) {
        case "Undefined":
            return t in n;
        case "Boolean":
            return c = Boolean(e(n[t]) ? n[t].length : n[t]),
            i === c;
        case "Function":
            return !!i(n[t], t, n);
        case "Array":
            return e(n[t]) ? (l = r ? v : d,
            l(n[t], i)) : !1;
        case "RegExp":
            return e(n[t]) ? r ? v(n[t], i) : !1 : Boolean(n[t] && n[t].match(i));
        case "Number":
            i = String(i);
        case "String":
            return e(n[t]) ? r ? v(n[t], i) : !1 : n[t] === i;
        default:
            throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter");
        }
    }
    ;
    u.joinPaths = function() {
        for (var o, t, n, i, r = [], f = [], s = 0, e = 0; e < arguments.length; e++)
            for (o = new u(arguments[e]),
            r.push(o),
            t = o.segment(),
            n = 0; n < t.length; n++)
                typeof t[n] == "string" && f.push(t[n]),
                t[n] && s++;
        return !f.length || !s ? new u("") : (i = new u("").segment(f),
        (r[0].path() === "" || r[0].path().slice(0, 1) === "/") && i.path("/" + i.path()),
        i.normalize())
    }
    ;
    u.commonPath = function(n, t) {
        for (var r = Math.min(n.length, t.length), i = 0; i < r; i++)
            if (n.charAt(i) !== t.charAt(i)) {
                i--;
                break
            }
        return i < 1 ? n.charAt(0) === t.charAt(0) && n.charAt(0) === "/" ? "/" : "" : ((n.charAt(i) !== "/" || t.charAt(i) !== "/") && (i = n.substring(0, i).lastIndexOf("/")),
        n.substring(0, i + 1))
    }
    ;
    u.withinString = function(n, t, i) {
        var c, r, a, l, y, e;
        i || (i = {});
        var o = i.start || u.findUri.start
          , p = i.end || u.findUri.end
          , v = i.trim || u.findUri.trim
          , w = i.parens || u.findUri.parens;
        for (o.lastIndex = 0; ; ) {
            if (c = o.exec(n),
            !c)
                break;
            if (r = c.index,
            !i.ignoreHtml || (a = n.slice(Math.max(r - 3, 0), r),
            !a || !/[a-z0-9-]=["']?$/i.test(a))) {
                for (var s = r + n.slice(r).search(p), f = n.slice(r, s), h = -1; ; ) {
                    if (l = w.exec(f),
                    !l)
                        break;
                    y = l.index + l[0].length;
                    h = Math.max(h, y)
                }
                if ((f = h > -1 ? f.slice(0, h) + f.slice(h).replace(v, "") : f.replace(v, ""),
                !(f.length <= c[0].length)) && (!i.ignore || !i.ignore.test(f))) {
                    if (s = r + f.length,
                    e = t(f, r, s, n),
                    e === undefined) {
                        o.lastIndex = s;
                        continue
                    }
                    e = String(e);
                    n = n.slice(0, r) + e + n.slice(s);
                    o.lastIndex = r + e.length
                }
            }
        }
        return o.lastIndex = 0,
        n
    }
    ;
    u.ensureValidHostname = function(t) {
        if (t.match(u.invalid_hostname_characters)) {
            if (!n)
                throw new TypeError('Hostname "' + t + '" contains characters other than [A-Z0-9.-] and Punycode.js is not available');
            if (n.toASCII(t).match(u.invalid_hostname_characters))
                throw new TypeError('Hostname "' + t + '" contains characters other than [A-Z0-9.-]');
        }
    }
    ;
    u.noConflict = function(n) {
        if (n) {
            var t = {
                URI: this.noConflict()
            };
            return r.URITemplate && typeof r.URITemplate.noConflict == "function" && (t.URITemplate = r.URITemplate.noConflict()),
            r.IPv6 && typeof r.IPv6.noConflict == "function" && (t.IPv6 = r.IPv6.noConflict()),
            r.SecondLevelDomains && typeof r.SecondLevelDomains.noConflict == "function" && (t.SecondLevelDomains = r.SecondLevelDomains.noConflict()),
            t
        }
        return r.URI === this && (r.URI = tt),
        this
    }
    ;
    f.build = function(n) {
        return n === !0 ? this._deferred_build = !0 : (n === undefined || this._deferred_build) && (this._string = u.build(this._parts),
        this._deferred_build = !1),
        this
    }
    ;
    f.clone = function() {
        return new u(this)
    }
    ;
    f.valueOf = f.toString = function() {
        return this.build(!1)._string
    }
    ;
    f.protocol = a("protocol");
    f.username = a("username");
    f.password = a("password");
    f.hostname = a("hostname");
    f.port = a("port");
    f.query = g("query", "?");
    f.fragment = g("fragment", "#");
    f.search = function(n, t) {
        var i = this.query(n, t);
        return typeof i == "string" && i.length ? "?" + i : i
    }
    ;
    f.hash = function(n, t) {
        var i = this.fragment(n, t);
        return typeof i == "string" && i.length ? "#" + i : i
    }
    ;
    f.pathname = function(n, t) {
        if (n === undefined || n === !0) {
            var i = this._parts.path || (this._parts.hostname ? "/" : "");
            return n ? (this._parts.urn ? u.decodeUrnPath : u.decodePath)(i) : i
        }
        return this._parts.path = this._parts.urn ? n ? u.recodeUrnPath(n) : "" : n ? u.recodePath(n) : "/",
        this.build(!t),
        this
    }
    ;
    f.path = f.pathname;
    f.href = function(n, t) {
        var i, r, f, s, e;
        if (n === undefined)
            return this.toString();
        if (this._string = "",
        this._parts = u._parts(),
        r = n instanceof u,
        f = typeof n == "object" && (n.hostname || n.path || n.pathname),
        n.nodeName && (s = u.getDomAttribute(n),
        n = n[s] || "",
        f = !1),
        !r && f && n.pathname !== undefined && (n = n.toString()),
        typeof n == "string" || n instanceof String)
            this._parts = u.parse(String(n), this._parts);
        else if (r || f) {
            e = r ? n._parts : n;
            for (i in e)
                o.call(this._parts, i) && (this._parts[i] = e[i])
        } else
            throw new TypeError("invalid input");
        return this.build(!t),
        this
    }
    ;
    f.is = function(n) {
        var r = !1
          , f = !1
          , e = !1
          , t = !1
          , s = !1
          , h = !1
          , c = !1
          , o = !this._parts.urn;
        this._parts.hostname && (o = !1,
        f = u.ip4_expression.test(this._parts.hostname),
        e = u.ip6_expression.test(this._parts.hostname),
        r = f || e,
        t = !r,
        s = t && i && i.has(this._parts.hostname),
        h = t && u.idn_expression.test(this._parts.hostname),
        c = t && u.punycode_expression.test(this._parts.hostname));
        switch (n.toLowerCase()) {
        case "relative":
            return o;
        case "absolute":
            return !o;
        case "domain":
        case "name":
            return t;
        case "sld":
            return s;
        case "ip":
            return r;
        case "ip4":
        case "ipv4":
        case "inet4":
            return f;
        case "ip6":
        case "ipv6":
        case "inet6":
            return e;
        case "idn":
            return h;
        case "url":
            return !this._parts.urn;
        case "urn":
            return !!this._parts.urn;
        case "punycode":
            return c
        }
        return null
    }
    ;
    var rt = f.protocol
      , ut = f.port
      , ft = f.hostname;
    return f.protocol = function(n, t) {
        if (n !== undefined && n && (n = n.replace(/:(\/\/)?$/, ""),
        !n.match(u.protocol_expression)))
            throw new TypeError('Protocol "' + n + "\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");
        return rt.call(this, n, t)
    }
    ,
    f.scheme = f.protocol,
    f.port = function(n, t) {
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n !== undefined && (n === 0 && (n = null),
        n && (n += "",
        n.charAt(0) === ":" && (n = n.substring(1)),
        n.match(/[^0-9]/))))
            throw new TypeError('Port "' + n + '" contains characters other than [0-9]');
        return ut.call(this, n, t)
    }
    ,
    f.hostname = function(n, t) {
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n !== undefined) {
            var i = {}
              , r = u.parseHost(n, i);
            if (r !== "/")
                throw new TypeError('Hostname "' + n + '" contains characters other than [A-Z0-9.-]');
            n = i.hostname
        }
        return ft.call(this, n, t)
    }
    ,
    f.origin = function(n, t) {
        var i, f, r;
        return this._parts.urn ? n === undefined ? "" : this : n === undefined ? (i = this.protocol(),
        f = this.authority(),
        !f) ? "" : (i ? i + "://" : "") + this.authority() : (r = u(n),
        this.protocol(r.protocol()).authority(r.authority()).build(!t),
        this)
    }
    ,
    f.host = function(n, t) {
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined)
            return this._parts.hostname ? u.buildHost(this._parts) : "";
        var i = u.parseHost(n, this._parts);
        if (i !== "/")
            throw new TypeError('Hostname "' + n + '" contains characters other than [A-Z0-9.-]');
        return this.build(!t),
        this
    }
    ,
    f.authority = function(n, t) {
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined)
            return this._parts.hostname ? u.buildAuthority(this._parts) : "";
        var i = u.parseAuthority(n, this._parts);
        if (i !== "/")
            throw new TypeError('Hostname "' + n + '" contains characters other than [A-Z0-9.-]');
        return this.build(!t),
        this
    }
    ,
    f.userinfo = function(n, t) {
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined) {
            var i = u.buildUserinfo(this._parts);
            return i ? i.substring(0, i.length - 1) : i
        }
        return n[n.length - 1] !== "@" && (n += "@"),
        u.parseUserinfo(n, this._parts),
        this.build(!t),
        this
    }
    ,
    f.resource = function(n, t) {
        var i;
        return n === undefined ? this.path() + this.search() + this.hash() : (i = u.parse(n),
        this._parts.path = i.path,
        this._parts.query = i.query,
        this._parts.fragment = i.fragment,
        this.build(!t),
        this)
    }
    ,
    f.subdomain = function(n, t) {
        var i;
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined)
            return !this._parts.hostname || this.is("IP") ? "" : (i = this._parts.hostname.length - this.domain().length - 1,
            this._parts.hostname.substring(0, i) || "");
        var r = this._parts.hostname.length - this.domain().length
          , f = this._parts.hostname.substring(0, r)
          , e = new RegExp("^" + s(f));
        return n && n.charAt(n.length - 1) !== "." && (n += "."),
        n && u.ensureValidHostname(n),
        this._parts.hostname = this._parts.hostname.replace(e, n),
        this.build(!t),
        this
    }
    ,
    f.domain = function(n, t) {
        var r, i, f;
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (typeof n == "boolean" && (t = n,
        n = undefined),
        n === undefined)
            return !this._parts.hostname || this.is("IP") ? "" : (r = this._parts.hostname.match(/\./g),
            r && r.length < 2) ? this._parts.hostname : (i = this._parts.hostname.length - this.tld(t).length - 1,
            i = this._parts.hostname.lastIndexOf(".", i - 1) + 1,
            this._parts.hostname.substring(i) || "");
        if (!n)
            throw new TypeError("cannot set domain empty");
        return u.ensureValidHostname(n),
        !this._parts.hostname || this.is("IP") ? this._parts.hostname = n : (f = new RegExp(s(this.domain()) + "$"),
        this._parts.hostname = this._parts.hostname.replace(f, n)),
        this.build(!t),
        this
    }
    ,
    f.tld = function(n, t) {
        var f, r, u;
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (typeof n == "boolean" && (t = n,
        n = undefined),
        n === undefined)
            return !this._parts.hostname || this.is("IP") ? "" : (f = this._parts.hostname.lastIndexOf("."),
            r = this._parts.hostname.substring(f + 1),
            t !== !0 && i && i.list[r.toLowerCase()]) ? i.get(this._parts.hostname) || r : r;
        if (n)
            if (n.match(/[^a-zA-Z0-9-]/))
                if (i && i.is(n))
                    u = new RegExp(s(this.tld()) + "$"),
                    this._parts.hostname = this._parts.hostname.replace(u, n);
                else
                    throw new TypeError('TLD "' + n + '" contains characters other than [A-Z0-9]');
            else if (!this._parts.hostname || this.is("IP"))
                throw new ReferenceError("cannot set TLD on non-domain host");
            else
                u = new RegExp(s(this.tld()) + "$"),
                this._parts.hostname = this._parts.hostname.replace(u, n);
        else
            throw new TypeError("cannot set TLD empty");
        return this.build(!t),
        this
    }
    ,
    f.directory = function(n, t) {
        var r, i;
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined || n === !0)
            return !this._parts.path && !this._parts.hostname ? "" : this._parts.path === "/" ? "/" : (r = this._parts.path.length - this.filename().length - 1,
            i = this._parts.path.substring(0, r) || (this._parts.hostname ? "/" : ""),
            n ? u.decodePath(i) : i);
        var f = this._parts.path.length - this.filename().length
          , e = this._parts.path.substring(0, f)
          , o = new RegExp("^" + s(e));
        return this.is("relative") || (n || (n = "/"),
        n.charAt(0) !== "/" && (n = "/" + n)),
        n && n.charAt(n.length - 1) !== "/" && (n += "/"),
        n = u.recodePath(n),
        this._parts.path = this._parts.path.replace(o, n),
        this.build(!t),
        this
    }
    ,
    f.filename = function(n, t) {
        var f, i, r, e;
        return this._parts.urn ? n === undefined ? "" : this : typeof n != "string" ? !this._parts.path || this._parts.path === "/" ? "" : (f = this._parts.path.lastIndexOf("/"),
        i = this._parts.path.substring(f + 1),
        n ? u.decodePathSegment(i) : i) : (r = !1,
        n.charAt(0) === "/" && (n = n.substring(1)),
        n.match(/\.?\//) && (r = !0),
        e = new RegExp(s(this.filename()) + "$"),
        n = u.recodePath(n),
        this._parts.path = this._parts.path.replace(e, n),
        r ? this.normalizePath(t) : this.build(!t),
        this)
    }
    ,
    f.suffix = function(n, t) {
        var r, f, e, o, i, h;
        if (this._parts.urn)
            return n === undefined ? "" : this;
        if (n === undefined || n === !0)
            return !this._parts.path || this._parts.path === "/" ? "" : (r = this.filename(),
            f = r.lastIndexOf("."),
            f === -1) ? "" : (e = r.substring(f + 1),
            o = /^[a-z0-9%]+$/i.test(e) ? e : "",
            n ? u.decodePathSegment(o) : o);
        if (n.charAt(0) === "." && (n = n.substring(1)),
        i = this.suffix(),
        i)
            h = n ? new RegExp(s(i) + "$") : new RegExp(s("." + i) + "$");
        else {
            if (!n)
                return this;
            this._parts.path += "." + u.recodePath(n)
        }
        return h && (n = u.recodePath(n),
        this._parts.path = this._parts.path.replace(h, n)),
        this.build(!t),
        this
    }
    ,
    f.segment = function(n, t, i) {
        var f = this._parts.urn ? ":" : "/", o = this.path(), s = o.substring(0, 1) === "/", r = o.split(f), u, h;
        if (n !== undefined && typeof n != "number" && (i = t,
        t = n,
        n = undefined),
        n !== undefined && typeof n != "number")
            throw new Error('Bad segment "' + n + '", must be 0-based integer');
        if (s && r.shift(),
        n < 0 && (n = Math.max(r.length + n, 0)),
        t === undefined)
            return n === undefined ? r : r[n];
        if (n === null || r[n] === undefined)
            if (e(t))
                for (r = [],
                u = 0,
                h = t.length; u < h; u++)
                    (t[u].length || r.length && r[r.length - 1].length) && (r.length && !r[r.length - 1].length && r.pop(),
                    r.push(w(t[u])));
            else
                (t || typeof t == "string") && (t = w(t),
                r[r.length - 1] === "" ? r[r.length - 1] = t : r.push(t));
        else
            t ? r[n] = w(t) : r.splice(n, 1);
        return s && r.unshift(""),
        this.path(r.join(f), i)
    }
    ,
    f.segmentCoded = function(n, t, i) {
        var f, r, o;
        if (typeof n != "number" && (i = t,
        t = n,
        n = undefined),
        t === undefined) {
            if (f = this.segment(n, t, i),
            e(f))
                for (r = 0,
                o = f.length; r < o; r++)
                    f[r] = u.decode(f[r]);
            else
                f = f !== undefined ? u.decode(f) : undefined;
            return f
        }
        if (e(t))
            for (r = 0,
            o = t.length; r < o; r++)
                t[r] = u.encode(t[r]);
        else
            t = typeof t == "string" || t instanceof String ? u.encode(t) : t;
        return this.segment(n, t, i)
    }
    ,
    nt = f.query,
    f.query = function(n, t) {
        if (n === !0)
            return u.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
        if (typeof n == "function") {
            var i = u.parseQuery(this._parts.query, this._parts.escapeQuerySpace)
              , r = n.call(this, i);
            return this._parts.query = u.buildQuery(r || i, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace),
            this.build(!t),
            this
        }
        return n !== undefined && typeof n != "string" ? (this._parts.query = u.buildQuery(n, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace),
        this.build(!t),
        this) : nt.call(this, n, t)
    }
    ,
    f.setQuery = function(n, t, i) {
        var f = u.parseQuery(this._parts.query, this._parts.escapeQuerySpace), r;
        if (typeof n == "string" || n instanceof String)
            f[n] = t !== undefined ? t : null;
        else if (typeof n == "object")
            for (r in n)
                o.call(n, r) && (f[r] = n[r]);
        else
            throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");
        return this._parts.query = u.buildQuery(f, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace),
        typeof n != "string" && (i = t),
        this.build(!i),
        this
    }
    ,
    f.addQuery = function(n, t, i) {
        var r = u.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
        return u.addQuery(r, n, t === undefined ? null : t),
        this._parts.query = u.buildQuery(r, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace),
        typeof n != "string" && (i = t),
        this.build(!i),
        this
    }
    ,
    f.removeQuery = function(n, t, i) {
        var r = u.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
        return u.removeQuery(r, n, t),
        this._parts.query = u.buildQuery(r, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace),
        typeof n != "string" && (i = t),
        this.build(!i),
        this
    }
    ,
    f.hasQuery = function(n, t, i) {
        var r = u.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
        return u.hasQuery(r, n, t, i)
    }
    ,
    f.setSearch = f.setQuery,
    f.addSearch = f.addQuery,
    f.removeSearch = f.removeQuery,
    f.hasSearch = f.hasQuery,
    f.normalize = function() {
        return this._parts.urn ? this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build() : this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()
    }
    ,
    f.normalizeProtocol = function(n) {
        return typeof this._parts.protocol == "string" && (this._parts.protocol = this._parts.protocol.toLowerCase(),
        this.build(!n)),
        this
    }
    ,
    f.normalizeHostname = function(i) {
        return this._parts.hostname && (this.is("IDN") && n ? this._parts.hostname = n.toASCII(this._parts.hostname) : this.is("IPv6") && t && (this._parts.hostname = t.best(this._parts.hostname)),
        this._parts.hostname = this._parts.hostname.toLowerCase(),
        this.build(!i)),
        this
    }
    ,
    f.normalizePort = function(n) {
        return typeof this._parts.protocol == "string" && this._parts.port === u.defaultPorts[this._parts.protocol] && (this._parts.port = null,
        this.build(!n)),
        this
    }
    ,
    f.normalizePath = function(n) {
        var t = this._parts.path, e, i, r, f;
        if (!t)
            return this;
        if (this._parts.urn)
            return this._parts.path = u.recodeUrnPath(this._parts.path),
            this.build(!n),
            this;
        if (this._parts.path === "/")
            return this;
        for (t = u.recodePath(t),
        i = "",
        t.charAt(0) !== "/" && (e = !0,
        t = "/" + t),
        (t.slice(-3) === "/.." || t.slice(-2) === "/.") && (t += "/"),
        t = t.replace(/(\/(\.\/)+)|(\/\.$)/g, "/").replace(/\/{2,}/g, "/"),
        e && (i = t.substring(1).match(/^(\.\.\/)+/) || "",
        i && (i = i[0])); ; ) {
            if (r = t.search(/\/\.\.(\/|$)/),
            r === -1)
                break;
            else if (r === 0) {
                t = t.substring(3);
                continue
            }
            f = t.substring(0, r).lastIndexOf("/");
            f === -1 && (f = r);
            t = t.substring(0, f) + t.substring(r + 3)
        }
        return e && this.is("relative") && (t = i + t.substring(1)),
        this._parts.path = t,
        this.build(!n),
        this
    }
    ,
    f.normalizePathname = f.normalizePath,
    f.normalizeQuery = function(n) {
        return typeof this._parts.query == "string" && (this._parts.query.length ? this.query(u.parseQuery(this._parts.query, this._parts.escapeQuerySpace)) : this._parts.query = null,
        this.build(!n)),
        this
    }
    ,
    f.normalizeFragment = function(n) {
        return this._parts.fragment || (this._parts.fragment = null,
        this.build(!n)),
        this
    }
    ,
    f.normalizeSearch = f.normalizeQuery,
    f.normalizeHash = f.normalizeFragment,
    f.iso8859 = function() {
        var n = u.encode
          , t = u.decode;
        u.encode = escape;
        u.decode = decodeURIComponent;
        try {
            this.normalize()
        } finally {
            u.encode = n;
            u.decode = t
        }
        return this
    }
    ,
    f.unicode = function() {
        var n = u.encode
          , t = u.decode;
        u.encode = b;
        u.decode = unescape;
        try {
            this.normalize()
        } finally {
            u.encode = n;
            u.decode = t
        }
        return this
    }
    ,
    f.readable = function() {
        var t = this.clone(), i, r, f;
        if (t.username("").password("").normalize(),
        i = "",
        t._parts.protocol && (i += t._parts.protocol + "://"),
        t._parts.hostname && (t.is("punycode") && n ? (i += n.toUnicode(t._parts.hostname),
        t._parts.port && (i += ":" + t._parts.port)) : i += t.host()),
        t._parts.hostname && t._parts.path && t._parts.path.charAt(0) !== "/" && (i += "/"),
        i += t.path(!0),
        t._parts.query) {
            r = "";
            for (var e = 0, o = t._parts.query.split("&"), s = o.length; e < s; e++)
                f = (o[e] || "").split("="),
                r += "&" + u.decodeQuery(f[0], this._parts.escapeQuerySpace).replace(/&/g, "%26"),
                f[1] !== undefined && (r += "=" + u.decodeQuery(f[1], this._parts.escapeQuerySpace).replace(/&/g, "%26"));
            i += "?" + r.substring(1)
        }
        return i + u.decodeQuery(t.hash(), !0)
    }
    ,
    f.absoluteTo = function(n) {
        var t = this.clone(), e = ["protocol", "username", "password", "hostname", "port"], i, r, f;
        if (this._parts.urn)
            throw new Error("URNs do not have any generally defined hierarchical components");
        if ((n instanceof u || (n = new u(n)),
        t._parts.protocol) || (t._parts.protocol = n._parts.protocol,
        this._parts.hostname))
            return t;
        for (r = 0; f = e[r]; r++)
            t._parts[f] = n._parts[f];
        return t._parts.path ? (t._parts.path.substring(-2) === ".." && (t._parts.path += "/"),
        t.path().charAt(0) !== "/" && (i = n.directory(),
        i = i ? i : n.path().indexOf("/") === 0 ? "/" : "",
        t._parts.path = (i ? i + "/" : "") + t._parts.path,
        t.normalizePath())) : (t._parts.path = n._parts.path,
        t._parts.query || (t._parts.query = n._parts.query)),
        t.build(),
        t
    }
    ,
    f.relativeTo = function(n) {
        var i = this.clone().normalize(), t, r, f, e, o, s;
        if (i._parts.urn)
            throw new Error("URNs do not have any generally defined hierarchical components");
        if (n = new u(n).normalize(),
        t = i._parts,
        r = n._parts,
        e = i.path(),
        o = n.path(),
        e.charAt(0) !== "/")
            throw new Error("URI is already relative");
        if (o.charAt(0) !== "/")
            throw new Error("Cannot calculate a URI relative to another relative URI");
        if ((t.protocol === r.protocol && (t.protocol = null),
        t.username !== r.username || t.password !== r.password) || t.protocol !== null || t.username !== null || t.password !== null)
            return i.build();
        if (t.hostname === r.hostname && t.port === r.port)
            t.hostname = null,
            t.port = null;
        else
            return i.build();
        return e === o ? (t.path = "",
        i.build()) : (f = u.commonPath(e, o),
        !f) ? i.build() : (s = r.path.substring(f.length).replace(/[^\/]*$/, "").replace(/.*?\//g, "../"),
        t.path = s + t.path.substring(f.length) || "./",
        i.build())
    }
    ,
    f.equals = function(n) {
        var r = this.clone(), f = new u(n), i = {}, s = {}, l = {}, h, c, t;
        if (r.normalize(),
        f.normalize(),
        r.toString() === f.toString())
            return !0;
        if ((h = r.query(),
        c = f.query(),
        r.query(""),
        f.query(""),
        r.toString() !== f.toString()) || h.length !== c.length)
            return !1;
        i = u.parseQuery(h, this._parts.escapeQuerySpace);
        s = u.parseQuery(c, this._parts.escapeQuerySpace);
        for (t in i)
            if (o.call(i, t)) {
                if (e(i[t])) {
                    if (!d(i[t], s[t]))
                        return !1
                } else if (i[t] !== s[t])
                    return !1;
                l[t] = !0
            }
        for (t in s)
            if (o.call(s, t) && !l[t])
                return !1;
        return !0
    }
    ,
    f.duplicateQueryParameters = function(n) {
        return this._parts.duplicateQueryParameters = !!n,
        this
    }
    ,
    f.escapeQuerySpace = function(n) {
        return this._parts.escapeQuerySpace = !!n,
        this
    }
    ,
    u
});
/*! D:\FW_API\scripts\rgbcolor.js*/
/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
(function(n) {
    function t(n) {
        var u, f, i, r;
        this.ok = !1;
        n.charAt(0) == "#" && (n = n.substr(1, 6));
        n = n.replace(/ /g, "");
        n = n.toLowerCase();
        u = {
            aliceblue: "f0f8ff",
            antiquewhite: "faebd7",
            aqua: "00ffff",
            aquamarine: "7fffd4",
            azure: "f0ffff",
            beige: "f5f5dc",
            bisque: "ffe4c4",
            black: "000000",
            blanchedalmond: "ffebcd",
            blue: "0000ff",
            blueviolet: "8a2be2",
            brown: "a52a2a",
            burlywood: "deb887",
            cadetblue: "5f9ea0",
            chartreuse: "7fff00",
            chocolate: "d2691e",
            coral: "ff7f50",
            cornflowerblue: "6495ed",
            cornsilk: "fff8dc",
            crimson: "dc143c",
            cyan: "00ffff",
            darkblue: "00008b",
            darkcyan: "008b8b",
            darkgoldenrod: "b8860b",
            darkgray: "a9a9a9",
            darkgreen: "006400",
            darkkhaki: "bdb76b",
            darkmagenta: "8b008b",
            darkolivegreen: "556b2f",
            darkorange: "ff8c00",
            darkorchid: "9932cc",
            darkred: "8b0000",
            darksalmon: "e9967a",
            darkseagreen: "8fbc8f",
            darkslateblue: "483d8b",
            darkslategray: "2f4f4f",
            darkturquoise: "00ced1",
            darkviolet: "9400d3",
            deeppink: "ff1493",
            deepskyblue: "00bfff",
            dimgray: "696969",
            dodgerblue: "1e90ff",
            feldspar: "d19275",
            firebrick: "b22222",
            floralwhite: "fffaf0",
            forestgreen: "228b22",
            fuchsia: "ff00ff",
            gainsboro: "dcdcdc",
            ghostwhite: "f8f8ff",
            gold: "ffd700",
            goldenrod: "daa520",
            gray: "808080",
            green: "008000",
            greenyellow: "adff2f",
            honeydew: "f0fff0",
            hotpink: "ff69b4",
            indianred: "cd5c5c",
            indigo: "4b0082",
            ivory: "fffff0",
            khaki: "f0e68c",
            lavender: "e6e6fa",
            lavenderblush: "fff0f5",
            lawngreen: "7cfc00",
            lemonchiffon: "fffacd",
            lightblue: "add8e6",
            lightcoral: "f08080",
            lightcyan: "e0ffff",
            lightgoldenrodyellow: "fafad2",
            lightgrey: "d3d3d3",
            lightgreen: "90ee90",
            lightpink: "ffb6c1",
            lightsalmon: "ffa07a",
            lightseagreen: "20b2aa",
            lightskyblue: "87cefa",
            lightslateblue: "8470ff",
            lightslategray: "778899",
            lightsteelblue: "b0c4de",
            lightyellow: "ffffe0",
            lime: "00ff00",
            limegreen: "32cd32",
            linen: "faf0e6",
            magenta: "ff00ff",
            maroon: "800000",
            mediumaquamarine: "66cdaa",
            mediumblue: "0000cd",
            mediumorchid: "ba55d3",
            mediumpurple: "9370d8",
            mediumseagreen: "3cb371",
            mediumslateblue: "7b68ee",
            mediumspringgreen: "00fa9a",
            mediumturquoise: "48d1cc",
            mediumvioletred: "c71585",
            midnightblue: "191970",
            mintcream: "f5fffa",
            mistyrose: "ffe4e1",
            moccasin: "ffe4b5",
            navajowhite: "ffdead",
            navy: "000080",
            oldlace: "fdf5e6",
            olive: "808000",
            olivedrab: "6b8e23",
            orange: "ffa500",
            orangered: "ff4500",
            orchid: "da70d6",
            palegoldenrod: "eee8aa",
            palegreen: "98fb98",
            paleturquoise: "afeeee",
            palevioletred: "d87093",
            papayawhip: "ffefd5",
            peachpuff: "ffdab9",
            peru: "cd853f",
            pink: "ffc0cb",
            plum: "dda0dd",
            powderblue: "b0e0e6",
            purple: "800080",
            red: "ff0000",
            rosybrown: "bc8f8f",
            royalblue: "4169e1",
            saddlebrown: "8b4513",
            salmon: "fa8072",
            sandybrown: "f4a460",
            seagreen: "2e8b57",
            seashell: "fff5ee",
            sienna: "a0522d",
            silver: "c0c0c0",
            skyblue: "87ceeb",
            slateblue: "6a5acd",
            slategray: "708090",
            snow: "fffafa",
            springgreen: "00ff7f",
            steelblue: "4682b4",
            tan: "d2b48c",
            teal: "008080",
            thistle: "d8bfd8",
            tomato: "ff6347",
            turquoise: "40e0d0",
            violet: "ee82ee",
            violetred: "d02090",
            wheat: "f5deb3",
            white: "ffffff",
            whitesmoke: "f5f5f5",
            yellow: "ffff00",
            yellowgreen: "9acd32"
        };
        for (f in u)
            n == f && (n = u[f]);
        for (i = [{
            re: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,
            example: ["rgb(123, 234, 45)", "rgb(255,234,245)"],
            process: function(n) {
                return [parseInt(n[1]), parseInt(n[2]), parseInt(n[3])]
            }
        }, {
            re: /^(\w{2})(\w{2})(\w{2})$/,
            example: ["#00ff00", "336699"],
            process: function(n) {
                return [parseInt(n[1], 16), parseInt(n[2], 16), parseInt(n[3], 16)]
            }
        }, {
            re: /^(\w{1})(\w{1})(\w{1})$/,
            example: ["#fb0", "f0f"],
            process: function(n) {
                return [parseInt(n[1] + n[1], 16), parseInt(n[2] + n[2], 16), parseInt(n[3] + n[3], 16)]
            }
        }],
        r = 0; r < i.length; r++) {
            var o = i[r].re
              , s = i[r].process
              , e = o.exec(n);
            e && (channels = s(e),
            this.r = channels[0],
            this.g = channels[1],
            this.b = channels[2],
            this.ok = !0)
        }
        this.r = this.r < 0 || isNaN(this.r) ? 0 : this.r > 255 ? 255 : this.r;
        this.g = this.g < 0 || isNaN(this.g) ? 0 : this.g > 255 ? 255 : this.g;
        this.b = this.b < 0 || isNaN(this.b) ? 0 : this.b > 255 ? 255 : this.b;
        this.toRGB = function() {
            return "rgb(" + this.r + ", " + this.g + ", " + this.b + ")"
        }
        ;
        this.toHex = function() {
            var n = this.r.toString(16)
              , t = this.g.toString(16)
              , i = this.b.toString(16);
            return n.length == 1 && (n = "0" + n),
            t.length == 1 && (t = "0" + t),
            i.length == 1 && (i = "0" + i),
            "#" + n + t + i
        }
        ;
        this.getHelpXML = function() {
            for (var s, f, l, e, a, r = [], n = 0; n < i.length; n++)
                for (s = i[n].example,
                f = 0; f < s.length; f++)
                    r[r.length] = s[f];
            for (l in u)
                r[r.length] = l;
            for (e = document.createElement("ul"),
            e.setAttribute("id", "rgbcolor-examples"),
            n = 0; n < r.length; n++)
                try {
                    var h = document.createElement("li")
                      , o = new t(r[n])
                      , c = document.createElement("div");
                    c.style.cssText = "margin: 3px; border: 1px solid black; background:" + o.toHex() + "; color:" + o.toHex();
                    c.appendChild(document.createTextNode("test"));
                    a = document.createTextNode(" " + r[n] + " -> " + o.toRGB() + " -> " + o.toHex());
                    h.appendChild(c);
                    h.appendChild(a);
                    e.appendChild(h)
                } catch (v) {}
            return e
        }
    }
    typeof define != "undefined" && define.amd ? define(function() {
        return t
    }) : typeof module != "undefined" && module.exports && (module.exports = t);
    n.RGBColor = t
}
)(typeof window != "undefined" ? window : this);
/*! D:\FW_API\scripts\html2canvas.js*/
(function(n, t, i, r, u, f) {
    /*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.0.1
 */
    function lr(n, t, i, r, u) {
        return ii(n, n, i, r, t, n.defaultView.pageXOffset, n.defaultView.pageYOffset).then(function(f) {
            var e, s;
            o("Document cloned");
            e = kt + u;
            s = "[" + e + "='" + u + "']";
            n.querySelector(s).removeAttribute(e);
            var h = f.contentWindow
              , c = h.document.querySelector(s)
              , l = typeof t.onclone == "function" ? Promise.resolve(t.onclone(h.document)) : Promise.resolve(!0);
            return l.then(function() {
                return dt(c, f, t, i, r)
            })
        })
    }
    function dt(n, i, r, u, f) {
        var e = i.contentWindow
          , a = new lt(e.document)
          , v = new l(r,a)
          , c = st(n)
          , y = r.type === "view" ? u : vr(e.document)
          , p = r.type === "view" ? f : yr(e.document)
          , h = new r.renderer(y,p,v,r,t)
          , w = new s(n,h,a,v,r);
        return w.ready.then(function() {
            o("Finished rendering");
            var t;
            return t = r.type === "view" ? gt(h.canvas, {
                width: h.canvas.width,
                height: h.canvas.height,
                top: 0,
                left: 0,
                x: 0,
                y: 0
            }) : n === e.document.body || n === e.document.documentElement || r.canvas != null ? h.canvas : gt(h.canvas, {
                width: r.width != null ? r.width : c.width,
                height: r.height != null ? r.height : c.height,
                top: c.top,
                left: c.left,
                x: e.pageXOffset,
                y: e.pageYOffset
            }),
            ar(i, r),
            t
        })
    }
    function ar(n, t) {
        t.removeContainer && (n.parentNode.removeChild(n),
        o("Cleaned up container"))
    }
    function gt(n, i) {
        var f = t.createElement("canvas")
          , r = Math.min(n.width - 1, Math.max(0, i.left))
          , e = Math.min(n.width, Math.max(1, i.left + i.width))
          , u = Math.min(n.height - 1, Math.max(0, i.top))
          , s = Math.min(n.height, Math.max(1, i.top + i.height));
        return f.width = i.width,
        f.height = i.height,
        o("Cropping canvas at:", "left:", i.left, "top:", i.top, "width:", e - r, "height:", s - u),
        o("Resulting crop with width", i.width, "and height", i.height, " with x", r, "and y", u),
        f.getContext("2d").drawImage(n, r, u, e - r, s - u, i.x, i.y, e - r, s - u),
        f
    }
    function vr(n) {
        return Math.max(Math.max(n.body.scrollWidth, n.documentElement.scrollWidth), Math.max(n.body.offsetWidth, n.documentElement.offsetWidth), Math.max(n.body.clientWidth, n.documentElement.clientWidth))
    }
    function yr(n) {
        return Math.max(Math.max(n.body.scrollHeight, n.documentElement.scrollHeight), Math.max(n.body.offsetHeight, n.documentElement.offsetHeight), Math.max(n.body.clientHeight, n.documentElement.clientHeight))
    }
    function ni() {
        return "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
    }
    function pr() {
        return t.documentMode && t.documentMode <= 9
    }
    function ti(n, i) {
        for (var u = n.nodeType === 3 ? t.createTextNode(n.nodeValue) : n.cloneNode(!1), r = n.firstChild; r; )
            (i === !0 || r.nodeType !== 1 || r.nodeName !== "SCRIPT") && u.appendChild(ti(r, i)),
            r = r.nextSibling;
        return u
    }
    function ii(n, t, i, r, u, f, e) {
        kr(n);
        var s = pr() ? ti(n.documentElement, u.javascriptEnabled) : n.documentElement.cloneNode(!0)
          , o = t.createElement("iframe");
        return o.className = "html2canvas-container",
        o.style.visibility = "hidden",
        o.style.position = "fixed",
        o.style.left = "-10000px",
        o.style.top = "0px",
        o.style.border = "0",
        o.width = i,
        o.height = r,
        o.scrolling = "no",
        t.body.appendChild(o),
        new Promise(function(t) {
            var i = o.contentWindow.document;
            ri(n.documentElement, s, "textarea");
            ri(n.documentElement, s, "select");
            o.contentWindow.onload = o.onload = function() {
                var r = setInterval(function() {
                    i.body.childNodes.length > 0 && (dr(n, i),
                    clearInterval(r),
                    u.type === "view" && o.contentWindow.scrollTo(f, e),
                    t(o))
                }, 50)
            }
            ;
            i.open();
            i.write("<!DOCTYPE html><html><\/html>");
            wr(n, f, e);
            i.replaceChild(u.javascriptEnabled === !0 ? i.adoptNode(s) : fi(i.adoptNode(s)), i.documentElement);
            i.close()
        }
        )
    }
    function ri(n, t, i) {
        for (var u = n.getElementsByTagName(i), f = t.getElementsByTagName(i), e = u.length, r = 0; r < e; r++)
            f[r].value = u[r].value
    }
    function wr(n, t, i) {
        n.defaultView && (t !== n.defaultView.pageXOffset || i !== n.defaultView.pageYOffset) && n.defaultView.scrollTo(t, i)
    }
    function ui(t, i, r, u, f, e) {
        return new uf(t,i,n.document).then(br(t)).then(function(n) {
            return ii(n, r, u, f, e, 0, 0)
        })
    }
    function br(n) {
        return function(i) {
            var e = new DOMParser, r, u, f;
            try {
                r = e.parseFromString(i, "text/html")
            } catch (s) {
                o("DOMParser not supported, falling back to createHTMLDocument");
                r = t.implementation.createHTMLDocument("");
                try {
                    r.open();
                    r.write(i);
                    r.close()
                } catch (h) {
                    o("createHTMLDocument write not supported, falling back to document.body.innerHTML");
                    r.body.innerHTML = i
                }
            }
            return u = r.querySelector("base"),
            u && u.href.host || (f = r.createElement("base"),
            f.href = n,
            r.head.insertBefore(f, r.head.firstChild)),
            r
        }
    }
    function kr(n) {
        [].slice.call(n.querySelectorAll("canvas"), 0).forEach(function(n) {
            n.setAttribute(d, "canvas-" + hr++)
        })
    }
    function dr(n, t) {
        [].slice.call(n.querySelectorAll("[" + d + "]"), 0).forEach(function(n) {
            try {
                var i = t.querySelector("[" + d + '="' + n.getAttribute(d) + '"]');
                i && (i.width = n.width,
                i.height = n.height,
                i.getContext("2d").putImageData(n.getContext("2d").getImageData(0, 0, n.width, n.height), 0, 0))
            } catch (r) {
                o("Unable to copy canvas content from", n, r)
            }
            n.removeAttribute(d)
        })
    }
    function fi(n) {
        return [].slice.call(n.childNodes, 0).filter(gr).forEach(function(t) {
            t.tagName === "SCRIPT" ? n.removeChild(t) : fi(t)
        }),
        n
    }
    function gr(n) {
        return n.nodeType === Node.ELEMENT_NODE
    }
    function nu(n) {
        var i = t.createElement("a");
        return i.href = n,
        i.href = i.href,
        i
    }
    function h(n) {
        this.r = 0;
        this.g = 0;
        this.b = 0;
        this.a = null;
        var t = this.fromArray(n) || this.namedColor(n) || this.rgb(n) || this.rgba(n) || this.hex6(n) || this.hex3(n)
    }
    function g(n) {
        if (this.src = n,
        o("DummyImageContainer for", n),
        !this.promise || !this.image) {
            o("Initiating DummyImageContainer");
            g.prototype.image = new Image;
            var t = this.image;
            g.prototype.promise = new Promise(function(n, i) {
                t.onload = n;
                t.onerror = i;
                t.src = ni();
                t.complete === !0 && n(t)
            }
            )
        }
    }
    function tu(n, i) {
        var r = t.createElement("div"), u = t.createElement("img"), f = t.createElement("span"), e = "Hidden Text", o, s;
        r.style.visibility = "hidden";
        r.style.fontFamily = n;
        r.style.fontSize = i;
        r.style.margin = 0;
        r.style.padding = 0;
        t.body.appendChild(r);
        u.src = ni();
        u.width = 1;
        u.height = 1;
        u.style.margin = 0;
        u.style.padding = 0;
        u.style.verticalAlign = "baseline";
        f.style.fontFamily = n;
        f.style.fontSize = i;
        f.style.margin = 0;
        f.style.padding = 0;
        f.appendChild(t.createTextNode(e));
        r.appendChild(f);
        r.appendChild(u);
        o = u.offsetTop - f.offsetTop + 1;
        r.removeChild(f);
        r.appendChild(t.createTextNode(e));
        r.style.lineHeight = "normal";
        u.style.verticalAlign = "super";
        s = u.offsetTop - r.offsetTop + 1;
        t.body.removeChild(r);
        this.baseline = o;
        this.lineWidth = 1;
        this.middle = s
    }
    function li() {
        this.data = {}
    }
    function ai(n, t, i) {
        this.image = null;
        this.src = n;
        var r = this
          , u = st(n);
        this.promise = (t ? new Promise(function(t) {
            n.contentWindow.document.URL === "about:blank" || n.contentWindow.document.documentElement == null ? n.contentWindow.onload = n.onload = function() {
                t(n)
            }
            : t(n)
        }
        ) : this.proxyLoad(i.proxy, u, i)).then(function(n) {
            return html2canvas(n.contentWindow.document.documentElement, {
                type: "view",
                width: n.width,
                height: n.height,
                proxy: i.proxy,
                javascriptEnabled: i.javascriptEnabled,
                removeContainer: i.removeContainer,
                allowTaint: i.allowTaint,
                imageTimeout: i.imageTimeout / 2
            })
        }).then(function(n) {
            return r.image = n
        })
    }
    function nt(n) {
        this.src = n.value;
        this.colorStops = [];
        this.type = null;
        this.x0 = .5;
        this.y0 = .5;
        this.x1 = .5;
        this.y1 = .5;
        this.promise = Promise.resolve(!0)
    }
    function at(n, t) {
        this.src = n;
        this.image = new Image;
        var i = this;
        this.tainted = null;
        this.promise = new Promise(function(r, u) {
            i.image.onload = r;
            i.image.onerror = u;
            t && (i.image.crossOrigin = "anonymous");
            i.image.src = n;
            i.image.complete === !0 && r(i.image)
        }
        )
    }
    function l(t, i) {
        this.link = null;
        this.options = t;
        this.support = i;
        this.origin = this.getOrigin(n.location.href)
    }
    function et(n) {
        nt.apply(this, arguments);
        this.type = this.TYPES.LINEAR;
        var t = n.args[0].match(this.stepRegExp) === null;
        t ? n.args[0].split(" ").reverse().forEach(function(n) {
            switch (n) {
            case "left":
                this.x0 = 0;
                this.x1 = 1;
                break;
            case "top":
                this.y0 = 0;
                this.y1 = 1;
                break;
            case "right":
                this.x0 = 1;
                this.x1 = 0;
                break;
            case "bottom":
                this.y0 = 1;
                this.y1 = 0;
                break;
            case "to":
                var t = this.y0
                  , i = this.x0;
                this.y0 = this.y1;
                this.x0 = this.x1;
                this.x1 = i;
                this.y1 = t
            }
        }, this) : (this.y0 = 0,
        this.y1 = 1);
        this.colorStops = n.args.slice(t ? 1 : 0).map(function(n) {
            var t = n.match(this.stepRegExp);
            return {
                color: new h(t[1]),
                stop: t[3] === "%" ? t[2] / 100 : null
            }
        }, this);
        this.colorStops[0].stop === null && (this.colorStops[0].stop = 0);
        this.colorStops[this.colorStops.length - 1].stop === null && (this.colorStops[this.colorStops.length - 1].stop = 1);
        this.colorStops.forEach(function(n, t) {
            n.stop === null && this.colorStops.slice(t).some(function(i, r) {
                return i.stop !== null ? (n.stop = (i.stop - this.colorStops[t - 1].stop) / (r + 1) + this.colorStops[t - 1].stop,
                !0) : !1
            }, this)
        }, this)
    }
    function o() {
        n.html2canvas.logging && n.console && n.console.log && Function.prototype.bind.call(n.console.log, n.console).apply(n.console, [Date.now() - n.html2canvas.start + "ms", "html2canvas:"].concat([].slice.call(arguments, 0)))
    }
    function e(n, t) {
        this.node = n;
        this.parent = t;
        this.stack = null;
        this.bounds = null;
        this.borders = null;
        this.clip = [];
        this.backgroundClip = [];
        this.offsetBounds = null;
        this.visible = null;
        this.computedStyles = null;
        this.colors = {};
        this.styles = {};
        this.backgroundImages = null;
        this.transformData = null;
        this.transformMatrix = null;
        this.isPseudoElement = !1;
        this.opacity = null
    }
    function iu(n) {
        var t = n.options[n.selectedIndex || 0];
        return t ? t.text || "" : ""
    }
    function ru(n) {
        if (n && n[1] === "matrix")
            return n[2].split(",").map(function(n) {
                return parseFloat(n.trim())
            })
    }
    function ot(n) {
        return n.toString().indexOf("%") !== -1
    }
    function vi(n) {
        var a = " \r\n\t", t, i, o, h, u, l = [], r = 0, s = 0, f, e, c = function() {
            t && (i.substr(0, 1) === '"' && (i = i.substr(1, i.length - 2)),
            i && e.push(i),
            t.substr(0, 1) === "-" && (h = t.indexOf("-", 1) + 1) > 0 && (o = t.substr(0, h),
            t = t.substr(h)),
            l.push({
                prefix: o,
                method: t.toLowerCase(),
                value: u,
                args: e,
                image: null
            }));
            e = [];
            t = o = i = u = ""
        };
        return e = [],
        t = o = i = u = "",
        n.split("").forEach(function(n) {
            if (r !== 0 || !(a.indexOf(n) > -1)) {
                switch (n) {
                case '"':
                    f ? f === n && (f = null) : f = n;
                    break;
                case "(":
                    if (f)
                        break;
                    else {
                        if (r === 0) {
                            r = 1;
                            u += n;
                            return
                        }
                        s++
                    }
                    break;
                case ")":
                    if (f)
                        break;
                    else if (r === 1) {
                        if (s === 0) {
                            r = 0;
                            u += n;
                            c();
                            return
                        }
                        s--
                    }
                    break;
                case ",":
                    if (f)
                        break;
                    else {
                        if (r === 0) {
                            c();
                            return
                        }
                        if (r === 1 && s === 0 && !t.match(/^url$/i)) {
                            e.push(i);
                            i = "";
                            u += n;
                            return
                        }
                    }
                }
                u += n;
                r === 0 ? t += n : i += n
            }
        }),
        c(),
        l
    }
    function uu(n) {
        return n.replace("px", "")
    }
    function fu(n) {
        return parseFloat(n)
    }
    function st(n) {
        if (n.getBoundingClientRect) {
            var t = n.getBoundingClientRect()
              , i = n.offsetWidth == null ? t.width : n.offsetWidth;
            return {
                top: t.top,
                bottom: t.bottom || t.top + t.height,
                right: t.left + i,
                left: t.left,
                width: i,
                height: n.offsetHeight == null ? t.height : n.offsetHeight
            }
        }
        return {}
    }
    function vt(n) {
        var t = n.offsetParent ? vt(n.offsetParent) : {
            top: 0,
            left: 0
        };
        return {
            top: n.offsetTop + t.top,
            bottom: n.offsetTop + n.offsetHeight + t.top,
            right: n.offsetLeft + t.left + n.offsetWidth,
            left: n.offsetLeft + t.left,
            width: n.offsetWidth,
            height: n.offsetHeight
        }
    }
    function s(n, t, i, r, u) {
        var f, s;
        o("Starting NodeParser");
        this.renderer = t;
        this.options = u;
        this.range = null;
        this.support = i;
        this.renderQueue = [];
        this.stack = new ft(!0,1,n.ownerDocument,null);
        f = new e(n,null);
        u.background && t.rectangle(0, 0, t.width, t.height, new h(u.background));
        n === n.ownerDocument.documentElement && (s = new e(f.color("backgroundColor").isTransparent() ? n.ownerDocument.body : n.ownerDocument.documentElement,null),
        t.rectangle(0, 0, t.width, t.height, s.color("backgroundColor")));
        f.visibile = f.isElementVisible();
        this.createPseudoHideStyles(n.ownerDocument);
        this.disableAnimations(n.ownerDocument);
        this.nodes = bt([f].concat(this.getChildren(f)).filter(function(n) {
            return n.visible = n.isElementVisible()
        }).map(this.getPseudoElements, this));
        this.fontMetrics = new li;
        o("Fetched nodes, total:", this.nodes.length);
        o("Calculate overflow clips");
        this.calculateOverflowClips();
        o("Start fetching images");
        this.images = r.fetch(this.nodes.filter(rt));
        this.ready = this.images.ready.then(ct(function() {
            return o("Images loaded, starting parsing"),
            o("Creating stacking contexts"),
            this.createStackingContexts(),
            o("Sorting stacking contexts"),
            this.sortStackingContexts(this.stack),
            this.parse(this.stack),
            o("Render queue created with " + this.renderQueue.length + " items"),
            new Promise(ct(function(n) {
                u.async ? typeof u.async == "function" ? u.async.call(this, this.renderQueue, n) : this.renderQueue.length > 0 ? (this.renderIndex = 0,
                this.asyncRenderer(this.renderQueue, n)) : n() : (this.renderQueue.forEach(this.paint, this),
                n())
            }, this))
        }, this))
    }
    function yi(n) {
        return n.parent && n.parent.clip.length
    }
    function eu(n) {
        return n.replace(/(\-[a-z])/g, function(n) {
            return n.toUpperCase().replace("-", "")
        })
    }
    function pi() {}
    function wi(n, t, i, r) {
        return n.map(function(u, f) {
            if (u.width > 0) {
                var o = t.left
                  , e = t.top
                  , s = t.width
                  , h = t.height - n[2].width;
                switch (f) {
                case 0:
                    h = n[0].width;
                    u.args = ht({
                        c1: [o, e],
                        c2: [o + s, e],
                        c3: [o + s - n[1].width, e + h],
                        c4: [o + n[3].width, e + h]
                    }, r[0], r[1], i.topLeftOuter, i.topLeftInner, i.topRightOuter, i.topRightInner);
                    break;
                case 1:
                    o = t.left + t.width - n[1].width;
                    s = n[1].width;
                    u.args = ht({
                        c1: [o + s, e],
                        c2: [o + s, e + h + n[2].width],
                        c3: [o, e + h],
                        c4: [o, e + n[0].width]
                    }, r[1], r[2], i.topRightOuter, i.topRightInner, i.bottomRightOuter, i.bottomRightInner);
                    break;
                case 2:
                    e = e + t.height - n[2].width;
                    h = n[2].width;
                    u.args = ht({
                        c1: [o + s, e + h],
                        c2: [o, e + h],
                        c3: [o + n[3].width, e],
                        c4: [o + s - n[3].width, e]
                    }, r[2], r[3], i.bottomRightOuter, i.bottomRightInner, i.bottomLeftOuter, i.bottomLeftInner);
                    break;
                case 3:
                    s = n[3].width;
                    u.args = ht({
                        c1: [o, e + h + n[2].width],
                        c2: [o, e],
                        c3: [o + s, e + n[0].width],
                        c4: [o + s, e + h]
                    }, r[3], r[0], i.bottomLeftOuter, i.bottomLeftInner, i.topLeftOuter, i.topLeftInner)
                }
            }
            return u
        })
    }
    function p(n, t, i, r) {
        var s = 4 * ((Math.sqrt(2) - 1) / 3)
          , e = i * s
          , o = r * s
          , u = n + i
          , f = t + r;
        return {
            topLeft: b({
                x: n,
                y: f
            }, {
                x: n,
                y: f - o
            }, {
                x: u - e,
                y: t
            }, {
                x: u,
                y: t
            }),
            topRight: b({
                x: n,
                y: t
            }, {
                x: n + e,
                y: t
            }, {
                x: u,
                y: f - o
            }, {
                x: u,
                y: f
            }),
            bottomRight: b({
                x: u,
                y: t
            }, {
                x: u,
                y: t + o
            }, {
                x: n + e,
                y: f
            }, {
                x: n,
                y: f
            }),
            bottomLeft: b({
                x: u,
                y: f
            }, {
                x: u - e,
                y: f
            }, {
                x: n,
                y: t + o
            }, {
                x: n,
                y: t
            })
        }
    }
    function bi(n, t, i) {
        var r = n.left
          , u = n.top
          , f = n.width
          , e = n.height
          , a = t[0][0]
          , v = t[0][1]
          , o = t[1][0]
          , y = t[1][1]
          , s = t[2][0]
          , h = t[2][1]
          , w = t[3][0]
          , c = t[3][1]
          , l = f - o
          , b = e - h
          , k = f - s
          , d = e - c;
        return {
            topLeftOuter: p(r, u, a, v).topLeft.subdivide(.5),
            topLeftInner: p(r + i[3].width, u + i[0].width, Math.max(0, a - i[3].width), Math.max(0, v - i[0].width)).topLeft.subdivide(.5),
            topRightOuter: p(r + l, u, o, y).topRight.subdivide(.5),
            topRightInner: p(r + Math.min(l, f + i[3].width), u + i[0].width, l > f + i[3].width ? 0 : o - i[3].width, y - i[0].width).topRight.subdivide(.5),
            bottomRightOuter: p(r + k, u + b, s, h).bottomRight.subdivide(.5),
            bottomRightInner: p(r + Math.min(k, f - i[3].width), u + Math.min(b, e + i[0].width), Math.max(0, s - i[1].width), h - i[2].width).bottomRight.subdivide(.5),
            bottomLeftOuter: p(r, u + d, w, c).bottomLeft.subdivide(.5),
            bottomLeftInner: p(r + i[3].width, u + d, Math.max(0, w - i[3].width), c - i[2].width).bottomLeft.subdivide(.5)
        }
    }
    function b(n, t, i, r) {
        var u = function(n, t, i) {
            return {
                x: n.x + (t.x - n.x) * i,
                y: n.y + (t.y - n.y) * i
            }
        };
        return {
            start: n,
            startControl: t,
            endControl: i,
            end: r,
            subdivide: function(f) {
                var e = u(n, t, f)
                  , o = u(t, i, f)
                  , s = u(i, r, f)
                  , h = u(e, o, f)
                  , c = u(o, s, f)
                  , l = u(h, c, f);
                return [b(n, e, h, l), b(l, c, s, r)]
            },
            curveTo: function(n) {
                n.push(["bezierCurve", t.x, t.y, i.x, i.y, r.x, r.y])
            },
            curveToReversed: function(r) {
                r.push(["bezierCurve", i.x, i.y, t.x, t.y, n.x, n.y])
            }
        }
    }
    function ht(n, t, i, r, u, f, e) {
        var o = [];
        return t[0] > 0 || t[1] > 0 ? (o.push(["line", r[1].start.x, r[1].start.y]),
        r[1].curveTo(o)) : o.push(["line", n.c1[0], n.c1[1]]),
        i[0] > 0 || i[1] > 0 ? (o.push(["line", f[0].start.x, f[0].start.y]),
        f[0].curveTo(o),
        o.push(["line", e[0].end.x, e[0].end.y]),
        e[0].curveToReversed(o)) : (o.push(["line", n.c2[0], n.c2[1]]),
        o.push(["line", n.c3[0], n.c3[1]])),
        t[0] > 0 || t[1] > 0 ? (o.push(["line", u[1].end.x, u[1].end.y]),
        u[1].curveToReversed(o)) : o.push(["line", n.c4[0], n.c4[1]]),
        o
    }
    function w(n, t, i, r, u, f, e) {
        t[0] > 0 || t[1] > 0 ? (n.push(["line", r[0].start.x, r[0].start.y]),
        r[0].curveTo(n),
        r[1].curveTo(n)) : n.push(["line", f, e]);
        (i[0] > 0 || i[1] > 0) && n.push(["line", u[0].start.x, u[0].start.y])
    }
    function ou(n) {
        return n.cssInt("zIndex") < 0
    }
    function su(n) {
        return n.cssInt("zIndex") > 0
    }
    function ki(n) {
        return n.cssInt("zIndex") === 0
    }
    function di(n) {
        return ["inline", "inline-block", "inline-table"].indexOf(n.css("display")) !== -1
    }
    function gi(n) {
        return n instanceof ft
    }
    function hu(n) {
        return n.node.data.trim().length > 0
    }
    function cu(n) {
        return /^(normal|none|0px)$/.test(n.parent.css("letterSpacing"))
    }
    function lu(n) {
        return ["TopLeft", "TopRight", "BottomRight", "BottomLeft"].map(function(t) {
            var r = n.css("border" + t + "Radius")
              , i = r.split(" ");
            return i.length <= 1 && (i[1] = i[0]),
            i.map(bu)
        })
    }
    function au(n) {
        return n.nodeType === Node.TEXT_NODE || n.nodeType === Node.ELEMENT_NODE
    }
    function vu(n) {
        var t = n.css("position")
          , i = ["absolute", "relative", "fixed"].indexOf(t) !== -1 ? n.css("zIndex") : "auto";
        return i !== "auto"
    }
    function tt(n) {
        return n.css("position") !== "static"
    }
    function pt(n) {
        return n.css("float") !== "none"
    }
    function yu(n) {
        return ["inline-block", "inline-table"].indexOf(n.css("display")) !== -1
    }
    function it(n) {
        var t = this;
        return function() {
            return !n.apply(t, arguments)
        }
    }
    function rt(n) {
        return n.node.nodeType === Node.ELEMENT_NODE
    }
    function ut(n) {
        return n.isPseudoElement === !0
    }
    function wt(n) {
        return n.node.nodeType === Node.TEXT_NODE
    }
    function pu(n) {
        return function(t, i) {
            return t.cssInt("zIndex") + n.indexOf(t) / n.length - (i.cssInt("zIndex") + n.indexOf(i) / n.length)
        }
    }
    function wu(n) {
        return n.getOpacity() < 1
    }
    function ct(n, t) {
        return function() {
            return n.apply(t, arguments)
        }
    }
    function bu(n) {
        return parseInt(n, 10)
    }
    function ku(n) {
        return n.width
    }
    function du(n) {
        return n.node.nodeType !== Node.ELEMENT_NODE || ["SCRIPT", "HEAD", "TITLE", "OBJECT", "BR", "OPTION"].indexOf(n.node.nodeName) === -1
    }
    function bt(n) {
        return [].concat.apply([], n)
    }
    function gu(n) {
        var t = n.substr(0, 1);
        return t === n.substr(n.length - 1) && t.match(/'|"/) ? n.substr(1, n.length - 2) : n
    }
    function nf(t) {
        for (var u = [], i = 0, f = !1, r; t.length; )
            tf(t[i]) === f ? (r = t.splice(0, i),
            r.length && u.push(n.html2canvas.punycode.ucs2.encode(r)),
            f = !f,
            i = 0) : i++,
            i >= t.length && (r = t.splice(0, i),
            r.length && u.push(n.html2canvas.punycode.ucs2.encode(r)));
        return u
    }
    function tf(n) {
        return [32, 13, 10, 9, 45].indexOf(n) !== -1
    }
    function rf(n) {
        return /[^\u0000-\u00ff]/.test(n)
    }
    function uf(n, t, i) {
        if (!t)
            return Promise.reject("No proxy configured");
        var r = rr(nr)
          , u = ur(t, n, r);
        return nr ? sr(u) : ir(i, u, r).then(function(n) {
            return fr(n.content)
        })
    }
    function ef(n, t, i) {
        var r = rr(tr)
          , u = ur(t, n, r);
        return tr ? Promise.resolve(u) : ir(i, u, r).then(function(n) {
            return "data:" + n.type + ";base64," + n.content
        })
    }
    function ir(t, i, r) {
        return new Promise(function(u, f) {
            var e = t.createElement("script")
              , o = function() {
                delete n.html2canvas.proxy[r];
                t.body.removeChild(e)
            };
            n.html2canvas.proxy[r] = function(n) {
                o();
                u(n)
            }
            ;
            e.src = i;
            e.onerror = function(n) {
                o();
                f(n)
            }
            ;
            t.body.appendChild(e)
        }
        )
    }
    function rr(n) {
        return n ? "" : "html2canvas_" + Date.now() + "_" + ++ff + "_" + Math.round(Math.random() * 1e5)
    }
    function ur(n, t, i) {
        return n + "?url=" + encodeURIComponent(t) + (i.length ? "&callback=html2canvas.proxy." + i : "")
    }
    function of(n, i) {
        var f = t.createElement("script"), u = t.createElement("a"), r;
        u.href = n;
        n = u.href;
        this.src = n;
        this.image = new Image;
        r = this;
        this.promise = new Promise(function(u, f) {
            r.image.crossOrigin = "Anonymous";
            r.image.onload = u;
            r.image.onerror = f;
            new ef(n,i,t).then(function(n) {
                r.image.src = n
            })["catch"](f)
        }
        )
    }
    function a(n, t, i) {
        e.call(this, n, t);
        this.isPseudoElement = !0;
        this.before = i === ":before"
    }
    function v(n, t, i, r, u) {
        this.width = n;
        this.height = t;
        this.images = i;
        this.options = r;
        this.document = u
    }
    function ft(n, t, i, r) {
        e.call(this, i, r);
        this.ownStacking = n;
        this.contexts = [];
        this.children = [];
        this.opacity = (this.parent ? this.parent.stack.opacity : 1) * t
    }
    function lt(n) {
        this.rangeBounds = this.testRangeBounds(n);
        this.cors = this.testCORS();
        this.svg = this.testSVG()
    }
    function y(n) {
        this.src = n;
        this.image = null;
        var t = this;
        this.promise = this.hasFabric().then(function() {
            return t.isInline(n) ? Promise.resolve(t.inlineFormatting(n)) : sr(n)
        }).then(function(n) {
            return new Promise(function(i) {
                html2canvas.fabric.loadSVGFromString(n, t.createCanvas.call(t, i))
            }
            )
        })
    }
    function fr(n) {
        for (var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", l = n.length, s, e, r, u, f, o, h, c = "", t = 0; t < l; t += 4)
            s = i.indexOf(n[t]),
            e = i.indexOf(n[t + 1]),
            r = i.indexOf(n[t + 2]),
            u = i.indexOf(n[t + 3]),
            f = s << 2 | e >> 4,
            o = (e & 15) << 4 | r >> 2,
            h = (r & 3) << 6 | u,
            c += r === 64 ? String.fromCharCode(f) : u === 64 || u === -1 ? String.fromCharCode(f, o) : String.fromCharCode(f, o, h);
        return c
    }
    function er(n, t) {
        this.src = n;
        this.image = null;
        var i = this;
        this.promise = t ? new Promise(function(t, r) {
            i.image = new Image;
            i.image.onload = t;
            i.image.onerror = r;
            i.image.src = "data:image/svg+xml," + (new XMLSerializer).serializeToString(n);
            i.image.complete === !0 && t(i.image)
        }
        ) : this.hasFabric().then(function() {
            return new Promise(function(t) {
                html2canvas.fabric.parseSVGDocument(n, i.createCanvas.call(i, t))
            }
            )
        })
    }
    function k(n, t) {
        e.call(this, n, t)
    }
    function sf(n, t, i) {
        if (n.length > 0)
            return t + i.toUpperCase()
    }
    function or(n) {
        nt.apply(this, arguments);
        this.type = n.args[0] === "linear" ? this.TYPES.LINEAR : this.TYPES.RADIAL
    }
    function sr(n) {
        return new Promise(function(t, i) {
            var r = new XMLHttpRequest;
            r.open("GET", n);
            r.onload = function() {
                r.status === 200 ? t(r.responseText) : i(new Error(r.statusText))
            }
            ;
            r.onerror = function() {
                i(new Error("Network Error"))
            }
            ;
            r.send()
        }
        )
    }
    function c(n, t) {
        v.apply(this, arguments);
        this.canvas = this.options.canvas || this.document.createElement("canvas");
        this.options.canvas || (this.canvas.width = n,
        this.canvas.height = t);
        this.ctx = this.canvas.getContext("2d");
        this.taintCtx = this.document.createElement("canvas").getContext("2d");
        this.ctx.textBaseline = "bottom";
        this.variables = {};
        o("Initialized CanvasRenderer with size", n, "x", t)
    }
    function hf(n) {
        return n.length > 0
    }
    var ei, oi, si, hi, ci, yt;
    if (function() {
        function a(n, t) {
            l[c] = n;
            l[c + 1] = t;
            c += 2;
            2 === c && ut()
        }
        function y(n) {
            return "function" == typeof n
        }
        function et() {
            return function() {
                process.nextTick(p)
            }
        }
        function ot() {
            var n = 0
              , r = new rt(p)
              , i = t.createTextNode("");
            return r.observe(i, {
                characterData: !0
            }),
            function() {
                i.data = n = ++n % 2
            }
        }
        function st() {
            var n = new MessageChannel;
            return n.port1.onmessage = p,
            function() {
                n.port2.postMessage(0)
            }
        }
        function ht() {
            return function() {
                setTimeout(p, 1)
            }
        }
        function p() {
            for (var n = 0; n < c; n += 2)
                l[n](l[n + 1]),
                l[n] = void 0,
                l[n + 1] = void 0;
            c = 0
        }
        function s() {}
        function ct(n, t, i, r) {
            try {
                n.call(t, i, r)
            } catch (u) {
                return u
            }
        }
        function lt(n, t, r) {
            a(function(n) {
                var u = !1
                  , e = ct(r, t, function(i) {
                    u || (u = !0,
                    t !== i ? h(n, i) : f(n, i))
                }, function(t) {
                    u || (u = !0,
                    i(n, t))
                });
                !u && e && (u = !0,
                i(n, e))
            }, n)
        }
        function at(n, t) {
            1 === t.a ? f(n, t.b) : 2 === n.a ? i(n, t.b) : w(t, void 0, function(t) {
                h(n, t)
            }, function(t) {
                i(n, t)
            })
        }
        function h(n, t) {
            if (n === t)
                i(n, new TypeError("You cannot resolve a promise with itself"));
            else if ("function" == typeof t || "object" == typeof t && null !== t)
                if (t.constructor === n.constructor)
                    at(n, t);
                else {
                    var r;
                    try {
                        r = t.then
                    } catch (u) {
                        v.error = u;
                        r = v
                    }
                    r === v ? i(n, v.error) : void 0 === r ? f(n, t) : y(r) ? lt(n, t, r) : f(n, t)
                }
            else
                f(n, t)
        }
        function vt(n) {
            n.f && n.f(n.b);
            d(n)
        }
        function f(n, t) {
            void 0 === n.a && (n.b = t,
            n.a = 1,
            0 !== n.e.length && a(d, n))
        }
        function i(n, t) {
            void 0 === n.a && (n.a = 2,
            n.b = t,
            a(vt, n))
        }
        function w(n, t, i, r) {
            var u = n.e
              , f = u.length;
            n.f = null;
            u[f] = t;
            u[f + 1] = i;
            u[f + 2] = r;
            0 === f && n.a && a(d, n)
        }
        function d(n) {
            var i = n.e, e = n.a, r, u, f, t;
            if (0 !== i.length) {
                for (f = n.b,
                t = 0; t < i.length; t += 3)
                    r = i[t],
                    u = i[t + e],
                    r ? tt(e, r, u, f) : u(f);
                n.e.length = 0
            }
        }
        function nt() {
            this.error = null
        }
        function tt(n, t, r, u) {
            var s = y(r), e, c, o, l;
            if (s) {
                try {
                    e = r(u)
                } catch (a) {
                    b.error = a;
                    e = b
                }
                if (e === b ? (l = !0,
                c = e.error,
                e = null) : o = !0,
                t === e) {
                    i(t, new TypeError("A promises callback cannot return that same promise."));
                    return
                }
            } else
                e = u,
                o = !0;
            void 0 === t.a && (s && o ? h(t, e) : l ? i(t, c) : 1 === n ? f(t, e) : 2 === n && i(t, e))
        }
        function yt(n, t) {
            try {
                t(function(t) {
                    h(n, t)
                }, function(t) {
                    i(n, t)
                })
            } catch (r) {
                i(n, r)
            }
        }
        function e(n, t, r, u) {
            this.n = n;
            this.c = new n(s,u);
            this.i = r;
            this.o(t) ? (this.m = t,
            this.d = this.length = t.length,
            this.l(),
            0 === this.length ? f(this.c, this.b) : (this.length = this.length || 0,
            this.k(),
            0 === this.d && f(this.c, this.b))) : i(this.c, this.p())
        }
        function o(n) {
            if (ft++,
            this.b = this.a = void 0,
            this.e = [],
            s !== n) {
                if (!y(n))
                    throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
                if (!(this instanceof o))
                    throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
                yt(this, n)
            }
        }
        var it = Array.isArray ? Array.isArray : function(n) {
            return "[object Array]" === Object.prototype.toString.call(n)
        }
        , c = 0, g = "undefined" != typeof n ? n : {}, rt = g.MutationObserver || g.WebKitMutationObserver, g = "undefined" != typeof Uint8ClampedArray && "undefined" != typeof importScripts && "undefined" != typeof MessageChannel, l = Array(1e3), ut, v, b, ft, k;
        ut = "undefined" != typeof process && "[object process]" === {}.toString.call(process) ? et() : rt ? ot() : g ? st() : ht();
        v = new nt;
        b = new nt;
        e.prototype.o = function(n) {
            return it(n)
        }
        ;
        e.prototype.p = function() {
            return Error("Array Methods must be provided an Array")
        }
        ;
        e.prototype.l = function() {
            this.b = Array(this.length)
        }
        ;
        e.prototype.k = function() {
            for (var t = this.length, i = this.c, r = this.m, n = 0; void 0 === i.a && n < t; n++)
                this.j(r[n], n)
        }
        ;
        e.prototype.j = function(n, t) {
            var i = this.n;
            "object" == typeof n && null !== n ? n.constructor === i && void 0 !== n.a ? (n.f = null,
            this.g(n.a, t, n.b)) : this.q(i.resolve(n), t) : (this.d--,
            this.b[t] = this.h(n))
        }
        ;
        e.prototype.g = function(n, t, r) {
            var u = this.c;
            void 0 === u.a && (this.d--,
            this.i && 2 === n ? i(u, r) : this.b[t] = this.h(r));
            0 === this.d && f(u, this.b)
        }
        ;
        e.prototype.h = function(n) {
            return n
        }
        ;
        e.prototype.q = function(n, t) {
            var i = this;
            w(n, void 0, function(n) {
                i.g(1, t, n)
            }, function(n) {
                i.g(2, t, n)
            })
        }
        ;
        ft = 0;
        o.all = function(n, t) {
            return new e(this,n,!0,t).c
        }
        ;
        o.race = function(n, t) {
            function e(n) {
                h(r, n)
            }
            function o(n) {
                i(r, n)
            }
            var r = new this(s,t), f, u;
            if (!it(n))
                return i(r, new TypeError("You must pass an array to race.")),
                r;
            for (f = n.length,
            u = 0; void 0 === r.a && u < f; u++)
                w(this.resolve(n[u]), void 0, e, o);
            return r
        }
        ;
        o.resolve = function(n, t) {
            if (n && "object" == typeof n && n.constructor === this)
                return n;
            var i = new this(s,t);
            return h(i, n),
            i
        }
        ;
        o.reject = function(n, t) {
            var r = new this(s,t);
            return i(r, n),
            r
        }
        ;
        o.prototype = {
            constructor: o,
            then: function(n, t) {
                var i = this.a, r, u, f;
                return 1 === i && !n || 2 === i && !t ? this : (r = new this.constructor(s),
                u = this.b,
                i ? (f = arguments[i - 1],
                a(function() {
                    tt(i, r, f, u)
                })) : w(this, r, n, t),
                r)
            },
            "catch": function(n) {
                return this.then(null, n)
            }
        };
        k = {
            Promise: o,
            polyfill: function() {
                var t;
                t = "undefined" != typeof r ? r : "undefined" != typeof n && n.document ? n : self;
                "Promise"in t && "resolve"in t.Promise && "reject"in t.Promise && "all"in t.Promise && "race"in t.Promise && function() {
                    var n;
                    return new t.Promise(function(t) {
                        n = t
                    }
                    ),
                    y(n)
                }() || (t.Promise = o)
            }
        };
        "function" == typeof u && u.amd ? u(function() {
            return k
        }) : "undefined" != typeof module && module.exports ? module.exports = k : "undefined" != typeof this && (this.ES6Promise = k)
    }
    .call(n),
    n && n.ES6Promise.polyfill(),
    typeof t == "undefined" || typeof Object.create != "function" || typeof t.createElement("canvas").getContext != "function") {
        (n || module.exports).html2canvas = function() {
            return Promise.reject("No canvas support")
        }
        ;
        return
    }
    /*! https://mths.be/punycode v1.3.1 by @mathias */
    (function(n) {
        function s(n) {
            throw RangeError(at[n]);
        }
        function g(n, t) {
            for (var i = n.length, r = []; i--; )
                r[i] = t(n[i]);
            return r
        }
        function nt(n, t) {
            var i = n.split("@"), r = "", u, f;
            return i.length > 1 && (r = i[0] + "@",
            n = i[1]),
            u = n.split(lt),
            f = g(u, t).join("."),
            r + f
        }
        function tt(n) {
            for (var r = [], i = 0, f = n.length, t, u; i < f; )
                t = n.charCodeAt(i++),
                t >= 55296 && t <= 56319 && i < f ? (u = n.charCodeAt(i++),
                (u & 64512) == 56320 ? r.push(((t & 1023) << 10) + (u & 1023) + 65536) : (r.push(t),
                i--)) : r.push(t);
            return r
        }
        function it(n) {
            return g(n, function(n) {
                var t = "";
                return n > 65535 && (n -= 65536,
                t += l(n >>> 10 & 1023 | 55296),
                n = 56320 | n & 1023),
                t + l(n)
            }).join("")
        }
        function vt(n) {
            return n - 48 < 10 ? n - 22 : n - 65 < 26 ? n - 65 : n - 97 < 26 ? n - 97 : t
        }
        function rt(n, t) {
            return n + 22 + 75 * (n < 26) - ((t != 0) << 5)
        }
        function ut(n, i, r) {
            var u = 0;
            for (n = r ? f(n / st) : n >> 1,
            n += f(n / i); n > p * c >> 1; u += t)
                n = f(n / p);
            return f(u + (p + 1) * n / (n + ot))
        }
        function ft(n) {
            var v = [], ft = n.length, u, i = 0, g = k, p = b, r, e, w, nt, o, l, a, tt, rt;
            for (r = n.lastIndexOf(d),
            r < 0 && (r = 0),
            e = 0; e < r; ++e)
                n.charCodeAt(e) >= 128 && s("not-basic"),
                v.push(n.charCodeAt(e));
            for (w = r > 0 ? r + 1 : 0; w < ft; ) {
                for (nt = i,
                o = 1,
                l = t; ; l += t) {
                    if (w >= ft && s("invalid-input"),
                    a = vt(n.charCodeAt(w++)),
                    (a >= t || a > f((h - i) / o)) && s("overflow"),
                    i += a * o,
                    tt = l <= p ? y : l >= p + c ? c : l - p,
                    a < tt)
                        break;
                    rt = t - tt;
                    o > f(h / rt) && s("overflow");
                    o *= rt
                }
                u = v.length + 1;
                p = ut(i - nt, u, nt == 0);
                f(i / u) > h - g && s("overflow");
                g += f(i / u);
                i %= u;
                v.splice(i++, 0, g)
            }
            return it(v)
        }
        function et(n) {
            var u, e, v, et, p, i, o, w, g, nt, r, a = [], it, ft, ot, st;
            for (n = tt(n),
            it = n.length,
            u = k,
            e = 0,
            p = b,
            i = 0; i < it; ++i)
                r = n[i],
                r < 128 && a.push(l(r));
            for (v = et = a.length,
            et && a.push(d); v < it; ) {
                for (o = h,
                i = 0; i < it; ++i)
                    r = n[i],
                    r >= u && r < o && (o = r);
                for (ft = v + 1,
                o - u > f((h - e) / ft) && s("overflow"),
                e += (o - u) * ft,
                u = o,
                i = 0; i < it; ++i)
                    if (r = n[i],
                    r < u && ++e > h && s("overflow"),
                    r == u) {
                        for (w = e,
                        g = t; ; g += t) {
                            if (nt = g <= p ? y : g >= p + c ? c : g - p,
                            w < nt)
                                break;
                            st = w - nt;
                            ot = t - nt;
                            a.push(l(rt(nt + st % ot, 0)));
                            w = f(st / ot)
                        }
                        a.push(l(rt(w, 0)));
                        p = ut(e, ft, v == et);
                        e = 0;
                        ++v
                    }
                ++e;
                ++u
            }
            return a.join("")
        }
        function yt(n) {
            return nt(n, function(n) {
                return ht.test(n) ? ft(n.slice(4).toLowerCase()) : n
            })
        }
        function pt(n) {
            return nt(n, function(n) {
                return ct.test(n) ? "xn--" + et(n) : n
            })
        }
        var v = typeof i == "object" && i && !i.nodeType && i
          , w = typeof module == "object" && module && !module.nodeType && module
          , e = typeof r == "object" && r;
        (e.global === e || e.window === e || e.self === e) && (n = e);
        var o, h = 2147483647, t = 36, y = 1, c = 26, ot = 38, st = 700, b = 72, k = 128, d = "-", ht = /^xn--/, ct = /[^\x20-\x7E]/, lt = /[\x2E\u3002\uFF0E\uFF61]/g, at = {
            overflow: "Overflow: input needs wider integers to process",
            "not-basic": "Illegal input >= 0x80 (not a basic code point)",
            "invalid-input": "Invalid input"
        }, p = t - y, f = Math.floor, l = String.fromCharCode, a;
        if (o = {
            version: "1.3.1",
            ucs2: {
                decode: tt,
                encode: it
            },
            decode: ft,
            encode: et,
            toASCII: pt,
            toUnicode: yt
        },
        typeof u == "function" && typeof u.amd == "object" && u.amd)
            u("punycode", function() {
                return o
            });
        else if (v && w)
            if (module.exports == v)
                w.exports = o;
            else
                for (a in o)
                    o.hasOwnProperty(a) && (v[a] = o[a]);
        else
            n.punycode = o
    }
    )(this);
    var kt = "data-html2canvas-node"
      , d = "data-html2canvas-canvas-clone"
      , hr = 0
      , cr = 0;
    n.html2canvas = function(i, r) {
        var e = cr++, s, h, u;
        return (r = r || {},
        r.logging && (n.html2canvas.logging = !0,
        n.html2canvas.start = Date.now()),
        r.async = typeof r.async == "undefined" ? !0 : r.async,
        r.allowTaint = typeof r.allowTaint == "undefined" ? !1 : r.allowTaint,
        r.removeContainer = typeof r.removeContainer == "undefined" ? !0 : r.removeContainer,
        r.javascriptEnabled = typeof r.javascriptEnabled == "undefined" ? !1 : r.javascriptEnabled,
        r.imageTimeout = typeof r.imageTimeout == "undefined" ? 1e4 : r.imageTimeout,
        r.renderer = typeof r.renderer == "function" ? r.renderer : c,
        r.strict = !!r.strict,
        typeof i == "string") ? typeof r.proxy != "string" ? Promise.reject("Proxy must be used when rendering url") : (s = r.width != null ? r.width : n.innerWidth,
        h = r.height != null ? r.height : n.innerHeight,
        ui(nu(i), r.proxy, t, s, h, r).then(function(n) {
            return dt(n.contentWindow.document.documentElement, n, r, s, h)
        })) : (u = (i === f ? [t.documentElement] : i.length ? i : [i])[0],
        u.setAttribute(kt + e, e),
        lr(u.ownerDocument, r, u.ownerDocument.defaultView.innerWidth, u.ownerDocument.defaultView.innerHeight, e).then(function(n) {
            if (typeof r.onrendered == "function") {
                o("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas");
                r.onrendered(n)
            }
            return n
        }))
    }
    ;
    n.html2canvas.punycode = this.punycode;
    n.html2canvas.proxy = {};
    h.prototype.darken = function(n) {
        var t = 1 - n;
        return new h([Math.round(this.r * t), Math.round(this.g * t), Math.round(this.b * t), this.a])
    }
    ;
    h.prototype.isTransparent = function() {
        return this.a === 0
    }
    ;
    h.prototype.isBlack = function() {
        return this.r === 0 && this.g === 0 && this.b === 0
    }
    ;
    h.prototype.fromArray = function(n) {
        return Array.isArray(n) && (this.r = Math.min(n[0], 255),
        this.g = Math.min(n[1], 255),
        this.b = Math.min(n[2], 255),
        n.length > 3 && (this.a = n[3])),
        Array.isArray(n)
    }
    ;
    ei = /^#([a-f0-9]{3})$/i;
    h.prototype.hex3 = function(n) {
        var t = null;
        return (t = n.match(ei)) !== null && (this.r = parseInt(t[1][0] + t[1][0], 16),
        this.g = parseInt(t[1][1] + t[1][1], 16),
        this.b = parseInt(t[1][2] + t[1][2], 16)),
        t !== null
    }
    ;
    oi = /^#([a-f0-9]{6})$/i;
    h.prototype.hex6 = function(n) {
        var t = null;
        return (t = n.match(oi)) !== null && (this.r = parseInt(t[1].substring(0, 2), 16),
        this.g = parseInt(t[1].substring(2, 4), 16),
        this.b = parseInt(t[1].substring(4, 6), 16)),
        t !== null
    }
    ;
    si = /^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;
    h.prototype.rgb = function(n) {
        var t = null;
        return (t = n.match(si)) !== null && (this.r = Number(t[1]),
        this.g = Number(t[2]),
        this.b = Number(t[3])),
        t !== null
    }
    ;
    hi = /^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;
    h.prototype.rgba = function(n) {
        var t = null;
        return (t = n.match(hi)) !== null && (this.r = Number(t[1]),
        this.g = Number(t[2]),
        this.b = Number(t[3]),
        this.a = Number(t[4])),
        t !== null
    }
    ;
    h.prototype.toString = function() {
        return this.a !== null && this.a !== 1 ? "rgba(" + [this.r, this.g, this.b, this.a].join(",") + ")" : "rgb(" + [this.r, this.g, this.b].join(",") + ")"
    }
    ;
    h.prototype.namedColor = function(n) {
        var t = ci[n.toLowerCase()];
        if (t)
            this.r = t[0],
            this.g = t[1],
            this.b = t[2];
        else if (n.toLowerCase() === "transparent")
            return this.r = this.g = this.b = this.a = 0,
            !0;
        return !!t
    }
    ;
    h.prototype.isColor = !0;
    ci = {
        aliceblue: [240, 248, 255],
        antiquewhite: [250, 235, 215],
        aqua: [0, 255, 255],
        aquamarine: [127, 255, 212],
        azure: [240, 255, 255],
        beige: [245, 245, 220],
        bisque: [255, 228, 196],
        black: [0, 0, 0],
        blanchedalmond: [255, 235, 205],
        blue: [0, 0, 255],
        blueviolet: [138, 43, 226],
        brown: [165, 42, 42],
        burlywood: [222, 184, 135],
        cadetblue: [95, 158, 160],
        chartreuse: [127, 255, 0],
        chocolate: [210, 105, 30],
        coral: [255, 127, 80],
        cornflowerblue: [100, 149, 237],
        cornsilk: [255, 248, 220],
        crimson: [220, 20, 60],
        cyan: [0, 255, 255],
        darkblue: [0, 0, 139],
        darkcyan: [0, 139, 139],
        darkgoldenrod: [184, 134, 11],
        darkgray: [169, 169, 169],
        darkgreen: [0, 100, 0],
        darkgrey: [169, 169, 169],
        darkkhaki: [189, 183, 107],
        darkmagenta: [139, 0, 139],
        darkolivegreen: [85, 107, 47],
        darkorange: [255, 140, 0],
        darkorchid: [153, 50, 204],
        darkred: [139, 0, 0],
        darksalmon: [233, 150, 122],
        darkseagreen: [143, 188, 143],
        darkslateblue: [72, 61, 139],
        darkslategray: [47, 79, 79],
        darkslategrey: [47, 79, 79],
        darkturquoise: [0, 206, 209],
        darkviolet: [148, 0, 211],
        deeppink: [255, 20, 147],
        deepskyblue: [0, 191, 255],
        dimgray: [105, 105, 105],
        dimgrey: [105, 105, 105],
        dodgerblue: [30, 144, 255],
        firebrick: [178, 34, 34],
        floralwhite: [255, 250, 240],
        forestgreen: [34, 139, 34],
        fuchsia: [255, 0, 255],
        gainsboro: [220, 220, 220],
        ghostwhite: [248, 248, 255],
        gold: [255, 215, 0],
        goldenrod: [218, 165, 32],
        gray: [128, 128, 128],
        green: [0, 128, 0],
        greenyellow: [173, 255, 47],
        grey: [128, 128, 128],
        honeydew: [240, 255, 240],
        hotpink: [255, 105, 180],
        indianred: [205, 92, 92],
        indigo: [75, 0, 130],
        ivory: [255, 255, 240],
        khaki: [240, 230, 140],
        lavender: [230, 230, 250],
        lavenderblush: [255, 240, 245],
        lawngreen: [124, 252, 0],
        lemonchiffon: [255, 250, 205],
        lightblue: [173, 216, 230],
        lightcoral: [240, 128, 128],
        lightcyan: [224, 255, 255],
        lightgoldenrodyellow: [250, 250, 210],
        lightgray: [211, 211, 211],
        lightgreen: [144, 238, 144],
        lightgrey: [211, 211, 211],
        lightpink: [255, 182, 193],
        lightsalmon: [255, 160, 122],
        lightseagreen: [32, 178, 170],
        lightskyblue: [135, 206, 250],
        lightslategray: [119, 136, 153],
        lightslategrey: [119, 136, 153],
        lightsteelblue: [176, 196, 222],
        lightyellow: [255, 255, 224],
        lime: [0, 255, 0],
        limegreen: [50, 205, 50],
        linen: [250, 240, 230],
        magenta: [255, 0, 255],
        maroon: [128, 0, 0],
        mediumaquamarine: [102, 205, 170],
        mediumblue: [0, 0, 205],
        mediumorchid: [186, 85, 211],
        mediumpurple: [147, 112, 219],
        mediumseagreen: [60, 179, 113],
        mediumslateblue: [123, 104, 238],
        mediumspringgreen: [0, 250, 154],
        mediumturquoise: [72, 209, 204],
        mediumvioletred: [199, 21, 133],
        midnightblue: [25, 25, 112],
        mintcream: [245, 255, 250],
        mistyrose: [255, 228, 225],
        moccasin: [255, 228, 181],
        navajowhite: [255, 222, 173],
        navy: [0, 0, 128],
        oldlace: [253, 245, 230],
        olive: [128, 128, 0],
        olivedrab: [107, 142, 35],
        orange: [255, 165, 0],
        orangered: [255, 69, 0],
        orchid: [218, 112, 214],
        palegoldenrod: [238, 232, 170],
        palegreen: [152, 251, 152],
        paleturquoise: [175, 238, 238],
        palevioletred: [219, 112, 147],
        papayawhip: [255, 239, 213],
        peachpuff: [255, 218, 185],
        peru: [205, 133, 63],
        pink: [255, 192, 203],
        plum: [221, 160, 221],
        powderblue: [176, 224, 230],
        purple: [128, 0, 128],
        rebeccapurple: [102, 51, 153],
        red: [255, 0, 0],
        rosybrown: [188, 143, 143],
        royalblue: [65, 105, 225],
        saddlebrown: [139, 69, 19],
        salmon: [250, 128, 114],
        sandybrown: [244, 164, 96],
        seagreen: [46, 139, 87],
        seashell: [255, 245, 238],
        sienna: [160, 82, 45],
        silver: [192, 192, 192],
        skyblue: [135, 206, 235],
        slateblue: [106, 90, 205],
        slategray: [112, 128, 144],
        slategrey: [112, 128, 144],
        snow: [255, 250, 250],
        springgreen: [0, 255, 127],
        steelblue: [70, 130, 180],
        tan: [210, 180, 140],
        teal: [0, 128, 128],
        thistle: [216, 191, 216],
        tomato: [255, 99, 71],
        turquoise: [64, 224, 208],
        violet: [238, 130, 238],
        wheat: [245, 222, 179],
        white: [255, 255, 255],
        whitesmoke: [245, 245, 245],
        yellow: [255, 255, 0],
        yellowgreen: [154, 205, 50]
    };
    li.prototype.getMetrics = function(n, t) {
        return this.data[n + "-" + t] === f && (this.data[n + "-" + t] = new tu(n,t)),
        this.data[n + "-" + t]
    }
    ;
    ai.prototype.proxyLoad = function(n, t, i) {
        var r = this.src;
        return ui(r.src, n, r.ownerDocument, t.width, t.height, i)
    }
    ;
    nt.prototype.TYPES = {
        LINEAR: 1,
        RADIAL: 2
    };
    l.prototype.findImages = function(n) {
        var t = [];
        return n.reduce(function(n, t) {
            switch (t.node.nodeName) {
            case "IMG":
                return n.concat([{
                    args: [t.node.src],
                    method: "url"
                }]);
            case "svg":
            case "IFRAME":
                return n.concat([{
                    args: [t.node],
                    method: t.node.nodeName
                }])
            }
            return n
        }, []).forEach(this.addImage(t, this.loadImage), this),
        t
    }
    ;
    l.prototype.findBackgroundImage = function(n, t) {
        return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(n, this.loadImage), this),
        n
    }
    ;
    l.prototype.addImage = function(n, t) {
        return function(i) {
            i.args.forEach(function(r) {
                this.imageExists(n, r) || (n.splice(0, 0, t.call(this, i)),
                o("Added image #" + n.length, typeof r == "string" ? r.substring(0, 100) : r))
            }, this)
        }
    }
    ;
    l.prototype.hasImageBackground = function(n) {
        return n.method !== "none"
    }
    ;
    l.prototype.loadImage = function(n) {
        if (n.method === "url") {
            var t = n.args[0];
            return !this.isSVG(t) || this.support.svg || this.options.allowTaint ? t.match(/data:image\/.*;base64,/i) ? new at(t.replace(/url\(['"]{0,}|['"]{0,}\)$/ig, ""),!1) : this.isSameOrigin(t) || this.options.allowTaint === !0 || this.isSVG(t) ? new at(t,!1) : this.support.cors && !this.options.allowTaint && this.options.useCORS ? new at(t,!0) : this.options.proxy ? new of(t,this.options.proxy) : new g(t) : new y(t)
        }
        return n.method === "linear-gradient" ? new et(n) : n.method === "gradient" ? new or(n) : n.method === "svg" ? new er(n.args[0],this.support.svg) : n.method === "IFRAME" ? new ai(n.args[0],this.isSameOrigin(n.args[0].src),this.options) : new g(n)
    }
    ;
    l.prototype.isSVG = function(n) {
        return n.substring(n.length - 3).toLowerCase() === "svg" || y.prototype.isInline(n)
    }
    ;
    l.prototype.imageExists = function(n, t) {
        return n.some(function(n) {
            return n.src === t
        })
    }
    ;
    l.prototype.isSameOrigin = function(n) {
        return this.getOrigin(n) === this.origin
    }
    ;
    l.prototype.getOrigin = function(n) {
        var i = this.link || (this.link = t.createElement("a"));
        return i.href = n,
        i.href = i.href,
        i.protocol + i.hostname + i.port
    }
    ;
    l.prototype.getPromise = function(n) {
        return this.timeout(n, this.options.imageTimeout)["catch"](function() {
            var t = new g(n.src);
            return t.promise.then(function(t) {
                n.image = t
            })
        })
    }
    ;
    l.prototype.get = function(n) {
        var t = null;
        return this.images.some(function(i) {
            return (t = i).src === n
        }) ? t : null
    }
    ;
    l.prototype.fetch = function(n) {
        return this.images = n.reduce(ct(this.findBackgroundImage, this), this.findImages(n)),
        this.images.forEach(function(n, t) {
            n.promise.then(function() {
                o("Succesfully loaded image #" + (t + 1), n)
            }, function(i) {
                o("Failed loading image #" + (t + 1), n, i)
            })
        }),
        this.ready = Promise.all(this.images.map(this.getPromise, this)),
        o("Finished searching images"),
        this
    }
    ;
    l.prototype.timeout = function(n, t) {
        var i, r = Promise.race([n.promise, new Promise(function(r, u) {
            i = setTimeout(function() {
                o("Timed out loading image", n);
                u(n)
            }, t)
        }
        )]).then(function(n) {
            return clearTimeout(i),
            n
        });
        return r["catch"](function() {
            clearTimeout(i)
        }),
        r
    }
    ;
    et.prototype = Object.create(nt.prototype);
    et.prototype.stepRegExp = /((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;
    e.prototype.cloneTo = function(n) {
        n.visible = this.visible;
        n.borders = this.borders;
        n.bounds = this.bounds;
        n.clip = this.clip;
        n.backgroundClip = this.backgroundClip;
        n.computedStyles = this.computedStyles;
        n.styles = this.styles;
        n.backgroundImages = this.backgroundImages;
        n.opacity = this.opacity
    }
    ;
    e.prototype.getOpacity = function() {
        return this.opacity === null ? this.opacity = this.cssFloat("opacity") : this.opacity
    }
    ;
    e.prototype.assignStack = function(n) {
        this.stack = n;
        n.children.push(this)
    }
    ;
    e.prototype.isElementVisible = function() {
        return this.node.nodeType === Node.TEXT_NODE ? this.parent.visible : this.css("display") !== "none" && this.css("visibility") !== "hidden" && !this.node.hasAttribute("data-html2canvas-ignore") && (this.node.nodeName !== "INPUT" || this.node.getAttribute("type") !== "hidden")
    }
    ;
    e.prototype.css = function(n) {
        return this.computedStyles || (this.computedStyles = this.isPseudoElement ? this.parent.computedStyle(this.before ? ":before" : ":after") : this.computedStyle(null)),
        this.styles[n] || (this.styles[n] = this.computedStyles[n])
    }
    ;
    e.prototype.prefixedCss = function(n) {
        var t = this.css(n);
        return t === f && ["webkit", "moz", "ms", "o"].some(function(i) {
            return t = this.css(i + n.substr(0, 1).toUpperCase() + n.substr(1)),
            t !== f
        }, this),
        t === f ? null : t
    }
    ;
    e.prototype.computedStyle = function(n) {
        return this.node.ownerDocument.defaultView.getComputedStyle(this.node, n)
    }
    ;
    e.prototype.cssInt = function(n) {
        var t = parseInt(this.css(n), 10);
        return isNaN(t) ? 0 : t
    }
    ;
    e.prototype.color = function(n) {
        return this.colors[n] || (this.colors[n] = new h(this.css(n)))
    }
    ;
    e.prototype.cssFloat = function(n) {
        var t = parseFloat(this.css(n));
        return isNaN(t) ? 0 : t
    }
    ;
    e.prototype.fontWeight = function() {
        var n = this.css("fontWeight");
        switch (parseInt(n, 10)) {
        case 401:
            n = "bold";
            break;
        case 400:
            n = "normal"
        }
        return n
    }
    ;
    e.prototype.parseClip = function() {
        var n = this.css("clip").match(this.CLIP);
        return n ? {
            top: parseInt(n[1], 10),
            right: parseInt(n[2], 10),
            bottom: parseInt(n[3], 10),
            left: parseInt(n[4], 10)
        } : null
    }
    ;
    e.prototype.parseBackgroundImages = function() {
        return this.backgroundImages || (this.backgroundImages = vi(this.css("backgroundImage")))
    }
    ;
    e.prototype.cssList = function(n, t) {
        var i = (this.css(n) || "").split(",");
        return i = i[t || 0] || i[0] || "auto",
        i = i.trim().split(" "),
        i.length === 1 && (i = [i[0], i[0]]),
        i
    }
    ;
    e.prototype.parseBackgroundSize = function(n, t, i) {
        var r = this.cssList("backgroundSize", i), u, e, o, f;
        if (ot(r[0]))
            u = n.width * parseFloat(r[0]) / 100;
        else {
            if (/contain|cover/.test(r[0]))
                return o = n.width / n.height,
                f = t.width / t.height,
                o < f ^ r[0] === "contain" ? {
                    width: n.height * f,
                    height: n.height
                } : {
                    width: n.width,
                    height: n.width / f
                };
            u = parseInt(r[0], 10)
        }
        return e = r[0] === "auto" && r[1] === "auto" ? t.height : r[1] === "auto" ? u / t.width * t.height : ot(r[1]) ? n.height * parseFloat(r[1]) / 100 : parseInt(r[1], 10),
        r[0] === "auto" && (u = e / t.height * t.width),
        {
            width: u,
            height: e
        }
    }
    ;
    e.prototype.parseBackgroundPosition = function(n, t, i, r) {
        var u = this.cssList("backgroundPosition", i), f, e;
        return f = ot(u[0]) ? (n.width - (r || t).width) * (parseFloat(u[0]) / 100) : parseInt(u[0], 10),
        e = u[1] === "auto" ? f / t.width * t.height : ot(u[1]) ? (n.height - (r || t).height) * parseFloat(u[1]) / 100 : parseInt(u[1], 10),
        u[0] === "auto" && (f = e / t.height * t.width),
        {
            left: f,
            top: e
        }
    }
    ;
    e.prototype.parseBackgroundRepeat = function(n) {
        return this.cssList("backgroundRepeat", n)[0]
    }
    ;
    e.prototype.parseTextShadows = function() {
        var r = this.css("textShadow"), u = [], t, i, n;
        if (r && r !== "none")
            for (t = r.match(this.TEXT_SHADOW_PROPERTY),
            i = 0; t && i < t.length; i++)
                n = t[i].match(this.TEXT_SHADOW_VALUES),
                u.push({
                    color: new h(n[0]),
                    offsetX: n[1] ? parseFloat(n[1].replace("px", "")) : 0,
                    offsetY: n[2] ? parseFloat(n[2].replace("px", "")) : 0,
                    blur: n[3] ? n[3].replace("px", "") : 0
                });
        return u
    }
    ;
    e.prototype.parseTransform = function() {
        if (!this.transformData)
            if (this.hasTransform()) {
                var t = this.parseBounds()
                  , n = this.prefixedCss("transformOrigin").split(" ").map(uu).map(fu);
                n[0] += t.left;
                n[1] += t.top;
                this.transformData = {
                    origin: n,
                    matrix: this.parseTransformMatrix()
                }
            } else
                this.transformData = {
                    origin: [0, 0],
                    matrix: [1, 0, 0, 1, 0, 0]
                };
        return this.transformData
    }
    ;
    e.prototype.parseTransformMatrix = function() {
        if (!this.transformMatrix) {
            var n = this.prefixedCss("transform")
              , t = n ? ru(n.match(this.MATRIX_PROPERTY)) : null;
            this.transformMatrix = t ? t : [1, 0, 0, 1, 0, 0]
        }
        return this.transformMatrix
    }
    ;
    e.prototype.parseBounds = function() {
        return this.bounds || (this.bounds = this.hasTransform() ? vt(this.node) : st(this.node))
    }
    ;
    e.prototype.hasTransform = function() {
        return this.parseTransformMatrix().join(",") !== "1,0,0,1,0,0" || this.parent && this.parent.hasTransform()
    }
    ;
    e.prototype.getValue = function() {
        var n = this.node.value || "";
        return this.node.tagName === "SELECT" ? n = iu(this.node) : this.node.type === "password" && (n = Array(n.length + 1).join("•")),
        n.length === 0 ? this.node.placeholder || "" : n
    }
    ;
    e.prototype.MATRIX_PROPERTY = /(matrix)\((.+)\)/;
    e.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;
    e.prototype.TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;
    e.prototype.CLIP = /^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;
    s.prototype.calculateOverflowClips = function() {
        this.nodes.forEach(function(n) {
            if (rt(n)) {
                ut(n) && n.appendToDOM();
                n.borders = this.parseBorders(n);
                var i = n.css("overflow") === "hidden" ? [n.borders.clip] : []
                  , t = n.parseClip();
                t && ["absolute", "fixed"].indexOf(n.css("position")) !== -1 && i.push([["rect", n.bounds.left + t.left, n.bounds.top + t.top, t.right - t.left, t.bottom - t.top]]);
                n.clip = yi(n) ? n.parent.clip.concat(i) : i;
                n.backgroundClip = n.css("overflow") !== "hidden" ? n.clip.concat([n.borders.clip]) : n.clip;
                ut(n) && n.cleanDOM()
            } else
                wt(n) && (n.clip = yi(n) ? n.parent.clip : []);
            ut(n) || (n.bounds = null)
        }, this)
    }
    ;
    s.prototype.asyncRenderer = function(n, t, i) {
        i = i || Date.now();
        this.paint(n[this.renderIndex++]);
        n.length === this.renderIndex ? t() : i + 20 > Date.now() ? this.asyncRenderer(n, t, i) : setTimeout(ct(function() {
            this.asyncRenderer(n, t)
        }, this), 0)
    }
    ;
    s.prototype.createPseudoHideStyles = function(n) {
        this.createStyles(n, "." + a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: "" !important; display: none !important; }.' + a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: "" !important; display: none !important; }')
    }
    ;
    s.prototype.disableAnimations = function(n) {
        this.createStyles(n, "* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")
    }
    ;
    s.prototype.createStyles = function(n, t) {
        var i = n.createElement("style");
        i.innerHTML = t;
        n.body.appendChild(i)
    }
    ;
    s.prototype.getPseudoElements = function(n) {
        var t = [[n]], i, r;
        return n.node.nodeType === Node.ELEMENT_NODE && (i = this.getPseudoElement(n, ":before"),
        r = this.getPseudoElement(n, ":after"),
        i && t.push(i),
        r && t.push(r)),
        bt(t)
    }
    ;
    s.prototype.getPseudoElement = function(n, i) {
        var r = n.computedStyle(i), f, s, h;
        if (!r || !r.content || r.content === "none" || r.content === "-moz-alt-content" || r.display === "none")
            return null;
        var e = gu(r.content)
          , c = e.substr(0, 3) === "url"
          , u = t.createElement(c ? "img" : "html2canvaspseudoelement")
          , o = new a(u,n,i);
        for (f = r.length - 1; f >= 0; f--)
            s = eu(r.item(f)),
            u.style[s] = r[s];
        return u.className = a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + " " + a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER,
        c ? (u.src = vi(e)[0].args[0],
        [o]) : (h = t.createTextNode(e),
        u.appendChild(h),
        [o, new k(h,o)])
    }
    ;
    s.prototype.getChildren = function(n) {
        return bt([].filter.call(n.node.childNodes, au).map(function(t) {
            var i = [t.nodeType === Node.TEXT_NODE ? new k(t,n) : new e(t,n)].filter(du);
            return t.nodeType === Node.ELEMENT_NODE && i.length && t.tagName !== "TEXTAREA" ? i[0].isElementVisible() ? i.concat(this.getChildren(i[0])) : [] : i
        }, this))
    }
    ;
    s.prototype.newStackingContext = function(n, t) {
        var i = new ft(t,n.getOpacity(),n.node,n.parent), r;
        n.cloneTo(i);
        r = t ? i.getParentStack(this) : i.parent.stack;
        r.contexts.push(i);
        n.stack = i
    }
    ;
    s.prototype.createStackingContexts = function() {
        this.nodes.forEach(function(n) {
            rt(n) && (this.isRootElement(n) || wu(n) || vu(n) || this.isBodyWithTransparentRoot(n) || n.hasTransform()) ? this.newStackingContext(n, !0) : rt(n) && (tt(n) && ki(n) || yu(n) || pt(n)) ? this.newStackingContext(n, !1) : n.assignStack(n.parent.stack)
        }, this)
    }
    ;
    s.prototype.isBodyWithTransparentRoot = function(n) {
        return n.node.nodeName === "BODY" && n.parent.color("backgroundColor").isTransparent()
    }
    ;
    s.prototype.isRootElement = function(n) {
        return n.parent === null
    }
    ;
    s.prototype.sortStackingContexts = function(n) {
        n.contexts.sort(pu(n.contexts.slice(0)));
        n.contexts.forEach(this.sortStackingContexts, this)
    }
    ;
    s.prototype.parseTextBounds = function(n) {
        return function(t, i, r) {
            var u, f, e;
            if (n.parent.css("textDecoration").substr(0, 4) !== "none" || t.trim().length !== 0) {
                if (this.support.rangeBounds && !n.parent.hasTransform())
                    return u = r.slice(0, i).join("").length,
                    this.getRangeBounds(n.node, u, t.length);
                if (n.node && typeof n.node.data == "string")
                    return f = n.node.splitText(t.length),
                    e = this.getWrapperBounds(n.node, n.parent.hasTransform()),
                    n.node = f,
                    e
            } else
                (!this.support.rangeBounds || n.parent.hasTransform()) && (n.node = n.node.splitText(t.length));
            return {}
        }
    }
    ;
    s.prototype.getWrapperBounds = function(n, t) {
        var i = n.ownerDocument.createElement("html2canvaswrapper"), r = n.parentNode, f = n.cloneNode(!0), u;
        return i.appendChild(n.cloneNode(!0)),
        r.replaceChild(i, n),
        u = t ? vt(i) : st(i),
        r.replaceChild(f, i),
        u
    }
    ;
    s.prototype.getRangeBounds = function(n, t, i) {
        var r = this.range || (this.range = n.ownerDocument.createRange());
        return r.setStart(n, t),
        r.setEnd(n, t + i),
        r.getBoundingClientRect()
    }
    ;
    s.prototype.parse = function(n) {
        var r = n.contexts.filter(ou)
          , i = n.children.filter(rt)
          , t = i.filter(it(pt))
          , u = t.filter(it(tt)).filter(it(di))
          , f = i.filter(it(tt)).filter(pt)
          , e = t.filter(it(tt)).filter(di)
          , o = n.contexts.concat(t.filter(tt)).filter(ki)
          , s = n.children.filter(wt).filter(hu)
          , h = n.contexts.filter(su);
        r.concat(u).concat(f).concat(e).concat(o).concat(s).concat(h).forEach(function(n) {
            this.renderQueue.push(n);
            gi(n) && (this.parse(n),
            this.renderQueue.push(new pi))
        }, this)
    }
    ;
    s.prototype.paint = function(n) {
        try {
            n instanceof pi ? this.renderer.ctx.restore() : wt(n) ? (ut(n.parent) && n.parent.appendToDOM(),
            this.paintText(n),
            ut(n.parent) && n.parent.cleanDOM()) : this.paintNode(n)
        } catch (t) {
            if (o(t),
            this.options.strict)
                throw t;
        }
    }
    ;
    s.prototype.paintNode = function(n) {
        gi(n) && (this.renderer.setOpacity(n.opacity),
        this.renderer.ctx.save(),
        n.hasTransform() && this.renderer.setTransform(n.parseTransform()));
        n.node.nodeName === "INPUT" && n.node.type === "checkbox" ? this.paintCheckbox(n) : n.node.nodeName === "INPUT" && n.node.type === "radio" ? this.paintRadio(n) : this.paintElement(n)
    }
    ;
    s.prototype.paintElement = function(n) {
        var t = n.parseBounds();
        this.renderer.clip(n.backgroundClip, function() {
            this.renderer.renderBackground(n, t, n.borders.borders.map(ku))
        }, this);
        this.renderer.clip(n.clip, function() {
            this.renderer.renderBorders(n.borders.borders)
        }, this);
        this.renderer.clip(n.backgroundClip, function() {
            var i, r;
            switch (n.node.nodeName) {
            case "svg":
            case "IFRAME":
                i = this.images.get(n.node);
                i ? this.renderer.renderImage(n, t, n.borders, i) : o("Error loading <" + n.node.nodeName + ">", n.node);
                break;
            case "IMG":
                r = this.images.get(n.node.src);
                r ? this.renderer.renderImage(n, t, n.borders, r) : o("Error loading <img>", n.node.src);
                break;
            case "CANVAS":
                this.renderer.renderImage(n, t, n.borders, {
                    image: n.node
                });
                break;
            case "SELECT":
            case "INPUT":
            case "TEXTAREA":
                this.paintFormValue(n)
            }
        }, this)
    }
    ;
    s.prototype.paintCheckbox = function(n) {
        var r = n.parseBounds()
          , i = Math.min(r.width, r.height)
          , t = {
            width: i - 1,
            height: i - 1,
            top: r.top,
            left: r.left
        }
          , u = [3, 3]
          , f = [u, u, u, u]
          , e = [1, 1, 1, 1].map(function(n) {
            return {
                color: new h("#A5A5A5"),
                width: n
            }
        })
          , o = bi(t, f, e);
        this.renderer.clip(n.backgroundClip, function() {
            this.renderer.rectangle(t.left + 1, t.top + 1, t.width - 2, t.height - 2, new h("#DEDEDE"));
            this.renderer.renderBorders(wi(e, t, o, f));
            n.node.checked && (this.renderer.font(new h("#424242"), "normal", "normal", "bold", i - 3 + "px", "arial"),
            this.renderer.text("✔", t.left + i / 6, t.top + i - 1))
        }, this)
    }
    ;
    s.prototype.paintRadio = function(n) {
        var t = n.parseBounds()
          , i = Math.min(t.width, t.height) - 2;
        this.renderer.clip(n.backgroundClip, function() {
            this.renderer.circleStroke(t.left + 1, t.top + 1, i, new h("#DEDEDE"), 1, new h("#A5A5A5"));
            n.node.checked && this.renderer.circle(Math.ceil(t.left + i / 4) + 1, Math.ceil(t.top + i / 4) + 1, Math.floor(i / 2), new h("#424242"))
        }, this)
    }
    ;
    s.prototype.paintFormValue = function(n) {
        var u = n.getValue(), r;
        if (u.length > 0) {
            var i = n.node.ownerDocument
              , t = i.createElement("html2canvaswrapper");
            ["lineHeight", "textAlign", "fontFamily", "fontWeight", "fontSize", "color", "paddingLeft", "paddingTop", "paddingRight", "paddingBottom", "width", "height", "borderLeftStyle", "borderTopStyle", "borderLeftWidth", "borderTopWidth", "boxSizing", "whiteSpace", "wordWrap"].forEach(function(i) {
                try {
                    t.style[i] = n.css(i)
                } catch (r) {
                    o("html2canvas: Parse: Exception caught in renderFormValue: " + r.message)
                }
            });
            r = n.parseBounds();
            t.style.position = "fixed";
            t.style.left = r.left + "px";
            t.style.top = r.top + "px";
            t.textContent = u;
            i.body.appendChild(t);
            this.paintText(new k(t.firstChild,n));
            i.body.removeChild(t)
        }
    }
    ;
    s.prototype.paintText = function(t) {
        t.applyTextTransform();
        var r = n.html2canvas.punycode.ucs2.decode(t.node.data)
          , u = (!this.options.letterRendering || cu(t)) && !rf(t.node.data) ? nf(r) : r.map(function(t) {
            return n.html2canvas.punycode.ucs2.encode([t])
        })
          , o = t.parent.fontWeight()
          , f = t.parent.css("fontSize")
          , e = t.parent.css("fontFamily")
          , i = t.parent.parseTextShadows();
        this.renderer.font(t.parent.color("color"), t.parent.css("fontStyle"), t.parent.css("fontVariant"), o, f, e);
        i.length ? this.renderer.fontShadow(i[0].color, i[0].offsetX, i[0].offsetY, i[0].blur) : this.renderer.clearShadow();
        this.renderer.clip(t.parent.clip, function() {
            u.map(this.parseTextBounds(t), this).forEach(function(n, i) {
                n && (this.renderer.text(u[i], n.left, n.bottom),
                this.renderTextDecoration(t.parent, n, this.fontMetrics.getMetrics(e, f)))
            }, this)
        }, this)
    }
    ;
    s.prototype.renderTextDecoration = function(n, t, i) {
        switch (n.css("textDecoration").split(" ")[0]) {
        case "underline":
            this.renderer.rectangle(t.left, Math.round(t.top + i.baseline + i.lineWidth), t.width, 1, n.color("color"));
            break;
        case "overline":
            this.renderer.rectangle(t.left, Math.round(t.top), t.width, 1, n.color("color"));
            break;
        case "line-through":
            this.renderer.rectangle(t.left, Math.ceil(t.top + i.middle + i.lineWidth), t.width, 1, n.color("color"))
        }
    }
    ;
    yt = {
        inset: [["darken", .6], ["darken", .1], ["darken", .1], ["darken", .6]]
    };
    s.prototype.parseBorders = function(n) {
        var t = n.parseBounds()
          , i = lu(n)
          , r = ["Top", "Right", "Bottom", "Left"].map(function(t, i) {
            var f = n.css("border" + t + "Style"), r = n.color("border" + t + "Color"), u;
            return f === "inset" && r.isBlack() && (r = new h([255, 255, 255, r.a])),
            u = yt[f] ? yt[f][i] : null,
            {
                width: n.cssInt("border" + t + "Width"),
                color: u ? r[u[0]](u[1]) : r,
                args: null
            }
        })
          , u = bi(t, i, r);
        return {
            clip: this.parseBackgroundClip(n, u, r, i, t),
            borders: wi(r, t, u, i)
        }
    }
    ;
    s.prototype.parseBackgroundClip = function(n, t, i, r, u) {
        var e = n.css("backgroundClip")
          , f = [];
        switch (e) {
        case "content-box":
        case "padding-box":
            w(f, r[0], r[1], t.topLeftInner, t.topRightInner, u.left + i[3].width, u.top + i[0].width);
            w(f, r[1], r[2], t.topRightInner, t.bottomRightInner, u.left + u.width - i[1].width, u.top + i[0].width);
            w(f, r[2], r[3], t.bottomRightInner, t.bottomLeftInner, u.left + u.width - i[1].width, u.top + u.height - i[2].width);
            w(f, r[3], r[0], t.bottomLeftInner, t.topLeftInner, u.left + i[3].width, u.top + u.height - i[2].width);
            break;
        default:
            w(f, r[0], r[1], t.topLeftOuter, t.topRightOuter, u.left, u.top);
            w(f, r[1], r[2], t.topRightOuter, t.bottomRightOuter, u.left + u.width, u.top);
            w(f, r[2], r[3], t.bottomRightOuter, t.bottomLeftOuter, u.left + u.width, u.top + u.height);
            w(f, r[3], r[0], t.bottomLeftOuter, t.topLeftOuter, u.left, u.top + u.height)
        }
        return f
    }
    ;
    var ff = 0
      , nr = "withCredentials"in new XMLHttpRequest
      , tr = "crossOrigin"in new Image;
    a.prototype.cloneTo = function(n) {
        a.prototype.cloneTo.call(this, n);
        n.isPseudoElement = !0;
        n.before = this.before
    }
    ;
    a.prototype = Object.create(e.prototype);
    a.prototype.appendToDOM = function() {
        this.before ? this.parent.node.insertBefore(this.node, this.parent.node.firstChild) : this.parent.node.appendChild(this.node);
        this.parent.node.className += " " + this.getHideClass()
    }
    ;
    a.prototype.cleanDOM = function() {
        this.node.parentNode.removeChild(this.node);
        this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), "")
    }
    ;
    a.prototype.getHideClass = function() {
        return this["PSEUDO_HIDE_ELEMENT_CLASS_" + (this.before ? "BEFORE" : "AFTER")]
    }
    ;
    a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = "___html2canvas___pseudoelement_before";
    a.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = "___html2canvas___pseudoelement_after";
    v.prototype.renderImage = function(n, t, i, r) {
        var f = n.cssInt("paddingLeft")
          , e = n.cssInt("paddingTop")
          , h = n.cssInt("paddingRight")
          , c = n.cssInt("paddingBottom")
          , u = i.borders
          , o = t.width - (u[1].width + u[3].width + f + h)
          , s = t.height - (u[0].width + u[2].width + e + c);
        this.drawImage(r, 0, 0, r.image.width || o, r.image.height || s, t.left + f + u[3].width, t.top + e + u[0].width, o, s)
    }
    ;
    v.prototype.renderBackground = function(n, t, i) {
        t.height > 0 && t.width > 0 && (this.renderBackgroundColor(n, t),
        this.renderBackgroundImage(n, t, i))
    }
    ;
    v.prototype.renderBackgroundColor = function(n, t) {
        var i = n.color("backgroundColor");
        i.isTransparent() || this.rectangle(t.left, t.top, t.width, t.height, i)
    }
    ;
    v.prototype.renderBorders = function(n) {
        n.forEach(this.renderBorder, this)
    }
    ;
    v.prototype.renderBorder = function(n) {
        n.color.isTransparent() || n.args === null || this.drawShape(n.args, n.color)
    }
    ;
    v.prototype.renderBackgroundImage = function(n, t, i) {
        var r = n.parseBackgroundImages();
        r.reverse().forEach(function(r, u, f) {
            var e, s;
            switch (r.method) {
            case "url":
                e = this.images.get(r.args[0]);
                e ? this.renderBackgroundRepeating(n, t, e, f.length - (u + 1), i) : o("Error loading background-image", r.args[0]);
                break;
            case "linear-gradient":
            case "gradient":
                s = this.images.get(r.value);
                s ? this.renderBackgroundGradient(s, t, i) : o("Error loading background-image", r.args[0]);
                break;
            case "none":
                break;
            default:
                o("Unknown background-image type", r.args[0])
            }
        }, this)
    }
    ;
    v.prototype.renderBackgroundRepeating = function(n, t, i, r, u) {
        var f = n.parseBackgroundSize(t, i.image, r)
          , e = n.parseBackgroundPosition(t, i.image, r, f)
          , o = n.parseBackgroundRepeat(r);
        switch (o) {
        case "repeat-x":
        case "repeat no-repeat":
            this.backgroundRepeatShape(i, e, f, t, t.left + u[3], t.top + e.top + u[0], 99999, f.height, u);
            break;
        case "repeat-y":
        case "no-repeat repeat":
            this.backgroundRepeatShape(i, e, f, t, t.left + e.left + u[3], t.top + u[0], f.width, 99999, u);
            break;
        case "no-repeat":
            this.backgroundRepeatShape(i, e, f, t, t.left + e.left + u[3], t.top + e.top + u[0], f.width, f.height, u);
            break;
        default:
            this.renderBackgroundRepeat(i, e, f, {
                top: t.top,
                left: t.left
            }, u[3], u[0])
        }
    }
    ;
    ft.prototype = Object.create(e.prototype);
    ft.prototype.getParentStack = function(n) {
        var t = this.parent ? this.parent.stack : null;
        return t ? t.ownStacking ? t : t.getParentStack(n) : n.stack
    }
    ;
    lt.prototype.testRangeBounds = function(n) {
        var i, t, r, u, f = !1;
        return n.createRange && (i = n.createRange(),
        i.getBoundingClientRect && (t = n.createElement("boundtest"),
        t.style.height = "123px",
        t.style.display = "block",
        n.body.appendChild(t),
        i.selectNode(t),
        r = i.getBoundingClientRect(),
        u = r.height,
        u === 123 && (f = !0),
        n.body.removeChild(t))),
        f
    }
    ;
    lt.prototype.testCORS = function() {
        return typeof (new Image).crossOrigin != "undefined"
    }
    ;
    lt.prototype.testSVG = function() {
        var n = new Image
          , i = t.createElement("canvas")
          , r = i.getContext("2d");
        n.src = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'><\/svg>";
        try {
            r.drawImage(n, 0, 0);
            i.toDataURL()
        } catch (u) {
            return !1
        }
        return !0
    }
    ;
    y.prototype.hasFabric = function() {
        return html2canvas.fabric ? Promise.resolve() : Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))
    }
    ;
    y.prototype.inlineFormatting = function(n) {
        return /^data:image\/svg\+xml;base64,/.test(n) ? this.decode64(this.removeContentType(n)) : this.removeContentType(n)
    }
    ;
    y.prototype.removeContentType = function(n) {
        return n.replace(/^data:image\/svg\+xml(;base64)?,/, "")
    }
    ;
    y.prototype.isInline = function(n) {
        return /^data:image\/svg\+xml/i.test(n)
    }
    ;
    y.prototype.createCanvas = function(n) {
        var t = this;
        return function(i, r) {
            var u = new html2canvas.fabric.StaticCanvas("c");
            t.image = u.lowerCanvasEl;
            u.setWidth(r.width).setHeight(r.height).add(html2canvas.fabric.util.groupSVGElements(i, r)).renderAll();
            n(u.lowerCanvasEl)
        }
    }
    ;
    y.prototype.decode64 = function(t) {
        return typeof n.atob == "function" ? n.atob(t) : fr(t)
    }
    ;
    er.prototype = Object.create(y.prototype);
    k.prototype = Object.create(e.prototype);
    k.prototype.applyTextTransform = function() {
        this.node.data = this.transform(this.parent.css("textTransform"))
    }
    ;
    k.prototype.transform = function(n) {
        var t = this.node.data;
        switch (n) {
        case "lowercase":
            return t.toLowerCase();
        case "capitalize":
            return t.replace(/(^|\s|:|-|\(|\))([a-z])/g, sf);
        case "uppercase":
            return t.toUpperCase();
        default:
            return t
        }
    }
    ;
    or.prototype = Object.create(nt.prototype);
    c.prototype = Object.create(v.prototype);
    c.prototype.setFillStyle = function(n) {
        return this.ctx.fillStyle = typeof n == "object" && !!n.isColor ? n.toString() : n,
        this.ctx
    }
    ;
    c.prototype.rectangle = function(n, t, i, r, u) {
        this.setFillStyle(u).fillRect(n, t, i, r)
    }
    ;
    c.prototype.circle = function(n, t, i, r) {
        this.setFillStyle(r);
        this.ctx.beginPath();
        this.ctx.arc(n + i / 2, t + i / 2, i / 2, 0, Math.PI * 2, !0);
        this.ctx.closePath();
        this.ctx.fill()
    }
    ;
    c.prototype.circleStroke = function(n, t, i, r, u, f) {
        this.circle(n, t, i, r);
        this.ctx.strokeStyle = f.toString();
        this.ctx.stroke()
    }
    ;
    c.prototype.drawShape = function(n, t) {
        this.shape(n);
        this.setFillStyle(t).fill()
    }
    ;
    c.prototype.taints = function(n) {
        if (n.tainted === null) {
            this.taintCtx.drawImage(n.image, 0, 0);
            try {
                this.taintCtx.getImageData(0, 0, 1, 1);
                n.tainted = !1
            } catch (i) {
                this.taintCtx = t.createElement("canvas").getContext("2d");
                n.tainted = !0
            }
        }
        return n.tainted
    }
    ;
    c.prototype.drawImage = function(n, t, i, r, u, f, e, o, s) {
        (!this.taints(n) || this.options.allowTaint) && this.ctx.drawImage(n.image, t, i, r, u, f, e, o, s)
    }
    ;
    c.prototype.clip = function(n, t, i) {
        this.ctx.save();
        n.filter(hf).forEach(function(n) {
            this.shape(n).clip()
        }, this);
        t.call(i);
        this.ctx.restore()
    }
    ;
    c.prototype.shape = function(n) {
        return this.ctx.beginPath(),
        n.forEach(function(n, t) {
            n[0] === "rect" ? this.ctx.rect.apply(this.ctx, n.slice(1)) : this.ctx[t === 0 ? "moveTo" : n[0] + "To"].apply(this.ctx, n.slice(1))
        }, this),
        this.ctx.closePath(),
        this.ctx
    }
    ;
    c.prototype.font = function(n, t, i, r, u, f) {
        this.setFillStyle(n).font = [t, i, r, u, f].join(" ").split(",")[0]
    }
    ;
    c.prototype.fontShadow = function(n, t, i, r) {
        this.setVariable("shadowColor", n.toString()).setVariable("shadowOffsetY", t).setVariable("shadowOffsetX", i).setVariable("shadowBlur", r)
    }
    ;
    c.prototype.clearShadow = function() {
        this.setVariable("shadowColor", "rgba(0,0,0,0)")
    }
    ;
    c.prototype.setOpacity = function(n) {
        this.ctx.globalAlpha = n
    }
    ;
    c.prototype.setTransform = function(n) {
        this.ctx.translate(n.origin[0], n.origin[1]);
        this.ctx.transform.apply(this.ctx, n.matrix);
        this.ctx.translate(-n.origin[0], -n.origin[1])
    }
    ;
    c.prototype.setVariable = function(n, t) {
        return this.variables[n] !== t && (this.variables[n] = this.ctx[n] = t),
        this
    }
    ;
    c.prototype.text = function(n, t, i) {
        this.ctx.fillText(n, t, i)
    }
    ;
    c.prototype.backgroundRepeatShape = function(n, t, i, r, u, f, e, o, s) {
        var h = [["line", Math.round(u), Math.round(f)], ["line", Math.round(u + e), Math.round(f)], ["line", Math.round(u + e), Math.round(o + f)], ["line", Math.round(u), Math.round(o + f)]];
        this.clip([h], function() {
            this.renderBackgroundRepeat(n, t, i, r, s[3], s[0])
        }, this)
    }
    ;
    c.prototype.renderBackgroundRepeat = function(n, t, i, r, u, f) {
        var e = Math.round(r.left + t.left + u)
          , o = Math.round(r.top + t.top + f);
        this.setFillStyle(this.ctx.createPattern(this.resizeImage(n, i), "repeat"));
        this.ctx.translate(e, o);
        this.ctx.fill();
        this.ctx.translate(-e, -o)
    }
    ;
    c.prototype.renderBackgroundGradient = function(n, t) {
        if (n instanceof et) {
            var i = this.ctx.createLinearGradient(t.left + t.width * n.x0, t.top + t.height * n.y0, t.left + t.width * n.x1, t.top + t.height * n.y1);
            n.colorStops.forEach(function(n) {
                i.addColorStop(n.stop, n.color.toString())
            });
            this.rectangle(t.left, t.top, t.width, t.height, i)
        }
    }
    ;
    c.prototype.resizeImage = function(n, i) {
        var r = n.image, f, u;
        return r.width === i.width && r.height === i.height ? r : (u = t.createElement("canvas"),
        u.width = i.width,
        u.height = i.height,
        f = u.getContext("2d"),
        f.drawImage(r, 0, 0, r.width, r.height, 0, 0, i.width, i.height),
        u)
    }
}
).call({}, typeof window != "undefined" ? window : undefined, typeof document != "undefined" ? document : undefined);
/*! D:\FW_API\scripts\canvg.js*/
(function(n, t) {
    "use strict";
    typeof define != "undefined" && define.amd ? define("canvgModule", ["rgbcolor", "stackblur"], t) : typeof module != "undefined" && module.exports && (module.exports = t(require("rgbcolor"), require("stackblur")));
    n.canvg = t(n.RGBColor, n.stackBlur)
}
)(typeof window != "undefined" ? window : this, function(n, t) {
    function a(n) {
        var i = [0, 0, 0]
          , t = function(t, r) {
            var u = n.match(t);
            u != null && (i[r] += u.length,
            n = n.replace(t, " "))
        };
        return n = n.replace(/:not\(([^\)]*)\)/g, "     $1 "),
        n = n.replace(/{[\s\S]*/gm, " "),
        t(f, 1),
        t(e, 0),
        t(o, 1),
        t(s, 2),
        t(h, 1),
        t(c, 1),
        n = n.replace(/[\*\s\+>~]/g, " "),
        n = n.replace(/[#\.]/g, " "),
        t(l, 2),
        i.join("")
    }
    function v(u) {
        var f = {
            opts: u
        }, e;
        return f.FRAMERATE = 30,
        f.MAX_VIRTUAL_PIXELS = 3e4,
        f.log = function() {}
        ,
        f.opts.log == !0 && typeof console != "undefined" && (f.log = function(n) {
            console.log(n)
        }
        ),
        f.init = function(n) {
            var t = 0;
            f.UniqueId = function() {
                return t++,
                "canvg" + t
            }
            ;
            f.Definitions = {};
            f.Styles = {};
            f.StylesSpecificity = {};
            f.Animations = [];
            f.Images = [];
            f.ctx = n;
            f.ViewPort = new function() {
                this.viewPorts = [];
                this.Clear = function() {
                    this.viewPorts = []
                }
                ;
                this.SetCurrent = function(n, t) {
                    this.viewPorts.push({
                        width: n,
                        height: t
                    })
                }
                ;
                this.RemoveCurrent = function() {
                    this.viewPorts.pop()
                }
                ;
                this.Current = function() {
                    return this.viewPorts[this.viewPorts.length - 1]
                }
                ;
                this.width = function() {
                    return this.Current().width
                }
                ;
                this.height = function() {
                    return this.Current().height
                }
                ;
                this.ComputeSize = function(n) {
                    return n != null && typeof n == "number" ? n : n == "x" ? this.width() : n == "y" ? this.height() : Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2)
                }
            }
        }
        ,
        f.init(),
        f.ImagesLoaded = function() {
            for (var n = 0; n < f.Images.length; n++)
                if (!f.Images[n].loaded)
                    return !1;
            return !0
        }
        ,
        f.trim = function(n) {
            return n.replace(/^\s+|\s+$/g, "")
        }
        ,
        f.compressSpaces = function(n) {
            return n.replace(/[\s\r\t\n]+/gm, " ")
        }
        ,
        f.ajax = function(n) {
            var t;
            return (t = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"),
            t) ? (t.open("GET", n, !1),
            t.send(null),
            t.responseText) : null
        }
        ,
        f.parseXml = function(n) {
            var r, i, t;
            if (typeof Windows != "undefined" && typeof Windows.Data != "undefined" && typeof Windows.Data.Xml != "undefined")
                return t = new Windows.Data.Xml.Dom.XmlDocument,
                r = new Windows.Data.Xml.Dom.XmlLoadSettings,
                r.prohibitDtd = !1,
                t.loadXml(n, r),
                t;
            if (window.DOMParser)
                try {
                    return i = new DOMParser,
                    i.parseFromString(n, "image/svg+xml")
                } catch (u) {
                    return i = new DOMParser,
                    i.parseFromString(n, "text/xml")
                }
            else
                return n = n.replace(/<!DOCTYPE svg[^>]*>/, ""),
                t = new ActiveXObject("Microsoft.XMLDOM"),
                t.async = "false",
                t.loadXML(n),
                t
        }
        ,
        f.Property = function(n, t) {
            this.name = n;
            this.value = t
        }
        ,
        f.Property.prototype.getValue = function() {
            return this.value
        }
        ,
        f.Property.prototype.hasValue = function() {
            return this.value != null && this.value !== ""
        }
        ,
        f.Property.prototype.numValue = function() {
            if (!this.hasValue())
                return 0;
            var n = parseFloat(this.value);
            return (this.value + "").match(/%$/) && (n = n / 100),
            n
        }
        ,
        f.Property.prototype.valueOrDefault = function(n) {
            return this.hasValue() ? this.value : n
        }
        ,
        f.Property.prototype.numValueOrDefault = function(n) {
            return this.hasValue() ? this.numValue() : n
        }
        ,
        f.Property.prototype.addOpacity = function(n) {
            var i = this.value, t;
            return n.value != null && n.value != "" && typeof this.value == "string" && (t = new window.RGBColor(this.value),
            t.ok && (i = "rgba(" + t.r + ", " + t.g + ", " + t.b + ", " + n.numValue() + ")")),
            new f.Property(this.name,i)
        }
        ,
        f.Property.prototype.getDefinition = function() {
            var n = this.value.match(/#([^\)'"]+)/);
            return n && (n = n[1]),
            n || (n = this.value),
            f.Definitions[n]
        }
        ,
        f.Property.prototype.isUrlDefinition = function() {
            return this.value.indexOf("url(") == 0
        }
        ,
        f.Property.prototype.getFillStyleDefinition = function(n, t) {
            var i = this.getDefinition(), r;
            return i != null && i.createGradient ? i.createGradient(f.ctx, n, t) : i != null && i.createPattern ? (i.getHrefAttribute().hasValue() && (r = i.attribute("patternTransform"),
            i = i.getHrefAttribute().getDefinition(),
            r.hasValue() && (i.attribute("patternTransform", !0).value = r.value)),
            i.createPattern(f.ctx, n)) : null
        }
        ,
        f.Property.prototype.getDPI = function() {
            return 96
        }
        ,
        f.Property.prototype.getEM = function(n) {
            var t = 12
              , i = new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);
            return i.hasValue() && (t = i.toPixels(n)),
            t
        }
        ,
        f.Property.prototype.getUnits = function() {
            var n = this.value + "";
            return n.replace(/[0-9\.\-]/g, "")
        }
        ,
        f.Property.prototype.toPixels = function(n, t) {
            var i, r;
            return this.hasValue() ? (i = this.value + "",
            i.match(/em$/)) ? this.numValue() * this.getEM(n) : i.match(/ex$/) ? this.numValue() * this.getEM(n) / 2 : i.match(/px$/) ? this.numValue() : i.match(/pt$/) ? this.numValue() * this.getDPI(n) * (1 / 72) : i.match(/pc$/) ? this.numValue() * 15 : i.match(/cm$/) ? this.numValue() * this.getDPI(n) / 2.54 : i.match(/mm$/) ? this.numValue() * this.getDPI(n) / 25.4 : i.match(/in$/) ? this.numValue() * this.getDPI(n) : i.match(/%$/) ? this.numValue() * f.ViewPort.ComputeSize(n) : (r = this.numValue(),
            t && r < 1) ? r * f.ViewPort.ComputeSize(n) : r : 0
        }
        ,
        f.Property.prototype.toMilliseconds = function() {
            if (!this.hasValue())
                return 0;
            var n = this.value + "";
            return n.match(/s$/) ? this.numValue() * 1e3 : (n.match(/ms$/),
            this.numValue())
        }
        ,
        f.Property.prototype.toRadians = function() {
            if (!this.hasValue())
                return 0;
            var n = this.value + "";
            return n.match(/deg$/) ? this.numValue() * (Math.PI / 180) : n.match(/grad$/) ? this.numValue() * (Math.PI / 200) : n.match(/rad$/) ? this.numValue() : this.numValue() * (Math.PI / 180)
        }
        ,
        e = {
            baseline: "alphabetic",
            "before-edge": "top",
            "text-before-edge": "top",
            middle: "middle",
            central: "middle",
            "after-edge": "bottom",
            "text-after-edge": "bottom",
            ideographic: "ideographic",
            alphabetic: "alphabetic",
            hanging: "hanging",
            mathematical: "alphabetic"
        },
        f.Property.prototype.toTextBaseline = function() {
            return this.hasValue() ? e[this.value] : null
        }
        ,
        f.Font = new function() {
            this.Styles = "normal|italic|oblique|inherit";
            this.Variants = "normal|small-caps|inherit";
            this.Weights = "normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";
            this.CreateFont = function(n, t, i, r, u, e) {
                var o = e != null ? this.Parse(e) : this.CreateFont("", "", "", "", "", f.ctx.font);
                return {
                    fontFamily: u || o.fontFamily,
                    fontSize: r || o.fontSize,
                    fontStyle: n || o.fontStyle,
                    fontWeight: i || o.fontWeight,
                    fontVariant: t || o.fontVariant,
                    toString: function() {
                        return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(" ")
                    }
                }
            }
            ;
            var n = this;
            this.Parse = function(t) {
                for (var e = {}, r = f.trim(f.compressSpaces(t || "")).split(" "), u = {
                    fontSize: !1,
                    fontStyle: !1,
                    fontWeight: !1,
                    fontVariant: !1
                }, o = "", i = 0; i < r.length; i++)
                    u.fontStyle || n.Styles.indexOf(r[i]) == -1 ? u.fontVariant || n.Variants.indexOf(r[i]) == -1 ? u.fontWeight || n.Weights.indexOf(r[i]) == -1 ? u.fontSize ? r[i] != "inherit" && (o += r[i]) : (r[i] != "inherit" && (e.fontSize = r[i].split("/")[0]),
                    u.fontStyle = u.fontVariant = u.fontWeight = u.fontSize = !0) : (r[i] != "inherit" && (e.fontWeight = r[i]),
                    u.fontStyle = u.fontVariant = u.fontWeight = !0) : (r[i] != "inherit" && (e.fontVariant = r[i]),
                    u.fontStyle = u.fontVariant = !0) : (r[i] != "inherit" && (e.fontStyle = r[i]),
                    u.fontStyle = !0);
                return o != "" && (e.fontFamily = o),
                e
            }
        }
        ,
        f.ToNumberArray = function(n) {
            for (var t = f.trim(f.compressSpaces((n || "").replace(/,/g, " "))).split(" "), i = 0; i < t.length; i++)
                t[i] = parseFloat(t[i]);
            return t
        }
        ,
        f.Point = function(n, t) {
            this.x = n;
            this.y = t
        }
        ,
        f.Point.prototype.angleTo = function(n) {
            return Math.atan2(n.y - this.y, n.x - this.x)
        }
        ,
        f.Point.prototype.applyTransform = function(n) {
            var t = this.x * n[0] + this.y * n[2] + n[4]
              , i = this.x * n[1] + this.y * n[3] + n[5];
            this.x = t;
            this.y = i
        }
        ,
        f.CreatePoint = function(n) {
            var t = f.ToNumberArray(n);
            return new f.Point(t[0],t[1])
        }
        ,
        f.CreatePath = function(n) {
            for (var i = f.ToNumberArray(n), r = [], t = 0; t < i.length; t += 2)
                r.push(new f.Point(i[t],i[t + 1]));
            return r
        }
        ,
        f.BoundingBox = function(n, t, r, u) {
            this.x1 = Number.NaN;
            this.y1 = Number.NaN;
            this.x2 = Number.NaN;
            this.y2 = Number.NaN;
            this.x = function() {
                return this.x1
            }
            ;
            this.y = function() {
                return this.y1
            }
            ;
            this.width = function() {
                return this.x2 - this.x1
            }
            ;
            this.height = function() {
                return this.y2 - this.y1
            }
            ;
            this.addPoint = function(n, t) {
                n != null && ((isNaN(this.x1) || isNaN(this.x2)) && (this.x1 = n,
                this.x2 = n),
                n < this.x1 && (this.x1 = n),
                n > this.x2 && (this.x2 = n));
                t != null && ((isNaN(this.y1) || isNaN(this.y2)) && (this.y1 = t,
                this.y2 = t),
                t < this.y1 && (this.y1 = t),
                t > this.y2 && (this.y2 = t))
            }
            ;
            this.addX = function(n) {
                this.addPoint(n, null)
            }
            ;
            this.addY = function(n) {
                this.addPoint(null, n)
            }
            ;
            this.addBoundingBox = function(n) {
                this.addPoint(n.x1, n.y1);
                this.addPoint(n.x2, n.y2)
            }
            ;
            this.addQuadraticCurve = function(n, t, i, r, u, f) {
                var e = n + 2 / 3 * (i - n)
                  , o = t + 2 / 3 * (r - t)
                  , s = e + 1 / 3 * (u - n)
                  , h = o + 1 / 3 * (f - t);
                this.addBezierCurve(n, t, e, s, o, h, u, f)
            }
            ;
            this.addBezierCurve = function(n, t, r, u, f, e, o, s) {
                var h = [n, t], p = [r, u], d = [f, e], w = [o, s], a, k, v, y;
                for (this.addPoint(h[0], h[1]),
                this.addPoint(w[0], w[1]),
                i = 0; i <= 1; i++) {
                    var c = function(n) {
                        return Math.pow(1 - n, 3) * h[i] + 3 * Math.pow(1 - n, 2) * n * p[i] + 3 * (1 - n) * Math.pow(n, 2) * d[i] + Math.pow(n, 3) * w[i]
                    }
                      , l = 6 * h[i] - 12 * p[i] + 6 * d[i]
                      , b = -3 * h[i] + 9 * p[i] - 9 * d[i] + 3 * w[i]
                      , g = 3 * p[i] - 3 * h[i];
                    if (b == 0) {
                        if (l == 0)
                            continue;
                        a = -g / l;
                        0 < a && a < 1 && (i == 0 && this.addX(c(a)),
                        i == 1 && this.addY(c(a)));
                        continue
                    }
                    (k = Math.pow(l, 2) - 4 * g * b,
                    k < 0) || (v = (-l + Math.sqrt(k)) / (2 * b),
                    0 < v && v < 1 && (i == 0 && this.addX(c(v)),
                    i == 1 && this.addY(c(v))),
                    y = (-l - Math.sqrt(k)) / (2 * b),
                    0 < y && y < 1 && (i == 0 && this.addX(c(y)),
                    i == 1 && this.addY(c(y))))
                }
            }
            ;
            this.isPointInBox = function(n, t) {
                return this.x1 <= n && n <= this.x2 && this.y1 <= t && t <= this.y2
            }
            ;
            this.addPoint(n, t);
            this.addPoint(r, u)
        }
        ,
        f.Transform = function(n) {
            var r = this, i, t, u;
            for (this.Type = {},
            this.Type.translate = function(n) {
                this.p = f.CreatePoint(n);
                this.apply = function(n) {
                    n.translate(this.p.x || 0, this.p.y || 0)
                }
                ;
                this.unapply = function(n) {
                    n.translate(-1 * this.p.x || 0, -1 * this.p.y || 0)
                }
                ;
                this.applyToPoint = function(n) {
                    n.applyTransform([1, 0, 0, 1, this.p.x || 0, this.p.y || 0])
                }
            }
            ,
            this.Type.rotate = function(n) {
                var t = f.ToNumberArray(n);
                this.angle = new f.Property("angle",t[0]);
                this.cx = t[1] || 0;
                this.cy = t[2] || 0;
                this.apply = function(n) {
                    n.translate(this.cx, this.cy);
                    n.rotate(this.angle.toRadians());
                    n.translate(-this.cx, -this.cy)
                }
                ;
                this.unapply = function(n) {
                    n.translate(this.cx, this.cy);
                    n.rotate(-1 * this.angle.toRadians());
                    n.translate(-this.cx, -this.cy)
                }
                ;
                this.applyToPoint = function(n) {
                    var t = this.angle.toRadians();
                    n.applyTransform([1, 0, 0, 1, this.p.x || 0, this.p.y || 0]);
                    n.applyTransform([Math.cos(t), Math.sin(t), -Math.sin(t), Math.cos(t), 0, 0]);
                    n.applyTransform([1, 0, 0, 1, -this.p.x || 0, -this.p.y || 0])
                }
            }
            ,
            this.Type.scale = function(n) {
                this.p = f.CreatePoint(n);
                this.apply = function(n) {
                    n.scale(this.p.x || 1, this.p.y || this.p.x || 1)
                }
                ;
                this.unapply = function(n) {
                    n.scale(1 / this.p.x || 1, 1 / this.p.y || this.p.x || 1)
                }
                ;
                this.applyToPoint = function(n) {
                    n.applyTransform([this.p.x || 0, 0, 0, this.p.y || 0, 0, 0])
                }
            }
            ,
            this.Type.matrix = function(n) {
                this.m = f.ToNumberArray(n);
                this.apply = function(n) {
                    n.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5])
                }
                ;
                this.unapply = function(n) {
                    var h = this.m[0]
                      , c = this.m[2]
                      , u = this.m[4]
                      , f = this.m[1]
                      , e = this.m[3]
                      , t = this.m[5]
                      , o = 0
                      , s = 0
                      , i = 1
                      , r = 1 / (h * (e * i - t * s) - c * (f * i - t * o) + u * (f * s - e * o));
                    n.transform(r * (e * i - t * s), r * (t * o - f * i), r * (u * s - c * i), r * (h * i - u * o), r * (c * t - u * e), r * (u * f - h * t))
                }
                ;
                this.applyToPoint = function(n) {
                    n.applyTransform(this.m)
                }
            }
            ,
            this.Type.SkewBase = function(n) {
                this.base = r.Type.matrix;
                this.base(n);
                this.angle = new f.Property("angle",n)
            }
            ,
            this.Type.SkewBase.prototype = new this.Type.matrix,
            this.Type.skewX = function(n) {
                this.base = r.Type.SkewBase;
                this.base(n);
                this.m = [1, 0, Math.tan(this.angle.toRadians()), 1, 0, 0]
            }
            ,
            this.Type.skewX.prototype = new this.Type.SkewBase,
            this.Type.skewY = function(n) {
                this.base = r.Type.SkewBase;
                this.base(n);
                this.m = [1, Math.tan(this.angle.toRadians()), 0, 1, 0, 0]
            }
            ,
            this.Type.skewY.prototype = new this.Type.SkewBase,
            this.transforms = [],
            this.apply = function(n) {
                for (var t = 0; t < this.transforms.length; t++)
                    this.transforms[t].apply(n)
            }
            ,
            this.unapply = function(n) {
                for (var t = this.transforms.length - 1; t >= 0; t--)
                    this.transforms[t].unapply(n)
            }
            ,
            this.applyToPoint = function(n) {
                for (var t = 0; t < this.transforms.length; t++)
                    this.transforms[t].applyToPoint(n)
            }
            ,
            i = f.trim(f.compressSpaces(n)).replace(/\)([a-zA-Z])/g, ") $1").replace(/\)(\s?,\s?)/g, ") ").split(/\s(?=[a-z])/),
            t = 0; t < i.length; t++) {
                var e = f.trim(i[t].split("(")[0])
                  , s = i[t].split("(")[1].replace(")", "")
                  , o = this.Type[e];
                typeof o != "undefined" && (u = new o(s),
                u.type = e,
                this.transforms.push(u))
            }
        }
        ,
        f.AspectRatio = function(n, t, i, r, u, e, o, s, h, c) {
            t = f.compressSpaces(t);
            t = t.replace(/^defer\s/, "");
            var w = t.split(" ")[0] || "xMidYMid"
              , l = t.split(" ")[1] || "meet"
              , y = i / r
              , p = u / e
              , a = Math.min(y, p)
              , v = Math.max(y, p);
            l == "meet" && (r *= a,
            e *= a);
            l == "slice" && (r *= v,
            e *= v);
            h = new f.Property("refX",h);
            c = new f.Property("refY",c);
            h.hasValue() && c.hasValue() ? n.translate(-a * h.toPixels("x"), -a * c.toPixels("y")) : (w.match(/^xMid/) && (l == "meet" && a == p || l == "slice" && v == p) && n.translate(i / 2 - r / 2, 0),
            w.match(/YMid$/) && (l == "meet" && a == y || l == "slice" && v == y) && n.translate(0, u / 2 - e / 2),
            w.match(/^xMax/) && (l == "meet" && a == p || l == "slice" && v == p) && n.translate(i - r, 0),
            w.match(/YMax$/) && (l == "meet" && a == y || l == "slice" && v == y) && n.translate(0, u - e));
            w == "none" ? n.scale(y, p) : l == "meet" ? n.scale(a, a) : l == "slice" && n.scale(v, v);
            n.translate(o == null ? 0 : -o, s == null ? 0 : -s)
        }
        ,
        f.Element = {},
        f.EmptyProperty = new f.Property("EMPTY",""),
        f.Element.ElementBase = function(n) {
            var s, h, e, o, u, t, i, a;
            if (this.attributes = {},
            this.styles = {},
            this.stylesSpecificity = {},
            this.children = [],
            this.attribute = function(n, t) {
                var i = this.attributes[n];
                return i != null ? i : (t == !0 && (i = new f.Property(n,""),
                this.attributes[n] = i),
                i || f.EmptyProperty)
            }
            ,
            this.getHrefAttribute = function() {
                for (var n in this.attributes)
                    if (n == "href" || n.match(/:href$/))
                        return this.attributes[n];
                return f.EmptyProperty
            }
            ,
            this.style = function(n, t, i) {
                var r = this.styles[n], u, o, e;
                return r != null ? r : (u = this.attribute(n),
                u != null && u.hasValue()) ? (this.styles[n] = u,
                u) : i != !0 && (o = this.parent,
                o != null && (e = o.style(n),
                e != null && e.hasValue())) ? e : (t == !0 && (r = new f.Property(n,""),
                this.styles[n] = r),
                r || f.EmptyProperty)
            }
            ,
            this.render = function(n) {
                var t, i;
                this.style("display").value != "none" && this.style("visibility").value != "hidden" && (n.save(),
                this.style("mask").hasValue() ? (t = this.style("mask").getDefinition(),
                t != null && t.apply(n, this)) : this.style("filter").hasValue() ? (i = this.style("filter").getDefinition(),
                i != null && i.apply(n, this)) : (this.setContext(n),
                this.renderChildren(n),
                this.clearContext(n)),
                n.restore())
            }
            ,
            this.setContext = function() {}
            ,
            this.clearContext = function() {}
            ,
            this.renderChildren = function(n) {
                for (var t = 0; t < this.children.length; t++)
                    this.children[t].render(n)
            }
            ,
            this.addChild = function(n, t) {
                var i = n;
                t && (i = f.CreateElement(n));
                i.parent = this;
                i.type != "title" && this.children.push(i)
            }
            ,
            this.addStylesFromStyleDefinition = function() {
                var t, u, o, i, e;
                for (t in f.Styles)
                    if (t[0] != "@" && r(n, t) && (u = f.Styles[t],
                    o = f.StylesSpecificity[t],
                    u != null))
                        for (i in u)
                            e = this.stylesSpecificity[i],
                            typeof e == "undefined" && (e = "000"),
                            o > e && (this.styles[i] = u[i],
                            this.stylesSpecificity[i] = o)
            }
            ,
            s = new RegExp("^[A-Z-]+$"),
            h = function(n) {
                return s.test(n) ? n.toLowerCase() : n
            }
            ,
            n != null && n.nodeType == 1) {
                for (t = 0; t < n.attributes.length; t++)
                    e = n.attributes[t],
                    o = h(e.nodeName),
                    this.attributes[o] = new f.Property(o,e.value);
                if (this.addStylesFromStyleDefinition(),
                this.attribute("style").hasValue())
                    for (u = this.attribute("style").value.split(";"),
                    t = 0; t < u.length; t++)
                        if (f.trim(u[t]) != "") {
                            var c = u[t].split(":")
                              , l = f.trim(c[0])
                              , v = f.trim(c[1]);
                            this.styles[l] = new f.Property(l,v)
                        }
                for (this.attribute("id").hasValue() && f.Definitions[this.attribute("id").value] == null && (f.Definitions[this.attribute("id").value] = this),
                t = 0; t < n.childNodes.length; t++)
                    i = n.childNodes[t],
                    i.nodeType == 1 && this.addChild(i, !0),
                    this.captureTextNodes && (i.nodeType == 3 || i.nodeType == 4) && (a = i.value || i.text || i.textContent || "",
                    f.compressSpaces(a) != "" && this.addChild(new f.Element.tspan(i), !1))
            }
        }
        ,
        f.Element.RenderedElementBase = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.setContext = function(n) {
                var t, r, i, o, u, e, h, s;
                this.style("fill").isUrlDefinition() ? (r = this.style("fill").getFillStyleDefinition(this, this.style("fill-opacity")),
                r != null && (n.fillStyle = r)) : this.style("fill").hasValue() && (t = this.style("fill"),
                t.value == "currentColor" && (t.value = this.style("color").value),
                t.value != "inherit" && (n.fillStyle = t.value == "none" ? "rgba(0,0,0,0)" : t.value));
                this.style("fill-opacity").hasValue() && (t = new f.Property("fill",n.fillStyle),
                t = t.addOpacity(this.style("fill-opacity")),
                n.fillStyle = t.value);
                this.style("stroke").isUrlDefinition() ? (r = this.style("stroke").getFillStyleDefinition(this, this.style("stroke-opacity")),
                r != null && (n.strokeStyle = r)) : this.style("stroke").hasValue() && (i = this.style("stroke"),
                i.value == "currentColor" && (i.value = this.style("color").value),
                i.value != "inherit" && (n.strokeStyle = i.value == "none" ? "rgba(0,0,0,0)" : i.value));
                this.style("stroke-opacity").hasValue() && (i = new f.Property("stroke",n.strokeStyle),
                i = i.addOpacity(this.style("stroke-opacity")),
                n.strokeStyle = i.value);
                this.style("stroke-width").hasValue() && (o = this.style("stroke-width").toPixels(),
                n.lineWidth = o == 0 ? .001 : o);
                this.style("stroke-linecap").hasValue() && (n.lineCap = this.style("stroke-linecap").value);
                this.style("stroke-linejoin").hasValue() && (n.lineJoin = this.style("stroke-linejoin").value);
                this.style("stroke-miterlimit").hasValue() && (n.miterLimit = this.style("stroke-miterlimit").value);
                this.style("stroke-dasharray").hasValue() && this.style("stroke-dasharray").value != "none" && (u = f.ToNumberArray(this.style("stroke-dasharray").value),
                typeof n.setLineDash != "undefined" ? n.setLineDash(u) : typeof n.webkitLineDash != "undefined" ? n.webkitLineDash = u : typeof n.mozDash == "undefined" || u.length == 1 && u[0] == 0 || (n.mozDash = u),
                e = this.style("stroke-dashoffset").numValueOrDefault(1),
                typeof n.lineDashOffset != "undefined" ? n.lineDashOffset = e : typeof n.webkitLineDashOffset != "undefined" ? n.webkitLineDashOffset = e : typeof n.mozDashOffset != "undefined" && (n.mozDashOffset = e));
                typeof n.font != "undefined" && (n.font = f.Font.CreateFont(this.style("font-style").value, this.style("font-variant").value, this.style("font-weight").value, this.style("font-size").hasValue() ? this.style("font-size").toPixels() + "px" : "", this.style("font-family").value).toString());
                this.style("transform", !1, !0).hasValue() && (h = new f.Transform(this.style("transform", !1, !0).value),
                h.apply(n));
                this.style("clip-path", !1, !0).hasValue() && (s = this.style("clip-path", !1, !0).getDefinition(),
                s != null && s.apply(n));
                this.style("opacity").hasValue() && (n.globalAlpha = this.style("opacity").numValue())
            }
        }
        ,
        f.Element.RenderedElementBase.prototype = new f.Element.ElementBase,
        f.Element.PathElementBase = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.path = function(n) {
                return n != null && n.beginPath(),
                new f.BoundingBox
            }
            ;
            this.renderChildren = function(n) {
                var t, r, i;
                if (this.path(n),
                f.Mouse.checkPath(this, n),
                n.fillStyle != "" && (this.style("fill-rule").valueOrDefault("inherit") != "inherit" ? n.fill(this.style("fill-rule").value) : n.fill()),
                n.strokeStyle != "" && n.stroke(),
                t = this.getMarkers(),
                t != null) {
                    if (this.style("marker-start").isUrlDefinition() && (i = this.style("marker-start").getDefinition(),
                    i.render(n, t[0][0], t[0][1])),
                    this.style("marker-mid").isUrlDefinition())
                        for (i = this.style("marker-mid").getDefinition(),
                        r = 1; r < t.length - 1; r++)
                            i.render(n, t[r][0], t[r][1]);
                    this.style("marker-end").isUrlDefinition() && (i = this.style("marker-end").getDefinition(),
                    i.render(n, t[t.length - 1][0], t[t.length - 1][1]))
                }
            }
            ;
            this.getBoundingBox = function() {
                return this.path()
            }
            ;
            this.getMarkers = function() {
                return null
            }
        }
        ,
        f.Element.PathElementBase.prototype = new f.Element.RenderedElementBase,
        f.Element.svg = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.baseClearContext = this.clearContext;
            this.clearContext = function(n) {
                this.baseClearContext(n);
                f.ViewPort.RemoveCurrent()
            }
            ;
            this.baseSetContext = this.setContext;
            this.setContext = function(n) {
                var t, i, u, e;
                if (n.strokeStyle = "rgba(0,0,0,0)",
                n.lineCap = "butt",
                n.lineJoin = "miter",
                n.miterLimit = 4,
                typeof n.font != "undefined" && typeof getComputedStyle != "undefined" && (n.font = window.getComputedStyle(n.canvas).getPropertyValue("font")),
                this.baseSetContext(n),
                this.attribute("x").hasValue() || (this.attribute("x", !0).value = 0),
                this.attribute("y").hasValue() || (this.attribute("y", !0).value = 0),
                n.translate(this.attribute("x").toPixels("x"), this.attribute("y").toPixels("y")),
                t = f.ViewPort.width(),
                i = f.ViewPort.height(),
                this.attribute("width").hasValue() || (this.attribute("width", !0).value = "100%"),
                this.attribute("height").hasValue() || (this.attribute("height", !0).value = "100%"),
                typeof this.root == "undefined" && (t = this.attribute("width").toPixels("x"),
                i = this.attribute("height").toPixels("y"),
                u = 0,
                e = 0,
                this.attribute("refX").hasValue() && this.attribute("refY").hasValue() && (u = -this.attribute("refX").toPixels("x"),
                e = -this.attribute("refY").toPixels("y")),
                this.attribute("overflow").valueOrDefault("hidden") != "visible" && (n.beginPath(),
                n.moveTo(u, e),
                n.lineTo(t, e),
                n.lineTo(t, i),
                n.lineTo(u, i),
                n.closePath(),
                n.clip())),
                f.ViewPort.SetCurrent(t, i),
                this.attribute("viewBox").hasValue()) {
                    var r = f.ToNumberArray(this.attribute("viewBox").value)
                      , o = r[0]
                      , s = r[1];
                    t = r[2];
                    i = r[3];
                    f.AspectRatio(n, this.attribute("preserveAspectRatio").value, f.ViewPort.width(), t, f.ViewPort.height(), i, o, s, this.attribute("refX").value, this.attribute("refY").value);
                    f.ViewPort.RemoveCurrent();
                    f.ViewPort.SetCurrent(r[2], r[3])
                }
            }
        }
        ,
        f.Element.svg.prototype = new f.Element.RenderedElementBase,
        f.Element.rect = function(n) {
            this.base = f.Element.PathElementBase;
            this.base(n);
            this.path = function(n) {
                var t = this.attribute("x").toPixels("x")
                  , i = this.attribute("y").toPixels("y")
                  , u = this.attribute("width").toPixels("x")
                  , e = this.attribute("height").toPixels("y")
                  , r = this.attribute("rx").toPixels("x")
                  , o = this.attribute("ry").toPixels("y");
                return this.attribute("rx").hasValue() && !this.attribute("ry").hasValue() && (o = r),
                this.attribute("ry").hasValue() && !this.attribute("rx").hasValue() && (r = o),
                r = Math.min(r, u / 2),
                o = Math.min(o, e / 2),
                n != null && (n.beginPath(),
                n.moveTo(t + r, i),
                n.lineTo(t + u - r, i),
                n.quadraticCurveTo(t + u, i, t + u, i + o),
                n.lineTo(t + u, i + e - o),
                n.quadraticCurveTo(t + u, i + e, t + u - r, i + e),
                n.lineTo(t + r, i + e),
                n.quadraticCurveTo(t, i + e, t, i + e - o),
                n.lineTo(t, i + o),
                n.quadraticCurveTo(t, i, t + r, i),
                n.closePath()),
                new f.BoundingBox(t,i,t + u,i + e)
            }
        }
        ,
        f.Element.rect.prototype = new f.Element.PathElementBase,
        f.Element.circle = function(n) {
            this.base = f.Element.PathElementBase;
            this.base(n);
            this.path = function(n) {
                var i = this.attribute("cx").toPixels("x")
                  , r = this.attribute("cy").toPixels("y")
                  , t = this.attribute("r").toPixels();
                return n != null && (n.beginPath(),
                n.arc(i, r, t, 0, Math.PI * 2, !0),
                n.closePath()),
                new f.BoundingBox(i - t,r - t,i + t,r + t)
            }
        }
        ,
        f.Element.circle.prototype = new f.Element.PathElementBase,
        f.Element.ellipse = function(n) {
            this.base = f.Element.PathElementBase;
            this.base(n);
            this.path = function(n) {
                var e = 4 * ((Math.sqrt(2) - 1) / 3)
                  , u = this.attribute("rx").toPixels("x")
                  , r = this.attribute("ry").toPixels("y")
                  , t = this.attribute("cx").toPixels("x")
                  , i = this.attribute("cy").toPixels("y");
                return n != null && (n.beginPath(),
                n.moveTo(t, i - r),
                n.bezierCurveTo(t + e * u, i - r, t + u, i - e * r, t + u, i),
                n.bezierCurveTo(t + u, i + e * r, t + e * u, i + r, t, i + r),
                n.bezierCurveTo(t - e * u, i + r, t - u, i + e * r, t - u, i),
                n.bezierCurveTo(t - u, i - e * r, t - e * u, i - r, t, i - r),
                n.closePath()),
                new f.BoundingBox(t - u,i - r,t + u,i + r)
            }
        }
        ,
        f.Element.ellipse.prototype = new f.Element.PathElementBase,
        f.Element.line = function(n) {
            this.base = f.Element.PathElementBase;
            this.base(n);
            this.getPoints = function() {
                return [new f.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")), new f.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]
            }
            ;
            this.path = function(n) {
                var t = this.getPoints();
                return n != null && (n.beginPath(),
                n.moveTo(t[0].x, t[0].y),
                n.lineTo(t[1].x, t[1].y)),
                new f.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)
            }
            ;
            this.getMarkers = function() {
                var n = this.getPoints()
                  , t = n[0].angleTo(n[1]);
                return [[n[0], t], [n[1], t]]
            }
        }
        ,
        f.Element.line.prototype = new f.Element.PathElementBase,
        f.Element.polyline = function(n) {
            this.base = f.Element.PathElementBase;
            this.base(n);
            this.points = f.CreatePath(this.attribute("points").value);
            this.path = function(n) {
                var i = new f.BoundingBox(this.points[0].x,this.points[0].y), t;
                for (n != null && (n.beginPath(),
                n.moveTo(this.points[0].x, this.points[0].y)),
                t = 1; t < this.points.length; t++)
                    i.addPoint(this.points[t].x, this.points[t].y),
                    n != null && n.lineTo(this.points[t].x, this.points[t].y);
                return i
            }
            ;
            this.getMarkers = function() {
                for (var n = [], t = 0; t < this.points.length - 1; t++)
                    n.push([this.points[t], this.points[t].angleTo(this.points[t + 1])]);
                return n.length > 0 && n.push([this.points[this.points.length - 1], n[n.length - 1][1]]),
                n
            }
        }
        ,
        f.Element.polyline.prototype = new f.Element.PathElementBase,
        f.Element.polygon = function(n) {
            this.base = f.Element.polyline;
            this.base(n);
            this.basePath = this.path;
            this.path = function(n) {
                var t = this.basePath(n);
                return n != null && (n.lineTo(this.points[0].x, this.points[0].y),
                n.closePath()),
                t
            }
        }
        ,
        f.Element.polygon.prototype = new f.Element.polyline,
        f.Element.path = function(n) {
            var t, i;
            for (this.base = f.Element.PathElementBase,
            this.base(n),
            t = this.attribute("d").value,
            t = t.replace(/,/gm, " "),
            i = 0; i < 2; i++)
                t = t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm, "$1 $2");
            for (t = t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm, "$1 $2"),
            t = t.replace(/([0-9])([+\-])/gm, "$1 $2"),
            i = 0; i < 2; i++)
                t = t.replace(/(\.[0-9]*)(\.)/gm, "$1 $2");
            t = t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm, "$1 $3 $4 ");
            t = f.compressSpaces(t);
            t = f.trim(t);
            this.PathParser = new function(n) {
                this.tokens = n.split(" ");
                this.reset = function() {
                    this.i = -1;
                    this.command = "";
                    this.previousCommand = "";
                    this.start = new f.Point(0,0);
                    this.control = new f.Point(0,0);
                    this.current = new f.Point(0,0);
                    this.points = [];
                    this.angles = []
                }
                ;
                this.isEnd = function() {
                    return this.i >= this.tokens.length - 1
                }
                ;
                this.isCommandOrEnd = function() {
                    return this.isEnd() ? !0 : this.tokens[this.i + 1].match(/^[A-Za-z]$/) != null
                }
                ;
                this.isRelativeCommand = function() {
                    switch (this.command) {
                    case "m":
                    case "l":
                    case "h":
                    case "v":
                    case "c":
                    case "s":
                    case "q":
                    case "t":
                    case "a":
                    case "z":
                        return !0
                    }
                    return !1
                }
                ;
                this.getToken = function() {
                    return this.i++,
                    this.tokens[this.i]
                }
                ;
                this.getScalar = function() {
                    return parseFloat(this.getToken())
                }
                ;
                this.nextCommand = function() {
                    this.previousCommand = this.command;
                    this.command = this.getToken()
                }
                ;
                this.getPoint = function() {
                    var n = new f.Point(this.getScalar(),this.getScalar());
                    return this.makeAbsolute(n)
                }
                ;
                this.getAsControlPoint = function() {
                    var n = this.getPoint();
                    return this.control = n,
                    n
                }
                ;
                this.getAsCurrentPoint = function() {
                    var n = this.getPoint();
                    return this.current = n,
                    n
                }
                ;
                this.getReflectedControlPoint = function() {
                    if (this.previousCommand.toLowerCase() != "c" && this.previousCommand.toLowerCase() != "s" && this.previousCommand.toLowerCase() != "q" && this.previousCommand.toLowerCase() != "t")
                        return this.current;
                    return new f.Point(2 * this.current.x - this.control.x,2 * this.current.y - this.control.y)
                }
                ;
                this.makeAbsolute = function(n) {
                    return this.isRelativeCommand() && (n.x += this.current.x,
                    n.y += this.current.y),
                    n
                }
                ;
                this.addMarker = function(n, t, i) {
                    i != null && this.angles.length > 0 && this.angles[this.angles.length - 1] == null && (this.angles[this.angles.length - 1] = this.points[this.points.length - 1].angleTo(i));
                    this.addMarkerAngle(n, t == null ? null : t.angleTo(n))
                }
                ;
                this.addMarkerAngle = function(n, t) {
                    this.points.push(n);
                    this.angles.push(t)
                }
                ;
                this.getMarkerPoints = function() {
                    return this.points
                }
                ;
                this.getMarkerAngles = function() {
                    for (var t, n = 0; n < this.angles.length; n++)
                        if (this.angles[n] == null)
                            for (t = n + 1; t < this.angles.length; t++)
                                if (this.angles[t] != null) {
                                    this.angles[n] = this.angles[t];
                                    break
                                }
                    return this.angles
                }
            }
            (t);
            this.path = function(n) {
                var t = this.PathParser, c, ft, u, y, s, r, i, w;
                for (t.reset(),
                c = new f.BoundingBox,
                n != null && n.beginPath(); !t.isEnd(); ) {
                    t.nextCommand();
                    switch (t.command) {
                    case "M":
                    case "m":
                        for (u = t.getAsCurrentPoint(),
                        t.addMarker(u),
                        c.addPoint(u.x, u.y),
                        n != null && n.moveTo(u.x, u.y),
                        t.start = t.current; !t.isCommandOrEnd(); )
                            u = t.getAsCurrentPoint(),
                            t.addMarker(u, t.start),
                            c.addPoint(u.x, u.y),
                            n != null && n.lineTo(u.x, u.y);
                        break;
                    case "L":
                    case "l":
                        while (!t.isCommandOrEnd())
                            ft = t.current,
                            u = t.getAsCurrentPoint(),
                            t.addMarker(u, ft),
                            c.addPoint(u.x, u.y),
                            n != null && n.lineTo(u.x, u.y);
                        break;
                    case "H":
                    case "h":
                        while (!t.isCommandOrEnd())
                            y = new f.Point((t.isRelativeCommand() ? t.current.x : 0) + t.getScalar(),t.current.y),
                            t.addMarker(y, t.current),
                            t.current = y,
                            c.addPoint(t.current.x, t.current.y),
                            n != null && n.lineTo(t.current.x, t.current.y);
                        break;
                    case "V":
                    case "v":
                        while (!t.isCommandOrEnd())
                            y = new f.Point(t.current.x,(t.isRelativeCommand() ? t.current.y : 0) + t.getScalar()),
                            t.addMarker(y, t.current),
                            t.current = y,
                            c.addPoint(t.current.x, t.current.y),
                            n != null && n.lineTo(t.current.x, t.current.y);
                        break;
                    case "C":
                    case "c":
                        while (!t.isCommandOrEnd()) {
                            var s = t.current
                              , l = t.getPoint()
                              , r = t.getAsControlPoint()
                              , i = t.getAsCurrentPoint();
                            t.addMarker(i, r, l);
                            c.addBezierCurve(s.x, s.y, l.x, l.y, r.x, r.y, i.x, i.y);
                            n != null && n.bezierCurveTo(l.x, l.y, r.x, r.y, i.x, i.y)
                        }
                        break;
                    case "S":
                    case "s":
                        while (!t.isCommandOrEnd()) {
                            var s = t.current
                              , l = t.getReflectedControlPoint()
                              , r = t.getAsControlPoint()
                              , i = t.getAsCurrentPoint();
                            t.addMarker(i, r, l);
                            c.addBezierCurve(s.x, s.y, l.x, l.y, r.x, r.y, i.x, i.y);
                            n != null && n.bezierCurveTo(l.x, l.y, r.x, r.y, i.x, i.y)
                        }
                        break;
                    case "Q":
                    case "q":
                        while (!t.isCommandOrEnd()) {
                            var s = t.current
                              , r = t.getAsControlPoint()
                              , i = t.getAsCurrentPoint();
                            t.addMarker(i, r, r);
                            c.addQuadraticCurve(s.x, s.y, r.x, r.y, i.x, i.y);
                            n != null && n.quadraticCurveTo(r.x, r.y, i.x, i.y)
                        }
                        break;
                    case "T":
                    case "t":
                        while (!t.isCommandOrEnd())
                            s = t.current,
                            r = t.getReflectedControlPoint(),
                            t.control = r,
                            i = t.getAsCurrentPoint(),
                            t.addMarker(i, r, r),
                            c.addQuadraticCurve(s.x, s.y, r.x, r.y, i.x, i.y),
                            n != null && n.quadraticCurveTo(r.x, r.y, i.x, i.y);
                        break;
                    case "A":
                    case "a":
                        while (!t.isCommandOrEnd()) {
                            var s = t.current
                              , e = t.getScalar()
                              , o = t.getScalar()
                              , a = t.getScalar() * (Math.PI / 180)
                              , ct = t.getScalar()
                              , g = t.getScalar()
                              , i = t.getAsCurrentPoint()
                              , h = new f.Point(Math.cos(a) * (s.x - i.x) / 2 + Math.sin(a) * (s.y - i.y) / 2,-Math.sin(a) * (s.x - i.x) / 2 + Math.cos(a) * (s.y - i.y) / 2)
                              , nt = Math.pow(h.x, 2) / Math.pow(e, 2) + Math.pow(h.y, 2) / Math.pow(o, 2);
                            nt > 1 && (e *= Math.sqrt(nt),
                            o *= Math.sqrt(nt));
                            w = (ct == g ? -1 : 1) * Math.sqrt((Math.pow(e, 2) * Math.pow(o, 2) - Math.pow(e, 2) * Math.pow(h.y, 2) - Math.pow(o, 2) * Math.pow(h.x, 2)) / (Math.pow(e, 2) * Math.pow(h.y, 2) + Math.pow(o, 2) * Math.pow(h.x, 2)));
                            isNaN(w) && (w = 0);
                            var v = new f.Point(w * e * h.y / o,w * -o * h.x / e)
                              , p = new f.Point((s.x + i.x) / 2 + Math.cos(a) * v.x - Math.sin(a) * v.y,(s.y + i.y) / 2 + Math.sin(a) * v.x + Math.cos(a) * v.y)
                              , et = function(n) {
                                return Math.sqrt(Math.pow(n[0], 2) + Math.pow(n[1], 2))
                            }
                              , b = function(n, t) {
                                return (n[0] * t[0] + n[1] * t[1]) / (et(n) * et(t))
                            }
                              , ot = function(n, t) {
                                return (n[0] * t[1] < n[1] * t[0] ? -1 : 1) * Math.acos(b(n, t))
                            }
                              , tt = ot([1, 0], [(h.x - v.x) / e, (h.y - v.y) / o])
                              , it = [(h.x - v.x) / e, (h.y - v.y) / o]
                              , rt = [(-h.x - v.x) / e, (-h.y - v.y) / o]
                              , k = ot(it, rt);
                            b(it, rt) <= -1 && (k = Math.PI);
                            b(it, rt) >= 1 && (k = 0);
                            var ut = 1 - g ? 1 : -1
                              , d = tt + ut * (k / 2)
                              , lt = new f.Point(p.x + e * Math.cos(d),p.y + o * Math.sin(d));
                            if (t.addMarkerAngle(lt, d - ut * Math.PI / 2),
                            t.addMarkerAngle(i, d - ut * Math.PI),
                            c.addPoint(i.x, i.y),
                            n != null) {
                                var b = e > o ? e : o
                                  , st = e > o ? 1 : e / o
                                  , ht = e > o ? o / e : 1;
                                n.translate(p.x, p.y);
                                n.rotate(a);
                                n.scale(st, ht);
                                n.arc(0, 0, b, tt, tt + k, 1 - g);
                                n.scale(1 / st, 1 / ht);
                                n.rotate(-a);
                                n.translate(-p.x, -p.y)
                            }
                        }
                        break;
                    case "Z":
                    case "z":
                        n != null && n.closePath();
                        t.current = t.start
                    }
                }
                return c
            }
            ;
            this.getMarkers = function() {
                for (var t = this.PathParser.getMarkerPoints(), r = this.PathParser.getMarkerAngles(), i = [], n = 0; n < t.length; n++)
                    i.push([t[n], r[n]]);
                return i
            }
        }
        ,
        f.Element.path.prototype = new f.Element.PathElementBase,
        f.Element.pattern = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.createPattern = function(n) {
                var o = this.attribute("width").toPixels("x", !0), s = this.attribute("height").toPixels("y", !0), t = new f.Element.svg, i, r, u, e;
                for (t.attributes.viewBox = new f.Property("viewBox",this.attribute("viewBox").value),
                t.attributes.width = new f.Property("width",o + "px"),
                t.attributes.height = new f.Property("height",s + "px"),
                t.attributes.transform = new f.Property("transform",this.attribute("patternTransform").value),
                t.children = this.children,
                i = document.createElement("canvas"),
                i.width = o,
                i.height = s,
                r = i.getContext("2d"),
                this.attribute("x").hasValue() && this.attribute("y").hasValue() && r.translate(this.attribute("x").toPixels("x", !0), this.attribute("y").toPixels("y", !0)),
                u = -1; u <= 1; u++)
                    for (e = -1; e <= 1; e++)
                        r.save(),
                        t.attributes.x = new f.Property("x",u * i.width),
                        t.attributes.y = new f.Property("y",e * i.height),
                        t.render(r),
                        r.restore();
                return n.createPattern(i, "repeat")
            }
        }
        ,
        f.Element.pattern.prototype = new f.Element.ElementBase,
        f.Element.marker = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.baseRender = this.render;
            this.render = function(n, t, i) {
                n.translate(t.x, t.y);
                this.attribute("orient").valueOrDefault("auto") == "auto" && n.rotate(i);
                this.attribute("markerUnits").valueOrDefault("strokeWidth") == "strokeWidth" && n.scale(n.lineWidth, n.lineWidth);
                n.save();
                var r = new f.Element.svg;
                r.attributes.viewBox = new f.Property("viewBox",this.attribute("viewBox").value);
                r.attributes.refX = new f.Property("refX",this.attribute("refX").value);
                r.attributes.refY = new f.Property("refY",this.attribute("refY").value);
                r.attributes.width = new f.Property("width",this.attribute("markerWidth").value);
                r.attributes.height = new f.Property("height",this.attribute("markerHeight").value);
                r.attributes.fill = new f.Property("fill",this.attribute("fill").valueOrDefault("black"));
                r.attributes.stroke = new f.Property("stroke",this.attribute("stroke").valueOrDefault("none"));
                r.children = this.children;
                r.render(n);
                n.restore();
                this.attribute("markerUnits").valueOrDefault("strokeWidth") == "strokeWidth" && n.scale(1 / n.lineWidth, 1 / n.lineWidth);
                this.attribute("orient").valueOrDefault("auto") == "auto" && n.rotate(-i);
                n.translate(-t.x, -t.y)
            }
        }
        ,
        f.Element.marker.prototype = new f.Element.ElementBase,
        f.Element.defs = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.render = function() {}
        }
        ,
        f.Element.defs.prototype = new f.Element.ElementBase,
        f.Element.GradientBase = function(n) {
            var t, i;
            for (this.base = f.Element.ElementBase,
            this.base(n),
            this.stops = [],
            t = 0; t < this.children.length; t++)
                i = this.children[t],
                i.type == "stop" && this.stops.push(i);
            this.getGradient = function() {}
            ;
            this.gradientUnits = function() {
                return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")
            }
            ;
            this.attributesToInherit = ["gradientUnits"];
            this.inheritStopContainer = function(n) {
                for (var t, i = 0; i < this.attributesToInherit.length; i++)
                    t = this.attributesToInherit[i],
                    !this.attribute(t).hasValue() && n.attribute(t).hasValue() && (this.attribute(t, !0).value = n.attribute(t).value)
            }
            ;
            this.createGradient = function(n, t, i) {
                var r = this, v, o, s, h, e, l, u, c, a;
                if (this.getHrefAttribute().hasValue() && (r = this.getHrefAttribute().getDefinition(),
                this.inheritStopContainer(r)),
                v = function(n) {
                    if (i.hasValue()) {
                        var t = new f.Property("color",n);
                        return t.addOpacity(i).value
                    }
                    return n
                }
                ,
                o = this.getGradient(n, t),
                o == null)
                    return v(r.stops[r.stops.length - 1].color);
                for (s = 0; s < r.stops.length; s++)
                    o.addColorStop(r.stops[s].offset, v(r.stops[s].color));
                return this.attribute("gradientTransform").hasValue() ? (h = f.ViewPort.viewPorts[0],
                e = new f.Element.rect,
                e.attributes.x = new f.Property("x",-f.MAX_VIRTUAL_PIXELS / 3),
                e.attributes.y = new f.Property("y",-f.MAX_VIRTUAL_PIXELS / 3),
                e.attributes.width = new f.Property("width",f.MAX_VIRTUAL_PIXELS),
                e.attributes.height = new f.Property("height",f.MAX_VIRTUAL_PIXELS),
                l = new f.Element.g,
                l.attributes.transform = new f.Property("transform",this.attribute("gradientTransform").value),
                l.children = [e],
                u = new f.Element.svg,
                u.attributes.x = new f.Property("x",0),
                u.attributes.y = new f.Property("y",0),
                u.attributes.width = new f.Property("width",h.width),
                u.attributes.height = new f.Property("height",h.height),
                u.children = [l],
                c = document.createElement("canvas"),
                c.width = h.width,
                c.height = h.height,
                a = c.getContext("2d"),
                a.fillStyle = o,
                u.render(a),
                a.createPattern(c, "no-repeat")) : o
            }
        }
        ,
        f.Element.GradientBase.prototype = new f.Element.ElementBase,
        f.Element.linearGradient = function(n) {
            this.base = f.Element.GradientBase;
            this.base(n);
            this.attributesToInherit.push("x1");
            this.attributesToInherit.push("y1");
            this.attributesToInherit.push("x2");
            this.attributesToInherit.push("y2");
            this.getGradient = function(n, t) {
                var i = this.gradientUnits() == "objectBoundingBox" ? t.getBoundingBox() : null;
                this.attribute("x1").hasValue() || this.attribute("y1").hasValue() || this.attribute("x2").hasValue() || this.attribute("y2").hasValue() || (this.attribute("x1", !0).value = 0,
                this.attribute("y1", !0).value = 0,
                this.attribute("x2", !0).value = 1,
                this.attribute("y2", !0).value = 0);
                var r = this.gradientUnits() == "objectBoundingBox" ? i.x() + i.width() * this.attribute("x1").numValue() : this.attribute("x1").toPixels("x")
                  , u = this.gradientUnits() == "objectBoundingBox" ? i.y() + i.height() * this.attribute("y1").numValue() : this.attribute("y1").toPixels("y")
                  , f = this.gradientUnits() == "objectBoundingBox" ? i.x() + i.width() * this.attribute("x2").numValue() : this.attribute("x2").toPixels("x")
                  , e = this.gradientUnits() == "objectBoundingBox" ? i.y() + i.height() * this.attribute("y2").numValue() : this.attribute("y2").toPixels("y");
                return r == f && u == e ? null : n.createLinearGradient(r, u, f, e)
            }
        }
        ,
        f.Element.linearGradient.prototype = new f.Element.GradientBase,
        f.Element.radialGradient = function(n) {
            this.base = f.Element.GradientBase;
            this.base(n);
            this.attributesToInherit.push("cx");
            this.attributesToInherit.push("cy");
            this.attributesToInherit.push("r");
            this.attributesToInherit.push("fx");
            this.attributesToInherit.push("fy");
            this.getGradient = function(n, t) {
                var i = t.getBoundingBox(), o;
                this.attribute("cx").hasValue() || (this.attribute("cx", !0).value = "50%");
                this.attribute("cy").hasValue() || (this.attribute("cy", !0).value = "50%");
                this.attribute("r").hasValue() || (this.attribute("r", !0).value = "50%");
                var r = this.gradientUnits() == "objectBoundingBox" ? i.x() + i.width() * this.attribute("cx").numValue() : this.attribute("cx").toPixels("x")
                  , u = this.gradientUnits() == "objectBoundingBox" ? i.y() + i.height() * this.attribute("cy").numValue() : this.attribute("cy").toPixels("y")
                  , f = r
                  , e = u;
                return this.attribute("fx").hasValue() && (f = this.gradientUnits() == "objectBoundingBox" ? i.x() + i.width() * this.attribute("fx").numValue() : this.attribute("fx").toPixels("x")),
                this.attribute("fy").hasValue() && (e = this.gradientUnits() == "objectBoundingBox" ? i.y() + i.height() * this.attribute("fy").numValue() : this.attribute("fy").toPixels("y")),
                o = this.gradientUnits() == "objectBoundingBox" ? (i.width() + i.height()) / 2 * this.attribute("r").numValue() : this.attribute("r").toPixels(),
                n.createRadialGradient(f, e, 0, r, u, o)
            }
        }
        ,
        f.Element.radialGradient.prototype = new f.Element.GradientBase,
        f.Element.stop = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.offset = this.attribute("offset").numValue();
            this.offset < 0 && (this.offset = 0);
            this.offset > 1 && (this.offset = 1);
            var t = this.style("stop-color", !0);
            t.value === "" && (t.value = "#000");
            this.style("stop-opacity").hasValue() && (t = t.addOpacity(this.style("stop-opacity")));
            this.color = t.value
        }
        ,
        f.Element.stop.prototype = new f.Element.ElementBase,
        f.Element.AnimateBase = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            f.Animations.push(this);
            this.duration = 0;
            this.begin = this.attribute("begin").toMilliseconds();
            this.maxDuration = this.begin + this.attribute("dur").toMilliseconds();
            this.getProperty = function() {
                var t = this.attribute("attributeType").value
                  , n = this.attribute("attributeName").value;
                return t == "CSS" ? this.parent.style(n, !0) : this.parent.attribute(n, !0)
            }
            ;
            this.initialValue = null;
            this.initialUnits = "";
            this.removed = !1;
            this.calcValue = function() {
                return ""
            }
            ;
            this.update = function(n) {
                var i, t, r;
                if (this.initialValue == null && (this.initialValue = this.getProperty().value,
                this.initialUnits = this.getProperty().getUnits()),
                this.duration > this.maxDuration) {
                    if (this.attribute("repeatCount").value == "indefinite" || this.attribute("repeatDur").value == "indefinite")
                        this.duration = 0;
                    else if (this.attribute("fill").valueOrDefault("remove") != "freeze" || this.frozen) {
                        if (this.attribute("fill").valueOrDefault("remove") == "remove" && !this.removed)
                            return this.removed = !0,
                            this.getProperty().value = this.parent.animationFrozen ? this.parent.animationFrozenValue : this.initialValue,
                            !0
                    } else
                        this.frozen = !0,
                        this.parent.animationFrozen = !0,
                        this.parent.animationFrozenValue = this.getProperty().value;
                    return !1
                }
                return this.duration = this.duration + n,
                i = !1,
                this.begin < this.duration && (t = this.calcValue(),
                this.attribute("type").hasValue() && (r = this.attribute("type").value,
                t = r + "(" + t + ")"),
                this.getProperty().value = t,
                i = !0),
                i
            }
            ;
            this.from = this.attribute("from");
            this.to = this.attribute("to");
            this.values = this.attribute("values");
            this.values.hasValue() && (this.values.value = this.values.value.split(";"));
            this.progress = function() {
                var n = {
                    progress: (this.duration - this.begin) / (this.maxDuration - this.begin)
                };
                if (this.values.hasValue()) {
                    var t = n.progress * (this.values.value.length - 1)
                      , i = Math.floor(t)
                      , r = Math.ceil(t);
                    n.from = new f.Property("from",parseFloat(this.values.value[i]));
                    n.to = new f.Property("to",parseFloat(this.values.value[r]));
                    n.progress = (t - i) / (r - i)
                } else
                    n.from = this.from,
                    n.to = this.to;
                return n
            }
        }
        ,
        f.Element.AnimateBase.prototype = new f.Element.ElementBase,
        f.Element.animate = function(n) {
            this.base = f.Element.AnimateBase;
            this.base(n);
            this.calcValue = function() {
                var n = this.progress()
                  , t = n.from.numValue() + (n.to.numValue() - n.from.numValue()) * n.progress;
                return t + this.initialUnits
            }
        }
        ,
        f.Element.animate.prototype = new f.Element.AnimateBase,
        f.Element.animateColor = function(t) {
            this.base = f.Element.AnimateBase;
            this.base(t);
            this.calcValue = function() {
                var i = this.progress()
                  , t = new n(i.from.value)
                  , r = new n(i.to.value);
                if (t.ok && r.ok) {
                    var u = t.r + (r.r - t.r) * i.progress
                      , f = t.g + (r.g - t.g) * i.progress
                      , e = t.b + (r.b - t.b) * i.progress;
                    return "rgb(" + parseInt(u, 10) + "," + parseInt(f, 10) + "," + parseInt(e, 10) + ")"
                }
                return this.attribute("from").value
            }
        }
        ,
        f.Element.animateColor.prototype = new f.Element.AnimateBase,
        f.Element.animateTransform = function(n) {
            this.base = f.Element.AnimateBase;
            this.base(n);
            this.calcValue = function() {
                for (var t = this.progress(), i = f.ToNumberArray(t.from.value), u = f.ToNumberArray(t.to.value), r = "", n = 0; n < i.length; n++)
                    r += i[n] + (u[n] - i[n]) * t.progress + " ";
                return r
            }
        }
        ,
        f.Element.animateTransform.prototype = new f.Element.animate,
        f.Element.font = function(n) {
            var i, t;
            for (this.base = f.Element.ElementBase,
            this.base(n),
            this.horizAdvX = this.attribute("horiz-adv-x").numValue(),
            this.isRTL = !1,
            this.isArabic = !1,
            this.fontFace = null,
            this.missingGlyph = null,
            this.glyphs = [],
            i = 0; i < this.children.length; i++)
                t = this.children[i],
                t.type == "font-face" ? (this.fontFace = t,
                t.style("font-family").hasValue() && (f.Definitions[t.style("font-family").value] = this)) : t.type == "missing-glyph" ? this.missingGlyph = t : t.type == "glyph" && (t.arabicForm != "" ? (this.isRTL = !0,
                this.isArabic = !0,
                typeof this.glyphs[t.unicode] == "undefined" && (this.glyphs[t.unicode] = []),
                this.glyphs[t.unicode][t.arabicForm] = t) : this.glyphs[t.unicode] = t)
        }
        ,
        f.Element.font.prototype = new f.Element.ElementBase,
        f.Element.fontface = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.ascent = this.attribute("ascent").value;
            this.descent = this.attribute("descent").value;
            this.unitsPerEm = this.attribute("units-per-em").numValue()
        }
        ,
        f.Element.fontface.prototype = new f.Element.ElementBase,
        f.Element.missingglyph = function(n) {
            this.base = f.Element.path;
            this.base(n);
            this.horizAdvX = 0
        }
        ,
        f.Element.missingglyph.prototype = new f.Element.path,
        f.Element.glyph = function(n) {
            this.base = f.Element.path;
            this.base(n);
            this.horizAdvX = this.attribute("horiz-adv-x").numValue();
            this.unicode = this.attribute("unicode").value;
            this.arabicForm = this.attribute("arabic-form").value
        }
        ,
        f.Element.glyph.prototype = new f.Element.path,
        f.Element.text = function(n) {
            this.captureTextNodes = !0;
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.baseSetContext = this.setContext;
            this.setContext = function(n) {
                this.baseSetContext(n);
                var t = this.style("dominant-baseline").toTextBaseline();
                t == null && (t = this.style("alignment-baseline").toTextBaseline());
                t != null && (n.textBaseline = t)
            }
            ;
            this.getBoundingBox = function() {
                var n = this.attribute("x").toPixels("x")
                  , t = this.attribute("y").toPixels("y")
                  , i = this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize);
                return new f.BoundingBox(n,t - i,n + Math.floor(i * 2 / 3) * this.children[0].getText().length,t)
            }
            ;
            this.renderChildren = function(n) {
                this.x = this.attribute("x").toPixels("x");
                this.y = this.attribute("y").toPixels("y");
                this.attribute("dx").hasValue() && (this.x += this.attribute("dx").toPixels("x"));
                this.attribute("dy").hasValue() && (this.y += this.attribute("dy").toPixels("y"));
                this.x += this.getAnchorDelta(n, this, 0);
                for (var t = 0; t < this.children.length; t++)
                    this.renderChild(n, this, this, t)
            }
            ;
            this.getAnchorDelta = function(n, t, i) {
                var e = this.style("text-anchor").valueOrDefault("start"), u, r, f;
                if (e != "start") {
                    for (u = 0,
                    r = i; r < t.children.length; r++) {
                        if (f = t.children[r],
                        r > i && f.attribute("x").hasValue())
                            break;
                        u += f.measureTextRecursive(n)
                    }
                    return -1 * (e == "end" ? u : u / 2)
                }
                return 0
            }
            ;
            this.renderChild = function(n, t, i, r) {
                var u = i.children[r], r;
                for (u.attribute("x").hasValue() ? (u.x = u.attribute("x").toPixels("x") + t.getAnchorDelta(n, i, r),
                u.attribute("dx").hasValue() && (u.x += u.attribute("dx").toPixels("x"))) : (u.attribute("dx").hasValue() && (t.x += u.attribute("dx").toPixels("x")),
                u.x = t.x),
                t.x = u.x + u.measureText(n),
                u.attribute("y").hasValue() ? (u.y = u.attribute("y").toPixels("y"),
                u.attribute("dy").hasValue() && (u.y += u.attribute("dy").toPixels("y"))) : (u.attribute("dy").hasValue() && (t.y += u.attribute("dy").toPixels("y")),
                u.y = t.y),
                t.y = u.y,
                u.render(n),
                r = 0; r < u.children.length; r++)
                    t.renderChild(n, t, u, r)
            }
        }
        ,
        f.Element.text.prototype = new f.Element.RenderedElementBase,
        f.Element.TextElementBase = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.getGlyph = function(n, t, i) {
                var u = t[i], r = null, f;
                return n.isArabic ? (f = "isolated",
                (i == 0 || t[i - 1] == " ") && i < t.length - 2 && t[i + 1] != " " && (f = "terminal"),
                i > 0 && t[i - 1] != " " && i < t.length - 2 && t[i + 1] != " " && (f = "medial"),
                i > 0 && t[i - 1] != " " && (i == t.length - 1 || t[i + 1] == " ") && (f = "initial"),
                typeof n.glyphs[u] != "undefined" && (r = n.glyphs[u][f],
                r == null && n.glyphs[u].type == "glyph" && (r = n.glyphs[u]))) : r = n.glyphs[u],
                r == null && (r = n.missingGlyph),
                r
            }
            ;
            this.renderChildren = function(n) {
                var t = this.parent.style("font-family").getDefinition(), e, i, s, r, c;
                if (t != null) {
                    var o = this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize)
                      , h = this.parent.style("font-style").valueOrDefault(f.Font.Parse(f.ctx.font).fontStyle)
                      , u = this.getText();
                    for (t.isRTL && (u = u.split("").reverse().join("")),
                    e = f.ToNumberArray(this.parent.attribute("dx").value),
                    i = 0; i < u.length; i++)
                        s = this.getGlyph(t, u, i),
                        r = o / t.fontFace.unitsPerEm,
                        n.translate(this.x, this.y),
                        n.scale(r, -r),
                        c = n.lineWidth,
                        n.lineWidth = n.lineWidth * t.fontFace.unitsPerEm / o,
                        h == "italic" && n.transform(1, 0, .4, 1, 0, 0),
                        s.render(n),
                        h == "italic" && n.transform(1, 0, -.4, 1, 0, 0),
                        n.lineWidth = c,
                        n.scale(1 / r, -1 / r),
                        n.translate(-this.x, -this.y),
                        this.x += o * (s.horizAdvX || t.horizAdvX) / t.fontFace.unitsPerEm,
                        typeof e[i] == "undefined" || isNaN(e[i]) || (this.x += e[i]);
                    return
                }
                n.fillStyle != "" && n.fillText(f.compressSpaces(this.getText()), this.x, this.y);
                n.strokeStyle != "" && n.strokeText(f.compressSpaces(this.getText()), this.x, this.y)
            }
            ;
            this.getText = function() {}
            ;
            this.measureTextRecursive = function(n) {
                for (var i = this.measureText(n), t = 0; t < this.children.length; t++)
                    i += this.children[t].measureTextRecursive(n);
                return i
            }
            ;
            this.measureText = function(n) {
                var i = this.parent.style("font-family").getDefinition(), u, t, s, o, h;
                if (i != null) {
                    var c = this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize)
                      , e = 0
                      , r = this.getText();
                    for (i.isRTL && (r = r.split("").reverse().join("")),
                    u = f.ToNumberArray(this.parent.attribute("dx").value),
                    t = 0; t < r.length; t++)
                        s = this.getGlyph(i, r, t),
                        e += (s.horizAdvX || i.horizAdvX) * c / i.fontFace.unitsPerEm,
                        typeof u[t] == "undefined" || isNaN(u[t]) || (e += u[t]);
                    return e
                }
                return (o = f.compressSpaces(this.getText()),
                !n.measureText) ? o.length * 10 : (n.save(),
                this.setContext(n),
                h = n.measureText(o).width,
                n.restore(),
                h)
            }
        }
        ,
        f.Element.TextElementBase.prototype = new f.Element.RenderedElementBase,
        f.Element.tspan = function(n) {
            this.captureTextNodes = !0;
            this.base = f.Element.TextElementBase;
            this.base(n);
            this.text = f.compressSpaces(n.value || n.text || n.textContent || "");
            this.getText = function() {
                return this.children.length > 0 ? "" : this.text
            }
        }
        ,
        f.Element.tspan.prototype = new f.Element.TextElementBase,
        f.Element.tref = function(n) {
            this.base = f.Element.TextElementBase;
            this.base(n);
            this.getText = function() {
                var n = this.getHrefAttribute().getDefinition();
                if (n != null)
                    return n.children[0].getText()
            }
        }
        ,
        f.Element.tref.prototype = new f.Element.TextElementBase,
        f.Element.a = function(n) {
            this.base = f.Element.TextElementBase;
            this.base(n);
            this.hasText = n.childNodes.length > 0;
            for (var t = 0; t < n.childNodes.length; t++)
                n.childNodes[t].nodeType != 3 && (this.hasText = !1);
            this.text = this.hasText ? n.childNodes[0].value : "";
            this.getText = function() {
                return this.text
            }
            ;
            this.baseRenderChildren = this.renderChildren;
            this.renderChildren = function(n) {
                var i, t;
                this.hasText ? (this.baseRenderChildren(n),
                i = new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize),
                f.Mouse.checkBoundingBox(this, new f.BoundingBox(this.x,this.y - i.toPixels("y"),this.x + this.measureText(n),this.y))) : this.children.length > 0 && (t = new f.Element.g,
                t.children = this.children,
                t.parent = this,
                t.render(n))
            }
            ;
            this.onclick = function() {
                window.open(this.getHrefAttribute().value)
            }
            ;
            this.onmousemove = function() {
                f.ctx.canvas.style.cursor = "pointer"
            }
        }
        ,
        f.Element.a.prototype = new f.Element.TextElementBase,
        f.Element.image = function(n) {
            var t, i, r;
            (this.base = f.Element.RenderedElementBase,
            this.base(n),
            t = this.getHrefAttribute().value,
            t != "") && (i = t.match(/\.svg$/),
            f.Images.push(this),
            this.loaded = !1,
            i ? (this.img = f.ajax(t),
            this.loaded = !0) : (this.img = document.createElement("img"),
            f.opts.useCORS == !0 && (this.img.crossOrigin = "Anonymous"),
            r = this,
            this.img.onload = function() {
                r.loaded = !0
            }
            ,
            this.img.onerror = function() {
                f.log('ERROR: image "' + t + '" not found');
                r.loaded = !0
            }
            ,
            this.img.src = t),
            this.renderChildren = function(n) {
                var u = this.attribute("x").toPixels("x")
                  , e = this.attribute("y").toPixels("y")
                  , t = this.attribute("width").toPixels("x")
                  , r = this.attribute("height").toPixels("y");
                t != 0 && r != 0 && (n.save(),
                i ? n.drawSvg(this.img, u, e, t, r) : (n.translate(u, e),
                f.AspectRatio(n, this.attribute("preserveAspectRatio").value, t, this.img.width, r, this.img.height, 0, 0),
                n.drawImage(this.img, 0, 0)),
                n.restore())
            }
            ,
            this.getBoundingBox = function() {
                var n = this.attribute("x").toPixels("x")
                  , t = this.attribute("y").toPixels("y")
                  , i = this.attribute("width").toPixels("x")
                  , r = this.attribute("height").toPixels("y");
                return new f.BoundingBox(n,t,n + i,t + r)
            }
            )
        }
        ,
        f.Element.image.prototype = new f.Element.RenderedElementBase,
        f.Element.g = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.getBoundingBox = function() {
                for (var t = new f.BoundingBox, n = 0; n < this.children.length; n++)
                    t.addBoundingBox(this.children[n].getBoundingBox());
                return t
            }
        }
        ,
        f.Element.g.prototype = new f.Element.RenderedElementBase,
        f.Element.symbol = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.render = function() {}
        }
        ,
        f.Element.symbol.prototype = new f.Element.RenderedElementBase,
        f.Element.style = function(n) {
            var i, c, t, l, r, h, u, g, o, e, v, tt;
            for (this.base = f.Element.ElementBase,
            this.base(n),
            i = "",
            t = 0; t < n.childNodes.length; t++)
                i += n.childNodes[t].data;
            for (i = i.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm, ""),
            i = f.compressSpaces(i),
            c = i.split("}"),
            t = 0; t < c.length; t++)
                if (f.trim(c[t]) != "") {
                    var b = c[t].split("{")
                      , k = b[0].split(",")
                      , s = b[1].split(";");
                    for (l = 0; l < k.length; l++)
                        if (r = f.trim(k[l]),
                        r != "") {
                            for (h = f.Styles[r] || {},
                            u = 0; u < s.length; u++) {
                                var y = s[u].indexOf(":")
                                  , p = s[u].substr(0, y)
                                  , d = s[u].substr(y + 1, s[u].length - y);
                                p != null && d != null && (h[f.trim(p)] = new f.Property(f.trim(p),f.trim(d)))
                            }
                            if (f.Styles[r] = h,
                            f.StylesSpecificity[r] = a(r),
                            r == "@font-face")
                                for (g = h["font-family"].value.replace(/"/g, ""),
                                o = h.src.value.split(","),
                                e = 0; e < o.length; e++)
                                    if (o[e].indexOf('format("svg")') > 0) {
                                        var w = o[e].indexOf("url")
                                          , it = o[e].indexOf(")", w)
                                          , rt = o[e].substr(w + 5, it - w - 6)
                                          , ut = f.parseXml(f.ajax(rt))
                                          , nt = ut.getElementsByTagName("font");
                                        for (v = 0; v < nt.length; v++)
                                            tt = f.CreateElement(nt[v]),
                                            f.Definitions[g] = tt
                                    }
                        }
                }
        }
        ,
        f.Element.style.prototype = new f.Element.ElementBase,
        f.Element.use = function(n) {
            this.base = f.Element.RenderedElementBase;
            this.base(n);
            this.baseSetContext = this.setContext;
            this.setContext = function(n) {
                this.baseSetContext(n);
                this.attribute("x").hasValue() && n.translate(this.attribute("x").toPixels("x"), 0);
                this.attribute("y").hasValue() && n.translate(0, this.attribute("y").toPixels("y"))
            }
            ;
            var t = this.getHrefAttribute().getDefinition();
            this.path = function(n) {
                t != null && t.path(n)
            }
            ;
            this.getBoundingBox = function() {
                if (t != null)
                    return t.getBoundingBox()
            }
            ;
            this.renderChildren = function(n) {
                var i, r;
                t != null && (i = t,
                t.type == "symbol" && (i = new f.Element.svg,
                i.type = "svg",
                i.attributes.viewBox = new f.Property("viewBox",t.attribute("viewBox").value),
                i.attributes.preserveAspectRatio = new f.Property("preserveAspectRatio",t.attribute("preserveAspectRatio").value),
                i.attributes.overflow = new f.Property("overflow",t.attribute("overflow").value),
                i.children = t.children),
                i.type == "svg" && (this.attribute("width").hasValue() && (i.attributes.width = new f.Property("width",this.attribute("width").value)),
                this.attribute("height").hasValue() && (i.attributes.height = new f.Property("height",this.attribute("height").value))),
                r = i.parent,
                i.parent = null,
                i.render(n),
                i.parent = r)
            }
        }
        ,
        f.Element.use.prototype = new f.Element.RenderedElementBase,
        f.Element.mask = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.apply = function(n, t) {
                var h = this.attribute("x").toPixels("x"), c = this.attribute("y").toPixels("y"), u = this.attribute("width").toPixels("x"), e = this.attribute("height").toPixels("y"), i, l, v, o, a, s, r;
                if (u == 0 && e == 0) {
                    for (i = new f.BoundingBox,
                    l = 0; l < this.children.length; l++)
                        i.addBoundingBox(this.children[l].getBoundingBox());
                    var h = Math.floor(i.x1)
                      , c = Math.floor(i.y1)
                      , u = Math.floor(i.width())
                      , e = Math.floor(i.height())
                }
                v = t.attribute("mask").value;
                t.attribute("mask").value = "";
                o = document.createElement("canvas");
                o.width = h + u;
                o.height = c + e;
                a = o.getContext("2d");
                this.renderChildren(a);
                s = document.createElement("canvas");
                s.width = h + u;
                s.height = c + e;
                r = s.getContext("2d");
                t.render(r);
                r.globalCompositeOperation = "destination-in";
                r.fillStyle = a.createPattern(o, "no-repeat");
                r.fillRect(0, 0, h + u, c + e);
                n.fillStyle = r.createPattern(s, "no-repeat");
                n.fillRect(0, 0, h + u, c + e);
                t.attribute("mask").value = v
            }
            ;
            this.render = function() {}
        }
        ,
        f.Element.mask.prototype = new f.Element.ElementBase,
        f.Element.clipPath = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.apply = function(n) {
                var e = CanvasRenderingContext2D.prototype.beginPath, r, u, t, i;
                for (CanvasRenderingContext2D.prototype.beginPath = function() {}
                ,
                r = CanvasRenderingContext2D.prototype.closePath,
                CanvasRenderingContext2D.prototype.closePath = function() {}
                ,
                e.call(n),
                u = 0; u < this.children.length; u++)
                    t = this.children[u],
                    typeof t.path != "undefined" && (i = null,
                    t.style("transform", !1, !0).hasValue() && (i = new f.Transform(t.style("transform", !1, !0).value),
                    i.apply(n)),
                    t.path(n),
                    CanvasRenderingContext2D.prototype.closePath = r,
                    i && i.unapply(n));
                r.call(n);
                n.clip();
                CanvasRenderingContext2D.prototype.beginPath = e;
                CanvasRenderingContext2D.prototype.closePath = r
            }
            ;
            this.render = function() {}
        }
        ,
        f.Element.clipPath.prototype = new f.Element.ElementBase,
        f.Element.filter = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.apply = function(n, t) {
                var e = t.getBoundingBox(), l = Math.floor(e.x1), a = Math.floor(e.y1), o = Math.floor(e.width()), s = Math.floor(e.height()), v = t.style("filter").value, i, r, c, f, h, u;
                for (t.style("filter").value = "",
                i = 0,
                r = 0,
                u = 0; u < this.children.length; u++)
                    c = this.children[u].extraFilterDistance || 0,
                    i = Math.max(i, c),
                    r = Math.max(r, c);
                for (f = document.createElement("canvas"),
                f.width = o + 2 * i,
                f.height = s + 2 * r,
                h = f.getContext("2d"),
                h.translate(-l + i, -a + r),
                t.render(h),
                u = 0; u < this.children.length; u++)
                    typeof this.children[u].apply == "function" && this.children[u].apply(h, 0, 0, o + 2 * i, s + 2 * r);
                n.drawImage(f, 0, 0, o + 2 * i, s + 2 * r, l - i, a - r, o + 2 * i, s + 2 * r);
                t.style("filter", !0).value = v
            }
            ;
            this.render = function() {}
        }
        ,
        f.Element.filter.prototype = new f.Element.ElementBase,
        f.Element.feMorphology = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.apply = function() {}
        }
        ,
        f.Element.feMorphology.prototype = new f.Element.ElementBase,
        f.Element.feComposite = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.apply = function() {}
        }
        ,
        f.Element.feComposite.prototype = new f.Element.ElementBase,
        f.Element.feColorMatrix = function(n) {
            function e(n, t, i, r, u, f) {
                return n[i * r * 4 + t * 4 + f]
            }
            function o(n, t, i, r, u, f, e) {
                n[i * r * 4 + t * 4 + f] = e
            }
            function t(n, t) {
                var i = u[n];
                return i * (i < 0 ? t - 255 : t)
            }
            var u, i, s, r;
            this.base = f.Element.ElementBase;
            this.base(n);
            u = f.ToNumberArray(this.attribute("values").value);
            switch (this.attribute("type").valueOrDefault("matrix")) {
            case "saturate":
                i = u[0];
                u = [.213 + .787 * i, .715 - .715 * i, .072 - .072 * i, 0, 0, .213 - .213 * i, .715 + .285 * i, .072 - .072 * i, 0, 0, .213 - .213 * i, .715 - .715 * i, .072 + .928 * i, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];
                break;
            case "hueRotate":
                s = u[0] * Math.PI / 180;
                r = function(n, t, i) {
                    return n + Math.cos(s) * t + Math.sin(s) * i
                }
                ;
                u = [r(.213, .787, -.213), r(.715, -.715, -.715), r(.072, -.072, .928), 0, 0, r(.213, -.213, .143), r(.715, .285, .14), r(.072, -.072, -.283), 0, 0, r(.213, -.213, -.787), r(.715, -.715, .715), r(.072, .928, .072), 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1];
                break;
            case "luminanceToAlpha":
                u = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, .2125, .7154, .0721, 0, 0, 0, 0, 0, 0, 1]
            }
            this.apply = function(n, i, r, u, f) {
                for (var i, s = n.getImageData(0, 0, u, f), r = 0; r < f; r++)
                    for (i = 0; i < u; i++) {
                        var h = e(s.data, i, r, u, f, 0)
                          , c = e(s.data, i, r, u, f, 1)
                          , l = e(s.data, i, r, u, f, 2)
                          , a = e(s.data, i, r, u, f, 3);
                        o(s.data, i, r, u, f, 0, t(0, h) + t(1, c) + t(2, l) + t(3, a) + t(4, 1));
                        o(s.data, i, r, u, f, 1, t(5, h) + t(6, c) + t(7, l) + t(8, a) + t(9, 1));
                        o(s.data, i, r, u, f, 2, t(10, h) + t(11, c) + t(12, l) + t(13, a) + t(14, 1));
                        o(s.data, i, r, u, f, 3, t(15, h) + t(16, c) + t(17, l) + t(18, a) + t(19, 1))
                    }
                n.clearRect(0, 0, u, f);
                n.putImageData(s, 0, 0)
            }
        }
        ,
        f.Element.feColorMatrix.prototype = new f.Element.ElementBase,
        f.Element.feGaussianBlur = function(n) {
            this.base = f.Element.ElementBase;
            this.base(n);
            this.blurRadius = Math.floor(this.attribute("stdDeviation").numValue());
            this.extraFilterDistance = this.blurRadius;
            this.apply = function(n, i, r, u, e) {
                if (typeof t.canvasRGBA == "undefined") {
                    f.log("ERROR: StackBlur.js must be included for blur to work");
                    return
                }
                n.canvas.id = f.UniqueId();
                n.canvas.style.display = "none";
                document.body.appendChild(n.canvas);
                t.canvasRGBA(n.canvas.id, i, r, u, e, this.blurRadius);
                document.body.removeChild(n.canvas)
            }
        }
        ,
        f.Element.feGaussianBlur.prototype = new f.Element.ElementBase,
        f.Element.title = function() {}
        ,
        f.Element.title.prototype = new f.Element.ElementBase,
        f.Element.desc = function() {}
        ,
        f.Element.desc.prototype = new f.Element.ElementBase,
        f.Element.MISSING = function(n) {
            f.log("ERROR: Element '" + n.nodeName + "' not yet implemented.")
        }
        ,
        f.Element.MISSING.prototype = new f.Element.ElementBase,
        f.CreateElement = function(n) {
            var t = n.nodeName.replace(/^[^:]+:/, ""), i;
            return t = t.replace(/\-/g, ""),
            i = null,
            i = typeof f.Element[t] != "undefined" ? new f.Element[t](n) : new f.Element.MISSING(n),
            i.type = n.nodeName,
            i
        }
        ,
        f.load = function(n, t) {
            f.loadXml(n, f.ajax(t))
        }
        ,
        f.loadXml = function(n, t) {
            f.loadXmlDoc(n, f.parseXml(t))
        }
        ,
        f.loadXmlDoc = function(n, t) {
            f.loadXmlNode(n, t.documentElement)
        }
        ,
        f.loadXmlNode = function(n, t) {
            var r, i;
            f.init(n);
            r = function(t) {
                for (var i = n.canvas; i; )
                    t.x -= i.offsetLeft,
                    t.y -= i.offsetTop,
                    i = i.offsetParent;
                return window.scrollX && (t.x += window.scrollX),
                window.scrollY && (t.y += window.scrollY),
                t
            }
            ;
            f.opts.ignoreMouse != !0 && (n.canvas.onclick = function(n) {
                var t = r(new f.Point(n != null ? n.clientX : event.clientX,n != null ? n.clientY : event.clientY));
                f.Mouse.onclick(t.x, t.y)
            }
            ,
            n.canvas.onmousemove = function(n) {
                var t = r(new f.Point(n != null ? n.clientX : event.clientX,n != null ? n.clientY : event.clientY));
                f.Mouse.onmousemove(t.x, t.y)
            }
            );
            i = f.CreateElement(t);
            i.root = !0;
            i.addStylesFromStyleDefinition();
            var e = !0
              , o = function() {
                var o, s;
                if (f.ViewPort.Clear(),
                n.canvas.parentNode && f.ViewPort.SetCurrent(n.canvas.parentNode.clientWidth, n.canvas.parentNode.clientHeight),
                f.opts.ignoreDimensions != !0 && (i.style("width").hasValue() && (n.canvas.width = i.style("width").toPixels("x"),
                n.canvas.style.width = n.canvas.width + "px"),
                i.style("height").hasValue() && (n.canvas.height = i.style("height").toPixels("y"),
                n.canvas.style.height = n.canvas.height + "px")),
                o = n.canvas.clientWidth || n.canvas.width,
                s = n.canvas.clientHeight || n.canvas.height,
                f.opts.ignoreDimensions == !0 && i.style("width").hasValue() && i.style("height").hasValue() && (o = i.style("width").toPixels("x"),
                s = i.style("height").toPixels("y")),
                f.ViewPort.SetCurrent(o, s),
                f.opts.offsetX != null && (i.attribute("x", !0).value = f.opts.offsetX),
                f.opts.offsetY != null && (i.attribute("y", !0).value = f.opts.offsetY),
                f.opts.scaleWidth != null || f.opts.scaleHeight != null) {
                    var r = null
                      , u = null
                      , h = f.ToNumberArray(i.attribute("viewBox").value);
                    f.opts.scaleWidth != null && (i.attribute("width").hasValue() ? r = i.attribute("width").toPixels("x") / f.opts.scaleWidth : isNaN(h[2]) || (r = h[2] / f.opts.scaleWidth));
                    f.opts.scaleHeight != null && (i.attribute("height").hasValue() ? u = i.attribute("height").toPixels("y") / f.opts.scaleHeight : isNaN(h[3]) || (u = h[3] / f.opts.scaleHeight));
                    r == null && (r = u);
                    u == null && (u = r);
                    i.attribute("width", !0).value = f.opts.scaleWidth;
                    i.attribute("height", !0).value = f.opts.scaleHeight;
                    i.style("transform", !0, !0).value += " scale(" + 1 / r + "," + 1 / u + ")"
                }
                f.opts.ignoreClear != !0 && n.clearRect(0, 0, o, s);
                i.render(n);
                e && (e = !1,
                typeof f.opts.renderCallback == "function" && f.opts.renderCallback(t))
            }
              , u = !0;
            f.ImagesLoaded() && (u = !1,
            o());
            f.intervalID = setInterval(function() {
                var n = !1, t;
                if (u && f.ImagesLoaded() && (u = !1,
                n = !0),
                f.opts.ignoreMouse != !0 && (n = n | f.Mouse.hasEvents()),
                f.opts.ignoreAnimation != !0)
                    for (t = 0; t < f.Animations.length; t++)
                        n = n | f.Animations[t].update(1e3 / f.FRAMERATE);
                typeof f.opts.forceRedraw == "function" && f.opts.forceRedraw() == !0 && (n = !0);
                n && (o(),
                f.Mouse.runEvents())
            }, 1e3 / f.FRAMERATE)
        }
        ,
        f.stop = function() {
            f.intervalID && clearInterval(f.intervalID)
        }
        ,
        f.Mouse = new function() {
            this.events = [];
            this.hasEvents = function() {
                return this.events.length != 0
            }
            ;
            this.onclick = function(n, t) {
                this.events.push({
                    type: "onclick",
                    x: n,
                    y: t,
                    run: function(n) {
                        n.onclick && n.onclick()
                    }
                })
            }
            ;
            this.onmousemove = function(n, t) {
                this.events.push({
                    type: "onmousemove",
                    x: n,
                    y: t,
                    run: function(n) {
                        n.onmousemove && n.onmousemove()
                    }
                })
            }
            ;
            this.eventElements = [];
            this.checkPath = function(n, t) {
                for (var r, i = 0; i < this.events.length; i++)
                    r = this.events[i],
                    t.isPointInPath && t.isPointInPath(r.x, r.y) && (this.eventElements[i] = n)
            }
            ;
            this.checkBoundingBox = function(n, t) {
                for (var r, i = 0; i < this.events.length; i++)
                    r = this.events[i],
                    t.isPointInBox(r.x, r.y) && (this.eventElements[i] = n)
            }
            ;
            this.runEvents = function() {
                var n, i, t;
                for (f.ctx.canvas.style.cursor = "",
                n = 0; n < this.events.length; n++)
                    for (i = this.events[n],
                    t = this.eventElements[n]; t; )
                        i.run(t),
                        t = t.parent;
                this.events = [];
                this.eventElements = []
            }
        }
        ,
        f
    }
    var u = function(n, t, i) {
        var h, s, r, e, c, f, o;
        if (n == null && t == null && i == null) {
            for (h = document.querySelectorAll("svg"),
            s = 0; s < h.length; s++)
                r = h[s],
                e = document.createElement("canvas"),
                e.width = r.clientWidth,
                e.height = r.clientHeight,
                r.parentNode.insertBefore(e, r),
                r.parentNode.removeChild(r),
                c = document.createElement("div"),
                c.appendChild(r),
                u(e, c.innerHTML);
            return
        }
        typeof n == "string" && (n = document.getElementById(n));
        n.svg != null && n.svg.stop();
        f = v(i || {});
        n.childNodes.length == 1 && n.childNodes[0].nodeName == "OBJECT" || (n.svg = f);
        o = n.getContext("2d");
        typeof t.documentElement != "undefined" ? f.loadXmlDoc(o, t) : typeof t.ownerDocument != "undefined" ? f.loadXmlNode(o, t) : t.substr(0, 1) == "<" ? f.loadXml(o, t) : f.load(o, t)
    }, r;
    typeof Element.prototype.matches != "undefined" ? r = function(n, t) {
        return n.matches(t)
    }
    : typeof Element.prototype.webkitMatchesSelector != "undefined" ? r = function(n, t) {
        return n.webkitMatchesSelector(t)
    }
    : typeof Element.prototype.mozMatchesSelector != "undefined" ? r = function(n, t) {
        return n.mozMatchesSelector(t)
    }
    : typeof Element.prototype.msMatchesSelector != "undefined" ? r = function(n, t) {
        return n.msMatchesSelector(t)
    }
    : typeof Element.prototype.oMatchesSelector != "undefined" ? r = function(n, t) {
        return n.oMatchesSelector(t)
    }
    : ((typeof jQuery == "function" || typeof Zepto == "function") && (r = function(n, t) {
        return $(n).is(t)
    }
    ),
    typeof r == "undefined" && (r = Sizzle.matchesSelector));
    var f = /(\[[^\]]+\])/g
      , e = /(#[^\s\+>~\.\[:]+)/g
      , o = /(\.[^\s\+>~\.\[:]+)/g
      , s = /(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi
      , h = /(:[\w-]+\([^\)]*\))/gi
      , c = /(:[^\s\+>~\.\[:]+)/g
      , l = /([^\s\+>~\.\[:]+)/g;
    return typeof CanvasRenderingContext2D != "undefined" && (CanvasRenderingContext2D.prototype.drawSvg = function(n, t, i, r, f, e) {
        var s = {
            ignoreMouse: !0,
            ignoreAnimation: !0,
            ignoreDimensions: !0,
            ignoreClear: !0,
            offsetX: t,
            offsetY: i,
            scaleWidth: r,
            scaleHeight: f
        };
        for (var o in e)
            e.hasOwnProperty(o) && (s[o] = e[o]);
        u(this.canvas, n, s)
    }
    ),
    u
})
